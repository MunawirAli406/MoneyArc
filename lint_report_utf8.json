[{"filePath":"M:\\Projects\\MoneyArc\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\components\\layout\\GoToSearch.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nM:\\Projects\\MoneyArc\\src\\components\\layout\\GoToSearch.tsx:69:13\n  67 |         if (isOpen) {\n  68 |             inputRef.current?.focus();\n> 69 |             setSelectedIndex(0);\n     |             ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  70 |         }\n  71 |     }, [isOpen]);\n  72 |","line":69,"column":13,"nodeType":null,"endLine":69,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Search, Command, FileText, Wallet, BookOpen, Settings, LayoutDashboard, ChevronRight, Package } from 'lucide-react';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport type { Ledger } from '../../services/accounting/ReportService';\r\nimport type { StockItem } from '../../services/inventory/types';\r\n\r\nconst STATIC_ITEMS = [\r\n    { label: 'Dashboard', path: '/dashboard', icon: LayoutDashboard },\r\n    { label: 'Voucher Entry', path: '/vouchers/new', icon: Wallet },\r\n    { label: 'Chart of Accounts', path: '/ledgers', icon: BookOpen },\r\n    { label: 'Daybook', path: '/reports/daybook', icon: BookOpen },\r\n    { label: 'Balance Sheet', path: '/reports/balance-sheet', icon: FileText },\r\n    { label: 'Profit & Loss', path: '/reports/profit-loss', icon: FileText },\r\n    { label: 'GSTR-1 Report', path: '/reports/gst/r1', icon: FileText },\r\n    { label: 'GSTR-3B Summary', path: '/reports/gst/r3b', icon: FileText },\r\n    { label: 'Ratio Analysis', path: '/reports/ratios', icon: FileText },\r\n    { label: 'Audit Trail', path: '/security/audit', icon: Search },\r\n    { label: 'GST Overview', path: '/reports/gst', icon: FileText },\r\n    { label: 'Cash Flow', path: '/reports/cash-flow', icon: Wallet },\r\n    { label: 'Fund Flow', path: '/reports/fund-flow', icon: FileText },\r\n    { label: 'Settings', path: '/settings', icon: Settings },\r\n    { label: 'Stock Items', path: '/inventory/items', icon: Package },\r\n    { label: 'Stock Groups', path: '/inventory/groups', icon: Package },\r\n    { label: 'Units of Measure', path: '/inventory/units', icon: Package },\r\n];\r\n\r\nexport default function GoToSearch() {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [query, setQuery] = useState('');\r\n    const [ledgers, setLedgers] = useState<Ledger[]>([]);\r\n    const [stockItems, setStockItems] = useState<StockItem[]>([]);\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n    const { provider, activeCompany } = usePersistence();\r\n    const navigate = useNavigate();\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n    useEffect(() => {\r\n        const loadDocs = async () => {\r\n            if (provider && activeCompany) {\r\n                const [ledgerData, itemData] = await Promise.all([\r\n                    provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                    provider.read<StockItem[]>('stock_items.json', activeCompany.path)\r\n                ]);\r\n                setLedgers(ledgerData || []);\r\n                setStockItems(itemData || []);\r\n            }\r\n        };\r\n        loadDocs();\r\n    }, [provider, activeCompany]);\r\n\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if ((e.metaKey || e.ctrlKey) && e.key === 'g') {\r\n                e.preventDefault();\r\n                setIsOpen(true);\r\n            }\r\n            if (e.key === 'Escape') {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            inputRef.current?.focus();\r\n            setSelectedIndex(0);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    const filteredItems = [\r\n        ...STATIC_ITEMS.map(i => ({ ...i, type: 'Page' })),\r\n        ...ledgers.map((l: Ledger) => ({\r\n            label: `Ledger: ${l.name}`,\r\n            path: `/ledgers/${l.id}`,\r\n            icon: BookOpen,\r\n            type: 'Ledger'\r\n        })),\r\n        ...stockItems.map((i: StockItem) => ({\r\n            label: `Item: ${i.name}`,\r\n            path: `/inventory/items/${i.id}`,\r\n            icon: Package,\r\n            type: 'Inventory'\r\n        }))\r\n    ].filter(item =>\r\n        item.label.toLowerCase().includes(query.toLowerCase())\r\n    ).slice(0, 10);\r\n\r\n    const handleSelect = (path: string) => {\r\n        navigate(path);\r\n        setIsOpen(false);\r\n        setQuery('');\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'ArrowDown') {\r\n            e.preventDefault();\r\n            setSelectedIndex((prev: number) => (prev + 1) % filteredItems.length);\r\n        } else if (e.key === 'ArrowUp') {\r\n            e.preventDefault();\r\n            setSelectedIndex((prev: number) => (prev - 1 + filteredItems.length) % filteredItems.length);\r\n        } else if (e.key === 'Enter') {\r\n            if (filteredItems[selectedIndex]) {\r\n                handleSelect(filteredItems[selectedIndex].path);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div className=\"relative w-64 hidden md:block\">\r\n                <Search className=\"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\" />\r\n                <input\r\n                    type=\"text\"\r\n                    placeholder=\"Go To... (Ctrl+G)\"\r\n                    onFocus={() => setIsOpen(true)}\r\n                    className=\"w-full pl-9 pr-4 py-2 text-sm bg-background border border-input rounded-xl focus:outline-none focus:ring-2 focus:ring-primary font-medium cursor-pointer\"\r\n                    readOnly\r\n                />\r\n            </div>\r\n\r\n            {isOpen && (\r\n                <div className=\"fixed inset-0 z-50 flex items-start justify-center pt-20 px-4 bg-background/80 backdrop-blur-sm animate-in fade-in duration-200\">\r\n                    <div className=\"fixed inset-0\" onClick={() => setIsOpen(false)} />\r\n\r\n                    <div className=\"relative w-full max-w-2xl bg-card border border-border rounded-3xl shadow-2xl overflow-hidden animate-in slide-in-from-top-4 duration-300\">\r\n                        <div className=\"p-6 border-b border-border bg-muted/30\">\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <Command className=\"w-5 h-5 text-primary\" />\r\n                                <input\r\n                                    ref={inputRef}\r\n                                    type=\"text\"\r\n                                    placeholder=\"Where would you like to go?\"\r\n                                    value={query}\r\n                                    onChange={(e) => setQuery(e.target.value)}\r\n                                    onKeyDown={handleKeyDown}\r\n                                    className=\"flex-1 bg-transparent border-none outline-none text-lg font-bold placeholder:text-muted-foreground\"\r\n                                />\r\n                                <div className=\"px-2 py-1 rounded-lg bg-background border border-border text-[10px] font-black uppercase text-muted-foreground\">\r\n                                    ESC to close\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"max-h-[400px] overflow-y-auto p-2\">\r\n                            {filteredItems.length > 0 ? (\r\n                                filteredItems.map((item, index) => (\r\n                                    <button\r\n                                        key={item.path + index}\r\n                                        onClick={() => handleSelect(item.path)}\r\n                                        onMouseEnter={() => setSelectedIndex(index)}\r\n                                        className={`w-full flex items-center justify-between p-4 rounded-2xl transition-all ${index === selectedIndex ? 'bg-primary text-primary-foreground shadow-lg shadow-primary/20' : 'hover:bg-muted'\r\n                                            }`}\r\n                                    >\r\n                                        <div className=\"flex items-center gap-4\">\r\n                                            <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${index === selectedIndex ? 'bg-white/20' : 'bg-primary/10 text-primary'\r\n                                                }`}>\r\n                                                <item.icon className=\"w-5 h-5\" />\r\n                                            </div>\r\n                                            <div className=\"text-left\">\r\n                                                <p className=\"font-bold\">{item.label}</p>\r\n                                                <p className={`text-[10px] font-black uppercase tracking-widest ${index === selectedIndex ? 'text-white/60' : 'text-muted-foreground'\r\n                                                    }`}>\r\n                                                    {item.type}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                        <ChevronRight className={`w-5 h-5 ${index === selectedIndex ? 'opacity-100' : 'opacity-20'}`} />\r\n                                    </button>\r\n                                ))\r\n                            ) : (\r\n                                <div className=\"p-12 text-center text-muted-foreground\">\r\n                                    <p className=\"font-bold\">No results for \"{query}\"</p>\r\n                                    <p className=\"text-sm\">Try searching for a report or ledger name.</p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"p-4 border-t border-border bg-muted/10 flex items-center gap-6 justify-center\">\r\n                            <div className=\"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-muted-foreground\">\r\n                                <span className=\"px-1.5 py-0.5 rounded border border-border bg-background\">ENTER</span> Select\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-muted-foreground\">\r\n                                <span className=\"px-1.5 py-0.5 rounded border border-border bg-background\">ΓåæΓåô</span> Navigate\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\components\\layout\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\components\\layout\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\components\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\accounting\\masters\\LedgerForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\accounting\\masters\\LedgerList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\accounting\\reports\\Daybook.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":162,"column":74,"nodeType":"Identifier","messageId":"unusedVar","endLine":162,"endColumn":77}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { usePersistence } from '../../../services/persistence/PersistenceContext';\r\nimport { ExportService } from '../../../services/reports/ExportService';\r\nimport { VoucherService, type Voucher } from '../../../services/accounting/VoucherService';\r\nimport { Calendar, FileDown, Printer, Edit, Trash2 } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport InvoiceModal from '../vouchers/InvoiceModal';\r\nimport type { Ledger } from '../../../services/accounting/ReportService';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport default function Daybook() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const navigate = useNavigate();\r\n    const [vouchers, setVouchers] = useState<Voucher[]>([]);\r\n    const [ledgers, setLedgers] = useState<Ledger[]>([]);\r\n    const [selectedVoucher, setSelectedVoucher] = useState<Voucher | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (!provider || !activeCompany) {\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const [vData, lData] = await Promise.all([\r\n                    provider.read<Voucher[]>('vouchers.json', activeCompany.path),\r\n                    provider.read<Ledger[]>('ledgers.json', activeCompany.path)\r\n                ]);\r\n\r\n                const sorted = (vData || []).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n\r\n                setVouchers(sorted);\r\n                setLedgers(lData || []);\r\n            } catch (err) {\r\n                console.error(\"Failed to load Daybook data\", err);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        loadData();\r\n    }, [provider, activeCompany]);\r\n\r\n    const handleExport = () => {\r\n        const rows = vouchers.map(v => {\r\n            const amount = v.rows.reduce((sum, r) => sum + (r.type === 'Dr' ? r.debit : 0), 0);\r\n            return [\r\n                new Date(v.date).toLocaleDateString(),\r\n                v.rows[0]?.account || 'Journal Entry',\r\n                `${v.type} #${v.voucherNo}`,\r\n                amount.toFixed(2),\r\n                amount.toFixed(2)\r\n            ];\r\n        });\r\n        ExportService.exportToPDF('Daybook', ['Date', 'Particulars', 'Voucher', 'Debit', 'Credit'], rows, activeCompany);\r\n    };\r\n\r\n    if (loading) return (\r\n        <div className=\"flex items-center justify-center p-12\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"space-y-8 max-w-7xl mx-auto pb-12\"\r\n        >\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-foreground tracking-tight\">Daybook</h1>\r\n                    <p className=\"text-muted-foreground font-medium\">Chronological record of transactions for {activeCompany?.name}</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <button\r\n                        onClick={handleExport}\r\n                        className=\"flex items-center gap-2 px-6 py-2.5 bg-card border border-border rounded-xl text-xs font-black uppercase tracking-widest hover:bg-muted transition-all\"\r\n                    >\r\n                        <FileDown className=\"w-4 h-4\" />\r\n                        Export PDF\r\n                    </button>\r\n                    <div className=\"relative group\">\r\n                        <Calendar className=\"w-4 h-4 text-muted-foreground absolute left-3.5 top-1/2 -translate-y-1/2 group-focus-within:text-primary transition-colors\" />\r\n                        <input\r\n                            type=\"date\"\r\n                            value={selectedDate}\r\n                            onChange={(e) => setSelectedDate(e.target.value)}\r\n                            className=\"pl-10 pr-4 py-2.5 bg-card border border-border rounded-xl text-sm font-bold focus:ring-2 focus:ring-primary outline-none transition-all\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-card rounded-3xl shadow-sm border border-border overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left text-sm\">\r\n                        <thead className=\"bg-muted/50 text-muted-foreground font-black uppercase tracking-widest text-[10px] border-b border-border\">\r\n                            <tr>\r\n                                <th className=\"px-8 py-4\">Date / Period</th>\r\n                                <th className=\"px-8 py-4\">Particulars & Narration</th>\r\n                                <th className=\"px-8 py-4\">Voucher Info</th>\r\n                                <th className=\"px-8 py-4 text-right\">Debit Balance</th>\r\n                                <th className=\"px-8 py-4 text-right\">Credit Balance</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border/50\">\r\n                            {vouchers.map((v) => {\r\n                                const amount = v.rows.reduce((sum, r) => sum + (r.type === 'Dr' ? r.debit : 0), 0);\r\n\r\n                                return (\r\n                                    <tr key={v.id} className=\"hover:bg-muted/10 transition-colors cursor-pointer group\">\r\n                                        <td className=\"px-8 py-5\">\r\n                                            <div className=\"text-foreground font-bold\">{new Date(v.date).toLocaleDateString()}</div>\r\n                                            <div className=\"text-[10px] text-muted-foreground uppercase font-black tracking-widest mt-0.5\">Authorized</div>\r\n                                        </td>\r\n                                        <td className=\"px-8 py-5\">\r\n                                            <div className=\"font-bold text-foreground group-hover:text-primary transition-colors\">{v.rows[0]?.account || 'Journal Entry'}</div>\r\n                                            <div className=\"text-xs text-muted-foreground font-medium mt-1 line-clamp-1\">{v.narration || 'No narrative provided'}</div>\r\n                                        </td>\r\n                                        <td className=\"px-8 py-5\">\r\n                                            <span className=\"px-2.5 py-1 rounded-lg bg-muted text-[10px] font-black uppercase tracking-wider text-muted-foreground group-hover:bg-primary/10 group-hover:text-primary transition-colors\">\r\n                                                {v.type} #{v.voucherNo}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-8 py-5 text-right font-mono font-bold text-foreground\">{amount.toLocaleString(undefined, { minimumFractionDigits: 2 })}</td>\r\n                                        <td className=\"px-8 py-5 text-right font-mono font-bold text-foreground\">\r\n                                            <div className=\"flex items-center justify-end gap-2\">\r\n                                                <span>{amount.toLocaleString(undefined, { minimumFractionDigits: 2 })}</span>\r\n                                                <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-all ml-4\">\r\n                                                    {v.type === 'Sales' && (\r\n                                                        <button\r\n                                                            onClick={(e) => {\r\n                                                                e.stopPropagation();\r\n                                                                setSelectedVoucher(v);\r\n                                                            }}\r\n                                                            className=\"p-2 hover:bg-primary/10 text-primary rounded-lg\"\r\n                                                            title=\"Print Invoice\"\r\n                                                        >\r\n                                                            <Printer className=\"w-4 h-4\" />\r\n                                                        </button>\r\n                                                    )}\r\n                                                    <button\r\n                                                        onClick={(e) => {\r\n                                                            e.stopPropagation();\r\n                                                            navigate(`/vouchers/edit/${v.id}`);\r\n                                                        }}\r\n                                                        className=\"p-2 hover:bg-indigo-500/10 text-indigo-500 rounded-lg\"\r\n                                                        title=\"Edit Voucher\"\r\n                                                    >\r\n                                                        <Edit className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={async (e) => {\r\n                                                            e.stopPropagation();\r\n                                                            if (confirm(\"Are you sure you want to delete this voucher? This will reverse all ledger and inventory impacts.\")) {\r\n                                                                try {\r\n                                                                    await VoucherService.deleteVoucher(provider!, v.id, activeCompany!.path);\r\n                                                                    setVouchers(prev => prev.filter(item => item.id !== v.id));\r\n                                                                } catch (err) {\r\n                                                                    alert(\"Failed to delete voucher.\");\r\n                                                                }\r\n                                                            }\r\n                                                        }}\r\n                                                        className=\"p-2 hover:bg-rose-500/10 text-rose-500 rounded-lg\"\r\n                                                        title=\"Delete Voucher\"\r\n                                                    >\r\n                                                        <Trash2 className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                );\r\n                            })}\r\n                            {vouchers.length === 0 && (\r\n                                <tr>\r\n                                    <td colSpan={5} className=\"px-8 py-20 text-center space-y-4\">\r\n                                        <div className=\"w-16 h-16 bg-muted rounded-2xl flex items-center justify-center mx-auto text-muted-foreground\">\r\n                                            <Calendar className=\"w-8 h-8\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h3 className=\"text-lg font-bold\">No transactions found</h3>\r\n                                            <p className=\"text-muted-foreground text-sm\">We couldn't find any vouchers for the selected period.</p>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n            <AnimatePresence>\r\n                {selectedVoucher && activeCompany && (\r\n                    <InvoiceModal\r\n                        voucher={selectedVoucher}\r\n                        company={activeCompany}\r\n                        customer={ledgers.find(l => l.name === selectedVoucher.rows.find(r => r.type === 'Dr')?.account) || { name: 'Cash', gstin: '', address: '', balance: 0, type: 'Dr', id: 'cash', group: 'Cash-in-hand', isGstEnabled: false }}\r\n                        onClose={() => setSelectedVoucher(null)}\r\n                    />\r\n                )}\r\n            </AnimatePresence>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\accounting\\vouchers\\InvoiceModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[700,703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[700,703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[809,812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[809,812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[906,909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[906,909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1001,1004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1001,1004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7020,7023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7020,7023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":118,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":121,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7086,7089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7086,7089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRef } from 'react';\r\nimport { Printer, X } from 'lucide-react';\r\nimport type { Voucher } from '../../../services/accounting/VoucherService';\r\nimport type { Company } from '../../../services/persistence/types';\r\nimport type { Ledger } from '../../../services/accounting/ReportService';\r\n\r\ninterface InvoiceModalProps {\r\n    voucher: Voucher;\r\n    company: Company;\r\n    customer: Ledger;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function InvoiceModal({ voucher, company, customer, onClose }: InvoiceModalProps) {\r\n    const printRef = useRef<HTMLDivElement>(null);\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    const taxableValue = voucher.rows.find((r: any) => r.type === 'Cr' && !r.account.includes('GST'))?.credit || 0;\r\n    const cgst = voucher.rows.find((r: any) => r.account.includes('Central GST'))?.credit || 0;\r\n    const sgst = voucher.rows.find((r: any) => r.account.includes('State GST'))?.credit || 0;\r\n    const igst = voucher.rows.find((r: any) => r.account.includes('Integrated GST'))?.credit || 0;\r\n    const totalAmount = taxableValue + cgst + sgst + igst;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4\">\r\n            <div className=\"bg-white text-slate-900 w-full max-w-4xl h-[90vh] overflow-y-auto rounded-3xl shadow-2xl flex flex-col no-print-modal\">\r\n                {/* Modal Toolbar */}\r\n                <div className=\"p-6 border-b border-slate-100 flex items-center justify-between bg-white sticky top-0 z-10\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <h2 className=\"text-xl font-black uppercase tracking-tight\">Tax Invoice Preview</h2>\r\n                        <span className=\"px-3 py-1 bg-emerald-100 text-emerald-700 text-[10px] font-black rounded-full uppercase\">{voucher.voucherNo}</span>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                        <button\r\n                            onClick={handlePrint}\r\n                            className=\"flex items-center gap-2 px-5 py-2.5 bg-slate-900 text-white rounded-xl text-xs font-black uppercase tracking-widest hover:bg-slate-800 transition-all shadow-lg shadow-slate-900/10\"\r\n                        >\r\n                            <Printer className=\"w-4 h-4\" />\r\n                            Print Invoice\r\n                        </button>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-2.5 hover:bg-slate-100 rounded-xl transition-all\"\r\n                        >\r\n                            <X className=\"w-5 h-5 text-slate-400\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Printable Content */}\r\n                <div ref={printRef} className=\"p-12 print:p-8 flex-1 bg-white printable-area\">\r\n                    <style>{`\r\n                        @media print {\r\n                            body * { visibility: hidden; }\r\n                            .printable-area, .printable-area * { visibility: visible; }\r\n                            .printable-area { position: absolute; left: 0; top: 0; width: 100%; }\r\n                            .no-print-modal { box-shadow: none !important; border: none !important; }\r\n                        }\r\n                    `}</style>\r\n\r\n                    {/* Header */}\r\n                    <div className=\"flex justify-between items-start border-b-2 border-slate-900 pb-8 mb-8\">\r\n                        <div>\r\n                            <h1 className=\"text-4xl font-black tracking-tighter uppercase text-slate-900\">{company.name}</h1>\r\n                            <p className=\"text-sm font-bold text-slate-500 mt-2 max-w-xs\">{company.address}</p>\r\n                            <div className=\"mt-4 inline-block px-3 py-1 bg-slate-100 rounded-lg\">\r\n                                <p className=\"text-[10px] font-black uppercase tracking-widest\">GSTIN: <span className=\"text-slate-900\">{company.gstin}</span></p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <h2 className=\"text-6xl font-black text-slate-100 uppercase tracking-tighter mb-2 leading-none\">INVOICE</h2>\r\n                            <p className=\"text-sm font-black text-slate-900 mt-4 uppercase tracking-widest\"># {voucher.voucherNo}</p>\r\n                            <p className=\"text-xs font-bold text-slate-500 mt-1 uppercase tracking-widest\">Date: {voucher.date}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Parties */}\r\n                    <div className=\"grid grid-cols-2 gap-12 mb-12\">\r\n                        <div>\r\n                            <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3\">Bill To</p>\r\n                            <h3 className=\"text-xl font-black text-slate-900 uppercase\">{customer.name}</h3>\r\n                            <p className=\"text-sm font-bold text-slate-500 mt-2 whitespace-pre-line\">{customer.address || \"Address not provided\"}</p>\r\n                            <p className=\"text-xs font-black text-slate-900 mt-3 uppercase tracking-widest\">GSTIN: {customer.gstin || \"URD\"}</p>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3\">Ship From</p>\r\n                            <h3 className=\"text-xl font-black text-slate-900 uppercase\">{company.name}</h3>\r\n                            <p className=\"text-sm font-bold text-slate-500 mt-2\">{company.address}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Table */}\r\n                    <table className=\"w-full mb-8\">\r\n                        <thead>\r\n                            <tr className=\"border-b-2 border-slate-900 text-left\">\r\n                                <th className=\"py-4 text-[10px] font-black uppercase tracking-widest text-slate-400\">Description</th>\r\n                                <th className=\"py-4 text-[10px] font-black uppercase tracking-widest text-slate-400 text-right\">Qty</th>\r\n                                <th className=\"py-4 text-[10px] font-black uppercase tracking-widest text-slate-400 text-right\">Rate</th>\r\n                                <th className=\"py-4 text-[10px] font-black uppercase tracking-widest text-slate-400 text-right\">Amount</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-100\">\r\n                            {/* In a real app we'd map inventory items here. \r\n                                For now we show the main taxable ledger amount as a generic 'Sales' item if items aren't available */}\r\n                            {voucher.rows.find((r: any) => r.inventoryAllocations)?.inventoryAllocations?.map((item: any, idx: number) => (\r\n                                <tr key={idx}>\r\n                                    <td className=\"py-6 font-black text-slate-900 uppercase\">\r\n                                        {/* Needs a way to resolve item names from IDs */}\r\n                                        Item {item.itemId}\r\n                                        <div className=\"text-[9px] text-slate-400 font-bold mt-1\">BATCH: {item.batchNo || '-'} // EXP: {item.expiryDate || '-'}</div>\r\n                                    </td>\r\n                                    <td className=\"py-6 text-right font-bold text-slate-900\">{item.quantity}</td>\r\n                                    <td className=\"py-6 text-right font-bold text-slate-900\">Γé╣{item.rate.toLocaleString()}</td>\r\n                                    <td className=\"py-6 text-right font-black text-slate-900\">Γé╣{item.amount.toLocaleString()}</td>\r\n                                </tr>\r\n                            )) || (\r\n                                    <tr>\r\n                                        <td className=\"py-6 font-black text-slate-900 uppercase\">Sales / Outward Supplies</td>\r\n                                        <td className=\"py-6 text-right font-bold text-slate-900\">1.00</td>\r\n                                        <td className=\"py-6 text-right font-bold text-slate-900\">Γé╣{taxableValue.toLocaleString()}</td>\r\n                                        <td className=\"py-6 text-right font-black text-slate-900\">Γé╣{taxableValue.toLocaleString()}</td>\r\n                                    </tr>\r\n                                )}\r\n                        </tbody>\r\n                    </table>\r\n\r\n                    {/* Totals */}\r\n                    <div className=\"flex justify-end\">\r\n                        <div className=\"w-full max-w-xs space-y-4\">\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"font-bold text-slate-500 uppercase tracking-widest\">Taxable Total</span>\r\n                                <span className=\"font-black text-slate-900\">Γé╣{taxableValue.toLocaleString()}</span>\r\n                            </div>\r\n                            {cgst > 0 && (\r\n                                <div className=\"flex justify-between text-sm\">\r\n                                    <span className=\"font-bold text-slate-500 uppercase tracking-widest text-[10px]\">CGST (Cent. Tax)</span>\r\n                                    <span className=\"font-black text-slate-900\">Γé╣{cgst.toLocaleString()}</span>\r\n                                </div>\r\n                            )}\r\n                            {sgst > 0 && (\r\n                                <div className=\"flex justify-between text-sm\">\r\n                                    <span className=\"font-bold text-slate-500 uppercase tracking-widest text-[10px]\">SGST (State Tax)</span>\r\n                                    <span className=\"font-black text-slate-900\">Γé╣{sgst.toLocaleString()}</span>\r\n                                </div>\r\n                            )}\r\n                            {igst > 0 && (\r\n                                <div className=\"flex justify-between text-sm\">\r\n                                    <span className=\"font-bold text-slate-500 uppercase tracking-widest text-[10px]\">IGST (Integ. Tax)</span>\r\n                                    <span className=\"font-black text-slate-900\">Γé╣{igst.toLocaleString()}</span>\r\n                                </div>\r\n                            )}\r\n                            <div className=\"flex justify-between items-center pt-4 border-t-2 border-slate-900\">\r\n                                <span className=\"text-sm font-black uppercase tracking-widest\">Total Payable</span>\r\n                                <span className=\"text-2xl font-black text-slate-900 tracking-tighter\">Γé╣{totalAmount.toLocaleString()}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Footer / Notes */}\r\n                    <div className=\"mt-20 pt-8 border-t border-slate-100 flex justify-between items-end\">\r\n                        <div>\r\n                            <p className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2\">Terms & Conditions</p>\r\n                            <ul className=\"text-[9px] font-bold text-slate-500 space-y-1\">\r\n                                <li>1. Goods once sold will not be taken back.</li>\r\n                                <li>2. Payment should be made within 15 days.</li>\r\n                                <li>3. Interest @ 18% will be charged for delayed payments.</li>\r\n                            </ul>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <div className=\"w-48 h-20 border-b border-slate-900 mb-2\"></div>\r\n                            <p className=\"text-[10px] font-black text-slate-900 uppercase tracking-widest\">Authorized Signatory</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\accounting\\vouchers\\VoucherEntry.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nM:\\Projects\\MoneyArc\\src\\features\\accounting\\vouchers\\VoucherEntry.tsx:78:13\n  76 |     useEffect(() => {\n  77 |         if (voucherType === 'Sales' || voucherType === 'Purchase') {\n> 78 |             setIsInventoryMode(true);\n     |             ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  79 |         } else {\n  80 |             setIsInventoryMode(false);\n  81 |         }","line":78,"column":13,"nodeType":null,"endLine":78,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_rowId' is defined but never used.","line":84,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":84,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_field' is defined but never used.","line":84,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":84,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5119,5122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5119,5122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6095,6098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6095,6098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'finalRows' is never reassigned. Use 'const' instead.","line":202,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":202,"endColumn":30,"fix":{"range":[8811,8884],"text":"const finalRows = newRows.filter(r => !taxLedgerNames.includes(r.account));"}}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { Save, Plus, Trash2, Calendar, ChevronDown, Keyboard, Package, Box, Tag, FileText } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport clsx from 'clsx';\r\nimport { usePersistence } from '../../../services/persistence/PersistenceContext';\r\nimport { VoucherService, type Voucher, type VoucherRow, type InventoryEntry } from '../../../services/accounting/VoucherService';\r\nimport type { Ledger } from '../../../services/accounting/ReportService';\r\nimport type { StockItem, UnitOfMeasure } from '../../../services/inventory/types';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\n\r\ntype VoucherType = 'Payment' | 'Receipt' | 'Journal' | 'Contra' | 'Sales' | 'Purchase';\r\n\r\nexport default function VoucherEntry() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n\r\n    // Data States\r\n    const [ledgers, setLedgers] = useState<Ledger[]>([]);\r\n    const [stockItems, setStockItems] = useState<StockItem[]>([]);\r\n    const [units, setUnits] = useState<UnitOfMeasure[]>([]);\r\n\r\n    // UI States\r\n    const [voucherType, setVoucherType] = useState<VoucherType>('Payment');\r\n    const [isInventoryMode, setIsInventoryMode] = useState(false);\r\n    const [rows, setRows] = useState<VoucherRow[]>([\r\n        { id: 1, type: 'Dr', account: '', debit: 0, credit: 0 },\r\n        { id: 2, type: 'Cr', account: '', debit: 0, credit: 0 },\r\n    ]);\r\n    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [narration, setNarration] = useState('');\r\n    const [voucherNo, setVoucherNo] = useState('1');\r\n    const [currency, setCurrency] = useState('INR');\r\n    const [exchangeRate, setExchangeRate] = useState(1);\r\n\r\n    // Inventory Allocation State\r\n    const [showInventoryModal, setShowInventoryModal] = useState(false);\r\n    const [activeRowId, setActiveRowId] = useState<number | null>(null);\r\n    const [tempAllocations, setTempAllocations] = useState<InventoryEntry[]>([]);\r\n\r\n    const tableRef = useRef<HTMLTableElement>(null);\r\n\r\n    // Initial Data Loading\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (provider && activeCompany) {\r\n                const [ledgerData, items, uoms, vouchers] = await Promise.all([\r\n                    provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                    provider.read<StockItem[]>('stock_items.json', activeCompany.path),\r\n                    provider.read<UnitOfMeasure[]>('units.json', activeCompany.path),\r\n                    id ? provider.read<Voucher[]>('vouchers.json', activeCompany.path) : Promise.resolve(null)\r\n                ]);\r\n\r\n                setLedgers(ledgerData || []);\r\n                setStockItems(items || []);\r\n                setUnits(uoms || []);\r\n\r\n                if (id && vouchers) {\r\n                    const voucher = vouchers.find(v => v.id === id);\r\n                    if (voucher) {\r\n                        setVoucherType(voucher.type as VoucherType);\r\n                        setVoucherNo(voucher.voucherNo);\r\n                        setDate(voucher.date);\r\n                        setNarration(voucher.narration);\r\n                        setRows(voucher.rows);\r\n                        setCurrency(voucher.currency || 'INR');\r\n                        setExchangeRate(voucher.exchangeRate || 1);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        loadData();\r\n    }, [provider, activeCompany, id]);\r\n\r\n    // Automatically set inventory mode for Sales/Purchase\r\n    useEffect(() => {\r\n        if (voucherType === 'Sales' || voucherType === 'Purchase') {\r\n            setIsInventoryMode(true);\r\n        } else {\r\n            setIsInventoryMode(false);\r\n        }\r\n    }, [voucherType]);\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent, _rowId: number, _field: string) => {\r\n        if (e.key === 'Enter') {\r\n            const isSelect = (e.target as HTMLElement).tagName === 'SELECT';\r\n            if (isSelect) return; // Let select handle enter for selection\r\n\r\n            e.preventDefault();\r\n            const inputs = Array.from(tableRef.current?.querySelectorAll('input, select') || []) as HTMLElement[];\r\n            const currentIndex = inputs.indexOf(e.target as HTMLElement);\r\n            if (currentIndex > -1 && currentIndex < inputs.length - 1) {\r\n                inputs[currentIndex + 1].focus();\r\n            } else if (currentIndex === inputs.length - 1) {\r\n                if (rows.length < 15) addRow();\r\n            }\r\n        }\r\n    };\r\n\r\n    const addRow = () => {\r\n        const lastRow = rows[rows.length - 1];\r\n        setRows([...rows, {\r\n            id: Date.now(),\r\n            type: lastRow.type === 'Dr' ? 'Cr' : 'Dr',\r\n            account: '',\r\n            debit: 0,\r\n            credit: 0\r\n        }]);\r\n    };\r\n\r\n    const removeRow = (id: number) => {\r\n        if (rows.length > 2) setRows(rows.filter(r => r.id !== id));\r\n    };\r\n\r\n    const updateRow = (id: number, field: keyof VoucherRow, value: any) => {\r\n        setRows(rows.map(r => r.id === id ? { ...r, [field]: value } : r));\r\n    };\r\n\r\n    const totalDebit = rows.reduce((acc, r) => acc + (Number(r.debit) || 0), 0);\r\n    const totalCredit = rows.reduce((acc, r) => acc + (Number(r.credit) || 0), 0);\r\n\r\n    // Inventory Allocation Logic\r\n    const openInventoryAllocation = (rowId: number) => {\r\n        const row = rows.find(r => r.id === rowId);\r\n        if (row) {\r\n            setActiveRowId(rowId);\r\n            setTempAllocations(row.inventoryAllocations || []);\r\n            setShowInventoryModal(true);\r\n        }\r\n    };\r\n\r\n    const addInventoryRow = () => {\r\n        setTempAllocations([...tempAllocations, {\r\n            id: Date.now().toString(),\r\n            itemId: '',\r\n            itemName: '',\r\n            quantity: 0,\r\n            unitId: '',\r\n            rate: 0,\r\n            amount: 0\r\n        }]);\r\n    };\r\n\r\n    const updateInventoryRow = (id: string, field: keyof InventoryEntry, value: any) => {\r\n        setTempAllocations(tempAllocations.map(a => {\r\n            if (a.id === id) {\r\n                const updated = { ...a, [field]: value };\r\n                if (field === 'itemId') {\r\n                    const item = stockItems.find(i => i.id === value);\r\n                    if (item) {\r\n                        updated.itemName = item.name;\r\n                        updated.unitId = item.unitId;\r\n                        updated.rate = item.currentRate || item.openingRate;\r\n                    }\r\n                }\r\n                if (field === 'quantity' || field === 'rate') {\r\n                    updated.amount = (Number(updated.quantity) || 0) * (Number(updated.rate) || 0);\r\n                }\r\n                return updated;\r\n            }\r\n            return a;\r\n        }));\r\n    };\r\n\r\n    const saveAllocation = () => {\r\n        if (activeRowId !== null) {\r\n            const totalAllocAmount = tempAllocations.reduce((sum, a) => sum + a.amount, 0);\r\n\r\n            // Determine Tax Type (Intra-state vs Inter-state)\r\n            const activeRow = rows.find(r => r.id === activeRowId);\r\n            const counterpartyLedger = rows.find(r => r.id !== activeRowId && r.account !== '' && !['GST', 'Tax', 'Output', 'Input'].some(k => r.account.includes(k))) ||\r\n                rows.find(r => r.id !== activeRowId && r.account !== '');\r\n            const counterparty = ledgers.find(l => l.name === counterpartyLedger?.account);\r\n\r\n            const isInterState = activeCompany?.state && counterparty?.state &&\r\n                activeCompany.state.trim().toLowerCase() !== counterparty.state.trim().toLowerCase();\r\n\r\n            // Calculate GST impact\r\n            let totalGst = 0;\r\n            tempAllocations.forEach(a => {\r\n                const item = stockItems.find(i => i.id === a.itemId);\r\n                if (item && item.gstRate) {\r\n                    totalGst += (a.amount * item.gstRate) / 100;\r\n                }\r\n            });\r\n\r\n            const newRows = [...rows];\r\n            const rowIndex = newRows.findIndex(r => r.id === activeRowId);\r\n\r\n            if (rowIndex !== -1) {\r\n                newRows[rowIndex] = {\r\n                    ...newRows[rowIndex],\r\n                    inventoryAllocations: tempAllocations,\r\n                    debit: newRows[rowIndex].type === 'Dr' ? totalAllocAmount : 0,\r\n                    credit: newRows[rowIndex].type === 'Cr' ? totalAllocAmount : 0\r\n                };\r\n\r\n                // Define tax ledgers\r\n                const taxLedgerNames = ['Central GST (CGST)', 'State GST (SGST)', 'Integrated GST (IGST)', 'Output GST'];\r\n\r\n                // Clear previous auto-added tax rows to avoid duplicates\r\n                let finalRows = newRows.filter(r => !taxLedgerNames.includes(r.account));\r\n\r\n                if (totalGst > 0) {\r\n                    const commonType = activeRow?.type || 'Dr';\r\n\r\n                    if (isInterState) {\r\n                        finalRows.push({\r\n                            id: Date.now() + 10,\r\n                            type: commonType,\r\n                            account: 'Integrated GST (IGST)',\r\n                            debit: commonType === 'Dr' ? totalGst : 0,\r\n                            credit: commonType === 'Cr' ? totalGst : 0\r\n                        });\r\n                    } else {\r\n                        finalRows.push({\r\n                            id: Date.now() + 11,\r\n                            type: commonType,\r\n                            account: 'Central GST (CGST)',\r\n                            debit: commonType === 'Dr' ? totalGst / 2 : 0,\r\n                            credit: commonType === 'Cr' ? totalGst / 2 : 0\r\n                        }, {\r\n                            id: Date.now() + 12,\r\n                            type: commonType,\r\n                            account: 'State GST (SGST)',\r\n                            debit: commonType === 'Dr' ? totalGst / 2 : 0,\r\n                            credit: commonType === 'Cr' ? totalGst / 2 : 0\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // Find the \"other\" row (typically Party, Cash, or Bank) to balance the voucher\r\n                const mainRowIndex = finalRows.findIndex(r =>\r\n                    r.id !== activeRowId &&\r\n                    !taxLedgerNames.includes(r.account) &&\r\n                    r.account !== ''\r\n                );\r\n\r\n                if (mainRowIndex !== -1) {\r\n                    const totalVoucherAmount = totalAllocAmount + totalGst;\r\n                    const otherRow = finalRows[mainRowIndex];\r\n                    finalRows[mainRowIndex] = {\r\n                        ...otherRow,\r\n                        debit: otherRow.type === 'Dr' ? totalVoucherAmount : 0,\r\n                        credit: otherRow.type === 'Cr' ? totalVoucherAmount : 0\r\n                    };\r\n                }\r\n\r\n                setRows(finalRows);\r\n            }\r\n\r\n            setShowInventoryModal(false);\r\n            setActiveRowId(null);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        if (!provider || !activeCompany) return;\r\n        if (Math.abs(totalDebit - totalCredit) > 0.01) {\r\n            alert(\"Debit and Credit totals must match!\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const voucher: Voucher = {\r\n                id: id || Date.now().toString(),\r\n                voucherNo,\r\n                date,\r\n                type: voucherType,\r\n                narration,\r\n                rows,\r\n                currency,\r\n                exchangeRate\r\n            };\r\n\r\n            if (id) {\r\n                await VoucherService.updateVoucher(provider, voucher, activeCompany.path);\r\n            } else {\r\n                await VoucherService.saveVoucher(provider, voucher, activeCompany.path);\r\n            }\r\n\r\n            navigate('/reports/daybook');\r\n        } catch (error) {\r\n            console.error(\"Save failed\", error);\r\n            alert(\"Failed to save voucher.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"max-w-7xl mx-auto space-y-6 pb-20\"\r\n        >\r\n            {/* Header Section */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                <div className=\"flex items-center gap-5\">\r\n                    <div className=\"w-14 h-14 cyan-gradient rounded-[1.25rem] flex items-center justify-center text-white shadow-xl shadow-primary/20 rotate-3\">\r\n                        <Keyboard className=\"w-7 h-7\" />\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-black text-foreground tracking-tight uppercase leading-none\">Universal Entry</h1>\r\n                        <p className=\"text-muted-foreground text-[10px] font-black uppercase tracking-[0.3em] mt-2 flex items-center gap-2\">\r\n                            <Box className=\"w-3 h-3\" /> {activeCompany?.name} // {voucherType}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-card p-1.5 rounded-2xl border border-border shadow-inner flex flex-wrap gap-1\">\r\n                    {['Payment', 'Receipt', 'Journal', 'Contra', 'Sales', 'Purchase'].map((type) => (\r\n                        <button\r\n                            key={type}\r\n                            onClick={() => setVoucherType(type as VoucherType)}\r\n                            className={clsx(\r\n                                'px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all duration-300',\r\n                                voucherType === type\r\n                                    ? 'bg-primary text-primary-foreground shadow-lg shadow-primary/20 scale-105'\r\n                                    : 'text-muted-foreground hover:text-foreground hover:bg-muted/50'\r\n                            )}\r\n                        >\r\n                            {type}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-card rounded-[2.5rem] shadow-2xl border border-border overflow-hidden\">\r\n                {/* Meta Data Bar */}\r\n                <div className=\"px-10 py-8 border-b border-border bg-muted/20\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8 items-end\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Vch Number</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={voucherNo}\r\n                                onChange={(e) => setVoucherNo(e.target.value)}\r\n                                className=\"w-full px-5 py-3.5 bg-background border border-border rounded-2xl text-sm font-bold focus:ring-4 focus:ring-primary/10 focus:border-primary outline-none transition-all shadow-sm\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Effective Date</label>\r\n                            <div className=\"relative\">\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={date}\r\n                                    onChange={(e) => setDate(e.target.value)}\r\n                                    className=\"w-full pl-12 pr-5 py-3.5 bg-background border border-border rounded-2xl text-sm font-bold focus:ring-4 focus:ring-primary/10 focus:border-primary outline-none transition-all shadow-sm\"\r\n                                />\r\n                                <Calendar className=\"w-5 h-5 text-primary absolute left-4 top-1/2 -translate-y-1/2\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Reference / External Doc #</label>\r\n                            <div className=\"relative\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"w-full pl-12 pr-5 py-3.5 bg-background border border-border rounded-2xl text-sm font-bold focus:ring-4 focus:ring-primary/10 focus:border-primary outline-none transition-all shadow-sm\"\r\n                                    placeholder=\"Order ID / Invoice reference...\"\r\n                                />\r\n                                <Tag className=\"w-5 h-5 text-muted-foreground/50 absolute left-4 top-1/2 -translate-y-1/2\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Currency</label>\r\n                                <select\r\n                                    value={currency}\r\n                                    onChange={(e) => setCurrency(e.target.value)}\r\n                                    className=\"w-full px-5 py-3.5 bg-background border border-border rounded-2xl text-sm font-bold focus:ring-4 focus:ring-primary/10 focus:border-primary outline-none transition-all shadow-sm appearance-none\"\r\n                                >\r\n                                    <option value=\"INR\">INR</option>\r\n                                    <option value=\"USD\">USD</option>\r\n                                    <option value=\"EUR\">EUR</option>\r\n                                    <option value=\"GBP\">GBP</option>\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Ex. Rate</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    step=\"0.0001\"\r\n                                    value={exchangeRate}\r\n                                    onChange={(e) => setExchangeRate(parseFloat(e.target.value) || 1)}\r\n                                    className=\"w-full px-5 py-3.5 bg-background border border-border rounded-2xl text-sm font-bold focus:ring-4 focus:ring-primary/10 focus:border-primary outline-none transition-all shadow-sm\"\r\n                                    placeholder=\"1.0000\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Entry Grid */}\r\n                <div className=\"p-0 overflow-x-auto\">\r\n                    <table ref={tableRef} className=\"w-full border-collapse\">\r\n                        <thead>\r\n                            <tr className=\"text-left text-[10px] font-black text-muted-foreground uppercase tracking-[0.3em] bg-muted/30 border-b border-border\">\r\n                                <th className=\"py-5 px-10 w-28\">Type</th>\r\n                                <th className=\"py-5 px-4\">Account Particulars</th>\r\n                                <th className=\"py-5 px-4 w-44 text-right\">Debit (Γé╣)</th>\r\n                                <th className=\"py-5 px-10 w-44 text-right\">Credit (Γé╣)</th>\r\n                                <th className=\"py-5 px-4 w-16\"></th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border/50\">\r\n                            {rows.map((row) => (\r\n                                <tr key={row.id} className=\"group transition-all hover:bg-muted/5\">\r\n                                    <td className=\"py-4 px-10\">\r\n                                        <select\r\n                                            value={row.type}\r\n                                            onChange={(e) => updateRow(row.id, 'type', e.target.value)}\r\n                                            className=\"w-full bg-transparent font-black text-sm text-primary outline-none cursor-pointer uppercase tracking-widest\"\r\n                                        >\r\n                                            <option value=\"Dr\">Dr</option>\r\n                                            <option value=\"Cr\">Cr</option>\r\n                                        </select>\r\n                                    </td>\r\n                                    <td className=\"py-4 px-4 relative\">\r\n                                        <div className=\"flex flex-col gap-1\">\r\n                                            <div className=\"relative group/input\">\r\n                                                <input\r\n                                                    list={`ledgers-${row.id}`}\r\n                                                    value={row.account}\r\n                                                    onChange={(e) => updateRow(row.id, 'account', e.target.value)}\r\n                                                    onKeyDown={(e) => handleKeyDown(e, row.id, 'account')}\r\n                                                    className=\"w-full outline-none border-b-2 border-transparent focus:border-primary transition-all font-bold text-base bg-transparent py-1.5 pr-8\"\r\n                                                    placeholder=\"Search ledger...\"\r\n                                                />\r\n                                                <datalist id={`ledgers-${row.id}`}>\r\n                                                    {ledgers.filter(l => {\r\n                                                        if (voucherType === 'Contra') {\r\n                                                            return l.group === 'Bank Accounts' || l.group === 'Cash-in-hand';\r\n                                                        }\r\n                                                        if (voucherType === 'Sales' && row.type === 'Cr') {\r\n                                                            return l.group === 'Sales Accounts';\r\n                                                        }\r\n                                                        if (voucherType === 'Purchase' && row.type === 'Dr') {\r\n                                                            return l.group === 'Purchase Accounts';\r\n                                                        }\r\n                                                        return true;\r\n                                                    }).map(l => <option key={l.id} value={l.name} />)}\r\n                                                </datalist>\r\n                                                <ChevronDown className=\"w-4 h-4 text-muted-foreground/30 absolute right-1 top-1/2 -translate-y-1/2 pointer-events-none group-focus-within/input:text-primary\" />\r\n                                            </div>\r\n\r\n                                            {/* Inventory Prompt if applicable */}\r\n                                            {isInventoryMode && row.account && !['Cash', 'Bank'].some(k => row.account.includes(k)) && (\r\n                                                <button\r\n                                                    onClick={() => openInventoryAllocation(row.id)}\r\n                                                    className={clsx(\r\n                                                        \"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest py-1 px-2 rounded-lg w-fit transition-all\",\r\n                                                        row.inventoryAllocations && row.inventoryAllocations.length > 0\r\n                                                            ? \"bg-emerald-500/10 text-emerald-600 hover:bg-emerald-500/20\"\r\n                                                            : \"bg-primary/5 text-primary hover:bg-primary/10\"\r\n                                                    )}\r\n                                                >\r\n                                                    <Package className=\"w-3.5 h-3.5\" />\r\n                                                    {row.inventoryAllocations && row.inventoryAllocations.length > 0\r\n                                                        ? `${row.inventoryAllocations.length} Items Allocated`\r\n                                                        : \"Allocate Inventory\"}\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"py-4 px-4\">\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={row.debit || ''}\r\n                                            onChange={(e) => updateRow(row.id, 'debit', parseFloat(e.target.value))}\r\n                                            onKeyDown={(e) => handleKeyDown(e, row.id, 'debit')}\r\n                                            disabled={row.type === 'Cr' || (isInventoryMode && !!row.inventoryAllocations?.length)}\r\n                                            className={clsx(\r\n                                                \"w-full text-right outline-none bg-transparent transition-all font-mono font-black text-base px-2 py-1.5 rounded-xl block ml-auto\",\r\n                                                row.type === 'Dr' ? \"text-foreground focus:bg-muted/30\" : \"opacity-0\"\r\n                                            )}\r\n                                            placeholder=\"0.00\"\r\n                                        />\r\n                                    </td>\r\n                                    <td className=\"py-4 px-10\">\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={row.credit || ''}\r\n                                            onChange={(e) => updateRow(row.id, 'credit', parseFloat(e.target.value))}\r\n                                            onKeyDown={(e) => handleKeyDown(e, row.id, 'credit')}\r\n                                            disabled={row.type === 'Dr' || (isInventoryMode && !!row.inventoryAllocations?.length)}\r\n                                            className={clsx(\r\n                                                \"w-full text-right outline-none bg-transparent transition-all font-mono font-black text-base px-2 py-1.5 rounded-xl block ml-auto\",\r\n                                                row.type === 'Cr' ? \"text-foreground focus:bg-muted/30\" : \"opacity-0\"\r\n                                            )}\r\n                                            placeholder=\"0.00\"\r\n                                        />\r\n                                    </td>\r\n                                    <td className=\"py-4 px-4\">\r\n                                        <button\r\n                                            onClick={() => removeRow(row.id)}\r\n                                            className=\"p-2 text-muted-foreground/20 hover:text-rose-500 hover:bg-rose-500/10 rounded-xl transition-all opacity-0 group-hover:opacity-100\"\r\n                                        >\r\n                                            <Trash2 className=\"w-5 h-5\" />\r\n                                        </button>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                        <tfoot className=\"bg-muted/30\">\r\n                            <tr className=\"font-black text-foreground divide-x divide-border/20\">\r\n                                <td colSpan={2} className=\"py-6 px-10 flex items-center justify-between\">\r\n                                    <span className=\"text-[10px] uppercase tracking-[0.3em] text-muted-foreground\">Voucher Valuation Control</span>\r\n                                    <div className=\"flex gap-4\">\r\n                                        <button\r\n                                            onClick={addRow}\r\n                                            className=\"text-[10px] text-primary font-black uppercase tracking-widest hover:bg-primary/10 px-5 py-2.5 rounded-2xl flex items-center gap-2 transition-all border border-primary/20\"\r\n                                        >\r\n                                            <Plus className=\"w-4 h-4\" /> Add Line (Ctrl+N)\r\n                                        </button>\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"py-6 px-4 text-right font-mono text-xl text-primary border-t-4 border-primary/50 relative\">\r\n                                    <div className=\"absolute top-0 right-0 left-0 h-1 bg-gradient-to-r from-transparent via-primary/30 to-transparent\" />\r\n                                    {totalDebit.toLocaleString(undefined, { minimumFractionDigits: 2 })}\r\n                                </td>\r\n                                <td className=\"py-6 px-10 text-right font-mono text-xl text-primary border-t-4 border-primary/50 relative\">\r\n                                    <div className=\"absolute top-0 right-0 left-0 h-1 bg-gradient-to-r from-transparent via-primary/30 to-transparent\" />\r\n                                    {totalCredit.toLocaleString(undefined, { minimumFractionDigits: 2 })}\r\n                                </td>\r\n                                <td></td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n                </div>\r\n\r\n                {/* Footer Section */}\r\n                <div className=\"px-10 py-10 bg-muted/10 border-t border-border grid grid-cols-1 lg:grid-cols-3 gap-10\">\r\n                    <div className=\"lg:col-span-2 space-y-4\">\r\n                        <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1 flex items-center gap-2\">\r\n                            <FileText className=\"w-4 h-4\" /> Detailed Narration Statement\r\n                        </label>\r\n                        <textarea\r\n                            value={narration}\r\n                            onChange={(e) => setNarration(e.target.value)}\r\n                            rows={3}\r\n                            className=\"w-full px-6 py-4 bg-background border border-border rounded-[1.5rem] focus:ring-4 focus:ring-primary/10 focus:border-primary outline-none resize-none font-bold text-sm transition-all shadow-inner\"\r\n                            placeholder=\"Type full transaction α▓╡α▓┐α▓╡α▓░ (description)...\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex flex-col justify-end gap-6\">\r\n                        {Math.abs(totalDebit - totalCredit) > 0.01 && (\r\n                            <div className=\"bg-rose-500/10 border border-rose-500/20 p-4 rounded-2xl flex items-center justify-between text-rose-500 animate-pulse\">\r\n                                <span className=\"text-[10px] font-black uppercase tracking-widest\">Difference</span>\r\n                                <span className=\"font-mono font-bold\">Γé╣{Math.abs(totalDebit - totalCredit).toFixed(2)}</span>\r\n                            </div>\r\n                        )}\r\n                        <div className=\"flex gap-4\">\r\n                            <button\r\n                                onClick={() => navigate('/dashboard')}\r\n                                className=\"flex-1 py-4 text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground hover:text-foreground hover:bg-muted border border-border rounded-2xl transition-all\"\r\n                            >\r\n                                Discard\r\n                            </button>\r\n                            <button\r\n                                onClick={handleSave}\r\n                                className=\"flex-[2] flex items-center justify-center gap-4 py-4 bg-primary text-primary-foreground rounded-2xl hover:shadow-2xl hover:shadow-primary/30 transition-all active:scale-[0.98] shadow-xl shadow-primary/10\"\r\n                            >\r\n                                <Save className=\"w-5 h-5\" />\r\n                                <span className=\"font-black uppercase tracking-[0.2em] text-[11px]\">Finalize Entry</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Inventory Allocation Modal */}\r\n            <AnimatePresence>\r\n                {showInventoryModal && (\r\n                    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-6 bg-background/80 backdrop-blur-md\">\r\n                        <motion.div\r\n                            initial={{ scale: 0.9, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            exit={{ scale: 0.9, opacity: 0 }}\r\n                            className=\"bg-card w-full max-w-5xl rounded-[3rem] shadow-2xl border border-border overflow-hidden flex flex-col max-h-[90vh]\"\r\n                        >\r\n                            <div className=\"px-10 py-8 border-b border-border bg-muted/20 flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className=\"w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-emerald-500/20 rotate-3\">\r\n                                        <Package className=\"w-6 h-6\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h2 className=\"text-2xl font-black text-foreground uppercase tracking-tight\">Inventory Allocations</h2>\r\n                                        <p className=\"text-xs font-bold text-muted-foreground uppercase tracking-widest\">{rows.find(r => r.id === activeRowId)?.account}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <button\r\n                                        onClick={addInventoryRow}\r\n                                        className=\"flex items-center gap-2 px-6 py-3 bg-emerald-500/10 text-emerald-600 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-emerald-500/20 transition-all border border-emerald-500/20\"\r\n                                    >\r\n                                        <Plus className=\"w-4 h-4\" /> Add Item\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex-1 overflow-y-auto p-0\">\r\n                                <table className=\"w-full border-collapse\">\r\n                                    <thead>\r\n                                        <tr className=\"text-left text-[9px] font-black text-muted-foreground uppercase tracking-[0.3em] bg-muted/10 border-b border-border\">\r\n                                            <th className=\"py-4 px-10\">Stock Item</th>\r\n                                            <th className=\"py-4 px-4 w-40\">Batch No / Expiry</th>\r\n                                            <th className=\"py-4 px-4 w-32 text-right\">Quantity</th>\r\n                                            <th className=\"py-4 px-4 w-36 text-right\">Rate / Unit</th>\r\n                                            <th className=\"py-4 px-10 w-44 text-right\">Value (Γé╣)</th>\r\n                                            <th className=\"py-4 px-4 w-12\"></th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"divide-y divide-border/50\">\r\n                                        {tempAllocations.map((alloc) => (\r\n                                            <tr key={alloc.id} className=\"hover:bg-muted/5 transition-all\">\r\n                                                <td className=\"py-4 px-10\">\r\n                                                    <select\r\n                                                        value={alloc.itemId}\r\n                                                        onChange={(e) => updateInventoryRow(alloc.id, 'itemId', e.target.value)}\r\n                                                        className=\"w-full bg-transparent font-bold text-sm outline-none focus:text-primary transition-all appearance-none\"\r\n                                                    >\r\n                                                        <option value=\"\">Select Stock Item...</option>\r\n                                                        {stockItems.map(item => (\r\n                                                            <option key={item.id} value={item.id}>{item.name} ({units.find(u => u.id === item.unitId)?.name})</option>\r\n                                                        ))}\r\n                                                    </select>\r\n                                                </td>\r\n                                                <td className=\"py-4 px-4 space-y-1\">\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={alloc.batchNo || ''}\r\n                                                        onChange={(e) => updateInventoryRow(alloc.id, 'batchNo', e.target.value)}\r\n                                                        className=\"w-full bg-background border border-border rounded-lg px-2 py-1 text-[10px] uppercase font-black\"\r\n                                                        placeholder=\"BATCH #\"\r\n                                                    />\r\n                                                    <input\r\n                                                        type=\"date\"\r\n                                                        value={alloc.expiryDate || ''}\r\n                                                        onChange={(e) => updateInventoryRow(alloc.id, 'expiryDate', e.target.value)}\r\n                                                        className=\"w-full bg-background border border-border rounded-lg px-2 py-1 text-[10px] font-bold\"\r\n                                                    />\r\n                                                </td>\r\n                                                <td className=\"py-4 px-4\">\r\n                                                    <input\r\n                                                        type=\"number\"\r\n                                                        value={alloc.quantity || ''}\r\n                                                        onChange={(e) => updateInventoryRow(alloc.id, 'quantity', parseFloat(e.target.value))}\r\n                                                        className=\"w-full text-right bg-transparent outline-none font-mono font-bold text-sm focus:text-emerald-500\"\r\n                                                        placeholder=\"0.00\"\r\n                                                    />\r\n                                                </td>\r\n                                                <td className=\"py-4 px-4\">\r\n                                                    <input\r\n                                                        type=\"number\"\r\n                                                        value={alloc.rate || ''}\r\n                                                        onChange={(e) => updateInventoryRow(alloc.id, 'rate', parseFloat(e.target.value))}\r\n                                                        className=\"w-full text-right bg-transparent outline-none font-mono font-bold text-sm focus:text-emerald-500\"\r\n                                                        placeholder=\"0.00\"\r\n                                                    />\r\n                                                </td>\r\n                                                <td className=\"py-4 px-10 text-right font-mono font-black text-sm text-emerald-600\">\r\n                                                    Γé╣{alloc.amount.toLocaleString(undefined, { minimumFractionDigits: 2 })}\r\n                                                </td>\r\n                                                <td className=\"py-4 px-4\">\r\n                                                    <button\r\n                                                        onClick={() => setTempAllocations(tempAllocations.filter(a => a.id !== alloc.id))}\r\n                                                        className=\"p-1.5 text-rose-500/20 hover:text-rose-500 hover:bg-rose-500/10 rounded-lg transition-all\"\r\n                                                    >\r\n                                                        <Trash2 className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                        {tempAllocations.length === 0 && (\r\n                                            <tr>\r\n                                                <td colSpan={5} className=\"py-20 text-center\">\r\n                                                    <div className=\"flex flex-col items-center gap-4 text-muted-foreground\">\r\n                                                        <Package className=\"w-12 h-12 opacity-10\" />\r\n                                                        <p className=\"text-xs font-black uppercase tracking-[0.3em]\">No items allocated yet</p>\r\n                                                        <button\r\n                                                            onClick={addInventoryRow}\r\n                                                            className=\"text-[10px] text-emerald-500 font-black uppercase tracking-widest hover:underline\"\r\n                                                        >\r\n                                                            Add first item\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </td>\r\n                                            </tr>\r\n                                        )}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n\r\n                            <div className=\"px-10 py-8 bg-muted/20 border-t border-border flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-6\">\r\n                                    <div>\r\n                                        <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-1\">Total Quantity</p>\r\n                                        <p className=\"text-xl font-black font-mono\">{tempAllocations.reduce((sum, a) => sum + (Number(a.quantity) || 0), 0)} Units</p>\r\n                                    </div>\r\n                                    <div className=\"w-px h-10 bg-border\" />\r\n                                    <div>\r\n                                        <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-1\">Total Valuation</p>\r\n                                        <p className=\"text-2xl font-black font-mono text-emerald-600\">Γé╣{tempAllocations.reduce((sum, a) => sum + a.amount, 0).toLocaleString()}</p>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex gap-4\">\r\n                                    <button\r\n                                        onClick={() => setShowInventoryModal(false)}\r\n                                        className=\"px-8 py-3.5 text-[10px] font-black uppercase tracking-widest text-muted-foreground hover:text-foreground transition-all\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={saveAllocation}\r\n                                        className=\"px-12 py-3.5 bg-emerald-500 text-white rounded-2xl font-black text-[11px] uppercase tracking-[0.2em] shadow-xl shadow-emerald-500/20 hover:shadow-emerald-500/40 transition-all active:scale-95\"\r\n                                    >\r\n                                        Confirm Allocation\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\auth\\AuthContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is assigned a value but never used.","line":67,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":67,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is assigned a value but never used.","line":92,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":32},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":112,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":112,"endColumn":24}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect, type ReactNode } from 'react';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\n\r\ninterface User {\r\n    id: string;\r\n    email: string;\r\n    name?: string;\r\n    password?: string; // Stored for local validation\r\n}\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    isAuthenticated: boolean;\r\n    isLoading: boolean;\r\n    login: (email: string, password?: string) => Promise<void>;\r\n    signup: (email: string, name: string, password?: string) => Promise<void>;\r\n    logout: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | null>(null);\r\n\r\nconst AUTH_KEY = 'moneyarc_auth_user';\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const { provider } = usePersistence();\r\n\r\n    useEffect(() => {\r\n        console.log('AuthProvider: Initializing...');\r\n        try {\r\n            const savedUser = localStorage.getItem(AUTH_KEY);\r\n            if (savedUser) {\r\n                console.log('AuthProvider: User found in localStorage.');\r\n                setUser(JSON.parse(savedUser));\r\n            } else {\r\n                console.log('AuthProvider: No user in localStorage.');\r\n            }\r\n        } catch (e) {\r\n            console.warn(\"Failed to parse auth user\", e);\r\n            localStorage.removeItem(AUTH_KEY);\r\n        }\r\n        setIsLoading(false);\r\n    }, []);\r\n\r\n    const getUsers = async (): Promise<User[]> => {\r\n        if (!provider) return JSON.parse(localStorage.getItem('moneyarc_fallback_users') || '[]');\r\n        return await provider.read<User[]>('users.json') || [];\r\n    };\r\n\r\n    const saveUsers = async (users: User[]) => {\r\n        if (!provider) {\r\n            localStorage.setItem('moneyarc_fallback_users', JSON.stringify(users));\r\n            return;\r\n        }\r\n        await provider.write('users.json', users);\r\n    };\r\n\r\n    const login = async (email: string, password?: string) => {\r\n        setIsLoading(true);\r\n        try {\r\n            await new Promise((resolve) => setTimeout(resolve, 600)); // Smooth feel\r\n            const users = await getUsers();\r\n            const foundUser = users.find((u) => u.email === email && (!password || u.password === password));\r\n\r\n            if (foundUser) {\r\n                const { password: _, ...userSafe } = foundUser;\r\n                setUser(userSafe as User);\r\n                localStorage.setItem(AUTH_KEY, JSON.stringify(userSafe));\r\n            } else {\r\n                throw new Error('Invalid credentials or user not found in this directory.');\r\n            }\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const signup = async (email: string, name: string, password?: string) => {\r\n        setIsLoading(true);\r\n        try {\r\n            await new Promise((resolve) => setTimeout(resolve, 800));\r\n            const users = await getUsers();\r\n\r\n            if (users.find((u) => u.email === email)) {\r\n                throw new Error('User already exists in this directory.');\r\n            }\r\n\r\n            const newUser = { id: Math.random().toString(36).substr(2, 9), email, name, password };\r\n            const updatedUsers = [...users, newUser];\r\n            await saveUsers(updatedUsers);\r\n\r\n            const { password: _, ...userSafe } = newUser;\r\n            setUser(userSafe as User);\r\n            localStorage.setItem(AUTH_KEY, JSON.stringify(userSafe));\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        setUser(null);\r\n        localStorage.removeItem(AUTH_KEY);\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, isAuthenticated: !!user, isLoading, login, signup, logout }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useAuth() {\r\n    const context = useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error('useAuth must be used within an AuthProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\auth\\LoginPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[830,833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[830,833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { Mail, ArrowRight, Loader2, Lock, FolderOpen, PieChart } from 'lucide-react';\r\nimport { useNavigate, useLocation, Link } from 'react-router-dom';\r\nimport { useAuth } from './AuthContext';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nexport default function LoginPage() {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [isLoadingLocal, setIsLoadingLocal] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    const { login } = useAuth();\r\n    const { provider, initializeStorage } = usePersistence();\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n\r\n    const from = (location.state as any)?.from?.pathname || \"/dashboard\";\r\n\r\n    const handleLogin = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!provider) {\r\n            setError('Please select a data source folder first.');\r\n            return;\r\n        }\r\n        setError('');\r\n        setIsLoadingLocal(true);\r\n        try {\r\n            await login(email, password);\r\n            navigate(from, { replace: true });\r\n        } catch (err) {\r\n            setError((err as Error).message || 'Invalid credentials.');\r\n        } finally {\r\n            setIsLoadingLocal(false);\r\n        }\r\n    };\r\n\r\n    const handleSelectDir = async () => {\r\n        try {\r\n            await initializeStorage('local');\r\n            setError('');\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-[#0F172A] flex items-center justify-center p-6 relative overflow-hidden\">\r\n            {/* Background Decorative Elements */}\r\n            <div className=\"absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-primary/10 rounded-full blur-[120px]\" />\r\n            <div className=\"absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] bg-cyan-500/10 rounded-full blur-[120px]\" />\r\n\r\n            <motion.div\r\n                initial={{ opacity: 0, scale: 0.95 }}\r\n                animate={{ opacity: 1, scale: 1 }}\r\n                className=\"max-w-md w-full z-10\"\r\n            >\r\n                {/* Logo Area */}\r\n                <div className=\"flex flex-col items-center mb-10\">\r\n                    <div className=\"w-16 h-16 rounded-[1.5rem] bg-gradient-to-br from-primary to-cyan-500 flex items-center justify-center shadow-2xl shadow-primary/20 mb-4 scale-110\">\r\n                        <PieChart className=\"w-8 h-8 text-white\" />\r\n                    </div>\r\n                    <h2 className=\"text-3xl font-black text-white tracking-tight uppercase px-4\">Money<span className=\"text-primary\">Arc</span></h2>\r\n                    <p className=\"text-slate-400 text-xs font-bold uppercase tracking-[0.3em] mt-2\">Professional Accounting Suite</p>\r\n                </div>\r\n\r\n                <div className=\"bg-slate-900/50 backdrop-blur-3xl border border-white/5 p-10 rounded-[2.5rem] shadow-2xl overflow-hidden relative\">\r\n                    <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-50\" />\r\n\r\n                    <div className=\"mb-8\">\r\n                        <h3 className=\"text-xl font-bold text-white mb-1\">Welcome Back</h3>\r\n                        <p className=\"text-slate-400 text-sm\">Unlock your financial data with precision.</p>\r\n                    </div>\r\n\r\n                    {!provider ? (\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"bg-primary/5 border border-primary/20 p-6 rounded-[2rem] text-center\">\r\n                                <FolderOpen className=\"w-10 h-10 text-primary mx-auto mb-4\" />\r\n                                <h4 className=\"text-white font-bold mb-2\">Initialize Data Vault</h4>\r\n                                <p className=\"text-slate-400 text-xs mb-6 px-4\">Select the folder on your computer where your accounting data is stored to proceed.</p>\r\n                                <button\r\n                                    onClick={handleSelectDir}\r\n                                    className=\"w-full py-4 bg-primary text-white rounded-2xl font-black uppercase tracking-widest text-[10px] hover:shadow-xl hover:shadow-primary/20 transition-all flex items-center justify-center gap-3\"\r\n                                >\r\n                                    Select Local Folder\r\n                                    <ArrowRight className=\"w-4 h-4\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <form onSubmit={handleLogin} className=\"space-y-5\">\r\n                            <AnimatePresence>\r\n                                {error && (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0, y: -10 }}\r\n                                        animate={{ opacity: 1, y: 0 }}\r\n                                        className=\"p-4 rounded-2xl bg-rose-500/10 border border-rose-500/20 text-rose-400 text-xs font-bold italic\"\r\n                                    >\r\n                                        {error}\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1\">Identity (Email)</label>\r\n                                    <div className=\"relative group\">\r\n                                        <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 w-4 h-4 group-focus-within:text-primary transition-colors\" />\r\n                                        <input\r\n                                            type=\"email\"\r\n                                            required\r\n                                            value={email}\r\n                                            onChange={(e) => setEmail(e.target.value)}\r\n                                            className=\"w-full pl-12 pr-4 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none focus:border-primary/50 focus:ring-4 focus:ring-primary/5 transition-all text-sm font-bold\"\r\n                                            placeholder=\"admin@company.com\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1\">Access Key (Password)</label>\r\n                                    <div className=\"relative group\">\r\n                                        <Lock className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 w-4 h-4 group-focus-within:text-primary transition-colors\" />\r\n                                        <input\r\n                                            type=\"password\"\r\n                                            required\r\n                                            value={password}\r\n                                            onChange={(e) => setPassword(e.target.value)}\r\n                                            className=\"w-full pl-12 pr-4 py-4 bg-white/5 border border-white/10 rounded-2xl text-white outline-none focus:border-primary/50 focus:ring-4 focus:ring-primary/5 transition-all text-sm font-bold\"\r\n                                            placeholder=\"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button\r\n                                type=\"submit\"\r\n                                disabled={isLoadingLocal}\r\n                                className=\"w-full py-5 bg-gradient-to-r from-primary to-cyan-600 text-white rounded-[1.5rem] font-black uppercase tracking-[0.2em] text-[11px] hover:shadow-2xl hover:shadow-primary/30 transition-all active:scale-95 disabled:opacity-50 mt-4 flex items-center justify-center gap-3\"\r\n                            >\r\n                                {isLoadingLocal ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : (\r\n                                    <>\r\n                                        Authorize Entry\r\n                                        <ArrowRight className=\"w-4 h-4\" />\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n\r\n                            <div className=\"pt-2 text-center text-[10px] text-slate-500 font-bold uppercase tracking-widest\">\r\n                                Connected to: <span className=\"text-primary/70\">Local System Vault</span>\r\n                            </div>\r\n                        </form>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"mt-8 text-center space-y-4\">\r\n                    <p className=\"text-slate-500 text-sm font-medium\">\r\n                        Need to establish a new vault? <Link to=\"/signup\" className=\"text-primary font-black hover:text-cyan-400 transition-colors uppercase tracking-widest ml-1\">Create Account</Link>\r\n                    </p>\r\n                    <div className=\"flex justify-center gap-6 opacity-30 grayscale hover:grayscale-0 transition-all\">\r\n                        {/* Soft Brand Icons if needed */}\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\auth\\SignUpPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\dashboard\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1476,1479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1476,1479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2410,2413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2410,2413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TrendingUp, TrendingDown, DollarSign, Activity, Wallet, FileText, ShieldCheck, Settings } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { useTheme } from '../../features/settings/ThemeContext';\r\nimport { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\nimport { ACCT_GROUPS, type Ledger } from '../../services/accounting/ReportService';\r\n\r\nexport default function Dashboard() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const { theme } = useTheme();\r\n    const navigate = useNavigate();\r\n    const [stats, setStats] = useState([\r\n        { label: 'Total Revenue', value: 'Γé╣0.00', change: '0%', icon: DollarSign, color: 'text-cyan-500', bg: 'bg-cyan-500/10' },\r\n        { label: 'Total Expenses', value: 'Γé╣0.00', change: '0%', icon: TrendingDown, color: 'text-rose-500', bg: 'bg-rose-500/10' },\r\n        { label: 'Net Profit', value: 'Γé╣0.00', change: '0%', icon: TrendingUp, color: 'text-emerald-500', bg: 'bg-emerald-500/10' },\r\n        { label: 'Vouchers', value: '0', change: '0', icon: Activity, color: 'text-purple-500', bg: 'bg-purple-500/10' },\r\n    ]);\r\n    const [chartData, setChartData] = useState<any[]>([]);\r\n\r\n    useEffect(() => {\r\n        const loadDashboardData = async () => {\r\n            if (!provider || !activeCompany) return;\r\n\r\n            const vouchers = await provider.read<Voucher[]>('vouchers.json', activeCompany.path) || [];\r\n            const ledgers = await provider.read<Ledger[]>('ledgers.json', activeCompany.path) || [];\r\n\r\n            // Map ledger name to group\r\n            const ledgerGroupMap = new Map(ledgers.map(l => [l.name, l.group]));\r\n\r\n            // Calculate stats\r\n            let revenue = 0;\r\n            let expenses = 0;\r\n\r\n            // Build month-based aggregation\r\n            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n            const monthlyData = months.reduce((acc, month) => {\r\n                acc[month] = { name: month, revenue: 0, expenses: 0 };\r\n                return acc;\r\n            }, {} as Record<string, any>);\r\n\r\n            vouchers.forEach(v => {\r\n                const date = new Date(v.date);\r\n                const month = months[date.getMonth()];\r\n\r\n                v.rows.forEach(r => {\r\n                    const group = ledgerGroupMap.get(r.account);\r\n                    if (group && ACCT_GROUPS.INCOME.includes(group)) {\r\n                        if (r.type === 'Cr') {\r\n                            revenue += r.credit;\r\n                            monthlyData[month].revenue += r.credit;\r\n                        }\r\n                    }\r\n                    if (group && ACCT_GROUPS.EXPENSES.includes(group)) {\r\n                        if (r.type === 'Dr') {\r\n                            expenses += r.debit;\r\n                            monthlyData[month].expenses += r.debit;\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            setStats([\r\n                { label: 'Total Revenue', value: `Γé╣${revenue.toLocaleString()}`, change: '+0%', icon: DollarSign, color: 'text-cyan-500', bg: 'bg-cyan-500/10' },\r\n                { label: 'Total Expenses', value: `Γé╣${expenses.toLocaleString()}`, change: '-0%', icon: TrendingDown, color: 'text-rose-500', bg: 'bg-rose-500/10' },\r\n                { label: 'Net Profit', value: `Γé╣${(revenue - expenses).toLocaleString()}`, change: '+0%', icon: TrendingUp, color: 'text-emerald-500', bg: 'bg-emerald-500/10' },\r\n                { label: 'Vouchers', value: vouchers.length.toString(), change: `+${vouchers.length}`, icon: Activity, color: 'text-purple-500', bg: 'bg-purple-500/10' },\r\n            ]);\r\n\r\n            // Filter out months with no data for a cleaner chart, or just show last 6 months\r\n            const currentMonth = new Date().getMonth();\r\n            const last6Months = [];\r\n            for (let i = 5; i >= 0; i--) {\r\n                const mIdx = (currentMonth - i + 12) % 12;\r\n                last6Months.push(monthlyData[months[mIdx]]);\r\n            }\r\n\r\n            setChartData(last6Months);\r\n        };\r\n        loadDashboardData();\r\n    }, [provider, activeCompany]);\r\n\r\n    const container = {\r\n        hidden: { opacity: 0 },\r\n        show: {\r\n            opacity: 1,\r\n            transition: { staggerChildren: 0.1 }\r\n        }\r\n    };\r\n\r\n    const item = {\r\n        hidden: { y: 20, opacity: 0 },\r\n        show: { y: 0, opacity: 1 }\r\n    };\r\n\r\n    return (\r\n        <motion.div variants={container} initial=\"hidden\" animate=\"show\" className=\"space-y-8 max-w-7xl mx-auto\">\r\n            <motion.div variants={item} className=\"flex justify-between items-end\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black tracking-tight text-foreground\">\r\n                        {activeCompany?.name || 'Dashboard'}\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground font-medium\">Financial overview for {activeCompany?.financialYear || 'current period'}</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <div className=\"px-4 py-2 bg-card border border-border rounded-xl text-xs font-bold uppercase tracking-widest text-muted-foreground shadow-sm\">\r\n                        Live Preview\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n                <AnimatePresence>\r\n                    {stats.map((stat, index) => (\r\n                        <motion.div\r\n                            key={index}\r\n                            variants={item}\r\n                            whileHover={{ y: -5, transition: { duration: 0.2 } }}\r\n                            className=\"bg-card p-6 rounded-2xl shadow-sm border border-border group relative overflow-hidden transition-colors\"\r\n                        >\r\n                            <div className={`absolute top-0 right-0 w-24 h-24 -mr-8 -mt-8 rounded-full ${stat.bg} blur-3xl opacity-20 group-hover:opacity-40 transition-opacity`} />\r\n                            <div className=\"flex items-center justify-between mb-4 relative z-10\">\r\n                                <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${stat.bg} ${stat.color} shadow-inner`}>\r\n                                    <stat.icon className=\"w-6 h-6\" />\r\n                                </div>\r\n                                <span className={`text-xs font-black px-2 py-1 rounded-lg ${stat.change.startsWith('+') ? 'bg-emerald-500/10 text-emerald-500' : 'bg-rose-500/10 text-rose-500'}`}>\r\n                                    {stat.change}\r\n                                </span>\r\n                            </div>\r\n                            <h3 className=\"text-muted-foreground text-xs font-bold uppercase tracking-widest\">{stat.label}</h3>\r\n                            <p className=\"text-2xl font-black mt-1 tracking-tight\">{stat.value}</p>\r\n                        </motion.div>\r\n                    ))}\r\n                </AnimatePresence>\r\n            </div>\r\n\r\n            <motion.div variants={item} className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                <div className=\"lg:col-span-2 bg-card rounded-3xl shadow-sm border border-border p-8 relative overflow-hidden group\">\r\n                    <div className=\"flex justify-between items-center mb-8 relative z-10\">\r\n                        <div>\r\n                            <h2 className=\"text-xl font-black tracking-tight\">Financial Trends</h2>\r\n                            <p className=\"text-sm text-muted-foreground\">Revenue and expenses over time</p>\r\n                        </div>\r\n                        <div className=\"flex gap-4\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <div className=\"w-3 h-3 rounded-full bg-cyan-500\" />\r\n                                <span className=\"text-xs font-bold text-muted-foreground uppercase\">Revenue</span>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <div className=\"w-3 h-3 rounded-full bg-rose-500\" />\r\n                                <span className=\"text-xs font-bold text-muted-foreground uppercase\">Expenses</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"h-80 relative z-10\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <AreaChart data={chartData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>\r\n                                <defs>\r\n                                    <linearGradient id=\"colorRev\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"rgb(6, 182, 212)\" stopOpacity={0.3} />\r\n                                        <stop offset=\"95%\" stopColor=\"rgb(6, 182, 212)\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                    <linearGradient id=\"colorExp\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"rgb(244, 63, 94)\" stopOpacity={0.3} />\r\n                                        <stop offset=\"95%\" stopColor=\"rgb(244, 63, 94)\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                </defs>\r\n                                <XAxis\r\n                                    dataKey=\"name\"\r\n                                    axisLine={false}\r\n                                    tickLine={false}\r\n                                    tick={{ fill: theme === 'dark' ? '#94a3b8' : '#64748b', fontSize: 12, fontWeight: 600 }}\r\n                                />\r\n                                <YAxis\r\n                                    axisLine={false}\r\n                                    tickLine={false}\r\n                                    tick={{ fill: theme === 'dark' ? '#94a3b8' : '#64748b', fontSize: 12, fontWeight: 600 }}\r\n                                />\r\n                                <CartesianGrid vertical={false} stroke={theme === 'dark' ? '#1e293b' : '#f1f5f9'} strokeDasharray=\"3 3\" />\r\n                                <Tooltip\r\n                                    contentStyle={{\r\n                                        backgroundColor: theme === 'dark' ? '#0f172a' : '#fff',\r\n                                        borderRadius: '16px',\r\n                                        border: 'none',\r\n                                        boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)',\r\n                                        fontSize: '12px',\r\n                                        fontWeight: 'bold'\r\n                                    }}\r\n                                />\r\n                                <Area type=\"monotone\" dataKey=\"revenue\" stroke=\"rgb(6, 182, 212)\" strokeWidth={4} fillOpacity={1} fill=\"url(#colorRev)\" />\r\n                                <Area type=\"monotone\" dataKey=\"expenses\" stroke=\"rgb(244, 63, 94)\" strokeWidth={4} fillOpacity={1} fill=\"url(#colorExp)\" />\r\n                            </AreaChart>\r\n                        </ResponsiveContainer>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"bg-card rounded-3xl shadow-sm border border-border p-8\">\r\n                        <h2 className=\"text-xl font-black tracking-tight mb-6 flex items-center gap-2\">\r\n                            Quick Actions\r\n                        </h2>\r\n                        <div className=\"space-y-4\">\r\n                            {[\r\n                                { label: 'New Voucher', icon: Wallet, color: 'text-cyan-500', bg: 'bg-cyan-500/10', path: '/vouchers/new' },\r\n                                { label: 'GSTR-1 Report', icon: FileText, color: 'text-emerald-500', bg: 'bg-emerald-500/10', path: '/reports/gst/r1' },\r\n                                { label: 'Audit Trail', icon: ShieldCheck, color: 'text-rose-500', bg: 'bg-rose-500/10', path: '/security/audit' },\r\n                                { label: 'Settings', icon: Settings, color: 'text-slate-500', bg: 'bg-slate-500/10', path: '/settings' },\r\n                            ].map((action, i) => (\r\n                                <button\r\n                                    key={i}\r\n                                    onClick={() => navigate(action.path)}\r\n                                    className=\"w-full flex items-center justify-between p-4 rounded-2xl border border-transparent bg-background hover:bg-muted hover:border-border transition-all group\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${action.bg} ${action.color}`}>\r\n                                            <action.icon className=\"w-5 h-5\" />\r\n                                        </div>\r\n                                        <span className=\"font-bold text-sm\">{action.label}</span>\r\n                                    </div>\r\n                                    <TrendingUp className=\"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors\" />\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\inventory\\StockGroupForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\inventory\\StockGroupList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\inventory\\StockItemForm.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.openingValue'. Either include it or remove the dependency array.","line":81,"column":8,"nodeType":"ArrayExpression","endLine":81,"endColumn":53,"suggestions":[{"desc":"Update the dependencies array to be: [formData.openingStock, formData.openingRate, formData.openingValue]","fix":{"range":[3251,3296],"text":"[formData.openingStock, formData.openingRate, formData.openingValue]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Save, Info, Target, Calculator } from 'lucide-react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport type { StockItem, UnitOfMeasure, StockGroup } from '../../services/inventory/types';\r\n\r\nexport default function StockItemForm() {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const { provider, activeCompany } = usePersistence();\r\n\r\n    const [units, setUnits] = useState<UnitOfMeasure[]>([]);\r\n    const [groups, setGroups] = useState<StockGroup[]>([]);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        groupId: '',\r\n        unitId: '',\r\n        sku: '',\r\n        description: '',\r\n        openingStock: 0,\r\n        openingRate: 0,\r\n        openingValue: 0,\r\n        reorderLevel: 0,\r\n        isBatchEnabled: false,\r\n        isExpiryEnabled: false,\r\n        hsnCode: '',\r\n        gstRate: 0\r\n    });\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            if (!provider || !activeCompany) return;\r\n            setIsLoading(true);\r\n            try {\r\n                const [itemData, unitData, groupData] = await Promise.all([\r\n                    id ? provider.read<StockItem[]>('stock_items.json', activeCompany.path) : Promise.resolve(null),\r\n                    provider.read<UnitOfMeasure[]>('units.json', activeCompany.path),\r\n                    provider.read<StockGroup[]>('stock_groups.json', activeCompany.path)\r\n                ]);\r\n\r\n                setUnits(unitData || []);\r\n                setGroups(groupData || []);\r\n\r\n                if (id && itemData) {\r\n                    const item = itemData.find(i => i.id === id);\r\n                    if (item) {\r\n                        setFormData({\r\n                            name: item.name,\r\n                            groupId: item.groupId,\r\n                            unitId: item.unitId,\r\n                            sku: item.sku || '',\r\n                            description: item.description || '',\r\n                            openingStock: item.openingStock,\r\n                            openingRate: item.openingRate,\r\n                            openingValue: item.openingValue,\r\n                            reorderLevel: item.reorderLevel || 0,\r\n                            isBatchEnabled: item.isBatchEnabled,\r\n                            isExpiryEnabled: item.isExpiryEnabled,\r\n                            hsnCode: item.hsnCode || '',\r\n                            gstRate: item.gstRate || 0\r\n                        });\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Failed to load stock data\", e);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n        fetchData();\r\n    }, [id, provider, activeCompany]);\r\n\r\n    // Auto-calculate total value\r\n    useEffect(() => {\r\n        const value = formData.openingStock * formData.openingRate;\r\n        if (value !== formData.openingValue) {\r\n            setFormData(prev => ({ ...prev, openingValue: value }));\r\n        }\r\n    }, [formData.openingStock, formData.openingRate]);\r\n\r\n    const handleSave = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!provider || !activeCompany) return;\r\n\r\n        try {\r\n            const items = (await provider.read<StockItem[]>('stock_items.json', activeCompany.path)) || [];\r\n            const newItem: StockItem = {\r\n                id: id || Date.now().toString(),\r\n                ...formData\r\n            };\r\n\r\n            let updated;\r\n            if (id) {\r\n                updated = items.map(i => i.id === id ? newItem : i);\r\n            } else {\r\n                updated = [...items, newItem];\r\n            }\r\n\r\n            await provider.write('stock_items.json', updated, activeCompany.path);\r\n            navigate('/inventory/items');\r\n        } catch (error) {\r\n            console.error('Failed to save stock item:', error);\r\n            alert('Failed to save stock item.');\r\n        }\r\n    };\r\n\r\n    if (isLoading) return <div className=\"p-12 text-center text-muted-foreground\">Loading Stock Item...</div>;\r\n\r\n    return (\r\n        <div className=\"max-w-5xl mx-auto space-y-8\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-foreground tracking-tight uppercase\">\r\n                        {id ? 'Alter Item' : 'Establish Item'}\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground font-medium\">Add or modify products in your inventory catalog.</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={() => navigate('/inventory/items')}\r\n                        className=\"px-6 py-3 border border-border rounded-xl font-bold uppercase tracking-widest text-xs text-muted-foreground hover:bg-muted/50 transition-all font-mono\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSave}\r\n                        className=\"flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-xl font-bold uppercase tracking-widest text-xs hover:shadow-lg hover:shadow-primary/20 transition-all active:scale-95\"\r\n                    >\r\n                        <Save className=\"w-5 h-5\" />\r\n                        <span>{id ? 'Update Item' : 'Save Item'}</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <form onSubmit={handleSave} className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                <div className=\"lg:col-span-2 space-y-8\">\r\n                    {/* Basic Info */}\r\n                    <div className=\"bg-card rounded-3xl p-8 border border-border shadow-sm space-y-6\">\r\n                        <div className=\"flex items-center gap-2 text-primary mb-2\">\r\n                            <Info className=\"w-4 h-4\" />\r\n                            <h3 className=\"text-xs font-black uppercase tracking-[0.2em]\">Basic Identity</h3>\r\n                        </div>\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Stock Item Name</label>\r\n                                <input\r\n                                    required\r\n                                    type=\"text\"\r\n                                    value={formData.name}\r\n                                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                                    className=\"w-full px-5 py-4 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-xl\"\r\n                                    placeholder=\"e.g. MacBook Pro M3\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-6\">\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">SKU / Part Number</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={formData.sku}\r\n                                        onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-mono font-bold\"\r\n                                        placeholder=\"MBP-M3-2024\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">HSN Code</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={formData.hsnCode}\r\n                                        onChange={(e) => setFormData({ ...formData, hsnCode: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-mono font-bold\"\r\n                                        placeholder=\"8471\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Classification */}\r\n                    <div className=\"bg-card rounded-3xl p-8 border border-border shadow-sm space-y-6\">\r\n                        <div className=\"flex items-center gap-2 text-primary mb-2\">\r\n                            <Target className=\"w-4 h-4\" />\r\n                            <h3 className=\"text-xs font-black uppercase tracking-[0.2em]\">Classification & Units</h3>\r\n                        </div>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Under Group</label>\r\n                                <select\r\n                                    value={formData.groupId}\r\n                                    onChange={(e) => setFormData({ ...formData, groupId: e.target.value })}\r\n                                    className=\"w-full px-5 py-4 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold appearance-none\"\r\n                                >\r\n                                    <option value=\"\">Primary</option>\r\n                                    {groups.map(g => <option key={g.id} value={g.id}>{g.name}</option>)}\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Base Unit</label>\r\n                                <select\r\n                                    required\r\n                                    value={formData.unitId}\r\n                                    onChange={(e) => setFormData({ ...formData, unitId: e.target.value })}\r\n                                    className=\"w-full px-5 py-4 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold appearance-none\"\r\n                                >\r\n                                    <option value=\"\">Select Unit</option>\r\n                                    {units.map(u => <option key={u.id} value={u.id}>{u.name} ({u.formalName})</option>)}\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Opening Balance */}\r\n                    <div className=\"bg-card rounded-3xl p-8 border border-border shadow-sm space-y-6\">\r\n                        <div className=\"flex items-center gap-2 text-primary mb-2\">\r\n                            <Calculator className=\"w-4 h-4\" />\r\n                            <h3 className=\"text-xs font-black uppercase tracking-[0.2em]\">Opening Balance</h3>\r\n                        </div>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Quantity</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.openingStock}\r\n                                    onChange={(e) => setFormData({ ...formData, openingStock: parseFloat(e.target.value) || 0 })}\r\n                                    className=\"w-full px-5 py-4 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-mono font-bold text-lg\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Rate per Unit</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.openingRate}\r\n                                    onChange={(e) => setFormData({ ...formData, openingRate: parseFloat(e.target.value) || 0 })}\r\n                                    className=\"w-full px-5 py-4 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-mono font-bold text-lg\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Total Value</label>\r\n                                <div className=\"w-full px-5 py-4 bg-primary/5 border border-primary/20 rounded-2xl font-mono font-black text-primary text-xl\">\r\n                                    {formData.openingValue.toLocaleString('en-IN', { minimumFractionDigits: 2 })}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-8\">\r\n                    {/* GST & Extra */}\r\n                    <div className=\"bg-card rounded-3xl p-8 border border-border shadow-sm space-y-6\">\r\n                        <h3 className=\"text-xs font-black text-muted-foreground uppercase tracking-[0.2em]\">Statutory & Tracking</h3>\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">GST Rate (%)</label>\r\n                                <select\r\n                                    value={formData.gstRate}\r\n                                    onChange={(e) => setFormData({ ...formData, gstRate: parseFloat(e.target.value) || 0 })}\r\n                                    className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold\"\r\n                                >\r\n                                    <option value=\"0\">0% (Exempt)</option>\r\n                                    <option value=\"5\">5%</option>\r\n                                    <option value=\"12\">12%</option>\r\n                                    <option value=\"18\">18%</option>\r\n                                    <option value=\"28\">28%</option>\r\n                                </select>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Re-order Level</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={formData.reorderLevel}\r\n                                    onChange={(e) => setFormData({ ...formData, reorderLevel: parseFloat(e.target.value) || 0 })}\r\n                                    className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-mono font-bold\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"pt-4 space-y-4\">\r\n                                <label className=\"flex items-center gap-3 cursor-pointer group\">\r\n                                    <div className={`w-10 h-6 rounded-full transition-all relative ${formData.isBatchEnabled ? 'bg-primary' : 'bg-muted'}`}>\r\n                                        <div className={`absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-all ${formData.isBatchEnabled ? 'translate-x-4' : ''}`} />\r\n                                    </div>\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        className=\"hidden\"\r\n                                        checked={formData.isBatchEnabled}\r\n                                        onChange={(e) => setFormData({ ...formData, isBatchEnabled: e.target.checked })}\r\n                                    />\r\n                                    <span className=\"text-xs font-bold text-foreground\">Maintain Batches</span>\r\n                                </label>\r\n                                <label className=\"flex items-center gap-3 cursor-pointer group\">\r\n                                    <div className={`w-10 h-6 rounded-full transition-all relative ${formData.isExpiryEnabled ? 'bg-primary' : 'bg-muted'}`}>\r\n                                        <div className={`absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-all ${formData.isExpiryEnabled ? 'translate-x-4' : ''}`} />\r\n                                    </div>\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        className=\"hidden\"\r\n                                        checked={formData.isExpiryEnabled}\r\n                                        onChange={(e) => setFormData({ ...formData, isExpiryEnabled: e.target.checked })}\r\n                                    />\r\n                                    <span className=\"text-xs font-bold text-foreground\">Track Expiry</span>\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\inventory\\StockItemList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\inventory\\StockSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\inventory\\UnitForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\inventory\\UnitList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\onboarding\\CompanySelect.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadCompanies' and 'navigate'. Either include them or remove the dependency array.","line":36,"column":8,"nodeType":"ArrayExpression","endLine":36,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [loadCompanies, navigate, provider]","fix":{"range":[1348,1358],"text":"[loadCompanies, navigate, provider]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":263,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15171,15174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15171,15174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Building2, Plus, Search, Calendar, ChevronRight, Loader2 } from 'lucide-react';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport type { Company } from '../../services/persistence/types';\r\n\r\nexport default function CompanySelect() {\r\n    const { provider, selectCompany } = usePersistence();\r\n    const [companies, setCompanies] = useState<Company[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [showCreateForm, setShowCreateForm] = useState(false);\r\n    const [editingCompanyId, setEditingCompanyId] = useState<string | null>(null);\r\n    const [newCompany, setNewCompany] = useState<Omit<Company, 'id' | 'path'>>({\r\n        name: '',\r\n        financialYear: '2025-26',\r\n        gstin: '',\r\n        address: '',\r\n        state: 'Maharashtra',\r\n        country: 'India',\r\n        phone: '',\r\n        email: '',\r\n        website: '',\r\n        currency: 'INR',\r\n        symbol: 'Γé╣',\r\n        registrationType: 'Regular'\r\n    });\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        if (!provider) {\r\n            navigate('/select-source');\r\n            return;\r\n        }\r\n        loadCompanies();\r\n    }, [provider]);\r\n\r\n    const loadCompanies = async () => {\r\n        if (!provider) return;\r\n        setIsLoading(true);\r\n        try {\r\n            const list = await provider.listCompanies();\r\n            setCompanies(list);\r\n        } catch (error) {\r\n            console.error(\"Failed to load companies\", error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSelect = (company: Company) => {\r\n        selectCompany(company);\r\n        navigate('/dashboard');\r\n    };\r\n\r\n    const handleEdit = (company: Company) => {\r\n        setNewCompany({\r\n            name: company.name,\r\n            financialYear: company.financialYear,\r\n            gstin: company.gstin || '',\r\n            address: company.address || '',\r\n            state: company.state || '',\r\n            country: company.country || 'India',\r\n            phone: company.phone || '',\r\n            email: company.email || '',\r\n            website: company.website || '',\r\n            currency: company.currency || 'INR',\r\n            symbol: company.symbol || 'Γé╣',\r\n            registrationType: company.registrationType || 'Regular'\r\n        });\r\n        setEditingCompanyId(company.id);\r\n        setShowCreateForm(true);\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setNewCompany({\r\n            name: '',\r\n            financialYear: '2025-26',\r\n            gstin: '',\r\n            address: '',\r\n            state: 'Maharashtra',\r\n            country: 'India',\r\n            phone: '',\r\n            email: '',\r\n            website: '',\r\n            currency: 'INR',\r\n            symbol: 'Γé╣',\r\n            registrationType: 'Regular'\r\n        });\r\n        setEditingCompanyId(null);\r\n        setShowCreateForm(false);\r\n    };\r\n\r\n    const handleCreate = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!provider) return;\r\n        setIsLoading(true);\r\n        try {\r\n            if (editingCompanyId) {\r\n                const companyToEdit = companies.find(c => c.id === editingCompanyId);\r\n                if (companyToEdit) {\r\n                    await provider.updateCompany(editingCompanyId, companyToEdit.path, newCompany);\r\n                    await loadCompanies();\r\n                    resetForm();\r\n                }\r\n            } else {\r\n                const created = await provider.createCompany(newCompany);\r\n                handleSelect(created);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to save company\", error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const filteredCompanies = companies.filter(c =>\r\n        c.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\r\n            <div className=\"max-w-4xl w-full\">\r\n                <div className=\"text-center mb-10\">\r\n                    <h1 className=\"text-4xl font-black text-foreground mb-4 tracking-tight uppercase\">Select Company</h1>\r\n                    <p className=\"text-muted-foreground font-medium\">Choose a workspace to manage your financial arc.</p>\r\n                </div>\r\n\r\n                <div className=\"bg-card rounded-3xl shadow-xl overflow-hidden border border-border\">\r\n                    <div className=\"p-8 border-b border-border flex items-center justify-between bg-card/50 backdrop-blur-sm sticky top-0 z-10\">\r\n                        <div className=\"relative flex-1 max-w-md\">\r\n                            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground w-5 h-5\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Search companies...\"\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                className=\"w-full pl-12 pr-4 py-3 bg-muted/30 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-medium\"\r\n                            />\r\n                        </div>\r\n                        <button\r\n                            onClick={() => setShowCreateForm(true)}\r\n                            className=\"ml-6 flex items-center gap-2 bg-primary text-primary-foreground px-6 py-3 rounded-2xl font-black uppercase tracking-widest text-xs hover:shadow-lg hover:shadow-primary/20 transition-all active:scale-95\"\r\n                        >\r\n                            <Plus className=\"w-5 h-5\" />\r\n                            New Company\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"divide-y divide-border/50 max-h-[500px] overflow-y-auto\">\r\n                        {isLoading ? (\r\n                            <div className=\"py-24 flex flex-col items-center justify-center text-muted-foreground\">\r\n                                <Loader2 className=\"w-12 h-12 animate-spin text-primary mb-6\" />\r\n                                <p className=\"font-bold uppercase tracking-widest text-xs\">Accessing Ledgers...</p>\r\n                            </div>\r\n                        ) : filteredCompanies.length > 0 ? (\r\n                            filteredCompanies.map((company) => (\r\n                                <button\r\n                                    key={company.id}\r\n                                    onClick={() => handleSelect(company)}\r\n                                    className=\"w-full p-8 flex items-center justify-between hover:bg-muted/30 transition-all text-left group\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-6\">\r\n                                        <div className=\"w-16 h-16 bg-primary/10 rounded-2xl flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-primary-foreground transition-all duration-300\">\r\n                                            <Building2 className=\"w-8 h-8\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h3 className=\"text-xl font-black text-foreground group-hover:text-primary transition-colors tracking-tight\">\r\n                                                {company.name}\r\n                                            </h3>\r\n                                            <div className=\"flex items-center gap-4 text-xs font-bold text-muted-foreground mt-2 uppercase tracking-widest\">\r\n                                                <span className=\"flex items-center gap-1.5\">\r\n                                                    <Calendar className=\"w-4 h-4\" />\r\n                                                    FY: {company.financialYear}\r\n                                                </span>\r\n                                                <span className=\"w-1.5 h-1.5 bg-border rounded-full\"></span>\r\n                                                <span>GSTIN: {company.gstin || 'UNREGISTERED'}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"text-right hidden sm:block\">\r\n                                            <p className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground\">Active State</p>\r\n                                            <p className=\"text-sm font-bold text-foreground\">{company.state || 'N/A'}</p>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                handleEdit(company);\r\n                                            }}\r\n                                            className=\"p-2 text-muted-foreground hover:text-primary hover:bg-primary/10 rounded-xl transition-all\"\r\n                                        >\r\n                                            <Building2 className=\"w-5 h-5\" />\r\n                                        </button>\r\n                                        <ChevronRight className=\"w-8 h-8 text-border group-hover:text-primary group-hover:translate-x-1 transition-all\" />\r\n                                    </div>\r\n                                </button>\r\n                            ))\r\n                        ) : (\r\n                            <div className=\"py-32 text-center text-muted-foreground\">\r\n                                <div className=\"w-20 h-20 bg-muted rounded-3xl flex items-center justify-center mx-auto mb-6\">\r\n                                    <Building2 className=\"w-10 h-10\" />\r\n                                </div>\r\n                                <p className=\"text-xl font-black text-foreground mb-2\">No Companies Found</p>\r\n                                <p className=\"text-sm font-medium\">Initialize a new company to begin your accounting arc.</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Create Company Modal */}\r\n            {showCreateForm && (\r\n                <div className=\"fixed inset-0 bg-background/80 backdrop-blur-md flex items-center justify-center p-4 z-50 overflow-y-auto\">\r\n                    <div className=\"bg-card rounded-[2.5rem] shadow-2xl w-full max-w-2xl my-8 overflow-hidden animate-in fade-in zoom-in duration-300 border border-border\">\r\n                        <div className=\"p-10 border-b border-border bg-muted/30\">\r\n                            <h2 className=\"text-3xl font-black text-foreground tracking-tight uppercase\">\r\n                                {editingCompanyId ? 'Alter Company' : 'Establish Company'}\r\n                            </h2>\r\n                            <p className=\"font-medium text-muted-foreground mt-1\">\r\n                                {editingCompanyId ? 'Modify your organization details.' : \"Define your organization's core financial identity.\"}\r\n                            </p>\r\n                        </div>\r\n                        <form onSubmit={handleCreate} className=\"p-10 space-y-8\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Company Name</label>\r\n                                    <input\r\n                                        required\r\n                                        type=\"text\"\r\n                                        value={newCompany.name}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, name: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground\"\r\n                                        placeholder=\"e.g., MoneyArc Tech Solutions\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Financial Year</label>\r\n                                    <select\r\n                                        value={newCompany.financialYear}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, financialYear: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground appearance-none\"\r\n                                    >\r\n                                        <option value=\"2024-25\">2024-25</option>\r\n                                        <option value=\"2025-26\">2025-26</option>\r\n                                        <option value=\"2026-27\">2026-27</option>\r\n                                    </select>\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">GSTIN Number</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={newCompany.gstin}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, gstin: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground uppercase\"\r\n                                        placeholder=\"27AAACR1234A1Z1\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Registration Type</label>\r\n                                    <select\r\n                                        value={newCompany.registrationType}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, registrationType: e.target.value as any })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground appearance-none\"\r\n                                    >\r\n                                        <option value=\"Regular\">Regular</option>\r\n                                        <option value=\"Composition\">Composition</option>\r\n                                        <option value=\"Unregistered\">Unregistered</option>\r\n                                    </select>\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Country</label>\r\n                                    <input\r\n                                        required\r\n                                        type=\"text\"\r\n                                        value={newCompany.country}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, country: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground\"\r\n                                        placeholder=\"e.g., India\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">State</label>\r\n                                    <input\r\n                                        required\r\n                                        type=\"text\"\r\n                                        value={newCompany.state}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, state: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground\"\r\n                                        placeholder=\"e.g., Maharashtra\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Phone</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={newCompany.phone}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, phone: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground\"\r\n                                        placeholder=\"+91 98765 43210\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Email</label>\r\n                                    <input\r\n                                        type=\"email\"\r\n                                        value={newCompany.email}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, email: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground\"\r\n                                        placeholder=\"contact@company.com\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"md:col-span-2 space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Business Address</label>\r\n                                    <textarea\r\n                                        value={newCompany.address}\r\n                                        onChange={(e) => setNewCompany({ ...newCompany, address: e.target.value })}\r\n                                        className=\"w-full px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground resize-none\"\r\n                                        rows={2}\r\n                                        placeholder=\"Enter full registered address...\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"md:col-span-2 space-y-2\">\r\n                                    <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] ml-1\">Currency & Symbol</label>\r\n                                    <div className=\"flex gap-4\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={newCompany.currency}\r\n                                            onChange={(e) => setNewCompany({ ...newCompany, currency: e.target.value })}\r\n                                            className=\"flex-1 px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground\"\r\n                                            placeholder=\"Currency (e.g., INR)\"\r\n                                        />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={newCompany.symbol}\r\n                                            onChange={(e) => setNewCompany({ ...newCompany, symbol: e.target.value })}\r\n                                            className=\"w-24 px-5 py-3.5 bg-muted/20 border border-border rounded-2xl focus:ring-2 focus:ring-primary outline-none transition-all font-bold text-foreground\"\r\n                                            placeholder=\"Symbol (Γé╣)\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-4 pt-6\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={resetForm}\r\n                                    className=\"flex-1 px-8 py-4 border border-border rounded-2xl font-black uppercase tracking-widest text-xs text-muted-foreground hover:bg-muted/50 hover:text-foreground transition-all\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={isLoading}\r\n                                    className=\"flex-[2] bg-primary text-primary-foreground px-8 py-4 rounded-2xl font-black uppercase tracking-widest text-xs hover:shadow-xl hover:shadow-primary/20 transition-all active:scale-95 flex items-center justify-center gap-2\"\r\n                                >\r\n                                    {isLoading ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : (editingCompanyId ? 'Update Workspace' : 'Create Workspace')}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\onboarding\\DataSourceSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\reports\\BalanceSheet.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1109,1112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1109,1112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3035,3038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3035,3038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { ReportService, ACCT_GROUPS, type Ledger, type GroupSummary } from '../../services/accounting/ReportService';\r\nimport { Calendar, FileDown } from 'lucide-react';\r\nimport { ExportService } from '../../services/reports/ExportService';\r\n\r\nexport default function BalanceSheet() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const [liabilities, setLiabilities] = useState<GroupSummary[]>([]);\r\n    const [assets, setAssets] = useState<GroupSummary[]>([]);\r\n    const [closingStock, setClosingStock] = useState(0);\r\n    const [netProfit, setNetProfit] = useState(0);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (!provider || !activeCompany) return;\r\n\r\n            const [ledgerData, stockItemsData] = await Promise.all([\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                provider.read<any[]>('stock_items.json', activeCompany.path)\r\n            ]);\r\n\r\n            const ledgers = ledgerData || [];\r\n            const stockItems = stockItemsData || [];\r\n\r\n            const liabilityData = ReportService.getGroupSummary(ledgers as Ledger[], ACCT_GROUPS.LIABILITIES);\r\n            const assetData = ReportService.getGroupSummary(ledgers as Ledger[], ACCT_GROUPS.ASSETS);\r\n\r\n            const np = ReportService.getNetProfit(ledgers as Ledger[]);\r\n            const cs = ReportService.getClosingStockValue(stockItems);\r\n\r\n            setLiabilities(liabilityData);\r\n            setAssets(assetData);\r\n            setNetProfit(np);\r\n            setClosingStock(cs);\r\n            setLoading(false);\r\n        };\r\n        loadData();\r\n    }, [provider, activeCompany]);\r\n\r\n    const totalLiabilities = ReportService.calculateTotal(liabilities) + (netProfit > 0 ? netProfit : 0);\r\n    const totalAssets = ReportService.calculateTotal(assets) + closingStock + (netProfit < 0 ? Math.abs(netProfit) : 0);\r\n\r\n    if (loading) return (\r\n        <div className=\"flex items-center justify-center p-12\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"space-y-8 max-w-6xl mx-auto pb-12\"\r\n        >\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-foreground tracking-tight\">Balance Sheet</h1>\r\n                    <p className=\"text-muted-foreground font-medium\">Financial health of {activeCompany?.name}</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <button\r\n                        onClick={() => {\r\n                            const rows: any[][] = [];\r\n                            liabilities.forEach(g => {\r\n                                if (g.total > 0) {\r\n                                    rows.push([g.groupName.toUpperCase(), g.total.toFixed(2)]);\r\n                                    g.ledgers.forEach(l => rows.push([`  ${l.name}`, l.balance.toFixed(2)]));\r\n                                }\r\n                            });\r\n                            rows.push(['---', '---']);\r\n                            assets.forEach(g => {\r\n                                if (g.total > 0) {\r\n                                    rows.push([g.groupName.toUpperCase(), g.total.toFixed(2)]);\r\n                                    g.ledgers.forEach(l => rows.push([`  ${l.name}`, l.balance.toFixed(2)]));\r\n                                }\r\n                            });\r\n                            ExportService.exportToPDF('Balance Sheet', ['Particulars', 'Amount (INR)'], rows, activeCompany);\r\n                        }}\r\n                        className=\"flex items-center gap-2 px-6 py-2.5 bg-primary text-primary-foreground rounded-xl text-xs font-black uppercase tracking-widest hover:shadow-lg transition-all shadow-md shadow-primary/10\"\r\n                    >\r\n                        <FileDown className=\"w-4 h-4\" />\r\n                        Export PDF\r\n                    </button>\r\n                    <div className=\"flex items-center gap-2 px-4 py-2 bg-muted rounded-xl text-xs font-bold text-muted-foreground uppercase tracking-widest border border-border\">\r\n                        <Calendar className=\"w-4 h-4\" />\r\n                        As on {new Date().toLocaleDateString()}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-card rounded-3xl shadow-sm border border-border overflow-hidden\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-border\">\r\n                    {/* Liabilities Side */}\r\n                    <div className=\"flex flex-col\">\r\n                        <div className=\"p-6 bg-muted/30 border-b border-border font-black text-primary uppercase text-[10px] tracking-[0.2em] text-center\">\r\n                            Liabilities & Equity\r\n                        </div>\r\n                        <div className=\"p-8 space-y-8 flex-1\">\r\n                            {liabilities.map(group => (\r\n                                group.total > 0 && (\r\n                                    <div key={group.groupName} className=\"space-y-4\">\r\n                                        <div className=\"flex justify-between items-baseline group cursor-pointer\">\r\n                                            <span className=\"text-sm font-black text-foreground uppercase tracking-tight group-hover:text-primary transition-colors\">{group.groupName}</span>\r\n                                            <span className=\"font-mono font-bold text-foreground text-base\">{group.total.toLocaleString()}</span>\r\n                                        </div>\r\n                                        <div className=\"space-y-2 border-l-2 border-muted pl-4 ml-1\">\r\n                                            {group.ledgers.map(l => (\r\n                                                <div key={l.id} className=\"flex justify-between items-center text-sm font-medium text-muted-foreground/80 hover:text-foreground transition-colors py-0.5\">\r\n                                                    <span>{l.name}</span>\r\n                                                    <span className=\"font-mono\">{l.balance.toLocaleString()}</span>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )\r\n                            ))}\r\n                            {netProfit > 0 && (\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"flex justify-between items-baseline group\">\r\n                                        <span className=\"text-sm font-black text-emerald-500 uppercase tracking-tight\">Profit & Loss A/c (Net Profit)</span>\r\n                                        <span className=\"font-mono font-bold text-emerald-600 text-base\">{netProfit.toLocaleString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"p-6 bg-muted/30 border-t border-border flex justify-between items-center px-8\">\r\n                            <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">Total Liabilities</span>\r\n                            <span className=\"text-xl font-black text-foreground font-mono\">{totalLiabilities.toLocaleString()}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Assets Side */}\r\n                    <div className=\"flex flex-col\">\r\n                        <div className=\"p-6 bg-muted/30 border-b border-border font-black text-cyan-500 uppercase text-[10px] tracking-[0.2em] text-center\">\r\n                            Assets & Resources\r\n                        </div>\r\n                        <div className=\"p-8 space-y-8 flex-1\">\r\n                            {closingStock > 0 && (\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"flex justify-between items-baseline group\">\r\n                                        <span className=\"text-sm font-black text-foreground uppercase tracking-tight group-hover:text-cyan-500 transition-colors\">Closing Stock</span>\r\n                                        <span className=\"font-mono font-bold text-foreground text-base\">{closingStock.toLocaleString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                            {assets.map(group => (\r\n                                group.total > 0 && (\r\n                                    <div key={group.groupName} className=\"space-y-4\">\r\n                                        <div className=\"flex justify-between items-baseline group cursor-pointer\">\r\n                                            <span className=\"text-sm font-black text-foreground uppercase tracking-tight group-hover:text-cyan-500 transition-colors\">{group.groupName}</span>\r\n                                            <span className=\"font-mono font-bold text-foreground text-base\">{group.total.toLocaleString()}</span>\r\n                                        </div>\r\n                                        <div className=\"space-y-2 border-l-2 border-muted pl-4 ml-1\">\r\n                                            {group.ledgers.map(l => (\r\n                                                <div key={l.id} className=\"flex justify-between items-center text-sm font-medium text-muted-foreground/80 hover:text-foreground transition-colors py-0.5\">\r\n                                                    <span>{l.name}</span>\r\n                                                    <span className=\"font-mono\">{l.balance.toLocaleString()}</span>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )\r\n                            ))}\r\n                            {netProfit < 0 && (\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"flex justify-between items-baseline group\">\r\n                                        <span className=\"text-sm font-black text-rose-500 uppercase tracking-tight\">Profit & Loss A/c (Net Loss)</span>\r\n                                        <span className=\"font-mono font-bold text-rose-600 text-base\">{Math.abs(netProfit).toLocaleString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"p-6 bg-muted/30 border-t border-border flex justify-between items-center px-8\">\r\n                            <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">Total Assets</span>\r\n                            <span className=\"text-xl font-black text-foreground font-mono\">{totalAssets.toLocaleString()}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Validation Check */}\r\n            <div className={`p-6 rounded-2xl border text-center font-bold text-sm tracking-wide ${Math.abs(totalAssets - totalLiabilities) < 0.01 ? 'bg-emerald-500/10 border-emerald-500/20 text-emerald-500' : 'bg-rose-500/10 border-rose-500/20 text-rose-500'}`}>\r\n                {Math.abs(totalAssets - totalLiabilities) < 0.01\r\n                    ? 'Γ£ô Balance Sheet is perfectly balanced'\r\n                    : `ΓÜá Balance Sheet Difference: ${(totalAssets - totalLiabilities).toLocaleString()}`\r\n                }\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\reports\\CashFlow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\reports\\FundFlow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\reports\\GstReport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\reports\\Gstr1Report.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\reports\\Gstr3bReport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\reports\\ProfitAndLoss.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1080,1083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1080,1083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2879,2882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2879,2882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { ReportService, ACCT_GROUPS, type Ledger, type GroupSummary } from '../../services/accounting/ReportService';\r\nimport { Calendar, TrendingUp, TrendingDown, FileDown } from 'lucide-react';\r\nimport { ExportService } from '../../services/reports/ExportService';\r\n\r\nexport default function ProfitAndLoss() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const [expenses, setExpenses] = useState<GroupSummary[]>([]);\r\n    const [incomes, setIncomes] = useState<GroupSummary[]>([]);\r\n    const [closingStock, setClosingStock] = useState(0);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (!provider || !activeCompany) return;\r\n\r\n            const [ledgerData, stockItemsData] = await Promise.all([\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                provider.read<any[]>('stock_items.json', activeCompany.path)\r\n            ]);\r\n\r\n            const ledgers = ledgerData || [];\r\n            const stockItems = stockItemsData || [];\r\n\r\n            const expenseData = ReportService.getGroupSummary(ledgers as Ledger[], ACCT_GROUPS.EXPENSES);\r\n            const incomeData = ReportService.getGroupSummary(ledgers as Ledger[], ACCT_GROUPS.INCOME);\r\n            const cs = ReportService.getClosingStockValue(stockItems);\r\n\r\n            setExpenses(expenseData);\r\n            setIncomes(incomeData);\r\n            setClosingStock(cs);\r\n            setLoading(false);\r\n        };\r\n        loadData();\r\n    }, [provider, activeCompany]);\r\n\r\n    const totalExpenses = ReportService.calculateTotal(expenses);\r\n    const totalIncome = ReportService.calculateTotal(incomes) + closingStock;\r\n    const netProfit = totalIncome - totalExpenses;\r\n\r\n    if (loading) return (\r\n        <div className=\"flex items-center justify-center p-12\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"space-y-8 max-w-6xl mx-auto pb-12\"\r\n        >\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-foreground tracking-tight\">Statement of Profit & Loss</h1>\r\n                    <p className=\"text-muted-foreground font-medium\">Performance summary for {activeCompany?.name}</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <button\r\n                        onClick={() => {\r\n                            const rows: any[][] = [];\r\n\r\n                            // Expenses Group\r\n                            rows.push(['EXPENSES', '']);\r\n                            expenses.forEach(g => {\r\n                                if (g.total > 0) {\r\n                                    rows.push([g.groupName.toUpperCase(), g.total.toFixed(2)]);\r\n                                    g.ledgers.forEach(l => rows.push([`  ${l.name}`, l.balance.toFixed(2)]));\r\n                                }\r\n                            });\r\n\r\n                            if (netProfit > 0) {\r\n                                rows.push(['NET PROFIT (Transfer)', netProfit.toFixed(2)]);\r\n                            }\r\n\r\n                            rows.push(['---', '---']);\r\n\r\n                            // Incomes Group\r\n                            rows.push(['REVENUE / INCOME', '']);\r\n                            incomes.forEach(g => {\r\n                                if (g.total > 0) {\r\n                                    rows.push([g.groupName.toUpperCase(), g.total.toFixed(2)]);\r\n                                    g.ledgers.forEach(l => rows.push([`  ${l.name}`, l.balance.toFixed(2)]));\r\n                                }\r\n                            });\r\n\r\n                            if (netProfit < 0) {\r\n                                rows.push(['NET LOSS', Math.abs(netProfit).toFixed(2)]);\r\n                            }\r\n\r\n                            ExportService.exportToPDF('Profit & Loss Statement', ['Particulars', 'Amount (INR)'], rows, activeCompany);\r\n                        }}\r\n                        className=\"flex items-center gap-2 px-6 py-2.5 bg-primary text-primary-foreground rounded-xl text-xs font-black uppercase tracking-widest hover:shadow-lg transition-all shadow-md shadow-primary/10\"\r\n                    >\r\n                        <FileDown className=\"w-4 h-4\" />\r\n                        Export PDF\r\n                    </button>\r\n                    <div className=\"flex items-center gap-2 px-4 py-2 bg-muted rounded-xl text-xs font-bold text-muted-foreground uppercase tracking-widest border border-border\">\r\n                        <Calendar className=\"w-4 h-4\" />\r\n                        Period Ending {new Date().toLocaleDateString()}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-card rounded-3xl shadow-sm border border-border overflow-hidden\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-border\">\r\n                    {/* Expenses Side */}\r\n                    <div className=\"flex flex-col\">\r\n                        <div className=\"p-6 bg-muted/30 border-b border-border font-black text-rose-500 uppercase text-[10px] tracking-[0.2em] text-center\">\r\n                            Operating Expenses\r\n                        </div>\r\n                        <div className=\"p-8 space-y-8 flex-1\">\r\n                            {expenses.map(group => (\r\n                                group.total > 0 && (\r\n                                    <div key={group.groupName} className=\"space-y-4\">\r\n                                        <div className=\"flex justify-between items-baseline group cursor-pointer\">\r\n                                            <span className=\"text-sm font-black text-foreground uppercase tracking-tight group-hover:text-rose-500 transition-colors\">{group.groupName}</span>\r\n                                            <span className=\"font-mono font-bold text-foreground text-base\">{group.total.toLocaleString()}</span>\r\n                                        </div>\r\n                                        <div className=\"space-y-2 border-l-2 border-muted pl-4 ml-1\">\r\n                                            {group.ledgers.map(l => (\r\n                                                <div key={l.id} className=\"flex justify-between items-center text-sm font-medium text-muted-foreground/80 hover:text-foreground transition-colors py-0.5\">\r\n                                                    <span>{l.name}</span>\r\n                                                    <span className=\"font-mono\">{l.balance.toLocaleString()}</span>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )\r\n                            ))}\r\n\r\n                            {netProfit > 0 && (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0, x: -10 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    className=\"flex justify-between items-center bg-emerald-500/5 p-4 rounded-2xl border border-emerald-500/10 mt-4\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center text-emerald-500\">\r\n                                            <TrendingUp className=\"w-4 h-4\" />\r\n                                        </div>\r\n                                        <span className=\"text-xs font-black uppercase tracking-widest text-emerald-600\">Transfer to Capital (NP)</span>\r\n                                    </div>\r\n                                    <span className=\"font-mono font-black text-emerald-600\">{netProfit.toLocaleString()}</span>\r\n                                </motion.div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"p-6 bg-muted/30 border-t border-border flex justify-between items-center px-8\">\r\n                            <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">Total debits</span>\r\n                            <span className=\"text-xl font-black text-foreground font-mono\">{Math.max(totalExpenses + (netProfit > 0 ? netProfit : 0), totalIncome).toLocaleString()}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Income Side */}\r\n                    <div className=\"flex flex-col\">\r\n                        <div className=\"p-6 bg-muted/30 border-b border-border font-black text-cyan-500 uppercase text-[10px] tracking-[0.2em] text-center\">\r\n                            Revenue & Income\r\n                        </div>\r\n                        <div className=\"p-8 space-y-8 flex-1\">\r\n                            {incomes.map(group => (\r\n                                group.total > 0 && (\r\n                                    <div key={group.groupName} className=\"space-y-4\">\r\n                                        <div className=\"flex justify-between items-baseline group cursor-pointer\">\r\n                                            <span className=\"text-sm font-black text-foreground uppercase tracking-tight group-hover:text-cyan-500 transition-colors\">{group.groupName}</span>\r\n                                            <span className=\"font-mono font-bold text-foreground text-base\">{group.total.toLocaleString()}</span>\r\n                                        </div>\r\n                                        <div className=\"space-y-2 border-l-2 border-muted pl-4 ml-1\">\r\n                                            {group.ledgers.map(l => (\r\n                                                <div key={l.id} className=\"flex justify-between items-center text-sm font-medium text-muted-foreground/80 hover:text-foreground transition-colors py-0.5\">\r\n                                                    <span>{l.name}</span>\r\n                                                    <span className=\"font-mono\">{l.balance.toLocaleString()}</span>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )\r\n                            ))}\r\n\r\n                            {closingStock > 0 && (\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"flex justify-between items-baseline group\">\r\n                                        <span className=\"text-sm font-black text-foreground uppercase tracking-tight group-hover:text-cyan-500 transition-colors\">Closing Stock</span>\r\n                                        <span className=\"font-mono font-bold text-foreground text-base\">{closingStock.toLocaleString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {netProfit < 0 && (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0, x: 10 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    className=\"flex justify-between items-center bg-rose-500/5 p-4 rounded-2xl border border-rose-500/10 mt-4\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"w-8 h-8 rounded-lg bg-rose-500/20 flex items-center justify-center text-rose-500\">\r\n                                            <TrendingDown className=\"w-4 h-4\" />\r\n                                        </div>\r\n                                        <span className=\"text-xs font-black uppercase tracking-widest text-rose-600\">Net Loss (Transfer)</span>\r\n                                    </div>\r\n                                    <span className=\"font-mono font-black text-rose-600\">{Math.abs(netProfit).toLocaleString()}</span>\r\n                                </motion.div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"p-6 bg-muted/30 border-t border-border flex justify-between items-center px-8\">\r\n                            <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">Total credits</span>\r\n                            <span className=\"text-xl font-black text-foreground font-mono\">{Math.max(totalExpenses + (netProfit > 0 ? netProfit : 0), totalIncome).toLocaleString()}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Performance Summary Pill */}\r\n            <div className={`p-6 rounded-2xl border text-center font-bold text-sm tracking-wide ${netProfit >= 0 ? 'bg-emerald-500/10 border-emerald-500/20 text-emerald-500' : 'bg-rose-500/10 border-rose-500/20 text-rose-500'}`}>\r\n                {netProfit >= 0\r\n                    ? `≡ƒÄë Excellent! The company generated a Net Profit of ${netProfit.toLocaleString()}`\r\n                    : `ΓÜá Attention: The company incurred a Net Loss of ${Math.abs(netProfit).toLocaleString()}`\r\n                }\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\reports\\RatioAnalysis.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[700,703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[700,703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'vData' is assigned a value but never used.","line":19,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1092,1095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1092,1095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { ArrowLeft, PieChart, TrendingUp, Target, Zap, ShieldCheck } from 'lucide-react';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { ACCT_GROUPS, type Ledger } from '../../services/accounting/ReportService';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\n\r\nexport default function RatioAnalysis() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const navigate = useNavigate();\r\n    const [loading, setLoading] = useState(true);\r\n    const [ratios, setRatios] = useState<any[]>([]);\r\n\r\n    useEffect(() => {\r\n        const calculateRatios = async () => {\r\n            if (!provider || !activeCompany) return;\r\n\r\n            const [vData, lData, sData] = await Promise.all([\r\n                provider.read<Voucher[]>('vouchers.json', activeCompany.path),\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                provider.read<any[]>('stock_items.json', activeCompany.path)\r\n            ]);\r\n\r\n            const ledgers = lData || [];\r\n            const stockItems = sData || [];\r\n\r\n            const ca_ledgers = ledgers.filter(l => ACCT_GROUPS.ASSETS.includes(l.group));\r\n            const cl_ledgers = ledgers.filter(l => ACCT_GROUPS.LIABILITIES.includes(l.group));\r\n\r\n            const closingStock = stockItems.reduce((sum, item) => {\r\n                const balance = item.currentBalance !== undefined ? item.currentBalance : item.openingStock;\r\n                const rate = item.currentRate !== undefined ? item.currentRate : item.openingRate;\r\n                return sum + (balance * rate);\r\n            }, 0);\r\n\r\n            const totalCA = ca_ledgers.reduce((sum, l) => sum + l.balance, 0) + closingStock;\r\n            const totalCL = cl_ledgers.reduce((sum, l) => sum + l.balance, 0);\r\n            const quickAssets = totalCA - closingStock;\r\n\r\n            // GP and NP\r\n            const revenue = ledgers.filter(l => ACCT_GROUPS.INCOME.includes(l.group))\r\n                .reduce((sum, l) => sum + l.balance, 0);\r\n            const expenses = ledgers.filter(l => ACCT_GROUPS.EXPENSES.includes(l.group))\r\n                .reduce((sum, l) => sum + l.balance, 0);\r\n\r\n            const netProfit = revenue - expenses;\r\n            const grossProfit = revenue - ledgers.filter(l => l.group === 'Direct Expenses' || l.group === 'Purchase Accounts')\r\n                .reduce((sum, l) => sum + l.balance, 0);\r\n\r\n            setRatios([\r\n                {\r\n                    name: 'Current Ratio',\r\n                    value: totalCL !== 0 ? (totalCA / totalCL).toFixed(2) : 'N/A',\r\n                    target: '2.00',\r\n                    desc: 'Ability to pay short-term obligations',\r\n                    icon: ShieldCheck,\r\n                    color: 'text-cyan-500',\r\n                    bg: 'bg-cyan-500/10'\r\n                },\r\n                {\r\n                    name: 'Quick Ratio',\r\n                    value: totalCL !== 0 ? (quickAssets / totalCL).toFixed(2) : 'N/A',\r\n                    target: '1.00',\r\n                    desc: 'Immediate liquidity position',\r\n                    icon: Zap,\r\n                    color: 'text-amber-500',\r\n                    bg: 'bg-amber-500/10'\r\n                },\r\n                {\r\n                    name: 'GP Margin',\r\n                    value: revenue !== 0 ? ((grossProfit / revenue) * 100).toFixed(2) + '%' : '0%',\r\n                    target: '25%+',\r\n                    desc: 'Profitability from core operations',\r\n                    icon: TrendingUp,\r\n                    color: 'text-emerald-500',\r\n                    bg: 'bg-emerald-500/10'\r\n                },\r\n                {\r\n                    name: 'Net Profit Margin',\r\n                    value: revenue !== 0 ? ((netProfit / revenue) * 100).toFixed(2) + '%' : '0%',\r\n                    target: '15%+',\r\n                    desc: 'Bottom-line efficiency',\r\n                    icon: Target,\r\n                    color: 'text-indigo-500',\r\n                    bg: 'bg-indigo-500/10'\r\n                }\r\n            ]);\r\n            setLoading(false);\r\n        };\r\n        calculateRatios();\r\n    }, [provider, activeCompany]);\r\n\r\n    if (loading) return <div className=\"p-20 text-center font-black uppercase tracking-widest animate-pulse\">Calculating Financial Ratios...</div>;\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"max-w-6xl mx-auto space-y-8 pb-20\"\r\n        >\r\n            <div className=\"flex items-center gap-4\">\r\n                <button\r\n                    onClick={() => navigate('/dashboard')}\r\n                    className=\"p-3 hover:bg-muted rounded-2xl transition-all\"\r\n                >\r\n                    <ArrowLeft className=\"w-5 h-5\" />\r\n                </button>\r\n                <div>\r\n                    <h1 className=\"text-4xl font-black text-foreground tracking-tight uppercase\">Ratio Analysis</h1>\r\n                    <p className=\"text-muted-foreground font-bold uppercase tracking-widest text-[10px] mt-1\">Financial Performance Health-check</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                {ratios.map((ratio, i) => (\r\n                    <motion.div\r\n                        key={i}\r\n                        whileHover={{ y: -5 }}\r\n                        className=\"bg-card p-10 rounded-[3rem] border border-border shadow-xl space-y-6 relative overflow-hidden group\"\r\n                    >\r\n                        <div className={`absolute top-0 right-0 w-32 h-32 -mr-12 -mt-12 rounded-full ${ratio.bg} blur-3xl opacity-20 group-hover:opacity-40 transition-opacity`} />\r\n                        <div className=\"flex items-center justify-between relative z-10\">\r\n                            <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${ratio.bg} ${ratio.color}`}>\r\n                                <ratio.icon className=\"w-7 h-7\" />\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-widest\">Industry Target</p>\r\n                                <p className=\"text-lg font-black text-foreground\">{ratio.target}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"relative z-10\">\r\n                            <h3 className=\"text-sm font-black uppercase tracking-widest text-muted-foreground\">{ratio.name}</h3>\r\n                            <p className=\"text-5xl font-black mt-2 tracking-tighter\">{ratio.value}</p>\r\n                            <p className=\"text-xs font-bold text-muted-foreground mt-4 italic\">{ratio.desc}</p>\r\n                        </div>\r\n                        <div className=\"pt-6 border-t border-border flex items-center justify-between relative z-10\">\r\n                            <span className=\"text-[9px] font-black uppercase tracking-[0.2em] text-emerald-500 bg-emerald-500/10 px-3 py-1 rounded-full\">Healthy</span>\r\n                            <div className=\"w-24 h-1.5 bg-muted rounded-full overflow-hidden\">\r\n                                <div className=\"w-3/4 h-full bg-primary\" />\r\n                            </div>\r\n                        </div>\r\n                    </motion.div>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"bg-card rounded-[3rem] border border-border p-10 shadow-sm relative overflow-hidden\">\r\n                <div className=\"flex items-center gap-4 mb-8\">\r\n                    <PieChart className=\"w-6 h-6 text-primary\" />\r\n                    <h2 className=\"text-xl font-black uppercase tracking-tight\">Interpretation & Insights</h2>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"text-[10px] font-black uppercase tracking-widest text-primary\">Liquidity</h4>\r\n                        <p className=\"text-xs font-bold leading-relaxed text-muted-foreground\">The Current Ratio of {ratios[0].value} indicates strong ability to cover short-term liabilities. Ideal range is 1.5 to 2.5.</p>\r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"text-[10px] font-black uppercase tracking-widest text-emerald-500\">Operation</h4>\r\n                        <p className=\"text-xs font-bold leading-relaxed text-muted-foreground\">GP Margin remains stable. Efforts to reduce direct material costs could further optimize profitability.</p>\r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"text-[10px] font-black uppercase tracking-widest text-indigo-500\">Stability</h4>\r\n                        <p className=\"text-xs font-bold leading-relaxed text-muted-foreground\">Long-term debt is negligible, suggesting a low-risk financial structure and high owner equity.</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\security\\AuditLogViewer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[755,758],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[755,758],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Shield, Clock, Activity, Search } from 'lucide-react';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { AuditService, type AuditLog } from '../../services/security/AuditService';\r\n\r\nexport default function AuditLogViewer() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const [logs, setLogs] = useState<AuditLog[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filter, setFilter] = useState('');\r\n\r\n    useEffect(() => {\r\n        const loadLogs = async () => {\r\n            if (provider && activeCompany) {\r\n                const data = await AuditService.getLogs(provider as any, activeCompany.path);\r\n                setLogs(data);\r\n                setLoading(false);\r\n            }\r\n        };\r\n        loadLogs();\r\n    }, [provider, activeCompany]);\r\n\r\n    const filteredLogs = logs.filter(l =>\r\n        l.details.toLowerCase().includes(filter.toLowerCase()) ||\r\n        l.entityType.toLowerCase().includes(filter.toLowerCase()) ||\r\n        l.action.toLowerCase().includes(filter.toLowerCase())\r\n    );\r\n\r\n    if (loading) return <div className=\"p-20 text-center font-black uppercase tracking-widest animate-pulse\">Retrieving Audit Trail...</div>;\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"max-w-6xl mx-auto space-y-8 pb-20\"\r\n        >\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6\">\r\n                <div>\r\n                    <h1 className=\"text-4xl font-black text-foreground tracking-tight uppercase\">Audit Trail</h1>\r\n                    <p className=\"text-muted-foreground font-bold uppercase tracking-widest text-[10px] mt-1\">System Compliance & Security Logs</p>\r\n                </div>\r\n                <div className=\"relative group min-w-[300px]\">\r\n                    <Search className=\"w-4 h-4 text-muted-foreground absolute left-4 top-1/2 -translate-y-1/2 group-focus-within:text-primary transition-colors\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"SEARCH LOGS...\"\r\n                        value={filter}\r\n                        onChange={(e) => setFilter(e.target.value)}\r\n                        className=\"w-full pl-12 pr-6 py-3.5 bg-card border border-border rounded-2xl text-xs font-black uppercase tracking-widest focus:ring-2 focus:ring-primary outline-none transition-all shadow-sm\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-card rounded-[3rem] border border-border shadow-2xl overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full\">\r\n                        <thead>\r\n                            <tr className=\"text-left text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] border-b border-border bg-muted/30\">\r\n                                <th className=\"px-10 py-6\">Timestamp</th>\r\n                                <th className=\"px-6 py-6\">Action</th>\r\n                                <th className=\"px-6 py-6\">Entity</th>\r\n                                <th className=\"px-6 py-6\">Event Description</th>\r\n                                <th className=\"px-10 py-6 text-right\">User</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border/50\">\r\n                            {filteredLogs.map(log => (\r\n                                <tr key={log.id} className=\"hover:bg-muted/10 transition-colors group\">\r\n                                    <td className=\"px-10 py-5\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <Clock className=\"w-3.5 h-3.5 text-muted-foreground\" />\r\n                                            <div className=\"text-xs font-mono font-bold\">\r\n                                                {new Date(log.timestamp).toLocaleDateString()}\r\n                                                <span className=\"text-muted-foreground ml-2\">{new Date(log.timestamp).toLocaleTimeString()}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-5\">\r\n                                        <span className={`px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest ${log.action === 'CREATE' ? 'bg-emerald-500/10 text-emerald-600' :\r\n                                            log.action === 'UPDATE' ? 'bg-blue-500/10 text-blue-600' :\r\n                                                'bg-rose-500/10 text-rose-600'\r\n                                            }`}>\r\n                                            {log.action}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-5\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Activity className=\"w-3 h-3 text-primary\" />\r\n                                            <span className=\"text-[10px] border border-border px-2 py-0.5 rounded-full font-black uppercase tracking-tighter bg-muted/30\">\r\n                                                {log.entityType}\r\n                                            </span>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-5 text-sm font-bold text-foreground/80 lowercase italic first-letter:uppercase\">\r\n                                        {log.details}\r\n                                    </td>\r\n                                    <td className=\"px-10 py-5 text-right\">\r\n                                        <div className=\"inline-flex items-center gap-2 px-3 py-1 bg-muted/50 rounded-lg text-[10px] font-black uppercase tracking-widest\">\r\n                                            <Shield className=\"w-3 h-3 text-muted-foreground\" />\r\n                                            SYSTEM\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\settings\\SettingsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\features\\settings\\ThemeContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":42,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":42,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState, type ReactNode } from 'react';\r\n\r\ntype Theme = 'light' | 'dark';\r\n\r\ninterface ThemeContextType {\r\n    theme: Theme;\r\n    toggleTheme: () => void;\r\n    setTheme: (theme: Theme) => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport function ThemeProvider({ children }: { children: ReactNode }) {\r\n    const [theme, setThemeState] = useState<Theme>(() => {\r\n        const saved = localStorage.getItem('moneyarc_theme');\r\n        if (saved === 'light' || saved === 'dark') return saved;\r\n        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n    });\r\n\r\n    useEffect(() => {\r\n        const root = window.document.documentElement;\r\n        root.classList.remove('light', 'dark');\r\n        root.classList.add(theme);\r\n        localStorage.setItem('moneyarc_theme', theme);\r\n    }, [theme]);\r\n\r\n    const toggleTheme = () => {\r\n        setThemeState(prev => prev === 'light' ? 'dark' : 'light');\r\n    };\r\n\r\n    const setTheme = (newTheme: Theme) => {\r\n        setThemeState(newTheme);\r\n    };\r\n\r\n    return (\r\n        <ThemeContext.Provider value={{ theme, toggleTheme, setTheme }}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useTheme() {\r\n    const context = useContext(ThemeContext);\r\n    if (context === undefined) {\r\n        throw new Error('useTheme must be used within a ThemeProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\services\\accounting\\ReportService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1782,1785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1782,1785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nexport interface Ledger {\r\n    id: string;\r\n    name: string;\r\n    group: string;\r\n    category?: string;\r\n    balance: number;\r\n    type: 'Dr' | 'Cr';\r\n    gstin?: string;\r\n    address?: string;\r\n    state?: string;\r\n    isGstEnabled: boolean;\r\n}\r\n\r\nexport interface GroupSummary {\r\n    groupName: string;\r\n    total: number;\r\n    ledgers: Ledger[];\r\n}\r\n\r\nexport const ACCT_GROUPS = {\r\n    ASSETS: ['Bank Accounts', 'Cash-in-hand', 'Sundry Debtors', 'Fixed Assets', 'Stock-in-hand', 'Current Assets', 'Loans & Advances (Asset)'],\r\n    LIABILITIES: ['Capital Account', 'Sundry Creditors', 'Loans (Liability)', 'Duties & Taxes', 'Current Liabilities', 'Reserves & Surplus'],\r\n    INCOME: ['Sales Accounts', 'Direct Incomes', 'Indirect Incomes'],\r\n    EXPENSES: ['Purchase Accounts', 'Direct Expenses', 'Indirect Expenses'],\r\n};\r\n\r\nexport class ReportService {\r\n    static getGroupSummary(ledgers: Ledger[], targetGroups: string[]): GroupSummary[] {\r\n        return targetGroups.map(group => {\r\n            const groupLedgers = ledgers.filter(l => l.group === group);\r\n            const total = groupLedgers.reduce((sum, l) => sum + l.balance, 0);\r\n            return {\r\n                groupName: group,\r\n                total,\r\n                ledgers: groupLedgers\r\n            };\r\n        });\r\n    }\r\n\r\n    static calculateTotal(summaries: GroupSummary[]): number {\r\n        return summaries.reduce((sum, g) => sum + g.total, 0);\r\n    }\r\n\r\n    static getNetProfit(ledgers: Ledger[]): number {\r\n        const income = this.calculateTotal(this.getGroupSummary(ledgers, ACCT_GROUPS.INCOME));\r\n        const expenses = this.calculateTotal(this.getGroupSummary(ledgers, ACCT_GROUPS.EXPENSES));\r\n        return income - expenses;\r\n    }\r\n\r\n    static getClosingStockValue(stockItems: any[]): number {\r\n        return stockItems.reduce((sum, item) => {\r\n            const balance = item.currentBalance !== undefined ? item.currentBalance : item.openingStock;\r\n            const rate = item.currentRate !== undefined ? item.currentRate : item.openingRate;\r\n            return sum + (balance * rate);\r\n        }, 0);\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\services\\accounting\\VoucherService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1355,1358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1355,1358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2427,2430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2427,2430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3642,3645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3642,3645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'change' is never reassigned. Use 'const' instead.","line":114,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":114,"endColumn":27,"fix":{"range":[4395,4467],"text":"const change = (row.type === 'Dr' ? row.debit : -row.credit) * multiplier;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4898,4901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4898,4901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import type { StorageProvider } from '../persistence/types';\r\nimport type { Ledger } from './ReportService';\r\nimport { AuditService } from '../security/AuditService';\r\n\r\nexport interface InventoryEntry {\r\n    id: string;\r\n    itemId: string;\r\n    itemName: string;\r\n    quantity: number;\r\n    unitId: string;\r\n    rate: number;\r\n    amount: number;\r\n    batchNo?: string;\r\n    expiryDate?: string;\r\n}\r\n\r\nexport interface VoucherRow {\r\n    id: number;\r\n    type: 'Dr' | 'Cr';\r\n    account: string; // Ledger Name\r\n    debit: number;\r\n    credit: number;\r\n    inventoryAllocations?: InventoryEntry[];\r\n}\r\n\r\nexport interface Voucher {\r\n    id: string;\r\n    voucherNo: string;\r\n    date: string;\r\n    type: string;\r\n    narration: string;\r\n    rows: VoucherRow[];\r\n    currency?: string;\r\n    exchangeRate?: number;\r\n}\r\n\r\nexport class VoucherService {\r\n    static async saveVoucher(provider: StorageProvider, voucher: Voucher, companyPath?: string): Promise<void> {\r\n        if (!provider) throw new Error(\"Storage provider not initialized\");\r\n\r\n        const vouchers = await provider.read<Voucher[]>('vouchers.json', companyPath) || [];\r\n        vouchers.push(voucher);\r\n        await provider.write('vouchers.json', vouchers, companyPath);\r\n\r\n        await this.applyImpact(provider, voucher, 1, companyPath);\r\n\r\n        await AuditService.log(provider as any, companyPath || '', {\r\n            action: 'CREATE',\r\n            entityType: 'VOUCHER',\r\n            entityId: voucher.id,\r\n            details: `${voucher.type} Voucher #${voucher.voucherNo} recorded for Γé╣${voucher.rows.reduce((sum, r) => sum + (r.type === 'Dr' ? r.debit : 0), 0).toLocaleString()}`\r\n        });\r\n    }\r\n\r\n    static async deleteVoucher(provider: StorageProvider, voucherId: string, companyPath?: string): Promise<void> {\r\n        if (!provider) throw new Error(\"Storage provider not initialized\");\r\n\r\n        const vouchers = await provider.read<Voucher[]>('vouchers.json', companyPath) || [];\r\n        const voucher = vouchers.find(v => v.id === voucherId);\r\n        if (!voucher) throw new Error(\"Voucher not found\");\r\n\r\n        // Reverse Impact\r\n        await this.applyImpact(provider, voucher, -1, companyPath);\r\n\r\n        // Remove from list\r\n        const updatedVouchers = vouchers.filter(v => v.id !== voucherId);\r\n        await provider.write('vouchers.json', updatedVouchers, companyPath);\r\n\r\n        await AuditService.log(provider as any, companyPath || '', {\r\n            action: 'DELETE',\r\n            entityType: 'VOUCHER',\r\n            entityId: voucherId,\r\n            details: `${voucher.type} Voucher #${voucher.voucherNo} deleted`\r\n        });\r\n    }\r\n\r\n    static async updateVoucher(provider: StorageProvider, voucher: Voucher, companyPath?: string): Promise<void> {\r\n        if (!provider) throw new Error(\"Storage provider not initialized\");\r\n\r\n        const vouchers = await provider.read<Voucher[]>('vouchers.json', companyPath) || [];\r\n        const oldVoucher = vouchers.find(v => v.id === voucher.id);\r\n\r\n        if (oldVoucher) {\r\n            // Revert old impact\r\n            await this.applyImpact(provider, oldVoucher, -1, companyPath);\r\n            // Replace in list\r\n            const updatedVouchers = vouchers.map(v => v.id === voucher.id ? voucher : v);\r\n            await provider.write('vouchers.json', updatedVouchers, companyPath);\r\n        } else {\r\n            vouchers.push(voucher);\r\n            await provider.write('vouchers.json', vouchers, companyPath);\r\n        }\r\n\r\n        // Apply new impact\r\n        await this.applyImpact(provider, voucher, 1, companyPath);\r\n\r\n        await AuditService.log(provider as any, companyPath || '', {\r\n            action: 'UPDATE',\r\n            entityType: 'VOUCHER',\r\n            entityId: voucher.id,\r\n            details: `${voucher.type} Voucher #${voucher.voucherNo} modified`\r\n        });\r\n    }\r\n\r\n    private static async applyImpact(provider: StorageProvider, voucher: Voucher, multiplier: 1 | -1, companyPath?: string): Promise<void> {\r\n        // 1. Update Ledger Balances\r\n        const ledgers = await provider.read<Ledger[]>('ledgers.json', companyPath) || [];\r\n        const ledgerMap = new Map(ledgers.map(l => [l.name, l]));\r\n\r\n        for (const row of voucher.rows) {\r\n            if (!row.account) continue;\r\n            const ledger = ledgerMap.get(row.account);\r\n            if (ledger) {\r\n                let change = (row.type === 'Dr' ? row.debit : -row.credit) * multiplier;\r\n                let currentSigned = ledger.balance * (ledger.type === 'Dr' ? 1 : -1);\r\n                currentSigned += change;\r\n                ledger.balance = Math.abs(currentSigned);\r\n                ledger.type = currentSigned >= 0 ? 'Dr' : 'Cr';\r\n            }\r\n        }\r\n        await provider.write('ledgers.json', ledgers, companyPath);\r\n\r\n        // 2. Update Inventory\r\n        const stockItems = await provider.read<any[]>('stock_items.json', companyPath) || [];\r\n        const stockMap = new Map(stockItems.map(i => [i.id, i]));\r\n        let stockChanged = false;\r\n\r\n        for (const row of voucher.rows) {\r\n            if (row.inventoryAllocations) {\r\n                for (const allocation of row.inventoryAllocations) {\r\n                    const item = stockMap.get(allocation.itemId);\r\n                    if (item) {\r\n                        stockChanged = true;\r\n                        if (item.currentBalance === undefined) {\r\n                            item.currentBalance = item.openingStock;\r\n                            item.currentRate = item.openingRate;\r\n                            item.currentValue = item.openingValue;\r\n                        }\r\n\r\n                        const qtyChange = allocation.quantity * multiplier;\r\n                        const valChange = allocation.amount * multiplier;\r\n\r\n                        if (voucher.type === 'Purchase') {\r\n                            item.currentBalance += qtyChange;\r\n                            item.currentValue += valChange;\r\n                        } else if (voucher.type === 'Sales') {\r\n                            item.currentBalance -= qtyChange;\r\n                            // Re-calculate value at current average rate\r\n                            item.currentValue = item.currentBalance * item.currentRate;\r\n                        }\r\n\r\n                        // Recalculate Average Rate if balance is positive\r\n                        if (item.currentBalance > 0) {\r\n                            item.currentRate = item.currentValue / item.currentBalance;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (stockChanged) {\r\n            await provider.write('stock_items.json', stockItems, companyPath);\r\n        }\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\services\\inventory\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\services\\persistence\\FileSystemProvider.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":42,"column":17,"severity":1,"nodeType":null,"fix":{"range":[1448,1510],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[593,596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[593,596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1690,1693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1690,1693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2618,2621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2618,2621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5752,5755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5752,5755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { get, set } from 'idb-keyval';\r\nimport type { StorageProvider, Company } from './types';\r\n\r\nconst HANDLE_KEY = 'moneyarc_dir_handle';\r\n\r\nexport class FileSystemProvider implements StorageProvider {\r\n    private dirHandle: FileSystemDirectoryHandle | null = null;\r\n\r\n    public get isReady(): boolean {\r\n        return this.dirHandle !== null;\r\n    }\r\n\r\n    async init(): Promise<void> {\r\n        try {\r\n            if ('showDirectoryPicker' in window) {\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                this.dirHandle = await (window as any).showDirectoryPicker({\r\n                    mode: 'readwrite',\r\n                    startIn: 'documents',\r\n                });\r\n\r\n                // Persist the handle for next session\r\n                if (this.dirHandle) {\r\n                    await set(HANDLE_KEY, this.dirHandle);\r\n                }\r\n            } else {\r\n                console.error(\"File System Access API not supported\");\r\n            }\r\n        } catch (err) {\r\n            if ((err as Error).name !== 'AbortError') {\r\n                console.error('Error selecting directory:', err);\r\n                throw err;\r\n            }\r\n        }\r\n    }\r\n\r\n    async restore(): Promise<boolean> {\r\n        try {\r\n            const savedHandle = await get<FileSystemDirectoryHandle>(HANDLE_KEY);\r\n            if (savedHandle) {\r\n                // Verify permissions\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                const options = { mode: 'readwrite' };\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                if (await (savedHandle as any).queryPermission(options) === 'granted') {\r\n                    this.dirHandle = savedHandle;\r\n                    return true;\r\n                }\r\n\r\n                // If permission is not granted, we might need to request it, \r\n                // but that requires a user gesture. We'll return false and let the context handle it.\r\n            }\r\n        } catch (err) {\r\n            console.warn('Failed to restore directory handle:', err);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async listCompanies(): Promise<Company[]> {\r\n        if (!this.dirHandle) throw new Error('Storage not initialized');\r\n        const companies: Company[] = [];\r\n\r\n        // In this simple implementation, each subdirectory represents a company\r\n        // We look for a 'company.json' in each subdirectory\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        for await (const entry of (this.dirHandle as any).values()) {\r\n            if (entry.kind === 'directory') {\r\n                try {\r\n                    const compFile = await entry.getFileHandle('company.json');\r\n                    const file = await compFile.getFile();\r\n                    const text = await file.text();\r\n                    const data = JSON.parse(text);\r\n                    companies.push({\r\n                        ...data,\r\n                        path: entry.name\r\n                    });\r\n                } catch {\r\n                    // Skip if not a company directory\r\n                }\r\n            }\r\n        }\r\n        return companies;\r\n    }\r\n\r\n    async createCompany(data: Omit<Company, 'id' | 'path'>): Promise<Company> {\r\n        if (!this.dirHandle) throw new Error('Storage not initialized');\r\n\r\n        const id = Math.random().toString(36).substr(2, 9);\r\n        const folderName = `${data.name.replace(/\\s+/g, '_')}_${id}`;\r\n\r\n        // Create directory\r\n        const companyDir = await this.dirHandle.getDirectoryHandle(folderName, { create: true });\r\n\r\n        const companyData: Company = {\r\n            id,\r\n            ...data,\r\n            path: folderName\r\n        };\r\n\r\n        // Write company metadata\r\n        const compFile = await companyDir.getFileHandle('company.json', { create: true });\r\n        const writable = await compFile.createWritable();\r\n        await writable.write(JSON.stringify(companyData, null, 2));\r\n        await writable.close();\r\n\r\n        return companyData;\r\n    }\r\n\r\n    async updateCompany(id: string, path: string, data: Partial<Omit<Company, 'id' | 'path'>>): Promise<Company> {\r\n        if (!this.dirHandle) throw new Error('Storage not initialized');\r\n\r\n        const companyDir = await this.dirHandle.getDirectoryHandle(path);\r\n        const compFile = await companyDir.getFileHandle('company.json');\r\n\r\n        // Read existing\r\n        const file = await compFile.getFile();\r\n        const text = await file.text();\r\n        const existingData = JSON.parse(text) as Company;\r\n\r\n        const updatedData: Company = {\r\n            ...existingData,\r\n            ...data,\r\n            id, // Ensure ID and path remain same\r\n            path\r\n        };\r\n\r\n        // Write back\r\n        const writable = await compFile.createWritable();\r\n        await writable.write(JSON.stringify(updatedData, null, 2));\r\n        await writable.close();\r\n\r\n        return updatedData;\r\n    }\r\n\r\n    async read<T>(filename: string, companyPath?: string): Promise<T | null> {\r\n        if (!this.dirHandle) throw new Error('Storage not initialized');\r\n\r\n        try {\r\n            let targetDir = this.dirHandle;\r\n            if (companyPath) {\r\n                targetDir = await this.dirHandle.getDirectoryHandle(companyPath);\r\n            }\r\n\r\n            const fileHandle = await targetDir.getFileHandle(filename, { create: false });\r\n            const file = await fileHandle.getFile();\r\n            const text = await file.text();\r\n            return JSON.parse(text) as T;\r\n        } catch (err) {\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            if ((err as any).name === 'NotFoundError') {\r\n                return null;\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    async write<T>(filename: string, data: T, companyPath?: string): Promise<void> {\r\n        if (!this.dirHandle) throw new Error('Storage not initialized');\r\n\r\n        try {\r\n            let targetDir = this.dirHandle;\r\n            if (companyPath) {\r\n                targetDir = await this.dirHandle.getDirectoryHandle(companyPath, { create: true });\r\n            }\r\n\r\n            const fileHandle = await targetDir.getFileHandle(filename, { create: true });\r\n            const writable = await fileHandle.createWritable();\r\n            await writable.write(JSON.stringify(data, null, 2));\r\n            await writable.close();\r\n        } catch (err) {\r\n            console.error('Error writing file:', err);\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\services\\persistence\\PersistenceContext.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`restoreStorage` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nM:\\Projects\\MoneyArc\\src\\services\\persistence\\PersistenceContext.tsx:24:9\n  22 |     useEffect(() => {\n  23 |         console.log('PersistenceProvider: Attempting to restore storage...');\n> 24 |         restoreStorage();\n     |         ^^^^^^^^^^^^^^ `restoreStorage` accessed before it is declared\n  25 |     }, []);\n  26 |\n  27 |     const restoreStorage = async () => {\n\nM:\\Projects\\MoneyArc\\src\\services\\persistence\\PersistenceContext.tsx:27:5\n  25 |     }, []);\n  26 |\n> 27 |     const restoreStorage = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 28 |         try {\n     | ^^^^^^^^^^^^^\n> 29 |             const localProvider = new FileSystemProvider();\n     ΓÇª\n     | ^^^^^^^^^^^^^\n> 41 |         return false;\n     | ^^^^^^^^^^^^^\n> 42 |     };\n     | ^^^^^^^ `restoreStorage` is declared here\n  43 |\n  44 |     const initializeStorage = async (type: StorageType) => {\n  45 |         let newProvider: StorageProvider | null = null;","line":24,"column":9,"nodeType":null,"endLine":24,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1276,1279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1276,1279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":79,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":79,"endColumn":31}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect, type ReactNode } from 'react';\r\nimport type { StorageProvider, StorageType, Company } from './types';\r\nimport { FileSystemProvider } from './FileSystemProvider';\r\n\r\ninterface PersistenceContextType {\r\n    provider: StorageProvider | null;\r\n    storageType: StorageType;\r\n    activeCompany: Company | null;\r\n    initializeStorage: (type: StorageType) => Promise<void>;\r\n    restoreStorage: () => Promise<boolean>;\r\n    selectCompany: (company: Company | null) => void;\r\n}\r\n\r\nconst PersistenceContext = createContext<PersistenceContextType | null>(null);\r\n\r\nexport function PersistenceProvider({ children }: { children: ReactNode }) {\r\n    const [provider, setProvider] = useState<StorageProvider | null>(null);\r\n    const [storageType, setStorageType] = useState<StorageType>(null);\r\n    const [activeCompany, setActiveCompany] = useState<Company | null>(null);\r\n\r\n    // Try to restore storage on mount\r\n    useEffect(() => {\r\n        console.log('PersistenceProvider: Attempting to restore storage...');\r\n        restoreStorage();\r\n    }, []);\r\n\r\n    const restoreStorage = async () => {\r\n        try {\r\n            const localProvider = new FileSystemProvider();\r\n            const restored = await (localProvider as any).restore?.();\r\n            if (restored) {\r\n                console.log('PersistenceProvider: Storage restored successfully.');\r\n                setProvider(localProvider);\r\n                setStorageType('local');\r\n                return true;\r\n            }\r\n        } catch (e) {\r\n            console.error('PersistenceProvider: Restore failed', e);\r\n        }\r\n        console.log('PersistenceProvider: Storage not restored (normal if first run).');\r\n        return false;\r\n    };\r\n\r\n    const initializeStorage = async (type: StorageType) => {\r\n        let newProvider: StorageProvider | null = null;\r\n\r\n        if (type === 'local') {\r\n            newProvider = new FileSystemProvider();\r\n        }\r\n        // Add Cloud provider logic here later\r\n\r\n        if (newProvider) {\r\n            await newProvider.init();\r\n            if (newProvider.isReady) {\r\n                setProvider(newProvider);\r\n                setStorageType(type);\r\n            }\r\n        }\r\n    };\r\n\r\n    const selectCompany = (company: Company | null) => {\r\n        setActiveCompany(company);\r\n    };\r\n\r\n    return (\r\n        <PersistenceContext.Provider value={{\r\n            provider,\r\n            storageType,\r\n            activeCompany,\r\n            initializeStorage,\r\n            restoreStorage,\r\n            selectCompany\r\n        }}>\r\n            {children}\r\n        </PersistenceContext.Provider>\r\n    );\r\n}\r\n\r\nexport function usePersistence() {\r\n    const context = useContext(PersistenceContext);\r\n    if (!context) {\r\n        throw new Error('usePersistence must be used within a PersistenceProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\services\\persistence\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\services\\reports\\ExportService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1809,1812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1809,1812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2425,2428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2425,2428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { jsPDF } from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport * as XLSX from 'xlsx';\r\nimport type { Company } from '../persistence/types';\r\n\r\nexport class ExportService {\r\n    static exportToPDF(title: string, columns: string[], rows: (string | number)[][], company: Company | null) {\r\n        // ... existing PDF logic ...\r\n        const doc = new jsPDF();\r\n        const timestamp = new Date().toLocaleString();\r\n\r\n        // Add Header\r\n        doc.setFontSize(22);\r\n        doc.setTextColor(15, 23, 42); // slate-900\r\n        doc.text(\"MoneyArc\", 14, 20);\r\n\r\n        doc.setFontSize(10);\r\n        doc.setTextColor(100, 116, 139); // slate-500\r\n        doc.text(\"Professional Accounting Suite\", 14, 26);\r\n\r\n        // Company Details\r\n        if (company) {\r\n            doc.setFontSize(12);\r\n            doc.setTextColor(15, 23, 42);\r\n            doc.text(company.name, 14, 40);\r\n            doc.setFontSize(9);\r\n            doc.setTextColor(100, 116, 139);\r\n            doc.text(`${company.address || 'Address not set'} | GST: ${company.gstin || 'No GSTIN'}`, 14, 45);\r\n        }\r\n\r\n        // Report Title\r\n        doc.setFontSize(16);\r\n        doc.setTextColor(14, 165, 233); // cyan-500\r\n        doc.text(title.toUpperCase(), 14, 60);\r\n\r\n        doc.setFontSize(9);\r\n        doc.setTextColor(100, 116, 139);\r\n        doc.text(`Generated on: ${timestamp}`, 14, 65);\r\n\r\n        // Table\r\n        autoTable(doc, {\r\n            startY: 75,\r\n            head: [columns],\r\n            body: rows,\r\n            theme: 'striped',\r\n            headStyles: { fillColor: [15, 23, 42], fontStyle: 'bold' },\r\n            styles: { fontSize: 8, cellPadding: 3 },\r\n            alternateRowStyles: { fillColor: [248, 250, 252] }\r\n        });\r\n\r\n        // Footer\r\n        const pageCount = (doc as any).internal.getNumberOfPages();\r\n        for (let i = 1; i <= pageCount; i++) {\r\n            doc.setPage(i);\r\n            doc.setFontSize(8);\r\n            doc.setTextColor(148, 163, 184);\r\n            doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.getWidth() - 30, doc.internal.pageSize.getHeight() - 10);\r\n            doc.text(\"MoneyArc - Accurate. Secure. Professional.\", 14, doc.internal.pageSize.getHeight() - 10);\r\n        }\r\n\r\n        doc.save(`${title.toLowerCase().replace(/\\s+/g, '_')}_${new Date().getTime()}.pdf`);\r\n    }\r\n\r\n    static exportToExcel(title: string, columns: string[], rows: any[][]) {\r\n        const worksheetData = [columns, ...rows];\r\n        const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);\r\n        const workbook = XLSX.utils.book_new();\r\n        XLSX.utils.book_append_sheet(workbook, worksheet, title);\r\n\r\n        XLSX.writeFile(workbook, `${title.toLowerCase().replace(/\\s+/g, '_')}_${new Date().getTime()}.xlsx`);\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\src\\services\\security\\AuditService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]

