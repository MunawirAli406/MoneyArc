[{"filePath":"M:\\Projects\\MoneyArc-main\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\list_models.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\ai\\AIReportAdvisor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[423,426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[423,426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[933,936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[933,936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Sparkles, Loader2, MessageSquare, ChevronDown, ChevronUp, RefreshCw } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { GeminiService } from '../../services/ai/GeminiService';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\n\r\ninterface AIReportAdvisorProps {\r\n    reportName: string;\r\n    data: any;\r\n    context?: string;\r\n}\r\n\r\nexport default function AIReportAdvisor({ reportName, data, context }: AIReportAdvisorProps) {\r\n    const { activeCompany } = usePersistence();\r\n    const [apiKey, setApiKey] = useState(localStorage.getItem('moneyarc_gemini_key') || '');\r\n    const [insight, setInsight] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const handleKeyUpdate = (e: any) => {\r\n            const newKey = e.detail || localStorage.getItem('moneyarc_gemini_key');\r\n            if (newKey) setApiKey(newKey);\r\n        };\r\n        const handleStorageChange = (e: StorageEvent) => {\r\n            if (e.key === 'moneyarc_gemini_key' && e.newValue) setApiKey(e.newValue);\r\n        };\r\n        window.addEventListener('moneyarc_key_updated', handleKeyUpdate);\r\n        window.addEventListener('storage', handleStorageChange);\r\n        return () => {\r\n            window.removeEventListener('moneyarc_key_updated', handleKeyUpdate);\r\n            window.removeEventListener('storage', handleStorageChange);\r\n        };\r\n    }, []);\r\n\r\n    const generateInsight = async () => {\r\n        const currentApiKey = apiKey || localStorage.getItem('moneyarc_gemini_key') || '';\r\n        if (!currentApiKey) return;\r\n\r\n        setLoading(true);\r\n        setIsExpanded(true);\r\n        try {\r\n            const service = new GeminiService(currentApiKey);\r\n            const prompt = `\r\n                Act as a high-end CFO. Analyze this \"${reportName}\" report for ${activeCompany?.name}.\r\n                Data: ${JSON.stringify(data, null, 2)}\r\n                ${context ? `Additional Context: ${context}` : ''}\r\n                \r\n                Provide:\r\n                1. A 3-bullet \"Executive Summary\" (concise).\r\n                2. One \"Critical Warning\" or \"Growth Opportunity\".\r\n                3. One actionable advice for the next 30 days.\r\n                \r\n                Use a professional, sharp, and encouraging tone. Use ${activeCompany?.symbol || '₹'} for currency.\r\n                Format with markdown (bolding, etc.).\r\n            `;\r\n            const result = await service.generateInsight(prompt, {\r\n                vouchers: [],\r\n                ledgers: [],\r\n                companyName: activeCompany?.name || '',\r\n                symbol: activeCompany?.symbol || '₹'\r\n            });\r\n            setInsight(result);\r\n        } catch (error) {\r\n            console.error(error);\r\n            setInsight(\"I encountered an error analyzing this report. Please check your connectivity.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"mb-8\">\r\n            <motion.div\r\n                layout\r\n                className=\"glass-panel overflow-hidden border-primary/20 shadow-2xl relative\"\r\n                initial={false}\r\n            >\r\n                <div className=\"p-4 flex items-center justify-between bg-white/5\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-2xl bg-primary/20 flex items-center justify-center text-primary shadow-inner\">\r\n                            <Sparkles className={`w-5 h-5 ${loading ? 'animate-pulse' : ''}`} />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className=\"text-sm font-black uppercase tracking-tighter\">AI Financial Advisor</h3>\r\n                            <p className=\"text-[10px] font-bold text-muted-foreground uppercase opacity-70\">Contextual Insight for {reportName}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-2\">\r\n                        {!insight && !loading ? (\r\n                            <button\r\n                                onClick={generateInsight}\r\n                                className=\"px-4 py-2 bg-primary text-primary-foreground rounded-xl text-[10px] font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-lg flex items-center gap-2\"\r\n                            >\r\n                                <MessageSquare className=\"w-3 h-3\" />\r\n                                Run Smart Analysis\r\n                            </button>\r\n                        ) : (\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <button\r\n                                    onClick={generateInsight}\r\n                                    className=\"p-2 hover:bg-white/10 rounded-xl transition-colors text-muted-foreground\"\r\n                                    title=\"Regenerate\"\r\n                                >\r\n                                    <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setIsExpanded(!isExpanded)}\r\n                                    className=\"p-2 hover:bg-white/10 rounded-xl transition-colors text-muted-foreground\"\r\n                                >\r\n                                    {isExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <AnimatePresence>\r\n                    {isExpanded && (\r\n                        <motion.div\r\n                            initial={{ height: 0, opacity: 0 }}\r\n                            animate={{ height: 'auto', opacity: 1 }}\r\n                            exit={{ height: 0, opacity: 0 }}\r\n                            className=\"border-t border-white/5\"\r\n                        >\r\n                            <div className=\"p-6 relative\">\r\n                                {loading ? (\r\n                                    <div className=\"flex flex-col items-center justify-center py-12 gap-4\">\r\n                                        <Loader2 className=\"w-8 h-8 animate-spin text-primary opacity-50\" />\r\n                                        <p className=\"text-[10px] font-black uppercase tracking-widest animate-pulse opacity-50\">CFO is analyzing your data...</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"prose prose-invert prose-sm max-w-none prose-p:text-muted-foreground prose-strong:text-foreground prose-li:text-muted-foreground\">\r\n                                        <div className=\"text-[11px] leading-relaxed font-medium whitespace-pre-wrap\">\r\n                                            {insight}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"absolute top-0 right-0 h-full w-24 bg-gradient-to-l from-primary/5 to-transparent pointer-events-none\" />\r\n                            </div>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </motion.div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\layout\\DynamicBackground.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nM:\\Projects\\MoneyArc-main\\src\\components\\layout\\DynamicBackground.tsx:13:12\n  11 |     // Pre-calculate particles to satisfy purity rules\n  12 |     const particles = useMemo(() => [...Array(20)].map(() => ({\n> 13 |         x: Math.random() * 100,\n     |            ^^^^^^^^^^^^^ Cannot call impure function\n  14 |         y: Math.random() * 100,\n  15 |         tx: Math.random() * 100,\n  16 |         ty: Math.random() * 100,","line":13,"column":12,"nodeType":null,"endLine":13,"endColumn":25},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nM:\\Projects\\MoneyArc-main\\src\\components\\layout\\DynamicBackground.tsx:14:12\n  12 |     const particles = useMemo(() => [...Array(20)].map(() => ({\n  13 |         x: Math.random() * 100,\n> 14 |         y: Math.random() * 100,\n     |            ^^^^^^^^^^^^^ Cannot call impure function\n  15 |         tx: Math.random() * 100,\n  16 |         ty: Math.random() * 100,\n  17 |         duration: 15 + Math.random() * 20,","line":14,"column":12,"nodeType":null,"endLine":14,"endColumn":25},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nM:\\Projects\\MoneyArc-main\\src\\components\\layout\\DynamicBackground.tsx:15:13\n  13 |         x: Math.random() * 100,\n  14 |         y: Math.random() * 100,\n> 15 |         tx: Math.random() * 100,\n     |             ^^^^^^^^^^^^^ Cannot call impure function\n  16 |         ty: Math.random() * 100,\n  17 |         duration: 15 + Math.random() * 20,\n  18 |         opacity: 0.1 + Math.random() * 0.3","line":15,"column":13,"nodeType":null,"endLine":15,"endColumn":26},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nM:\\Projects\\MoneyArc-main\\src\\components\\layout\\DynamicBackground.tsx:16:13\n  14 |         y: Math.random() * 100,\n  15 |         tx: Math.random() * 100,\n> 16 |         ty: Math.random() * 100,\n     |             ^^^^^^^^^^^^^ Cannot call impure function\n  17 |         duration: 15 + Math.random() * 20,\n  18 |         opacity: 0.1 + Math.random() * 0.3\n  19 |     })), []);","line":16,"column":13,"nodeType":null,"endLine":16,"endColumn":26},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nM:\\Projects\\MoneyArc-main\\src\\components\\layout\\DynamicBackground.tsx:17:24\n  15 |         tx: Math.random() * 100,\n  16 |         ty: Math.random() * 100,\n> 17 |         duration: 15 + Math.random() * 20,\n     |                        ^^^^^^^^^^^^^ Cannot call impure function\n  18 |         opacity: 0.1 + Math.random() * 0.3\n  19 |     })), []);\n  20 |","line":17,"column":24,"nodeType":null,"endLine":17,"endColumn":37},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nM:\\Projects\\MoneyArc-main\\src\\components\\layout\\DynamicBackground.tsx:18:24\n  16 |         ty: Math.random() * 100,\n  17 |         duration: 15 + Math.random() * 20,\n> 18 |         opacity: 0.1 + Math.random() * 0.3\n     |                        ^^^^^^^^^^^^^ Cannot call impure function\n  19 |     })), []);\n  20 |\n  21 |     return (","line":18,"column":24,"nodeType":null,"endLine":18,"endColumn":37}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { BASE_GRADIENT, BACKGROUNDS } from './backgrounds';\r\n\r\nexport default function DynamicBackground() {\r\n    const { activeCompany } = usePersistence();\r\n    const type = activeCompany?.businessType || 'General';\r\n    const bgClass = BACKGROUNDS[type] || BACKGROUNDS['General'];\r\n\r\n    // Pre-calculate particles to satisfy purity rules\r\n    const particles = useMemo(() => [...Array(20)].map(() => ({\r\n        x: Math.random() * 100,\r\n        y: Math.random() * 100,\r\n        tx: Math.random() * 100,\r\n        ty: Math.random() * 100,\r\n        duration: 15 + Math.random() * 20,\r\n        opacity: 0.1 + Math.random() * 0.3\r\n    })), []);\r\n\r\n    return (\r\n        <div className={BASE_GRADIENT}>\r\n            <AnimatePresence mode=\"wait\">\r\n                <motion.div\r\n                    key={type}\r\n                    initial={{ opacity: 0 }}\r\n                    animate={{ opacity: 1 }}\r\n                    exit={{ opacity: 0 }}\r\n                    transition={{ duration: 1.5, ease: \"easeInOut\" }}\r\n                    className={`absolute inset-0 ${bgClass}`}\r\n                />\r\n            </AnimatePresence>\r\n\r\n            {/* Living Data Particles for high-end feel */}\r\n            <div className=\"absolute inset-0 opacity-20 pointer-events-none\">\r\n                {particles.map((p, i) => (\r\n                    <motion.div\r\n                        key={i}\r\n                        className=\"absolute w-1 h-1 bg-white rounded-full blur-[1px]\"\r\n                        style={{ left: `${p.x}%`, top: `${p.y}%` }}\r\n                        animate={{\r\n                            x: [0, (p.tx - p.x) * 10],\r\n                            y: [0, (p.ty - p.y) * 10],\r\n                            opacity: [p.opacity, p.opacity * 2, p.opacity]\r\n                        }}\r\n                        transition={{\r\n                            duration: p.duration,\r\n                            repeat: Infinity,\r\n                            ease: \"linear\"\r\n                        }}\r\n                    />\r\n                ))}\r\n            </div>\r\n\r\n            {/* Grain Overlay for high-end texture */}\r\n            <div className=\"absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/p6.png')] blur-[0.5px]\" />\r\n\r\n            {/* Dark Mode subtle darkening overlay */}\r\n            <div className=\"absolute inset-0 bg-slate-950/20 pointer-events-none text-google-blue\" />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\layout\\GoToSearch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\layout\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\layout\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\layout\\PageTransition.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[473,476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[473,476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":32,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":32,"endColumn":26}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { motion } from 'framer-motion';\r\nimport { useLocation } from 'react-router-dom';\r\n\r\nconst pageVariants = {\r\n    initial: {\r\n        opacity: 0,\r\n        y: 20,\r\n        filter: 'blur(10px)',\r\n    },\r\n    animate: {\r\n        opacity: 1,\r\n        y: 0,\r\n        filter: 'blur(0px)',\r\n        transition: {\r\n            type: 'spring',\r\n            damping: 25,\r\n            stiffness: 100,\r\n            staggerChildren: 0.1,\r\n            duration: 0.5,\r\n        } as any,\r\n    },\r\n    exit: {\r\n        opacity: 0,\r\n        y: -20,\r\n        filter: 'blur(10px)',\r\n        transition: {\r\n            duration: 0.3,\r\n        },\r\n    },\r\n};\r\n\r\nexport const itemVariants = {\r\n    initial: { opacity: 0, y: 10 },\r\n    animate: { opacity: 1, y: 0 },\r\n};\r\n\r\nexport default function PageTransition({ children }: { children: React.ReactNode }) {\r\n    const location = useLocation();\r\n\r\n    return (\r\n        <motion.div\r\n            key={location.pathname}\r\n            variants={pageVariants}\r\n            initial=\"initial\"\r\n            animate=\"animate\"\r\n            exit=\"exit\"\r\n            className=\"w-full h-full\"\r\n        >\r\n            {children}\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\layout\\Sidebar.tsx","messages":[{"ruleId":"no-empty-pattern","severity":2,"message":"Unexpected empty object pattern.","line":34,"column":11,"nodeType":"ObjectPattern","messageId":"unexpected","endLine":34,"endColumn":14}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Link, useLocation } from 'react-router-dom';\r\nimport { LayoutDashboard, BookOpen, FileText, Wallet, TrendingUp, Layers, Building2, Activity, Shield, Database, Lock } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\nimport clsx from 'clsx';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { useAuth } from '../../features/auth/AuthContext.provider';\r\nimport Logo from '../ui/Logo';\r\n\r\nconst navItems = [\r\n    { icon: LayoutDashboard, label: 'Dashboard', path: '/dashboard', color: 'text-google-blue' },\r\n    { icon: Wallet, label: 'Vouchers', path: '/vouchers/new', color: 'text-amber-500' },\r\n    { icon: BookOpen, label: 'Ledgers', path: '/ledgers', color: 'text-google-green' },\r\n    { icon: BookOpen, label: 'Trial Balance', path: '/reports/trial-balance', color: 'text-violet-500' },\r\n    { icon: BookOpen, label: 'Daybook', path: '/reports/daybook', color: 'text-rose-500' },\r\n    { icon: FileText, label: 'Balance Sheet', path: '/reports/balance-sheet', color: 'text-google-blue' },\r\n    { icon: TrendingUp, label: 'Profit & Loss', path: '/reports/profit-loss', color: 'text-google-green' },\r\n    { icon: FileText, label: 'GST Reports', path: '/reports/gst', color: 'text-google-red' },\r\n    { icon: Wallet, label: 'Cash Flow', path: '/reports/cash-flow', color: 'text-amber-500' },\r\n    { icon: TrendingUp, label: 'Fund Flow', path: '/reports/fund-flow', color: 'text-violet-500' },\r\n    { icon: Layers, label: 'Inventory Master', path: '/inventory/master', color: 'text-google-blue' },\r\n    { icon: TrendingUp, label: 'Stock Summary', path: '/reports/stock-summary', color: 'text-google-green' },\r\n    { icon: Activity, label: 'Ratio Analysis', path: '/reports/ratios', color: 'text-google-red' },\r\n    { icon: Shield, label: 'Security Center', path: '/security', color: 'text-amber-500' },\r\n    { icon: Database, label: 'Data Portability', path: '/utility/portability', color: 'text-google-blue' },\r\n];\r\n\r\ninterface SidebarProps {\r\n    onClose?: () => void;\r\n}\r\n\r\nexport default function Sidebar({ onClose }: SidebarProps) {\r\n    const location = useLocation();\r\n    const { activeCompany } = usePersistence();\r\n    const { } = useAuth();\r\n\r\n    const BusinessIcon = Building2;\r\n\r\n    return (\r\n        <div className=\"w-64 h-full bg-card border-r border-border flex flex-col transition-colors duration-300 flex-shrink-0\">\r\n            <div className=\"h-24 flex flex-col justify-center px-6 border-b border-border bg-muted/20\">\r\n                <div className=\"mb-2\">\r\n                    <Logo size={32} />\r\n                </div>\r\n                {activeCompany ? (\r\n                    <div className=\"flex items-center gap-2 text-[9px] text-primary font-black bg-primary/10 border border-primary/20 px-2 py-0.5 rounded-full w-fit max-w-full uppercase tracking-widest shadow-sm\">\r\n                        <BusinessIcon\r\n                            className=\"w-3 h-3 flex-shrink-0\"\r\n                            style={{ color: 'hsl(var(--primary))' }}\r\n                        />\r\n                        <span className=\"truncate\">{activeCompany.name}</span>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"text-[10px] text-muted-foreground font-medium uppercase tracking-widest\">No Selection</div>\r\n                )}\r\n            </div>\r\n\r\n            <nav className=\"flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar\">\r\n                {navItems.map((item, idx) => {\r\n                    const isActive = location.pathname.startsWith(item.path);\r\n                    return (\r\n                        <motion.div\r\n                            key={item.path}\r\n                            initial={{ opacity: 0, x: -10 }}\r\n                            animate={{ opacity: 1, x: 0 }}\r\n                            transition={{ delay: idx * 0.03 }}\r\n                        >\r\n                            <Link\r\n                                to={item.path}\r\n                                onClick={onClose}\r\n                                className={clsx(\r\n                                    'flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all duration-300 group relative overflow-hidden',\r\n                                    isActive\r\n                                        ? 'bg-primary text-primary-foreground shadow-lg shadow-primary/20'\r\n                                        : 'text-muted-foreground hover:bg-accent hover:text-foreground'\r\n                                )}\r\n                            >\r\n                                {isActive && (\r\n                                    <motion.div\r\n                                        layoutId=\"sidebar-active\"\r\n                                        className=\"absolute inset-0 bg-primary z-0\"\r\n                                        transition={{ type: \"spring\", bounce: 0.2, duration: 0.6 }}\r\n                                    />\r\n                                )}\r\n                                <item.icon className={clsx('w-5 h-5 transition-transform group-hover:scale-110 relative z-10', isActive ? 'text-primary-foreground' : item.color)} />\r\n                                <span className=\"font-black text-sm relative z-10 tracking-tight uppercase tracking-[0.05em]\">{item.label}</span>\r\n                                {isActive && (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0, scale: 0 }}\r\n                                        animate={{ opacity: 1, scale: 1 }}\r\n                                        className=\"ml-auto w-1.5 h-1.5 bg-white rounded-full relative z-10 shadow-[0_0_8px_rgba(255,255,255,0.8)]\"\r\n                                    />\r\n                                )}\r\n                            </Link>\r\n                        </motion.div>\r\n                    );\r\n                })}\r\n            </nav>\r\n\r\n            <div className=\"p-4 border-t border-border bg-muted/10\">\r\n                <div className=\"flex items-center gap-3 px-4 py-3 bg-emerald-500/5 border border-emerald-500/10 rounded-2xl group cursor-help transition-all hover:bg-emerald-500/10\">\r\n                    <div className=\"relative\">\r\n                        <Shield className=\"w-4 h-4 text-emerald-500\" />\r\n                        <motion.div\r\n                            animate={{ scale: [1, 1.5, 1], opacity: [0.5, 0, 0.5] }}\r\n                            transition={{ duration: 2, repeat: Infinity }}\r\n                            className=\"absolute inset-0 bg-emerald-500 rounded-full\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                        <p className=\"text-[10px] font-black uppercase tracking-[0.2em] text-emerald-600\">Secure Node</p>\r\n                        <p className=\"text-[8px] font-bold text-muted-foreground uppercase tracking-widest truncate\">System Integrity: 100%</p>\r\n                    </div>\r\n                    <Lock className=\"w-3 h-3 text-muted-foreground/30\" />\r\n                </div>\r\n            </div>\r\n\r\n        </div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\layout\\backgrounds.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\ui\\DatePicker.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nM:\\Projects\\MoneyArc-main\\src\\components\\ui\\DatePicker.tsx:30:13\n  28 |         if (value) {\n  29 |             const [y, m, d] = value.split('-').map(Number);\n> 30 |             setViewDate(new Date(y, m - 1, d));\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  31 |         }\n  32 |     }, [value]);\n  33 |","line":30,"column":13,"nodeType":null,"endLine":30,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { ChevronLeft, ChevronRight, Calendar } from 'lucide-react';\r\nimport clsx from 'clsx';\r\n\r\ninterface DatePickerProps {\r\n    value: string;\r\n    onChange: (date: string) => void;\r\n    label?: string;\r\n    className?: string; // Allow external styling\r\n}\r\n\r\nexport default function DatePicker({ value, onChange, label, className }: DatePickerProps) {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Initial date setup: parse value or use today\r\n    const getInitialDate = () => {\r\n        if (!value) return new Date();\r\n        const [y, m, d] = value.split('-').map(Number);\r\n        return new Date(y, m - 1, d);\r\n    };\r\n\r\n    const [viewDate, setViewDate] = useState(getInitialDate); // Date for month/year navigation\r\n\r\n    // Sync viewDate when value changes externally\r\n    useEffect(() => {\r\n        if (value) {\r\n            const [y, m, d] = value.split('-').map(Number);\r\n            setViewDate(new Date(y, m - 1, d));\r\n        }\r\n    }, [value]);\r\n\r\n    // Click outside to close\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const daysInMonth = (year: number, month: number) => new Date(year, month + 1, 0).getDate();\r\n    const firstDayOfMonth = (year: number, month: number) => new Date(year, month, 1).getDay();\r\n\r\n    const handleDateSelect = (day: number) => {\r\n        const newDate = new Date(viewDate.getFullYear(), viewDate.getMonth(), day);\r\n        const y = newDate.getFullYear();\r\n        const m = String(newDate.getMonth() + 1).padStart(2, '0');\r\n        const d = String(newDate.getDate()).padStart(2, '0');\r\n        onChange(`${y}-${m}-${d}`);\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const changeMonth = (offset: number) => {\r\n        setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + offset, 1));\r\n    };\r\n\r\n    const changeYear = (offset: number) => {\r\n        setViewDate(new Date(viewDate.getFullYear() + offset, viewDate.getMonth(), 1));\r\n    };\r\n\r\n    const monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\r\n        \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\r\n\r\n    const renderCalendar = () => {\r\n        const year = viewDate.getFullYear();\r\n        const month = viewDate.getMonth();\r\n        const days = daysInMonth(year, month);\r\n        const firstDay = firstDayOfMonth(year, month);\r\n        const blanks = Array(firstDay).fill(null);\r\n        const dayArray = Array.from({ length: days }, (_, i) => i + 1);\r\n\r\n        const currentDateObj = getInitialDate();\r\n\r\n        return (\r\n            <div className=\"p-4 w-[280px]\">\r\n                {/* Header: Month/Year Navigation */}\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                    <button onClick={() => changeMonth(-1)} className=\"p-1 hover:bg-muted rounded-full transition-colors\" title=\"Previous Month\">\r\n                        <ChevronLeft className=\"w-4 h-4 text-muted-foreground\" />\r\n                    </button>\r\n                    <div className=\"flex flex-col items-center\">\r\n                        <span className=\"font-bold text-sm text-foreground\">{monthNames[month]}</span>\r\n                        {/* Year Navigation (Small buttons next to year) */}\r\n                        <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                            <button onClick={() => changeYear(-1)} className=\"hover:text-primary transition-colors\">{'<'}</button>\r\n                            <span>{year}</span>\r\n                            <button onClick={() => changeYear(1)} className=\"hover:text-primary transition-colors\">{'>'}</button>\r\n                        </div>\r\n                    </div>\r\n                    <button onClick={() => changeMonth(1)} className=\"p-1 hover:bg-muted rounded-full transition-colors\" title=\"Next Month\">\r\n                        <ChevronRight className=\"w-4 h-4 text-muted-foreground\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Day Names */}\r\n                <div className=\"grid grid-cols-7 gap-1 mb-2\">\r\n                    {['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].map(d => (\r\n                        <div key={d} className=\"text-center text-[10px] font-bold text-muted-foreground uppercase\">{d}</div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Days Grid */}\r\n                <div className=\"grid grid-cols-7 gap-1\">\r\n                    {blanks.map((_, i) => <div key={`blank-${i}`} />)}\r\n                    {dayArray.map(day => {\r\n                        const isSelected = value &&\r\n                            currentDateObj.getDate() === day &&\r\n                            currentDateObj.getMonth() === month &&\r\n                            currentDateObj.getFullYear() === year;\r\n\r\n                        const isToday = new Date().getDate() === day &&\r\n                            new Date().getMonth() === month &&\r\n                            new Date().getFullYear() === year;\r\n\r\n                        return (\r\n                            <button\r\n                                key={day}\r\n                                onClick={() => handleDateSelect(day)}\r\n                                className={clsx(\r\n                                    \"w-8 h-8 flex items-center justify-center rounded-lg text-xs font-medium transition-all relative\",\r\n                                    isSelected\r\n                                        ? \"bg-primary text-primary-foreground font-bold shadow-md shadow-primary/20 scale-105\"\r\n                                        : \"hover:bg-muted text-foreground hover:scale-105\",\r\n                                    !isSelected && isToday && \"bg-primary/5 text-primary font-bold border border-primary/20\"\r\n                                )}\r\n                            >\r\n                                {day}\r\n                                {/* Dot for today if not selected */}\r\n                                {!isSelected && isToday && (\r\n                                    <div className=\"absolute bottom-1 left-1/2 -translate-x-1/2 w-0.5 h-0.5 rounded-full bg-primary\" />\r\n                                )}\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n                {/* Footer: Today Button */}\r\n                <div className=\"mt-3 pt-3 border-t border-border/50 flex justify-center\">\r\n                    <button\r\n                        onClick={() => {\r\n                            const today = new Date();\r\n                            const y = today.getFullYear();\r\n                            const m = String(today.getMonth() + 1).padStart(2, '0');\r\n                            const d = String(today.getDate()).padStart(2, '0');\r\n                            onChange(`${y}-${m}-${d}`);\r\n                            setIsOpen(false);\r\n                        }}\r\n                        className=\"text-[10px] font-bold text-primary hover:underline uppercase tracking-widest\"\r\n                    >\r\n                        Today\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className={clsx(\"relative\", className)} ref={containerRef}>\r\n            {label && <label className=\"text-[8px] uppercase font-black tracking-widest text-muted-foreground ml-1 mb-1.5 block\">{label}</label>}\r\n            <div onClick={() => setIsOpen(!isOpen)} className=\"cursor-pointer group w-full\">\r\n                <div className={clsx(\r\n                    \"flex items-center gap-2 bg-background/50 border border-primary/10 rounded-xl px-3 py-2 transition-all w-full\",\r\n                    isOpen ? \"ring-2 ring-primary/20 bg-background\" : \"hover:bg-primary/5 hover:border-primary/20\"\r\n                )}>\r\n                    <Calendar className={clsx(\"w-4 h-4 transition-colors\", isOpen ? \"text-primary\" : \"text-primary/60 group-hover:text-primary\")} />\r\n                    <span className=\"text-[10px] font-black text-foreground tabular-nums flex-1\">\r\n                        {value ? new Date(getInitialDate()).toLocaleDateString(undefined, { day: 'numeric', month: 'short', year: 'numeric' }) : 'Select Date'}\r\n                    </span>\r\n                    <ChevronLeft className={clsx(\"w-3 h-3 text-muted-foreground transition-transform rotate-[-90deg]\", isOpen && \"rotate-[90deg]\")} />\r\n                </div>\r\n            </div>\r\n            <AnimatePresence>\r\n                {isOpen && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: 10, scale: 0.95 }}\r\n                        animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                        exit={{ opacity: 0, y: 10, scale: 0.95 }}\r\n                        className=\"absolute z-[9999] mt-2 top-full left-0 glass-panel bg-[#09090b] border border-primary/20 rounded-2xl shadow-[0_20px_40px_-12px_rgba(0,0,0,0.5)] overflow-hidden\"\r\n                    >\r\n                        {renderCalendar()}\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\ui\\GeminiLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\ui\\Logo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\ui\\PeriodSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\ui\\Select.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[280,283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[280,283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { ChevronDown, Check } from 'lucide-react';\r\nimport { createPortal } from 'react-dom';\r\n\r\ninterface Option {\r\n    value: string;\r\n    label: string;\r\n    icon?: any;\r\n    description?: string;\r\n}\r\n\r\ninterface SelectProps {\r\n    value: string;\r\n    onChange: (value: string) => void;\r\n    options: Option[];\r\n    placeholder?: string;\r\n    label?: string;\r\n    className?: string;\r\n    disabled?: boolean;\r\n}\r\n\r\nexport default function Select({ value, onChange, options, placeholder = \"Select an option\", label, className = \"\", disabled = false }: SelectProps) {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [coords, setCoords] = useState({ top: 0, left: 0, width: 0 });\r\n    const triggerRef = useRef<HTMLDivElement>(null);\r\n    const selectedOption = options.find(o => o.value === value);\r\n\r\n    const updateCoords = () => {\r\n        if (triggerRef.current) {\r\n            const rect = triggerRef.current.getBoundingClientRect();\r\n            setCoords({\r\n                top: rect.bottom + window.scrollY + 8,\r\n                left: rect.left + window.scrollX,\r\n                width: rect.width\r\n            });\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            updateCoords();\r\n            window.addEventListener('scroll', updateCoords);\r\n            window.addEventListener('resize', updateCoords);\r\n        }\r\n        return () => {\r\n            window.removeEventListener('scroll', updateCoords);\r\n            window.removeEventListener('resize', updateCoords);\r\n        };\r\n    }, [isOpen]);\r\n\r\n    // Close on click outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (triggerRef.current && !triggerRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        if (isOpen) {\r\n            document.addEventListener('mousedown', handleClickOutside);\r\n        }\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, [isOpen]);\r\n\r\n    return (\r\n        <div className={`relative ${className}`}>\r\n            {label && (\r\n                <label className=\"block text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-2 ml-1\">\r\n                    {label}\r\n                </label>\r\n            )}\r\n\r\n            <div\r\n                ref={triggerRef}\r\n                onClick={() => !disabled && setIsOpen(!isOpen)}\r\n                className={`\r\n                    flex items-center justify-between gap-3 px-4 py-3 rounded-2xl border transition-all cursor-pointer bg-card\r\n                    ${disabled ? 'opacity-50 cursor-not-allowed' : 'hover:border-primary/50 hover:shadow-md'}\r\n                    ${isOpen ? 'border-primary ring-4 ring-primary/10 shadow-lg' : 'border-border shadow-sm'}\r\n                `}\r\n            >\r\n                <div className=\"flex items-center gap-3 overflow-hidden\">\r\n                    {selectedOption?.icon && <selectedOption.icon className=\"w-4 h-4 text-primary\" />}\r\n                    <span className={`text-sm font-bold truncate ${!selectedOption ? 'text-muted-foreground/50' : 'text-foreground'}`}>\r\n                        {selectedOption ? selectedOption.label : placeholder}\r\n                    </span>\r\n                </div>\r\n                <ChevronDown className={`w-4 h-4 text-muted-foreground transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`} />\r\n            </div>\r\n\r\n            {typeof document !== 'undefined' && createPortal(\r\n                <AnimatePresence>\r\n                    {isOpen && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0, y: -10, scale: 0.95 }}\r\n                            animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                            exit={{ opacity: 0, y: -10, scale: 0.95 }}\r\n                            transition={{ duration: 0.2, ease: \"easeOut\" }}\r\n                            style={{\r\n                                position: 'absolute',\r\n                                top: coords.top,\r\n                                left: coords.left,\r\n                                width: coords.width,\r\n                                zIndex: 9999\r\n                            }}\r\n                            className=\"bg-card/90 backdrop-blur-2xl border border-border/50 dark:border-white/10 rounded-2xl shadow-2xl overflow-hidden p-1\"\r\n                        >\r\n                            <div className=\"max-h-[300px] overflow-y-auto custom-scrollbar\">\r\n                                {options.map((option) => (\r\n                                    <button\r\n                                        key={option.value}\r\n                                        onClick={() => {\r\n                                            onChange(option.value);\r\n                                            setIsOpen(false);\r\n                                        }}\r\n                                        className={`\r\n                                            w-full flex flex-col items-start gap-1 p-3 rounded-xl transition-all text-left group\r\n                                            ${value === option.value\r\n                                                ? 'bg-primary text-primary-foreground shadow-lg shadow-primary/20'\r\n                                                : 'hover:bg-primary/5'\r\n                                            }\r\n                                        `}\r\n                                    >\r\n                                        <div className=\"flex items-center justify-between w-full\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                {option.icon && <option.icon className={`w-4 h-4 ${value === option.value ? 'text-white' : 'text-primary group-hover:scale-110 transition-transform'}`} />}\r\n                                                <span className=\"text-sm font-black tracking-tight\">{option.label}</span>\r\n                                            </div>\r\n                                            {value === option.value && <Check className=\"w-4 h-4\" />}\r\n                                        </div>\r\n                                        {option.description && (\r\n                                            <p className={`text-[10px] font-bold uppercase tracking-wider ${value === option.value ? 'text-white/70' : 'text-muted-foreground group-hover:text-primary/70'}`}>\r\n                                                {option.description}\r\n                                            </p>\r\n                                        )}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>,\r\n                document.body\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\components\\ui\\ShortcutHelp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\data\\countries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\data\\currencies.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\data\\indian_states.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\masters\\LedgerForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\masters\\LedgerList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\masters\\LedgerManagement.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nM:\\Projects\\MoneyArc-main\\src\\features\\accounting\\masters\\LedgerManagement.tsx:22:60\n  20 |         const tab = searchParams.get('tab');\n  21 |         const ledgerId = searchParams.get('ledgerId');\n> 22 |         if (tab && (tab === 'list' || tab === 'vouchers')) setActiveTab(tab as 'list' | 'vouchers');\n     |                                                            ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  23 |         if (ledgerId) setSelectedLedgerId(ledgerId);\n  24 |     }, [searchParams]);\n  25 |","line":22,"column":60,"nodeType":null,"endLine":22,"endColumn":72}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { List, FileText } from 'lucide-react';\r\nimport LedgerList from './LedgerList';\r\nimport LedgerReport from '../../reports/LedgerReport';\r\nimport clsx from 'clsx';\r\nimport { useSearchParams } from 'react-router-dom';\r\n\r\nexport default function LedgerManagement() {\r\n    const [searchParams, setSearchParams] = useSearchParams();\r\n    const [activeTab, setActiveTab] = useState<'list' | 'vouchers'>(\r\n        (searchParams.get('tab') as 'list' | 'vouchers') || 'list'\r\n    );\r\n    const [selectedLedgerId, setSelectedLedgerId] = useState<string>(\r\n        searchParams.get('ledgerId') || ''\r\n    );\r\n\r\n    // Sync state with URL params\r\n    useEffect(() => {\r\n        const tab = searchParams.get('tab');\r\n        const ledgerId = searchParams.get('ledgerId');\r\n        if (tab && (tab === 'list' || tab === 'vouchers')) setActiveTab(tab as 'list' | 'vouchers');\r\n        if (ledgerId) setSelectedLedgerId(ledgerId);\r\n    }, [searchParams]);\r\n\r\n    const handleViewTransactions = (ledgerId: string) => {\r\n        setSelectedLedgerId(ledgerId);\r\n        setActiveTab('vouchers');\r\n        setSearchParams({ tab: 'vouchers', ledgerId });\r\n    };\r\n\r\n    const handleTabChange = (tab: 'list' | 'vouchers') => {\r\n        setActiveTab(tab);\r\n        const params: Record<string, string> = { tab };\r\n        if (selectedLedgerId) params.ledgerId = selectedLedgerId;\r\n        setSearchParams(params);\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto space-y-6\">\r\n            <div className=\"p-1 gap-1 flex items-center bg-card/80 backdrop-blur-2xl border border-white/10 dark:border-white/5 rounded-2xl shadow-xl w-fit\">\r\n                <button\r\n                    onClick={() => handleTabChange('list')}\r\n                    className={clsx(\r\n                        \"relative flex items-center gap-3 px-6 py-3 text-xs font-black uppercase tracking-widest transition-all duration-500 rounded-xl overflow-hidden group\",\r\n                        activeTab === 'list' ? \"text-primary-foreground shadow-lg\" : \"text-muted-foreground hover:text-foreground hover:bg-white/5\"\r\n                    )}\r\n                >\r\n                    {activeTab === 'list' && (\r\n                        <motion.div\r\n                            layoutId=\"activeTabGlow\"\r\n                            className=\"absolute inset-0 bg-primary/20 backdrop-blur-xl\"\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            transition={{ duration: 0.5 }}\r\n                        />\r\n                    )}\r\n                    {activeTab === 'list' && (\r\n                        <motion.div\r\n                            layoutId=\"activeTabBase\"\r\n                            className=\"absolute inset-0 primary-gradient\"\r\n                            transition={{ type: \"spring\", bounce: 0.2, duration: 0.6 }}\r\n                        />\r\n                    )}\r\n                    <List className=\"w-4 h-4 relative z-10\" />\r\n                    <span className=\"relative z-10\">Ledger Registry</span>\r\n                </button>\r\n                <button\r\n                    onClick={() => handleTabChange('vouchers')}\r\n                    className={clsx(\r\n                        \"relative flex items-center gap-3 px-6 py-3 text-xs font-black uppercase tracking-widest transition-all duration-500 rounded-xl overflow-hidden group\",\r\n                        activeTab === 'vouchers' ? \"text-primary-foreground shadow-lg\" : \"text-muted-foreground hover:text-foreground hover:bg-white/5\"\r\n                    )}\r\n                >\r\n                    {activeTab === 'vouchers' && (\r\n                        <motion.div\r\n                            layoutId=\"activeTabGlow\"\r\n                            className=\"absolute inset-0 bg-primary/20 backdrop-blur-xl\"\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            transition={{ duration: 0.5 }}\r\n                        />\r\n                    )}\r\n                    {activeTab === 'vouchers' && (\r\n                        <motion.div\r\n                            layoutId=\"activeTabBase\"\r\n                            className=\"absolute inset-0 primary-gradient\"\r\n                            transition={{ type: \"spring\", bounce: 0.2, duration: 0.6 }}\r\n                        />\r\n                    )}\r\n                    <FileText className=\"w-4 h-4 relative z-10\" />\r\n                    <span className=\"relative z-10\">Executive Ledger Report</span>\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"relative\">\r\n                <AnimatePresence mode=\"wait\">\r\n                    {activeTab === 'list' ? (\r\n                        <motion.div\r\n                            key=\"list\"\r\n                            initial={{ opacity: 0, y: 10 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            exit={{ opacity: 0, y: -10 }}\r\n                            transition={{ duration: 0.2 }}\r\n                        >\r\n                            <LedgerList onViewTransactions={handleViewTransactions} />\r\n                        </motion.div>\r\n                    ) : (\r\n                        <motion.div\r\n                            key=\"vouchers\"\r\n                            initial={{ opacity: 0, y: 10 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            exit={{ opacity: 0, y: -10 }}\r\n                            transition={{ duration: 0.2 }}\r\n                        >\r\n                            <LedgerReport\r\n                                externalSelectedLedgerId={selectedLedgerId}\r\n                                onLedgerChange={setSelectedLedgerId}\r\n                                isEmbedded={true}\r\n                            />\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\masters\\QuickCategoryForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\masters\\QuickGroupForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\masters\\QuickLedgerForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\masters\\QuickStockItemForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\vouchers\\InvoiceModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9479,9482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9479,9482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9513,9516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9513,9516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":127,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":130,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9655,9658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9655,9658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":166,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":169,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9694,9697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9694,9697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9880,9883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9880,9883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":124,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":127,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10024,10027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10024,10027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10166,10169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10166,10169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRef } from 'react';\r\nimport { Printer, X, FileText } from 'lucide-react';\r\nimport type { Voucher } from '../../../services/accounting/VoucherService';\r\nimport type { Company } from '../../../services/persistence/types';\r\nimport type { Ledger } from '../../../services/accounting/ReportService';\r\nimport { useLocalization } from '../../../hooks/useLocalization';\r\nimport { TaxService } from '../../../services/accounting/TaxService';\r\n\r\ninterface InvoiceModalProps {\r\n    voucher: Voucher;\r\n    company: Company;\r\n    party: Ledger; // Renamed from customer to party to be generic\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function InvoiceModal({ voucher, company, party, onClose }: InvoiceModalProps) {\r\n    const { formatCurrency, tax } = useLocalization();\r\n    const printRef = useRef<HTMLDivElement>(null);\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    // Helper to determine Voucher Title\r\n    const getVoucherTitle = (type: string) => {\r\n        switch (type) {\r\n            case 'Sales': return 'TAX INVOICE';\r\n            case 'Purchase': return 'PURCHASE VOUCHER';\r\n            case 'Payment': return 'PAYMENT VOUCHER';\r\n            case 'Receipt': return 'RECEIPT VOUCHER';\r\n            case 'Contra': return 'CONTRA VOUCHER';\r\n            case 'Journal': return 'JOURNAL VOUCHER';\r\n            default: return `${type.toUpperCase()} VOUCHER`;\r\n        }\r\n    };\r\n\r\n    // Helper to determine Party Label (Bill To / Paid To / Received From)\r\n    const getPartyLabel = (type: string) => {\r\n        switch (type) {\r\n            case 'Sales': return 'Bill To';\r\n            case 'Purchase': return 'Supplier';\r\n            case 'Payment': return 'Paid To';\r\n            case 'Receipt': return 'Received From';\r\n            default: return 'Party Details';\r\n        }\r\n    };\r\n\r\n    const hasInventory = voucher.rows.some(r => r.inventoryAllocations && r.inventoryAllocations.length > 0);\r\n    const summary = TaxService.calculateVoucherSummary(voucher);\r\n    const { taxableValue, tax1, tax2, tax3, invoiceValue: totalAmount } = summary;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4\">\r\n            <div className=\"bg-card text-foreground w-full max-w-4xl h-[90vh] overflow-y-auto rounded-3xl shadow-2xl flex flex-col no-print-modal\">\r\n                {/* Modal Toolbar */}\r\n                <div className=\"p-6 border-b border-border flex items-center justify-between bg-card sticky top-0 z-10\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <FileText className=\"w-6 h-6 text-primary\" />\r\n                        <h2 className=\"text-xl font-black uppercase tracking-tight\">{getVoucherTitle(voucher.type)} PREVIEW</h2>\r\n                        <span className=\"px-3 py-1 bg-emerald-500/10 text-emerald-500 text-[10px] font-black rounded-full uppercase\">{voucher.voucherNo}</span>\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                        <button\r\n                            onClick={handlePrint}\r\n                            className=\"flex items-center gap-2 px-5 py-2.5 bg-foreground text-background rounded-xl text-xs font-black uppercase tracking-widest hover:opacity-90 transition-all shadow-lg\"\r\n                        >\r\n                            <Printer className=\"w-4 h-4\" />\r\n                            Print\r\n                        </button>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-2.5 hover:bg-muted rounded-xl transition-all\"\r\n                        >\r\n                            <X className=\"w-5 h-5 text-muted-foreground\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Printable Content */}\r\n                <div ref={printRef} className=\"p-12 print:p-8 flex-1 bg-card printable-area\">\r\n                    <style>{`\r\n                        @media print {\r\n                            body * { visibility: hidden; }\r\n                            .printable-area, .printable-area * { visibility: visible; }\r\n                            .printable-area { position: absolute; left: 0; top: 0; width: 100%; }\r\n                            .no-print-modal { box-shadow: none !important; border: none !important; }\r\n                        }\r\n                    `}</style>\r\n                    <div className=\"flex justify-between items-start border-b-2 border-foreground pb-8 mb-8\">\r\n                        <div>\r\n                            <h1 className=\"text-4xl font-black tracking-tighter uppercase text-foreground\">{company.name}</h1>\r\n                            <p className=\"text-sm font-bold text-muted-foreground mt-2 max-w-xs\">{company.address}</p>\r\n                            <div className=\"mt-4 inline-block px-3 py-1 bg-muted rounded-lg\">\r\n                                <p className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground\">{tax.idLabel}: <span className=\"text-foreground\">{company.gstin}</span></p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <h2 className=\"text-4xl font-black text-muted/10 uppercase tracking-tighter mb-2 leading-none\">{getVoucherTitle(voucher.type)}</h2>\r\n                            <p className=\"text-sm font-black text-foreground mt-4 uppercase tracking-widest\"># {voucher.voucherNo}</p>\r\n                            <p className=\"text-xs font-bold text-muted-foreground mt-1 uppercase tracking-widest\">Date: {new Date(voucher.date).toLocaleDateString()}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Parties */}\r\n                    <div className=\"grid grid-cols-2 gap-12 mb-12\">\r\n                        <div className=\"p-6 bg-muted/30 rounded-3xl border border-border\">\r\n                            <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] mb-3\">{getPartyLabel(voucher.type)}</p>\r\n                            <h3 className=\"text-xl font-black text-foreground uppercase\">{party.name}</h3>\r\n                            <p className=\"text-sm font-bold text-muted-foreground mt-2 whitespace-pre-line\">{party.address || \"Address not provided\"}</p>\r\n                            {party.gstin && <p className=\"text-xs font-black text-foreground mt-3 uppercase tracking-widest\">{tax.idLabel}: {party.gstin}</p>}\r\n                        </div>\r\n                        {/* Only show 'Ship From' / Company details again if it's Sales/Purchase, otherwise maybe less relevant? \r\n                            Actually, standard format usually shows Company as header (done) and 'Receiver/Payer' details.\r\n                            Let's keep the right side for Company Detail or empty for internal vouchers.\r\n                         */}\r\n                        <div className=\"p-6 bg-muted/30 rounded-3xl border border-border\">\r\n                            {/* For simple vouchers we might not need the second box, but keeping layout consistent */}\r\n                            <div className=\"text-right\">\r\n                                <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] mb-3\">Voucher Details</p>\r\n                                <p className=\"text-sm font-bold text-muted-foreground\">Type: <span className=\"text-foreground\">{voucher.type}</span></p>\r\n                                {voucher.narration && <p className=\"text-sm font-medium text-muted-foreground mt-2\">\"{voucher.narration}\"</p>}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Content Table */}\r\n                    <table className=\"w-full mb-8\">\r\n                        <thead>\r\n                            <tr className=\"border-b-2 border-foreground text-left\">\r\n                                <th className=\"py-4 text-[10px] font-black uppercase tracking-widest text-muted-foreground\">Particulars</th>\r\n                                {hasInventory && <th className=\"py-4 text-[10px] font-black uppercase tracking-widest text-muted-foreground text-right\">Qty</th>}\r\n                                {hasInventory && <th className=\"py-4 text-[10px] font-black uppercase tracking-widest text-muted-foreground text-right\">Rate</th>}\r\n                                <th className=\"py-4 text-[10px] font-black uppercase tracking-widest text-muted-foreground text-right\">Amount</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border\">\r\n                            {hasInventory ? (\r\n                                // Inventory Item Rows\r\n                                voucher.rows.map(r => r.inventoryAllocations).flat().filter(Boolean).map((item, idx: number) => (\r\n                                    <tr key={idx}>\r\n                                        <td className=\"py-6 font-black text-foreground uppercase\">\r\n                                            {/* We need Item Name here. If not in allocation, we have an issue. \r\n                                                VoucherService InventoryEntry has 'itemName'. Good. \r\n                                            */}\r\n                                            {(item as any).itemName || `Item ${(item as any).itemId}`}\r\n                                            <div className=\"text-[9px] text-muted-foreground font-bold mt-1\">BATCH: {(item as any).batchNo || '-'} // EXP: {(item as any).expiryDate || '-'}</div>\r\n                                        </td>\r\n                                        <td className=\"py-6 text-right font-bold text-foreground\">{(item as any).quantity}</td>\r\n                                        <td className=\"py-6 text-right font-bold text-foreground\">{formatCurrency((item as any).rate)}</td>\r\n                                        <td className=\"py-6 text-right font-black text-foreground\">{formatCurrency((item as any).amount)}</td>\r\n                                    </tr>\r\n                                ))\r\n                            ) : (\r\n                                // Accounting Rows (Ledgers)\r\n                                voucher.rows.map((row, idx) => (\r\n                                    <tr key={idx}>\r\n                                        <td className=\"py-6 font-black text-foreground uppercase\">\r\n                                            {row.account}\r\n                                            <div className=\"text-[9px] text-muted-foreground font-bold mt-1 uppercase tracking-wider\">{row.type === 'Dr' ? 'Debit' : 'Credit'}</div>\r\n                                        </td>\r\n                                        {/* Empty cells for Qty/Rate if generic table structure used, but we are conditionally rendering headers, so no need */}\r\n                                        <td className=\"py-6 text-right font-black text-foreground\">{formatCurrency(row.type === 'Dr' ? row.debit : row.credit)}</td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n\r\n                    {/* Totals */}\r\n                    <div className=\"flex justify-end\">\r\n                        <div className=\"w-full max-w-xs space-y-4\">\r\n                            {/* Only show Tax Breakdown if it's a Tax Invoice or has Tax */}\r\n                            {(tax1 > 0 || tax2 > 0 || tax3 > 0) && (\r\n                                <>\r\n                                    <div className=\"flex justify-between text-sm\">\r\n                                        <span className=\"font-bold text-muted-foreground uppercase tracking-widest\">{tax.labels.taxable}</span>\r\n                                        <span className=\"font-black text-foreground\">{formatCurrency(taxableValue)}</span>\r\n                                    </div>\r\n                                    {tax1 > 0 && (\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"font-bold text-muted-foreground uppercase tracking-widest text-[10px]\">{tax.labels.tier1 || 'Tax 1'}</span>\r\n                                            <span className=\"font-black text-foreground\">{formatCurrency(tax1)}</span>\r\n                                        </div>\r\n                                    )}\r\n                                    {tax2 > 0 && (\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"font-bold text-muted-foreground uppercase tracking-widest text-[10px]\">{tax.labels.tier2 || 'Tax 2'}</span>\r\n                                            <span className=\"font-black text-foreground\">{formatCurrency(tax2)}</span>\r\n                                        </div>\r\n                                    )}\r\n                                    {tax3 > 0 && (\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"font-bold text-muted-foreground uppercase tracking-widest text-[10px]\">{tax.labels.tier3 || 'Tax 3'}</span>\r\n                                            <span className=\"font-black text-foreground\">{formatCurrency(tax3)}</span>\r\n                                        </div>\r\n                                    )}\r\n                                </>\r\n                            )}\r\n\r\n                            <div className=\"flex justify-between items-center pt-4 border-t-2 border-foreground\">\r\n                                <span className=\"text-sm font-black uppercase tracking-widest text-foreground\">Total Amount</span>\r\n                                <span className=\"text-2xl font-black text-foreground tracking-tighter\">{formatCurrency(totalAmount)}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Footer / Notes */}\r\n                    <div className=\"mt-20 pt-8 border-t border-border flex justify-between items-end\">\r\n                        <div>\r\n                            {(voucher.type === 'Sales' || voucher.type === 'Purchase') && (\r\n                                <>\r\n                                    <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-2\">Terms & Conditions</p>\r\n                                    <ul className=\"text-[9px] font-bold text-muted-foreground space-y-1\">\r\n                                        <li>1. Goods once sold will not be taken back.</li>\r\n                                        <li>2. Payment should be made within 15 days.</li>\r\n                                    </ul>\r\n                                </>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                            <div className=\"w-48 h-20 border-b border-foreground mb-2\"></div>\r\n                            <p className=\"text-[10px] font-black text-foreground uppercase tracking-widest\">Authorized Signatory</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\accounting\\vouchers\\VoucherEntry.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3515,3518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3515,3518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3589,3592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3589,3592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4345,4348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4345,4348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4382,4385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4382,4385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4733,4736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4733,4736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":146,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":146,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'activeCompany?.symbol'. Either include it or remove the dependency array.","line":263,"column":8,"nodeType":"ArrayExpression","endLine":263,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [rows, ledgers, activeCompany?.symbol]","fix":{"range":[11753,11768],"text":"[rows, ledgers, activeCompany?.symbol]"}}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { Box, Plus, Trash2, FileText, AlertTriangle, Save, Tag, Package, Coins, Mic, MicOff, Sparkles, Shield, Loader2 } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport clsx from 'clsx';\r\nimport { usePersistence } from '../../../services/persistence/PersistenceContext';\r\nimport { VoucherService, type Voucher, type VoucherRow, type InventoryEntry } from '../../../services/accounting/VoucherService';\r\nimport type { Ledger } from '../../../services/accounting/ReportService';\r\nimport DatePicker from '../../../components/ui/DatePicker';\r\nimport Select from '../../../components/ui/Select';\r\nimport type { StockItem, UnitOfMeasure } from '../../../services/inventory/types';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport QuickLedgerForm from '../masters/QuickLedgerForm';\r\nimport QuickStockItemForm from '../masters/QuickStockItemForm';\r\nimport { GeminiService } from '../../../services/ai/GeminiService';\r\nimport { CURRENCIES } from '../../../data/currencies';\r\nimport { useLocalization } from '../../../hooks/useLocalization';\r\n\r\ntype VoucherType = 'Payment' | 'Receipt' | 'Journal' | 'Contra' | 'Sales' | 'Purchase';\r\n\r\nexport default function VoucherEntry() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const { tax, formatCurrency, symbol, valuationLabel } = useLocalization();\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n\r\n    // Data States\r\n    const [ledgers, setLedgers] = useState<Ledger[]>([]);\r\n    const [stockItems, setStockItems] = useState<StockItem[]>([]);\r\n    const [units, setUnits] = useState<UnitOfMeasure[]>([]);\r\n\r\n    // UI States\r\n    const [voucherType, setVoucherType] = useState<VoucherType>('Payment');\r\n    const isInventoryMode = voucherType === 'Sales' || voucherType === 'Purchase';\r\n    const [rows, setRows] = useState<VoucherRow[]>([\r\n        { id: 1, type: 'Dr', account: '', debit: 0, credit: 0 },\r\n        { id: 2, type: 'Cr', account: '', debit: 0, credit: 0 },\r\n    ]);\r\n    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [narration, setNarration] = useState('');\r\n    const [voucherNo, setVoucherNo] = useState('1');\r\n    const [currency, setCurrency] = useState(activeCompany?.currency || 'INR');\r\n    const [exchangeRate, setExchangeRate] = useState(1);\r\n\r\n    // Inventory Allocation State\r\n    const [showInventoryModal, setShowInventoryModal] = useState(false);\r\n    const [activeRowId, setActiveRowId] = useState<number | null>(null);\r\n    const [tempAllocations, setTempAllocations] = useState<InventoryEntry[]>([]);\r\n\r\n    const [showQuickLedger, setShowQuickLedger] = useState(false);\r\n    const [showQuickItem, setShowQuickItem] = useState(false);\r\n    const [quickCreateInitial, setQuickCreateInitial] = useState('');\r\n\r\n    const tableRef = useRef<HTMLTableElement>(null);\r\n\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const [negativeAlerts, setNegativeAlerts] = useState<string[]>([]);\r\n    const [taxSummary, setTaxSummary] = useState({ cgst: 0, sgst: 0, igst: 0 });\r\n\r\n    // Advanced Features State\r\n    const [apiKey, setApiKey] = useState(localStorage.getItem('moneyarc_gemini_key') || '');\r\n    const [isListening, setIsListening] = useState(false);\r\n    const [smartCheckLoading, setSmartCheckLoading] = useState(false);\r\n    const [smartInsight, setSmartInsight] = useState<string | null>(null);\r\n    const recognitionRef = useRef<any>(null);\r\n\r\n    useEffect(() => {\r\n        const handleKeyUpdate = (e: any) => {\r\n            const newKey = e.detail || localStorage.getItem('moneyarc_gemini_key');\r\n            if (newKey) setApiKey(newKey);\r\n        };\r\n        const handleStorageChange = (e: StorageEvent) => {\r\n            if (e.key === 'moneyarc_gemini_key' && e.newValue) setApiKey(e.newValue);\r\n        };\r\n        window.addEventListener('moneyarc_key_updated', handleKeyUpdate);\r\n        window.addEventListener('storage', handleStorageChange);\r\n        return () => {\r\n            window.removeEventListener('moneyarc_key_updated', handleKeyUpdate);\r\n            window.removeEventListener('storage', handleStorageChange);\r\n        };\r\n    }, []);\r\n\r\n    // Initialize Web Speech\r\n    useEffect(() => {\r\n        const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n        if (SpeechRecognition) {\r\n            recognitionRef.current = new SpeechRecognition();\r\n            recognitionRef.current.continuous = true;\r\n            recognitionRef.current.interimResults = false;\r\n            recognitionRef.current.lang = 'en-US';\r\n\r\n            recognitionRef.current.onresult = (event: any) => {\r\n                const transcript = event.results[event.results.length - 1][0].transcript;\r\n                setNarration(prev => (prev ? `${prev} ${transcript}` : transcript));\r\n            };\r\n\r\n            recognitionRef.current.onend = () => setIsListening(false);\r\n            recognitionRef.current.onerror = () => setIsListening(false);\r\n        }\r\n    }, []);\r\n\r\n    const toggleVoice = () => {\r\n        if (isListening) {\r\n            recognitionRef.current?.stop();\r\n        } else {\r\n            recognitionRef.current?.start();\r\n            setIsListening(true);\r\n        }\r\n    };\r\n\r\n    const runSmartCheck = async () => {\r\n        const currentApiKey = apiKey || localStorage.getItem('moneyarc_gemini_key') || 'AIzaSyD2XzwhQH1baDJE-lc1MT-jUYWPf1sfLTU';\r\n        if (!currentApiKey) {\r\n            alert(\"Please set your Gemini API Key in the AI Assistant or Settings.\");\r\n            return;\r\n        }\r\n\r\n        setSmartCheckLoading(true);\r\n        try {\r\n            const service = new GeminiService(currentApiKey);\r\n            const voucherData = {\r\n                type: voucherType,\r\n                rows,\r\n                narration,\r\n                date\r\n            };\r\n\r\n            const prompt = `\r\n                Perform a high-level \"Smart Audit\" of this pending voucher entry.\r\n                Check for:\r\n                1. Accounting logic (Debit matches Credit).\r\n                2. Potential tax issues (GST ledgers present if Sales/Purchase).\r\n                3. Ledger group appropriateness.\r\n                \r\n                Voucher Data: ${JSON.stringify(voucherData, null, 2)}\r\n                \r\n                Provide a short, critical, and helpful paragraph of advice.\r\n            `;\r\n\r\n            const insight = await service.generateInsight(prompt, {\r\n                vouchers: [], // Not needed for single check\r\n                ledgers,\r\n                companyName: activeCompany?.name || 'Company',\r\n                symbol: activeCompany?.symbol || '₹'\r\n            });\r\n            setSmartInsight(insight);\r\n        } catch (err) {\r\n            setSmartInsight(\"Failed to run AI analysis. Check your key.\");\r\n        } finally {\r\n            setSmartCheckLoading(false);\r\n        }\r\n    };\r\n\r\n    // Initial Data Loading\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (provider && activeCompany) {\r\n                const [ledgerData, items, uoms, vouchers] = await Promise.all([\r\n                    provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                    provider.read<StockItem[]>('stock_items.json', activeCompany.path),\r\n                    provider.read<UnitOfMeasure[]>('units.json', activeCompany.path),\r\n                    id ? provider.read<Voucher[]>('vouchers.json', activeCompany.path) : Promise.resolve(null)\r\n                ]);\r\n\r\n                setLedgers(ledgerData || []);\r\n                setStockItems(items || []);\r\n                setUnits(uoms || []);\r\n\r\n                if (id && vouchers) {\r\n                    const voucher = vouchers.find(v => v.id === id);\r\n                    if (voucher) {\r\n                        setVoucherType(voucher.type as VoucherType);\r\n                        setVoucherNo(voucher.voucherNo);\r\n                        setDate(voucher.date);\r\n                        setNarration(voucher.narration);\r\n                        setRows(voucher.rows);\r\n                        setCurrency(voucher.currency || 'INR');\r\n                        setExchangeRate(voucher.exchangeRate || 1);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        loadData();\r\n    }, [provider, activeCompany, id]);\r\n\r\n    // Auto-numbering Effect\r\n    useEffect(() => {\r\n        const fetchNextNumber = async () => {\r\n            if (provider && activeCompany && !id) {\r\n                const nextNo = await VoucherService.getNextVoucherNumber(provider, voucherType, activeCompany.path);\r\n                setVoucherNo(nextNo);\r\n            }\r\n        };\r\n        fetchNextNumber();\r\n    }, [voucherType, provider, activeCompany, id]);\r\n\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.altKey && e.key.toLowerCase() === 'c') {\r\n            e.preventDefault();\r\n            // Determine context: Ledger or Item?\r\n            // If Inventory Modal is open, it's Item. Else Ledger.\r\n            if (showInventoryModal) {\r\n                setShowQuickItem(true);\r\n            } else {\r\n                setShowQuickLedger(true);\r\n                if (activeRowId !== null) {\r\n                    const row = rows.find(r => r.id === activeRowId);\r\n                    if (row) setQuickCreateInitial(row.account || '');\r\n                } else {\r\n                    // Try to find focused input value? Hard to get without ref.\r\n                    setQuickCreateInitial('');\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (e.key === 'Enter') {\r\n            const isSelect = (e.target as HTMLElement).tagName === 'SELECT';\r\n            if (isSelect) return; // Let select handle enter for selection\r\n\r\n            e.preventDefault();\r\n            const inputs = Array.from(tableRef.current?.querySelectorAll('input, select') || []) as HTMLElement[];\r\n            const currentIndex = inputs.indexOf(e.target as HTMLElement);\r\n            if (currentIndex > -1 && currentIndex < inputs.length - 1) {\r\n                inputs[currentIndex + 1].focus();\r\n            } else if (currentIndex === inputs.length - 1) {\r\n                if (rows.length < 15) addRow();\r\n            }\r\n        }\r\n    };\r\n\r\n    // Real-time Insights Effect\r\n    useEffect(() => {\r\n        const analyzeVoucher = () => {\r\n            const alerts: string[] = [];\r\n            let cgst = 0, sgst = 0, igst = 0;\r\n\r\n            rows.forEach(r => {\r\n                if (!r.account) return;\r\n                const ledger = ledgers.find(l => l.name === r.account);\r\n                if (ledger) {\r\n                    // Tax Calculation\r\n                    if (ledger.name.includes('CGST')) cgst += (r.debit || r.credit);\r\n                    if (ledger.name.includes('SGST')) sgst += (r.debit || r.credit);\r\n                    if (ledger.name.includes('IGST')) igst += (r.debit || r.credit);\r\n\r\n                    // Negative Balance Check\r\n                    const currentBal = ledger.balance * (ledger.type === 'Dr' ? 1 : -1);\r\n                    const localChange = (r.debit || 0) - (r.credit || 0);\r\n                    const nextBal = currentBal + localChange;\r\n\r\n                    if (['Cash-in-hand', 'Bank Accounts'].includes(ledger.group)) {\r\n                        if (nextBal < 0) alerts.push(`${ledger.name} balance will drop to ${activeCompany?.symbol || '₹'}${Math.abs(nextBal).toLocaleString()} Cr`);\r\n                    }\r\n                }\r\n            });\r\n\r\n            setNegativeAlerts(alerts);\r\n            setTaxSummary({ cgst, sgst, igst });\r\n        };\r\n\r\n        analyzeVoucher();\r\n    }, [rows, ledgers]);\r\n\r\n    const addRow = () => {\r\n        const lastRow = rows[rows.length - 1];\r\n        setRows([...rows, {\r\n            id: Date.now(),\r\n            type: lastRow.type === 'Dr' ? 'Cr' : 'Dr',\r\n            account: '',\r\n            debit: 0,\r\n            credit: 0\r\n        }]);\r\n    };\r\n\r\n    const removeRow = (id: number) => {\r\n        if (rows.length > 2) setRows(rows.filter(r => r.id !== id));\r\n    };\r\n\r\n    const updateRow = (id: number, field: keyof VoucherRow, value: string | number | unknown) => {\r\n        setRows(rows.map(r => r.id === id ? { ...r, [field]: value } : r));\r\n    };\r\n\r\n    const totalDebit = rows.reduce((acc, r) => acc + (Number(r.debit) || 0), 0);\r\n    const totalCredit = rows.reduce((acc, r) => acc + (Number(r.credit) || 0), 0);\r\n\r\n    // Inventory Allocation Logic\r\n    const openInventoryAllocation = (rowId: number) => {\r\n        const row = rows.find(r => r.id === rowId);\r\n        if (row) {\r\n            setActiveRowId(rowId);\r\n            setTempAllocations(row.inventoryAllocations || []);\r\n            setShowInventoryModal(true);\r\n        }\r\n    };\r\n\r\n    const addInventoryRow = () => {\r\n        setTempAllocations([...tempAllocations, {\r\n            id: Date.now().toString(),\r\n            itemId: '',\r\n            itemName: '',\r\n            quantity: 0,\r\n            unitId: '',\r\n            rate: 0,\r\n            amount: 0\r\n        }]);\r\n    };\r\n\r\n    const updateInventoryRow = (id: string, field: keyof InventoryEntry, value: string | number | unknown) => {\r\n        setTempAllocations(tempAllocations.map(a => {\r\n            if (a.id === id) {\r\n                const updated = { ...a, [field]: value };\r\n                if (field === 'itemId') {\r\n                    const item = stockItems.find(i => i.id === value);\r\n                    if (item) {\r\n                        updated.itemName = item.name;\r\n                        updated.unitId = item.unitId;\r\n                        updated.rate = item.currentRate || item.openingRate;\r\n                    }\r\n                }\r\n                if (field === 'quantity' || field === 'rate') {\r\n                    updated.amount = (Number(updated.quantity) || 0) * (Number(updated.rate) || 0);\r\n                }\r\n                return updated;\r\n            }\r\n            return a;\r\n        }));\r\n    };\r\n\r\n    const saveAllocation = () => {\r\n        if (activeRowId !== null) {\r\n            const totalAllocAmount = tempAllocations.reduce((sum, a) => sum + a.amount, 0);\r\n\r\n            // Determine Tax Type (Intra-state vs Inter-state)\r\n            const activeRow = rows.find(r => r.id === activeRowId);\r\n            const counterpartyLedger = rows.find(r => r.id !== activeRowId && r.account !== '' && !['GST', 'Tax', 'Output', 'Input'].some(k => r.account.includes(k))) ||\r\n                rows.find(r => r.id !== activeRowId && r.account !== '');\r\n            const counterparty = ledgers.find(l => l.name === counterpartyLedger?.account);\r\n\r\n            const isInterState = activeCompany?.state && counterparty?.state &&\r\n                activeCompany.state.trim().toLowerCase() !== counterparty.state.trim().toLowerCase();\r\n\r\n            // Calculate GST impact\r\n            let totalGst = 0;\r\n            tempAllocations.forEach(a => {\r\n                const item = stockItems.find(i => i.id === a.itemId);\r\n                if (item && item.gstRate) {\r\n                    totalGst += (a.amount * item.gstRate) / 100;\r\n                }\r\n            });\r\n\r\n            const newRows = [...rows];\r\n            const rowIndex = newRows.findIndex(r => r.id === activeRowId);\r\n\r\n            if (rowIndex !== -1) {\r\n                newRows[rowIndex] = {\r\n                    ...newRows[rowIndex],\r\n                    inventoryAllocations: tempAllocations,\r\n                    debit: newRows[rowIndex].type === 'Dr' ? totalAllocAmount : 0,\r\n                    credit: newRows[rowIndex].type === 'Cr' ? totalAllocAmount : 0\r\n                };\r\n\r\n                // Define tax ledgers\r\n                const taxLedgerNames = ['Central GST (CGST)', 'State GST (SGST)', 'Integrated GST (IGST)', 'Output GST'];\r\n\r\n                // Clear previous auto-added tax rows to avoid duplicates\r\n                const finalRows = newRows.filter(r => !taxLedgerNames.includes(r.account));\r\n\r\n                if (totalGst > 0) {\r\n                    const commonType = activeRow?.type || 'Dr';\r\n\r\n                    if (isInterState) {\r\n                        finalRows.push({\r\n                            id: Date.now() + 10,\r\n                            type: commonType,\r\n                            account: 'Integrated GST (IGST)',\r\n                            debit: commonType === 'Dr' ? totalGst : 0,\r\n                            credit: commonType === 'Cr' ? totalGst : 0\r\n                        });\r\n                    } else {\r\n                        finalRows.push({\r\n                            id: Date.now() + 11,\r\n                            type: commonType,\r\n                            account: 'Central GST (CGST)',\r\n                            debit: commonType === 'Dr' ? totalGst / 2 : 0,\r\n                            credit: commonType === 'Cr' ? totalGst / 2 : 0\r\n                        }, {\r\n                            id: Date.now() + 12,\r\n                            type: commonType,\r\n                            account: 'State GST (SGST)',\r\n                            debit: commonType === 'Dr' ? totalGst / 2 : 0,\r\n                            credit: commonType === 'Cr' ? totalGst / 2 : 0\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // Find the \"other\" row (typically Party, Cash, or Bank) to balance the voucher\r\n                const mainRowIndex = finalRows.findIndex(r =>\r\n                    r.id !== activeRowId &&\r\n                    !taxLedgerNames.includes(r.account) &&\r\n                    r.account !== ''\r\n                );\r\n\r\n                if (mainRowIndex !== -1) {\r\n                    const totalVoucherAmount = totalAllocAmount + totalGst;\r\n                    const otherRow = finalRows[mainRowIndex];\r\n                    finalRows[mainRowIndex] = {\r\n                        ...otherRow,\r\n                        debit: otherRow.type === 'Dr' ? totalVoucherAmount : 0,\r\n                        credit: otherRow.type === 'Cr' ? totalVoucherAmount : 0\r\n                    };\r\n                }\r\n\r\n                setRows(finalRows);\r\n            }\r\n\r\n            setShowInventoryModal(false);\r\n            setActiveRowId(null);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        if (!provider || !activeCompany) return;\r\n        if (Math.abs(totalDebit - totalCredit) > 0.01) {\r\n            alert(\"Debit and Credit totals must match!\");\r\n            return;\r\n        }\r\n\r\n        setSubmitting(true);\r\n        try {\r\n            // Simulate a small delay for better UX\r\n            await new Promise(resolve => setTimeout(resolve, 600));\r\n\r\n            const voucher: Voucher = {\r\n                id: id || Date.now().toString(),\r\n                voucherNo,\r\n                date,\r\n                type: voucherType,\r\n                narration,\r\n                rows,\r\n                currency,\r\n                exchangeRate\r\n            };\r\n\r\n            if (id) {\r\n                await VoucherService.updateVoucher(provider, voucher, activeCompany.path);\r\n            } else {\r\n                await VoucherService.saveVoucher(provider, voucher, activeCompany.path);\r\n            }\r\n\r\n            navigate('/reports/daybook');\r\n        } catch (error) {\r\n            console.error(\"Save failed\", error);\r\n            alert(\"Failed to save voucher.\");\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className=\"max-w-7xl mx-auto space-y-6 pb-20\"\r\n            >\r\n                {/* Header Section */}\r\n                {/* ... (rest of the file remains, I need to match the StartLine) */}\r\n                {/* Actually, replacing the whole block is risky if I don't paste everything. */}\r\n                {/* I will use multi_replace to target top and bottom separately. */}\r\n                {/* Header Section */}\r\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-8 mb-12\">\r\n                    <div className=\"flex items-center gap-6\">\r\n                        <div className=\"p-4 bg-primary/10 rounded-3xl border border-primary/20 shadow-lg relative overflow-hidden group\">\r\n                            <div className=\"absolute inset-0 bg-primary/5 group-hover:bg-primary/10 transition-colors\" />\r\n                            <Box className=\"w-8 h-8 text-primary relative z-10\" />\r\n                        </div>\r\n                        <div>\r\n                            <h1 className=\"text-5xl font-black text-foreground tracking-tighter uppercase leading-none mb-2\">Universal Entry</h1>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <div className=\"w-2 h-2 rounded-full bg-google-blue animate-pulse\" />\r\n                                <p className=\"text-muted-foreground text-[10px] font-black uppercase tracking-[0.4em] opacity-70\">\r\n                                    {activeCompany?.name} <span className=\"text-primary font-black\">//</span> {voucherType}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <motion.button\r\n                            whileHover={{ scale: 1.05 }}\r\n                            whileTap={{ scale: 0.95 }}\r\n                            onClick={() => navigate('/security/audit')}\r\n                            className=\"p-4 bg-card/40 backdrop-blur-xl border border-white/10 rounded-2xl text-muted-foreground hover:text-primary transition-all shadow-xl hover:shadow-primary/5\"\r\n                            title=\"Audit Log\"\r\n                        >\r\n                            <Shield className=\"w-6 h-6\" />\r\n                        </motion.button>\r\n\r\n                        <motion.button\r\n                            whileHover={{ scale: 1.05 }}\r\n                            whileTap={{ scale: 0.95 }}\r\n                            onClick={runSmartCheck}\r\n                            disabled={smartCheckLoading}\r\n                            className={clsx(\r\n                                \"flex items-center gap-3 px-8 py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all shadow-2xl relative overflow-hidden group\",\r\n                                smartCheckLoading ? \"bg-muted text-muted-foreground animate-pulse\" : \"bg-google-blue text-white hover:shadow-google-blue/40\"\r\n                            )}\r\n                        >\r\n                            <div className=\"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n                            {smartCheckLoading ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <Sparkles className=\"w-5 h-5\" />}\r\n                            <span className=\"relative z-10\">AI Smart Check</span>\r\n                        </motion.button>\r\n\r\n                        <div className=\"glass-panel p-1.5 rounded-2xl flex items-center gap-1.5 ml-4 bg-card/60 backdrop-blur-2xl border-white/5 shadow-2xl\">\r\n                            {['Payment', 'Receipt', 'Journal', 'Contra', 'Sales', 'Purchase'].map(type => (\r\n                                <button\r\n                                    key={type}\r\n                                    onClick={() => setVoucherType(type as VoucherType)}\r\n                                    className={clsx(\r\n                                        \"px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all duration-500\",\r\n                                        voucherType === type\r\n                                            ? \"bg-primary text-primary-foreground shadow-2xl ring-1 ring-white/20\"\r\n                                            : \"text-muted-foreground hover:bg-white/5 hover:text-foreground\"\r\n                                    )}\r\n                                >\r\n                                    {type}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-card/40 backdrop-blur-2xl rounded-[3rem] shadow-[0_32px_128px_-32px_rgba(0,0,0,0.5)] border border-white/10 overflow-hidden relative\">\r\n                    <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-google-blue/5 opacity-50 pointer-events-none\" />\r\n                    {/* Meta Data Bar */}\r\n                    <div className=\"px-12 py-10 border-b border-white/10 relative z-10\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-10 items-end\">\r\n                            <div className=\"space-y-4\">\r\n                                <label className=\"text-[10px] font-black text-primary uppercase tracking-[0.3em] ml-1 opacity-60\">Vch Reference</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={voucherNo}\r\n                                    onChange={(e) => setVoucherNo(e.target.value)}\r\n                                    className=\"w-full px-6 py-4 bg-black/20 border border-white/5 rounded-2xl text-sm font-black tracking-tight focus:ring-4 focus:ring-primary/20 focus:border-primary/50 outline-none transition-all shadow-inner\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-4\">\r\n                                <DatePicker\r\n                                    label=\"Effective Date\"\r\n                                    value={date}\r\n                                    onChange={setDate}\r\n                                    className=\"!bg-black/20 !border-white/5 !rounded-2xl\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-4\">\r\n                                <label className=\"text-[10px] font-black text-primary uppercase tracking-[0.3em] ml-1 opacity-60\">External Proof</label>\r\n                                <div className=\"relative group/ext\">\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        className=\"w-full pl-14 pr-6 py-4 bg-black/20 border border-white/5 rounded-2xl text-sm font-bold focus:ring-4 focus:ring-primary/20 focus:border-primary/50 outline-none transition-all shadow-inner\"\r\n                                        placeholder=\"Order/Invoice Ref...\"\r\n                                    />\r\n                                    <Tag className=\"w-5 h-5 text-primary/40 absolute left-6 top-1/2 -translate-y-1/2 group-focus-within/ext:text-primary transition-colors\" />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-4\">\r\n                                    <label className=\"text-[10px] font-black text-primary uppercase tracking-[0.3em] ml-1 opacity-60\">Currency</label>\r\n                                    <Select\r\n                                        value={currency}\r\n                                        onChange={setCurrency}\r\n                                        options={CURRENCIES.map(c => ({\r\n                                            value: c.code,\r\n                                            label: c.code,\r\n                                            icon: Coins,\r\n                                            description: c.label\r\n                                        }))}\r\n                                        className=\"w-full !rounded-2xl shadow-inner border-white/5\"\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-4\">\r\n                                    <label className=\"text-[10px] font-black text-primary uppercase tracking-[0.3em] ml-1 opacity-60\">Ex. Node Rate</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        step=\"0.0001\"\r\n                                        value={exchangeRate}\r\n                                        onChange={(e) => setExchangeRate(parseFloat(e.target.value) || 1)}\r\n                                        className=\"w-full px-6 py-4 bg-black/20 border border-white/5 rounded-2xl text-sm font-mono tracking-widest focus:ring-4 focus:ring-primary/20 focus:border-primary/50 outline-none transition-all shadow-inner\"\r\n                                        placeholder=\"1.0000\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Entry Grid */}\r\n                    <div className=\"p-0 overflow-x-auto min-h-[400px]\">\r\n                        <table ref={tableRef} className=\"w-full border-collapse\">\r\n                            <thead>\r\n                                <tr className=\"text-left text-[10px] font-bold text-muted-foreground uppercase tracking-wider bg-muted/50 border-b border-border\">\r\n                                    <th className=\"py-1 px-2 w-20\">Type</th>\r\n                                    <th className=\"py-1 px-2\">Particulars</th>\r\n                                    <th className=\"py-1 px-2 w-32 text-right\">Debit</th>\r\n                                    <th className=\"py-1 px-2 w-32 text-right\">Credit</th>\r\n                                    <th className=\"py-1 px-1 w-8\"></th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-border/50\">\r\n                                {rows.map((row) => (\r\n                                    <tr key={row.id} className=\"group hover:bg-muted/10 transition-colors relative\">\r\n                                        <td className=\"py-0.5 px-2 align-top\">\r\n                                            <Select\r\n                                                value={row.type}\r\n                                                onChange={(val) => updateRow(row.id, 'type', val)}\r\n                                                options={[\r\n                                                    { value: 'Dr', label: 'Dr', description: 'Debit' },\r\n                                                    { value: 'Cr', label: 'Cr', description: 'Credit' },\r\n                                                ]}\r\n                                                className=\"w-20\"\r\n                                            />\r\n                                        </td>\r\n                                        <td className=\"py-0.5 px-2 relative align-top\">\r\n                                            <div className=\"flex flex-col gap-1\">\r\n                                                <div className=\"relative group/input\">\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        value={row.account}\r\n                                                        onChange={(e) => {\r\n                                                            updateRow(row.id, 'account', e.target.value);\r\n                                                            setActiveRowId(row.id); // Open dropdown on type\r\n                                                        }}\r\n                                                        onFocus={() => setActiveRowId(row.id)}\r\n                                                        onBlur={() => setTimeout(() => {\r\n                                                            if (activeRowId === row.id) setActiveRowId(null)\r\n                                                        }, 200)}\r\n                                                        onKeyDown={(e) => {\r\n                                                            if (e.key === 'ArrowDown') {\r\n                                                                // Logic to navigate custom dropdown could go here\r\n                                                            }\r\n                                                            handleKeyDown(e);\r\n                                                        }}\r\n                                                        className=\"w-full outline-none border-b border-transparent focus:border-primary font-semibold text-sm bg-transparent py-1 pr-8\"\r\n                                                        placeholder=\"Select Ledger...\"\r\n                                                    />\r\n                                                    {/* Custom Dropdown for Balance Display */}\r\n                                                    {activeRowId === row.id && (\r\n                                                        <div className=\"absolute z-50 left-0 top-full mt-1 w-full min-w-[300px] max-h-60 overflow-y-auto bg-card border border-border rounded-lg shadow-xl py-1\">\r\n                                                            <div\r\n                                                                className=\"px-3 py-2 hover:bg-google-green/10 cursor-pointer flex items-center gap-2 text-google-green font-bold border-b border-border/50\"\r\n                                                                onMouseDown={() => {\r\n                                                                    setQuickCreateInitial(row.account || '');\r\n                                                                    setShowQuickLedger(true);\r\n                                                                    setActiveRowId(null);\r\n                                                                }}\r\n                                                            >\r\n                                                                <Plus className=\"w-3 h-3\" /> Create New Ledger (Alt+C)\r\n                                                            </div>\r\n                                                            {ledgers\r\n                                                                .filter(l => {\r\n                                                                    const search = row.account.toLowerCase();\r\n                                                                    if (!l.name.toLowerCase().includes(search)) return false;\r\n\r\n                                                                    // Only maintain Contra restrictions (strictly Bank/Cash)\r\n                                                                    if (voucherType === 'Contra') {\r\n                                                                        return l.group === 'Bank Accounts' || l.group === 'Cash-in-hand';\r\n                                                                    }\r\n\r\n                                                                    // Remove restrictive filters for Payment, Sales, Purchase\r\n                                                                    // to allow for all accounting scenarios (Tax, expenses, etc.)\r\n                                                                    return true;\r\n                                                                })\r\n                                                                .map(l => (\r\n                                                                    <div\r\n                                                                        key={l.id}\r\n                                                                        onMouseDown={() => {\r\n                                                                            updateRow(row.id, 'account', l.name);\r\n                                                                            setActiveRowId(null);\r\n                                                                        }}\r\n                                                                        className=\"px-3 py-2 hover:bg-primary/10 cursor-pointer flex justify-between items-center text-xs group/item\"\r\n                                                                    >\r\n                                                                        <span className=\"font-semibold text-foreground\">{l.name}</span>\r\n                                                                        <div className=\"flex flex-col items-end\">\r\n                                                                            <span className=\"text-[10px] text-muted-foreground group-hover/item:text-foreground\">{l.group}</span>\r\n                                                                            <span className=\"font-mono text-muted-foreground font-bold\">\r\n                                                                                {l.balance.toLocaleString()} {l.type}\r\n                                                                            </span>\r\n                                                                        </div>\r\n                                                                    </div>\r\n                                                                ))\r\n                                                            }\r\n                                                            {ledgers.length === 0 && <div className=\"px-3 py-2 text-xs text-muted-foreground\">No ledgers found</div>}\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n\r\n                                                {/* Inventory Prompt */}\r\n                                                {isInventoryMode && row.account && !['Cash', 'Bank'].some(k => row.account.includes(k)) && (\r\n                                                    <button\r\n                                                        onClick={() => openInventoryAllocation(row.id)}\r\n                                                        className={clsx(\r\n                                                            \"flex items-center gap-1.5 text-[10px] font-bold uppercase tracking-wider py-0.5 px-2 rounded w-fit transition-all mb-1\",\r\n                                                            row.inventoryAllocations && row.inventoryAllocations.length > 0\r\n                                                                ? \"bg-emerald-500/10 text-emerald-600\"\r\n                                                                : \"bg-primary/5 text-primary\"\r\n                                                        )}\r\n                                                    >\r\n                                                        <Package className=\"w-3 h-3\" />\r\n                                                        {row.inventoryAllocations && row.inventoryAllocations.length > 0\r\n                                                            ? `${row.inventoryAllocations.length} Items`\r\n                                                            : \"Item Alloc\"}\r\n                                                    </button>\r\n                                                )}\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"py-0.5 px-2 align-top\">\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                value={row.debit || ''}\r\n                                                onChange={(e) => updateRow(row.id, 'debit', parseFloat(e.target.value))}\r\n                                                onKeyDown={handleKeyDown}\r\n                                                disabled={row.type === 'Cr' || (isInventoryMode && !!row.inventoryAllocations?.length)}\r\n                                                className={clsx(\r\n                                                    \"w-full text-right outline-none bg-transparent font-mono font-medium text-sm px-2 py-1 border-b border-transparent focus:border-primary transition-all\",\r\n                                                    row.type === 'Dr' ? \"text-foreground\" : \"opacity-0\"\r\n                                                )}\r\n                                                placeholder=\"\"\r\n                                            />\r\n                                        </td>\r\n                                        <td className=\"py-0.5 px-2 align-top\">\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                value={row.credit || ''}\r\n                                                onChange={(e) => updateRow(row.id, 'credit', parseFloat(e.target.value))}\r\n                                                onKeyDown={handleKeyDown}\r\n                                                disabled={row.type === 'Dr' || (isInventoryMode && !!row.inventoryAllocations?.length)}\r\n                                                className={clsx(\r\n                                                    \"w-full text-right outline-none bg-transparent font-mono font-medium text-sm px-2 py-1 border-b border-transparent focus:border-primary transition-all\",\r\n                                                    row.type === 'Cr' ? \"text-foreground\" : \"opacity-0\"\r\n                                                )}\r\n                                                placeholder=\"\"\r\n                                            />\r\n                                        </td>\r\n                                        <td className=\"py-1 px-2 align-top text-center\">\r\n                                            <button\r\n                                                onClick={() => removeRow(row.id)}\r\n                                                tabIndex={-1}\r\n                                                className=\"p-1 text-muted-foreground/20 hover:text-rose-500 hover:bg-rose-500/10 rounded transition-all\"\r\n                                            >\r\n                                                <Trash2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                            <tfoot className=\"bg-muted/20 font-bold text-sm\">\r\n                                <tr>\r\n                                    <td colSpan={5} className=\"py-2 px-4 shadow-inner\">\r\n                                        <button\r\n                                            onClick={addRow}\r\n                                            className=\"flex items-center gap-2 text-xs font-bold text-primary hover:text-primary/80 transition-colors uppercase tracking-widest bg-primary/5 hover:bg-primary/10 px-4 py-2 rounded-lg w-full justify-center\"\r\n                                        >\r\n                                            <Plus className=\"w-4 h-4\" /> Add Row\r\n                                        </button>\r\n                                    </td>\r\n                                </tr>\r\n                                <tr className=\"border-t border-border\">\r\n                                    <td colSpan={2} className=\"py-2 px-4 text-right pr-10 uppercase text-muted-foreground text-[10px] tracking-widest pt-3\">\r\n                                        Total\r\n                                    </td>\r\n                                    <td className=\"py-2 px-4 text-right font-mono text-foreground pt-3 border-t-2 border-foreground/10\">\r\n                                        {totalDebit.toLocaleString(undefined, { minimumFractionDigits: 2 })}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-4 text-right font-mono text-foreground pt-3 border-t-2 border-foreground/10\">\r\n                                        {totalCredit.toLocaleString(undefined, { minimumFractionDigits: 2 })}\r\n                                    </td>\r\n                                    <td></td>\r\n                                </tr>\r\n                            </tfoot>\r\n                        </table>\r\n                    </div>\r\n\r\n                    {/* Footer Section */}\r\n                    <div className=\"px-10 py-10 bg-muted/10 border-t border-border grid grid-cols-1 lg:grid-cols-3 gap-10\">\r\n                        <div className=\"lg:col-span-2 space-y-4\">\r\n                            <div className=\"flex items-center justify-between ml-1\">\r\n                                <label className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em] flex items-center gap-2\">\r\n                                    <FileText className=\"w-4 h-4\" /> Detailed Narration Statement\r\n                                </label>\r\n                                <button\r\n                                    onClick={toggleVoice}\r\n                                    className={clsx(\r\n                                        \"flex items-center gap-2 px-3 py-1.5 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all\",\r\n                                        isListening ? \"bg-rose-500 text-white animate-pulse\" : \"bg-muted text-muted-foreground hover:bg-muted/80\"\r\n                                    )}\r\n                                >\r\n                                    {isListening ? <MicOff className=\"w-3 h-3\" /> : <Mic className=\"w-3 h-3\" />}\r\n                                    {isListening ? \"Stop Listening\" : \"Voice Dictate\"}\r\n                                </button>\r\n                            </div>\r\n\r\n                            <AnimatePresence>\r\n                                {smartInsight && (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0, scale: 0.95 }}\r\n                                        animate={{ opacity: 1, scale: 1 }}\r\n                                        exit={{ opacity: 0, scale: 0.95 }}\r\n                                        className=\"bg-google-blue/10 border border-google-blue/20 p-5 rounded-[2rem] relative group\"\r\n                                    >\r\n                                        <button\r\n                                            onClick={() => setSmartInsight(null)}\r\n                                            className=\"absolute top-4 right-4 p-1 hover:bg-google-blue/10 rounded-full transition-colors\"\r\n                                        >\r\n                                            <Plus className=\"w-4 h-4 rotate-45 text-google-blue/50\" />\r\n                                        </button>\r\n                                        <div className=\"flex items-start gap-4\">\r\n                                            <div className=\"p-3 bg-google-blue/20 rounded-2xl text-google-blue\">\r\n                                                <Sparkles className=\"w-5 h-5\" />\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"text-[10px] font-black text-google-blue uppercase tracking-widest mb-1\">AI Smart Audit Insight</p>\r\n                                                <p className=\"text-xs font-bold leading-relaxed text-foreground/80\">\r\n                                                    {smartInsight}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n\r\n                            <textarea\r\n                                value={narration}\r\n                                onChange={(e) => setNarration(e.target.value)}\r\n                                rows={3}\r\n                                className=\"input-premium w-full resize-none min-h-[100px]\"\r\n                                placeholder=\"Type full transaction description...\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"flex flex-col justify-end gap-6\">\r\n                            {negativeAlerts.length > 0 && (\r\n                                <div className=\"space-y-2\">\r\n                                    {negativeAlerts.map((alert, i) => (\r\n                                        <motion.div\r\n                                            initial={{ x: 20, opacity: 0 }}\r\n                                            animate={{ x: 0, opacity: 1 }}\r\n                                            key={i}\r\n                                            className=\"bg-amber-500/10 border border-amber-500/20 p-3 rounded-xl flex items-center gap-3 text-amber-600\"\r\n                                        >\r\n                                            <AlertTriangle className=\"w-4 h-4\" />\r\n                                            <span className=\"text-[10px] font-black uppercase tracking-tight\">{alert}</span>\r\n                                        </motion.div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Tax Breakdown */}\r\n                            {(taxSummary.cgst > 0 || taxSummary.sgst > 0 || taxSummary.igst > 0) && (\r\n                                <div className=\"bg-primary/5 border border-primary/10 p-4 rounded-2xl space-y-2\">\r\n                                    <p className=\"text-[9px] font-black text-muted-foreground uppercase tracking-[0.2em] mb-2\">{tax.labels.total}</p>\r\n                                    {taxSummary.cgst > 0 && <div className=\"flex justify-between text-[10px] font-bold\"><span>{tax.labels.tier1 || 'Tax 1'}</span><span>{formatCurrency(taxSummary.cgst)}</span></div>}\r\n                                    {taxSummary.sgst > 0 && <div className=\"flex justify-between text-[10px] font-bold\"><span>{tax.labels.tier2 || 'Tax 2'}</span><span>{formatCurrency(taxSummary.sgst)}</span></div>}\r\n                                    {taxSummary.igst > 0 && <div className=\"flex justify-between text-[10px] font-bold\"><span>{tax.labels.tier3 || 'Tax 3'}</span><span>{formatCurrency(taxSummary.igst)}</span></div>}\r\n                                </div>\r\n                            )}\r\n\r\n                            {Math.abs(totalDebit - totalCredit) > 0.01 && (\r\n                                <div className=\"bg-rose-500/10 border border-rose-500/20 p-4 rounded-2xl flex items-center justify-between text-rose-500 animate-pulse\">\r\n                                    <span className=\"text-[10px] font-black uppercase tracking-widest\">Difference</span>\r\n                                    <span className=\"font-mono font-bold\">{formatCurrency(Math.abs(totalDebit - totalCredit))}</span>\r\n                                </div>\r\n                            )}\r\n                            <div className=\"flex gap-4\">\r\n                                <button\r\n                                    onClick={() => navigate('/dashboard')}\r\n                                    className=\"btn-premium flex-1 border border-border text-muted-foreground hover:text-foreground hover:bg-muted\"\r\n                                >\r\n                                    Discard\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleSave}\r\n                                    disabled={submitting}\r\n                                    className=\"btn-premium flex-[2] flex items-center justify-center gap-4 bg-primary text-primary-foreground\"\r\n                                >\r\n                                    {submitting ? (\r\n                                        <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                    ) : (\r\n                                        <Save className=\"w-5 h-5\" />\r\n                                    )}\r\n                                    <span>{submitting ? 'Saving...' : 'Finalize Entry'}</span>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Inventory Allocation Modal */}\r\n                <AnimatePresence>\r\n                    {showInventoryModal && (\r\n                        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-6 bg-background/80 backdrop-blur-md\">\r\n                            <motion.div\r\n                                initial={{ scale: 0.9, opacity: 0 }}\r\n                                animate={{ scale: 1, opacity: 1 }}\r\n                                exit={{ scale: 0.9, opacity: 0 }}\r\n                                className=\"bg-card w-full max-w-5xl rounded-[3rem] shadow-2xl border border-border overflow-hidden flex flex-col max-h-[90vh]\"\r\n                            >\r\n                                <div className=\"px-10 py-8 border-b border-border bg-muted/20 flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-emerald-500/20 rotate-3\">\r\n                                            <Package className=\"w-6 h-6\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h2 className=\"text-2xl font-black text-foreground uppercase tracking-tight\">Inventory Allocations</h2>\r\n                                            <p className=\"text-xs font-bold text-muted-foreground uppercase tracking-widest\">{rows.find(r => r.id === activeRowId)?.account}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <button\r\n                                            onClick={addInventoryRow}\r\n                                            className=\"flex items-center gap-2 px-6 py-3 bg-emerald-500/10 text-emerald-600 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-emerald-500/20 transition-all border border-emerald-500/20\"\r\n                                        >\r\n                                            <Plus className=\"w-4 h-4\" /> Add Item\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex-1 overflow-y-auto p-0\">\r\n                                    <table className=\"w-full border-collapse\">\r\n                                        <thead>\r\n                                            <tr className=\"text-left text-[9px] font-black text-muted-foreground uppercase tracking-[0.3em] bg-muted/10 border-b border-border\">\r\n                                                <th className=\"py-4 px-10\">Stock Item</th>\r\n                                                <th className=\"py-4 px-4 w-40\">Batch No / Expiry</th>\r\n                                                <th className=\"py-4 px-4 w-32 text-right\">Quantity</th>\r\n                                                <th className=\"py-4 px-4 w-36 text-right\">Rate / Unit</th>\r\n                                                <th className=\"py-4 px-10 w-44 text-right\">{valuationLabel} ({symbol})</th>\r\n                                                <th className=\"py-4 px-4 w-12\"></th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"divide-y divide-border/50\">\r\n                                            {tempAllocations.map((alloc) => (\r\n                                                <tr key={alloc.id} className=\"hover:bg-muted/5 transition-all\">\r\n                                                    <td className=\"py-4 px-10\">\r\n                                                        <div className=\"space-y-2\">\r\n                                                            <Select\r\n                                                                value={alloc.itemId}\r\n                                                                onChange={(val) => updateInventoryRow(alloc.id, 'itemId', val)}\r\n                                                                placeholder=\"Select Stock Item...\"\r\n                                                                options={stockItems.map(item => ({\r\n                                                                    value: item.id,\r\n                                                                    label: item.name,\r\n                                                                    description: units.find(u => u.id === item.unitId)?.name || 'Units',\r\n                                                                    icon: Package\r\n                                                                }))}\r\n                                                                className=\"w-full\"\r\n                                                            />\r\n                                                            {!alloc.itemId && stockItems.length === 0 && (\r\n                                                                <button\r\n                                                                    onClick={() => setShowQuickItem(true)}\r\n                                                                    className=\"flex items-center gap-1.5 text-[10px] font-bold uppercase tracking-wider py-1 px-2 rounded bg-emerald-500/10 text-emerald-600 hover:bg-emerald-500/20 transition-all w-full justify-center\"\r\n                                                                >\r\n                                                                    <Plus className=\"w-3 h-3\" /> Create First Item\r\n                                                                </button>\r\n                                                            )}\r\n                                                            {!alloc.itemId && stockItems.length > 0 && (\r\n                                                                <button\r\n                                                                    onClick={() => setShowQuickItem(true)}\r\n                                                                    className=\"flex items-center gap-1.5 text-[9px] font-bold uppercase tracking-wider py-0.5 px-2 rounded text-emerald-600/70 hover:text-emerald-600 hover:bg-emerald-500/5 transition-all\"\r\n                                                                >\r\n                                                                    <Plus className=\"w-3 h-3\" /> New Item\r\n                                                                </button>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    </td>\r\n                                                    <td className=\"py-4 px-4 space-y-1\">\r\n                                                        <input\r\n                                                            type=\"text\"\r\n                                                            value={alloc.batchNo || ''}\r\n                                                            onChange={(e) => updateInventoryRow(alloc.id, 'batchNo', e.target.value)}\r\n                                                            className=\"w-full bg-background border border-border rounded-lg px-2 py-1 text-[10px] uppercase font-black\"\r\n                                                            placeholder=\"BATCH #\"\r\n                                                        />\r\n                                                        <DatePicker\r\n                                                            value={alloc.expiryDate || ''}\r\n                                                            onChange={(date: string) => updateInventoryRow(alloc.id, 'expiryDate', date)}\r\n                                                            className=\"w-full\"\r\n                                                            label=\"Expiry\"\r\n                                                        />\r\n                                                    </td>\r\n                                                    <td className=\"py-4 px-4\">\r\n                                                        <input\r\n                                                            type=\"number\"\r\n                                                            value={alloc.quantity || ''}\r\n                                                            onChange={(e) => updateInventoryRow(alloc.id, 'quantity', parseFloat(e.target.value))}\r\n                                                            className=\"w-full text-right bg-transparent outline-none font-mono font-bold text-sm focus:text-emerald-500\"\r\n                                                            placeholder=\"0.00\"\r\n                                                        />\r\n                                                    </td>\r\n                                                    <td className=\"py-4 px-4\">\r\n                                                        <input\r\n                                                            type=\"number\"\r\n                                                            value={alloc.rate || ''}\r\n                                                            onChange={(e) => updateInventoryRow(alloc.id, 'rate', parseFloat(e.target.value))}\r\n                                                            className=\"w-full text-right bg-transparent outline-none font-mono font-bold text-sm focus:text-emerald-500\"\r\n                                                            placeholder=\"0.00\"\r\n                                                        />\r\n                                                    </td>\r\n                                                    <td className=\"py-4 px-10 text-right font-mono font-black text-sm text-emerald-600\">\r\n                                                        {formatCurrency(alloc.amount)}\r\n                                                    </td>\r\n                                                    <td className=\"py-4 px-4\">\r\n                                                        <button\r\n                                                            onClick={() => setTempAllocations(tempAllocations.filter(a => a.id !== alloc.id))}\r\n                                                            className=\"p-1.5 text-rose-500/20 hover:text-rose-500 hover:bg-rose-500/10 rounded-lg transition-all\"\r\n                                                        >\r\n                                                            <Trash2 className=\"w-4 h-4\" />\r\n                                                        </button>\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ))}\r\n                                            {tempAllocations.length === 0 && (\r\n                                                <tr>\r\n                                                    <td colSpan={5} className=\"py-20 text-center\">\r\n                                                        <div className=\"flex flex-col items-center gap-4 text-muted-foreground\">\r\n                                                            <Package className=\"w-12 h-12 opacity-10\" />\r\n                                                            <p className=\"text-xs font-black uppercase tracking-[0.3em]\">No items allocated yet</p>\r\n                                                            <button\r\n                                                                onClick={addInventoryRow}\r\n                                                                className=\"text-[10px] text-emerald-500 font-black uppercase tracking-widest hover:underline\"\r\n                                                            >\r\n                                                                Add first item\r\n                                                            </button>\r\n                                                        </div>\r\n                                                    </td>\r\n                                                </tr>\r\n                                            )}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n\r\n                                <div className=\"px-10 py-8 bg-muted/20 border-t border-border flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-6\">\r\n                                        <div>\r\n                                            <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-1\">Total Quantity</p>\r\n                                            <p className=\"text-xl font-black font-mono\">{tempAllocations.reduce((sum, a) => sum + (Number(a.quantity) || 0), 0)} Units</p>\r\n                                        </div>\r\n                                        <div className=\"w-px h-10 bg-border\" />\r\n                                        <div>\r\n                                            <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-widest mb-1\">{valuationLabel}</p>\r\n                                            <p className=\"text-2xl font-black font-mono text-emerald-600\">{formatCurrency(tempAllocations.reduce((sum, a) => sum + a.amount, 0))}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex gap-4\">\r\n                                        <button\r\n                                            onClick={() => setShowInventoryModal(false)}\r\n                                            className=\"px-8 py-3.5 text-[10px] font-black uppercase tracking-widest text-muted-foreground hover:text-foreground transition-all\"\r\n                                        >\r\n                                            Cancel\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={saveAllocation}\r\n                                            className=\"px-12 py-3.5 bg-emerald-500 text-white rounded-2xl font-black text-[11px] uppercase tracking-[0.2em] shadow-xl shadow-emerald-500/20 hover:shadow-emerald-500/40 transition-all active:scale-95\"\r\n                                        >\r\n                                            Confirm Allocation\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </motion.div>\r\n                        </div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </motion.div>\r\n\r\n            {\r\n                showQuickLedger && (\r\n                    <QuickLedgerForm\r\n                        onClose={() => setShowQuickLedger(false)}\r\n                        initialName={quickCreateInitial}\r\n                        onSuccess={(newName) => {\r\n                            // Refresh ledgers\r\n                            if (provider && activeCompany) {\r\n                                provider.read<Ledger[]>('ledgers.json', activeCompany.path).then(data => setLedgers(data || []));\r\n                            }\r\n                            // If opened from a row, update that row\r\n                            if (activeRowId !== null) {\r\n                                updateRow(activeRowId, 'account', newName);\r\n                            }\r\n                        }}\r\n                    />\r\n                )\r\n            }\r\n\r\n            {\r\n                showQuickItem && (\r\n                    <QuickStockItemForm\r\n                        onClose={() => setShowQuickItem(false)}\r\n                        initialName=\"\"\r\n                        onSuccess={(_itemName, itemId) => {\r\n                            // Refresh items\r\n                            if (provider && activeCompany) {\r\n                                provider.read<StockItem[]>('stock_items.json', activeCompany.path).then(data => {\r\n                                    setStockItems(data || []);\r\n                                    // Auto-select the newly created item in the last empty allocation row\r\n                                    const lastEmptyAlloc = tempAllocations.find(a => !a.itemId);\r\n                                    if (lastEmptyAlloc) {\r\n                                        updateInventoryRow(lastEmptyAlloc.id, 'itemId', itemId);\r\n                                    }\r\n                                });\r\n                            }\r\n                        }}\r\n                    />\r\n                )\r\n            }\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\ai\\GeminiAssistant.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1476,1479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1476,1479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1863,1866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1863,1866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2514,2517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2514,2517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2551,2554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2551,2554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2903,2906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2903,2906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":116,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":116,"endColumn":21}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Send, Loader2, Minimize2, Mic, MicOff } from 'lucide-react';\r\nimport clsx from 'clsx';\r\nimport GeminiLogo from '../../components/ui/GeminiLogo';\r\nimport { GeminiService } from '../../services/ai/GeminiService';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\nimport type { Ledger } from '../../services/accounting/ReportService';\r\nimport { useLocalization } from '../../hooks/useLocalization';\r\n\r\ninterface GeminiAssistantProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function GeminiAssistant({ isOpen, onClose }: GeminiAssistantProps) {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const { symbol } = useLocalization();\r\n    const [apiKey, setApiKey] = useState(localStorage.getItem('moneyarc_gemini_key') || '');\r\n    const [query, setQuery] = useState('');\r\n    const [messages, setMessages] = useState<{ role: 'user' | 'ai', text: string }[]>([\r\n        { role: 'ai', text: 'Hi! I am MoneyArc AI. Ask me anything about your finances. You can also use the microphone to speak!' }\r\n    ]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [isListening, setIsListening] = useState(false);\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n    const recognitionRef = useRef<any>(null);\r\n\r\n    useEffect(() => {\r\n        if (apiKey) localStorage.setItem('moneyarc_gemini_key', apiKey);\r\n    }, [apiKey]);\r\n\r\n    useEffect(() => {\r\n        const handleStorageChange = (e: StorageEvent) => {\r\n            if (e.key === 'moneyarc_gemini_key' && e.newValue) {\r\n                setApiKey(e.newValue);\r\n            }\r\n        };\r\n        const handleCustomEvent = (e: any) => {\r\n            if (e.detail) setApiKey(e.detail);\r\n        };\r\n        window.addEventListener('storage', handleStorageChange);\r\n        window.addEventListener('moneyarc_key_updated', handleCustomEvent);\r\n        return () => {\r\n            window.removeEventListener('storage', handleStorageChange);\r\n            window.removeEventListener('moneyarc_key_updated', handleCustomEvent);\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }, [messages, isOpen]);\r\n\r\n    // Initialize Web Speech API\r\n    useEffect(() => {\r\n        const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n        if (SpeechRecognition) {\r\n            recognitionRef.current = new SpeechRecognition();\r\n            recognitionRef.current.continuous = false;\r\n            recognitionRef.current.interimResults = false;\r\n            recognitionRef.current.lang = 'en-US';\r\n\r\n            recognitionRef.current.onresult = (event: any) => {\r\n                const transcript = event.results[0][0].transcript;\r\n                setQuery(transcript);\r\n                setIsListening(false);\r\n            };\r\n\r\n            recognitionRef.current.onerror = () => {\r\n                setIsListening(false);\r\n            };\r\n\r\n            recognitionRef.current.onend = () => {\r\n                setIsListening(false);\r\n            };\r\n        }\r\n    }, []);\r\n\r\n    const toggleListening = () => {\r\n        if (isListening) {\r\n            recognitionRef.current?.stop();\r\n        } else {\r\n            setQuery('');\r\n            recognitionRef.current?.start();\r\n            setIsListening(true);\r\n        }\r\n    };\r\n\r\n    const handleSend = async (customQuery?: string) => {\r\n        const finalQuery = customQuery || query;\r\n        if (!finalQuery.trim() || !apiKey) return;\r\n\r\n        const userMsg = finalQuery;\r\n        setMessages(prev => [...prev, { role: 'user', text: userMsg }]);\r\n        setQuery('');\r\n        setLoading(true);\r\n\r\n        try {\r\n            if (!provider || !activeCompany) throw new Error(\"Data source not ready\");\r\n\r\n            const [vouchers, ledgers] = await Promise.all([\r\n                provider.read<Voucher[]>('vouchers.json', activeCompany.path),\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path)\r\n            ]);\r\n\r\n            const service = new GeminiService(apiKey);\r\n            const response = await service.generateInsight(userMsg, {\r\n                vouchers: vouchers || [],\r\n                ledgers: ledgers || [],\r\n                companyName: activeCompany.name,\r\n                symbol: symbol\r\n            });\r\n\r\n            setMessages(prev => [...prev, { role: 'ai', text: response }]);\r\n        } catch (err) {\r\n            setMessages(prev => [...prev, { role: 'ai', text: \"Sorry, I couldn't process that. Check your API Key or connection.\" }]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 50, scale: 0.9 }}\r\n                    animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                    exit={{ opacity: 0, y: 50, scale: 0.9 }}\r\n                    className=\"fixed bottom-6 right-6 w-96 h-[550px] bg-card border border-border rounded-3xl shadow-2xl flex flex-col z-50 overflow-hidden\"\r\n                >\r\n                    {/* Header */}\r\n                    <div className=\"p-4 bg-muted/50 border-b border-border flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"p-2 bg-muted rounded-xl relative\">\r\n                                <GeminiLogo size={20} />\r\n                                {loading && (\r\n                                    <motion.div\r\n                                        animate={{ scale: [1, 1.5, 1], opacity: [0.5, 0, 0.5] }}\r\n                                        transition={{ repeat: Infinity, duration: 2 }}\r\n                                        className=\"absolute inset-0 bg-primary/20 rounded-xl\"\r\n                                    />\r\n                                )}\r\n                            </div>\r\n                            <h3 className=\"font-black text-sm uppercase tracking-wider\">MoneyArc AI</h3>\r\n                        </div>\r\n                        <button onClick={onClose} className=\"p-2 hover:bg-muted rounded-full\">\r\n                            <Minimize2 className=\"w-4 h-4 text-muted-foreground\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Content */}\r\n                    <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-background/50\">\r\n                        {!apiKey ? (\r\n                            <div className=\"text-center p-6 space-y-4\">\r\n                                <div className=\"mb-4 flex justify-center\">\r\n                                    <GeminiLogo size={48} animate={false} />\r\n                                </div>\r\n                                <h4 className=\"font-bold\">Gemini API Key Required</h4>\r\n                                <p className=\"text-xs text-muted-foreground\">To use AI features, please provide your Google Gemini API Key.</p>\r\n                                <input\r\n                                    type=\"password\"\r\n                                    placeholder=\"Paste API Key here...\"\r\n                                    className=\"w-full px-4 py-2 rounded-xl bg-muted border border-border text-xs focus:ring-2 ring-primary outline-none\"\r\n                                    value={apiKey}\r\n                                    onChange={(e) => setApiKey(e.target.value)}\r\n                                />\r\n                                <button\r\n                                    className=\"w-full py-2 bg-primary hover:bg-primary/90 text-white rounded-xl text-xs font-bold transition-colors\"\r\n                                    onClick={() => { if (apiKey) setMessages(prev => [...prev, { role: 'ai', text: \"Key saved! How can I help?\" }]) }}\r\n                                >\r\n                                    Save Key\r\n                                </button>\r\n                                <p className=\"text-[10px] text-muted-foreground\">\r\n                                    Get a free key from <a href=\"https://makersuite.google.com/app/apikey\" target=\"_blank\" rel=\"noreferrer\" className=\"underline text-primary\">Google AI Studio</a>.\r\n                                </p>\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                {messages.map((msg, i) => (\r\n                                    <div key={i} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>\r\n                                        <div className={`\r\n                                            max-w-[85%] p-3 rounded-2xl text-xs font-medium leading-relaxed\r\n                                            ${msg.role === 'user'\r\n                                                ? 'bg-primary text-primary-foreground rounded-tr-none shadow-lg'\r\n                                                : 'bg-muted text-foreground rounded-tl-none border border-border/50'}\r\n                                        `}>\r\n                                            {msg.text}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                                {loading && (\r\n                                    <div className=\"flex justify-start\">\r\n                                        <div className=\"bg-muted p-3 rounded-2xl rounded-tl-none flex items-center gap-2 border border-border/50\">\r\n                                            <Loader2 className=\"w-3 h-3 animate-spin text-primary\" />\r\n                                            <span className=\"text-xs text-muted-foreground font-bold uppercase tracking-widest text-[10px]\">Thinking...</span>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                                <div ref={messagesEndRef} />\r\n                            </>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Input Area */}\r\n                    {apiKey && (\r\n                        <div className=\"p-3 border-t border-border bg-card\">\r\n                            <div className=\"flex items-center gap-2 bg-muted/50 rounded-2xl px-3 py-2 border border-border focus-within:ring-2 ring-primary transition-all relative overflow-hidden\">\r\n                                {isListening && (\r\n                                    <motion.div\r\n                                        animate={{ x: ['-100%', '100%'] }}\r\n                                        transition={{ repeat: Infinity, duration: 2, ease: \"linear\" }}\r\n                                        className=\"absolute bottom-0 left-0 h-[2px] w-full bg-gradient-to-r from-transparent via-primary to-transparent\"\r\n                                    />\r\n                                )}\r\n                                <button\r\n                                    onClick={toggleListening}\r\n                                    className={clsx(\r\n                                        \"p-2 rounded-lg transition-colors\",\r\n                                        isListening ? \"bg-rose-500 text-white animate-pulse\" : \"text-muted-foreground hover:bg-muted\"\r\n                                    )}\r\n                                >\r\n                                    {isListening ? <MicOff className=\"w-4 h-4\" /> : <Mic className=\"w-4 h-4\" />}\r\n                                </button>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder={isListening ? \"Listening...\" : \"Ask about your finances...\"}\r\n                                    className=\"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground font-medium\"\r\n                                    value={query}\r\n                                    onChange={(e) => setQuery(e.target.value)}\r\n                                    onKeyDown={(e) => e.key === 'Enter' && handleSend()}\r\n                                />\r\n                                <button\r\n                                    onClick={() => handleSend()}\r\n                                    disabled={loading || !query.trim()}\r\n                                    className=\"p-2 bg-primary rounded-lg text-primary-foreground disabled:opacity-50 hover:bg-primary/90 transition-colors shadow-lg\"\r\n                                >\r\n                                    <Send className=\"w-4 h-4\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\auth\\AuthContext.provider.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\auth\\AuthContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\auth\\LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\auth\\SignUpPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\auth\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\dashboard\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":150,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":153,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3682,3685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3682,3685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":151,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":154,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3872,3875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3872,3875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":153,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":156,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4064,4067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4064,4067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":149,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":152,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4252,4255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4252,4255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4422,4425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4422,4425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4482,4485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4482,4485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6448,6451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6448,6451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7625,7628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7625,7628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAiHeartbeat'. Either include it or remove the dependency array.","line":169,"column":8,"nodeType":"ArrayExpression","endLine":169,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [provider, activeCompany, fetchAiHeartbeat]","fix":{"range":[11062,11087],"text":"[provider, activeCompany, fetchAiHeartbeat]"}}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TrendingUp, TrendingDown, Activity, Wallet, Shield, Target, ArrowRight, Clock, Loader2, Globe, Sparkles } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\nimport { AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer } from 'recharts';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\nimport { ACCT_GROUPS, type Ledger } from '../../services/accounting/ReportService';\r\nimport { GeminiService } from '../../services/ai/GeminiService';\r\nimport { useAuth } from '../auth/AuthContext.provider';\r\nimport { useLocalization } from '../../hooks/useLocalization';\r\nimport { AccountGroupManager } from '../../services/accounting/ReportService';\r\n\r\nconst WealthPerformanceGauge = ({ value, label, status, color }: { value: number; label: string; status: string; color: string }) => {\r\n    const strokeWidth = 12;\r\n    const radius = 60;\r\n    const circumference = 2 * Math.PI * radius;\r\n    const offset = circumference - (value / 100) * circumference;\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center justify-center text-center group\">\r\n            <div className=\"relative w-40 h-40 flex items-center justify-center mb-4 transition-transform group-hover:scale-110 duration-500\">\r\n                <svg className=\"w-full h-full -rotate-90\">\r\n                    <circle\r\n                        cx=\"80\" cy=\"80\" r={radius}\r\n                        fill=\"transparent\"\r\n                        stroke=\"currentColor\"\r\n                        strokeWidth={strokeWidth}\r\n                        className=\"text-muted/10\"\r\n                    />\r\n                    <motion.circle\r\n                        cx=\"80\" cy=\"80\" r={radius}\r\n                        fill=\"transparent\"\r\n                        stroke={color}\r\n                        strokeWidth={strokeWidth}\r\n                        strokeDasharray={circumference}\r\n                        initial={{ strokeDashoffset: circumference }}\r\n                        animate={{ strokeDashoffset: offset }}\r\n                        transition={{ duration: 1.5, ease: \"easeOut\" }}\r\n                        className=\"drop-shadow-[0_0_8px_currentColor]\"\r\n                    />\r\n                </svg>\r\n                <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n                    <span className=\"text-3xl font-black tracking-tighter tabular-nums\">{value}%</span>\r\n                    <span className=\"text-[8px] font-black uppercase tracking-widest text-muted-foreground opacity-60\">Success</span>\r\n                </div>\r\n            </div>\r\n            <h3 className=\"text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground mb-2\">{label}</h3>\r\n            <div className={`px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-widest ${status === 'Healthy' ? 'bg-google-green/10 text-google-green border border-google-green/20' : 'bg-google-red/10 text-google-red border border-google-red/20'}`}>\r\n                {status}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default function Dashboard() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const { formatCurrency } = useLocalization();\r\n    const { user } = useAuth();\r\n    const navigate = useNavigate();\r\n\r\n    // Data States\r\n    const [stats, setStats] = useState([\r\n        { label: 'Revenue', value: '0', change: '+0%', icon: TrendingUp, color: 'hsl(var(--google-blue))', bg: 'bg-google-blue/10', sparkData: [] as any[], path: '/reports/profit-loss' },\r\n        { label: 'Expenses', value: '0', change: '-0%', icon: TrendingDown, color: 'hsl(var(--google-red))', bg: 'bg-google-red/10', sparkData: [] as any[], path: '/reports/profit-loss' },\r\n        { label: 'Net Profit', value: '0', change: '+0%', icon: Activity, color: 'hsl(var(--google-green))', bg: 'bg-google-green/10', sparkData: [] as any[], path: '/reports/profit-loss' },\r\n        { label: 'Vouchers', value: '0', change: '0', icon: Wallet, color: 'hsl(var(--google-yellow))', bg: 'bg-google-yellow/10', sparkData: [] as any[], path: '/reports/daybook' },\r\n    ]);\r\n\r\n    const [recentVouchers, setRecentVouchers] = useState<Voucher[]>([]);\r\n    const [stockWatch, setStockWatch] = useState<any[]>([]);\r\n    const [chartData, setChartData] = useState<any[]>([]);\r\n    const [vitals, setVitals] = useState({ liquidRatio: 0, netMargin: 0, status: 'Healthy' });\r\n    const [aiSummary, setAiSummary] = useState<string>('');\r\n    const [aiLoading, setAiLoading] = useState(false);\r\n\r\n    interface ChartData { name: string; sales: number; purchases: number; }\r\n\r\n    const greeting = useMemo(() => {\r\n        const hour = new Date().getHours();\r\n        if (hour < 12) return 'Good Morning';\r\n        if (hour < 17) return 'Good Afternoon';\r\n        return 'Good Evening';\r\n    }, []);\r\n\r\n    const fetchAiHeartbeat = useCallback(async (rev: number, exp: number, vit: { netMargin: number }, vList: Voucher[], lList: Ledger[]) => {\r\n        const apiKey = localStorage.getItem('moneyarc_gemini_key') || '';\r\n        if (!apiKey) return;\r\n        setAiLoading(true);\r\n        try {\r\n            const service = new GeminiService(apiKey);\r\n            const prompt = `Provide a one-sentence high-end \"Executive Heartbeat\" for this dashboard. Stats: Rev ${activeCompany?.symbol}${rev}, Exp ${activeCompany?.symbol}${exp}, Margin ${vit.netMargin}%. One emoji only. Be professional.`;\r\n            const summary = await service.generateInsight(prompt, { vouchers: vList, ledgers: lList, companyName: activeCompany?.name || '', symbol: activeCompany?.symbol || '₹' });\r\n            setAiSummary(summary);\r\n        } catch (err) {\r\n            console.error(\"Heartbeat fetch failed\", err);\r\n            setAiSummary(\"AI Advisor is currently unavailable.\");\r\n        } finally { setAiLoading(false); }\r\n    }, [activeCompany?.name, activeCompany?.symbol]);\r\n\r\n    useEffect(() => {\r\n        const load = async () => {\r\n            if (!provider || !activeCompany) return;\r\n            const vouchers = await provider.read<Voucher[]>('vouchers.json', activeCompany.path) || [];\r\n            const ledgers = await provider.read<Ledger[]>('ledgers.json', activeCompany.path) || [];\r\n            const stockItems = await provider.read<any[]>('stock_items.json', activeCompany.path) || [];\r\n\r\n            setRecentVouchers([...vouchers].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()).slice(0, 4));\r\n            setStockWatch([...stockItems].sort((a, b) => ((b.currentBalance || b.openingStock) * (b.currentRate || b.openingRate)) - ((a.currentBalance || a.openingStock) * (a.currentRate || a.openingRate))).slice(0, 4));\r\n\r\n            const ledgerMap = new Map(ledgers.map(l => [l.name, l.group]));\r\n            let revenue = 0, expenses = 0;\r\n            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n            const monthlyData = months.reduce((acc, m) => ({ ...acc, [m]: { name: m, sales: 0, purchases: 0 } }), {} as Record<string, ChartData>);\r\n\r\n            const today = new Date();\r\n            const last7 = Array.from({ length: 7 }, (_, i) => {\r\n                const d = new Date(today); d.setDate(d.getDate() - (6 - i));\r\n                return d.toISOString().split('T')[0];\r\n            });\r\n            const sparkMap = last7.reduce((acc, d) => ({ ...acc, [d]: { rev: 0, exp: 0, count: 0 } }), {} as Record<string, any>);\r\n\r\n            vouchers.forEach(v => {\r\n                const vDate = v.date.split('T')[0];\r\n                const m = months[new Date(v.date).getMonth()];\r\n                if (sparkMap[vDate]) sparkMap[vDate].count++;\r\n                v.rows.forEach(r => {\r\n                    const g = ledgerMap.get(r.account);\r\n                    if (g && ACCT_GROUPS.INCOME.includes(g) && r.type === 'Cr') {\r\n                        revenue += r.credit;\r\n                        if (sparkMap[vDate]) sparkMap[vDate].rev += r.credit;\r\n                        if (g === 'Sales Accounts') monthlyData[m].sales += r.credit;\r\n                    }\r\n                    if (g && ACCT_GROUPS.EXPENSES.includes(g) && r.type === 'Dr') {\r\n                        expenses += r.debit;\r\n                        if (sparkMap[vDate]) sparkMap[vDate].exp += r.debit;\r\n                        if (g === 'Purchase Accounts') monthlyData[m].purchases += r.debit;\r\n                    }\r\n                });\r\n            });\r\n\r\n            const closingVal = stockItems.reduce((s, i) => s + ((i.currentBalance ?? i.openingStock) * (i.currentRate ?? i.openingRate)), 0);\r\n            const openingVal = stockItems.reduce((s, i) => s + (i.openingStock * i.openingRate), 0);\r\n            const profit = revenue + closingVal - (expenses + openingVal);\r\n\r\n            setStats([\r\n                { label: 'Revenue', value: revenue.toString(), change: '+12%', icon: TrendingUp, color: 'hsl(var(--google-blue))', bg: 'bg-google-blue/10', sparkData: last7.map(d => ({ v: sparkMap[d].rev })), path: '/reports/profit-loss' },\r\n                { label: 'Expenses', value: expenses.toString(), change: '-5%', icon: TrendingDown, color: 'hsl(var(--google-red))', bg: 'bg-google-red/10', sparkData: last7.map(d => ({ v: sparkMap[d].exp })), path: '/reports/profit-loss' },\r\n                { label: 'Net Profit', value: profit.toString(), change: '+8%', icon: Activity, color: 'hsl(var(--google-green))', bg: 'bg-google-green/10', sparkData: last7.map(d => ({ v: sparkMap[d].rev - sparkMap[d].exp })), path: '/reports/profit-loss' },\r\n                { label: 'Vouchers', value: vouchers.length.toString(), change: `+${vouchers.length}`, icon: Wallet, color: 'hsl(var(--google-yellow))', bg: 'bg-google-yellow/10', sparkData: last7.map(d => ({ v: sparkMap[d].count })), path: '/reports/daybook' },\r\n            ]);\r\n\r\n            const curM = new Date().getMonth();\r\n            const l6 = []; for (let i = 5; i >= 0; i--) l6.push(monthlyData[months[(curM - i + 12) % 12]]);\r\n            setChartData(l6);\r\n\r\n            const assets = AccountGroupManager.getGroups('ASSETS');\r\n            const liabs = AccountGroupManager.getGroups('LIABILITIES');\r\n\r\n            const liqA = ledgers.filter(l => assets.includes(l.group)).reduce((s, l) => s + (l.type === 'Dr' ? l.balance : -l.balance), 0);\r\n            const curL = ledgers.filter(l => liabs.includes(l.group)).reduce((s, l) => s + (l.type === 'Cr' ? l.balance : -l.balance), 0);\r\n            const ratio = curL <= 0 ? 1 : liqA / curL;\r\n            const margin = revenue === 0 ? 0 : (profit / revenue) * 100;\r\n            const vitResult = { liquidRatio: Number(ratio.toFixed(2)), netMargin: Number(margin.toFixed(1)), status: ratio >= 1.2 ? 'Healthy' : 'Warning' };\r\n            setVitals(vitResult);\r\n            fetchAiHeartbeat(revenue, expenses, vitResult, vouchers, ledgers);\r\n        };\r\n        load();\r\n    }, [provider, activeCompany]);\r\n\r\n    useEffect(() => {\r\n        const handleKeyUpdate = () => {\r\n            const revenue = stats[0].value.replace(/[^0-9.-]/g, '');\r\n            const expenses = stats[1].value.replace(/[^0-9.-]/g, '');\r\n            fetchAiHeartbeat(Number(revenue), Number(expenses), vitals, recentVouchers, []);\r\n        };\r\n        window.addEventListener('moneyarc_key_updated', handleKeyUpdate);\r\n        return () => window.removeEventListener('moneyarc_key_updated', handleKeyUpdate);\r\n    }, [stats, vitals, recentVouchers, fetchAiHeartbeat]);\r\n\r\n    const container = { hidden: { opacity: 0 }, show: { opacity: 1, transition: { staggerChildren: 0.1 } } };\r\n    const item = { hidden: { y: 20, opacity: 0 }, show: { y: 0, opacity: 1 } };\r\n\r\n    return (\r\n        <motion.div variants={container} initial=\"hidden\" animate=\"show\" className=\"space-y-8 max-w-[1600px] mx-auto px-6 lg:px-12 pb-24 pt-4\">\r\n\r\n            {/* Executive Top Row */}\r\n            <div className=\"flex flex-col lg:flex-row lg:items-center justify-between gap-6 mb-4\">\r\n                <motion.div variants={item}>\r\n                    <h1 className=\"text-4xl font-black tracking-tighter flex items-baseline gap-3\">\r\n                        {greeting}, <span className=\"text-primary\">{user?.name?.split(' ')[0] || 'Executive'}</span>\r\n                        <span className=\"hidden sm:inline-block w-2 h-2 rounded-full bg-google-green animate-pulse\" />\r\n                    </h1>\r\n                    <p className=\"text-sm text-muted-foreground font-medium mt-1 flex items-center gap-2\">\r\n                        <Globe className=\"w-3.5 h-3.5\" />\r\n                        Analyzing <span className=\"font-bold text-foreground\">{activeCompany?.name}</span> financial landscape\r\n                    </p>\r\n                </motion.div>\r\n\r\n                <motion.div variants={item} className=\"glass-panel px-6 py-4 rounded-3xl border-primary/20 flex items-center gap-4 max-w-xl shadow-lg ring-1 ring-white/5 backdrop-blur-2xl\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0\">\r\n                        <Sparkles className=\"w-5 h-5 text-primary animate-pulse\" />\r\n                    </div>\r\n                    <div className=\"min-w-0\">\r\n                        <span className=\"text-[10px] font-black uppercase tracking-widest text-primary/60 block mb-0.5\">AI Advisor Feed</span>\r\n                        <p className=\"text-xs font-bold truncate\">\r\n                            {aiLoading ? (\r\n                                <span className=\"flex items-center gap-2 text-muted-foreground italic\">\r\n                                    <Loader2 className=\"w-3 h-3 animate-spin\" /> Synthesizing financial metrics...\r\n                                </span>\r\n                            ) : aiSummary || \"Syncing with real-time voucher data for executive summary.\"}\r\n                        </p>\r\n                    </div>\r\n                </motion.div>\r\n            </div>\r\n\r\n            {/* Premium Bento Grid Layout */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-6 grid-rows-none\">\r\n\r\n                {/* AI Executive Pulse Hub */}\r\n                <motion.div variants={item} className=\"lg:col-span-8 glass-panel rounded-[2.5rem] p-8 border-primary/10 shadow-2xl relative overflow-hidden group min-h-[480px]\">\r\n                    <div className=\"absolute top-0 right-0 w-[500px] h-[500px] bg-primary/5 rounded-full blur-[120px] -mr-48 -mt-48 transition-all duration-1000 group-hover:bg-primary/10\" />\r\n                    <div className=\"absolute bottom-0 left-0 w-64 h-64 bg-accent-500/5 rounded-full blur-[80px] -ml-24 -mb-24\" />\r\n\r\n                    <div className=\"flex flex-col md:flex-row justify-between items-start relative z-10 mb-8 gap-6\">\r\n                        <div className=\"flex-1\">\r\n                            <div className=\"flex items-center gap-3 mb-2\">\r\n                                <span className=\"flex h-2 w-2 rounded-full bg-primary animate-pulse shadow-[0_0_10px_rgba(245,158,11,0.5)]\" />\r\n                                <h1 className=\"text-4xl font-black text-foreground tracking-tighter uppercase leading-none\">Growth Trajectory</h1>\r\n                            </div>\r\n                            <p className=\"text-[10px] uppercase tracking-[0.4em] font-black text-muted-foreground opacity-40 ml-5\">Fiscal Intelligence Stream</p>\r\n                        </div>\r\n\r\n                        <div className=\"flex bg-muted/20 p-1.5 rounded-2xl border border-border/50 backdrop-blur-sm self-start\">\r\n                            {['Sales', 'Purchases'].map((l, i) => (\r\n                                <div key={l} className=\"flex items-center gap-2 px-4 py-2 transition-all hover:bg-white/5 rounded-xl\">\r\n                                    <div className={`w-2 h-2 rounded-full ${i === 0 ? 'bg-google-blue' : 'bg-google-red'} shadow-[0_0_8px_currentColor]`} />\r\n                                    <span className=\"text-[10px] font-black uppercase tracking-widest opacity-80\">{l}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"h-[340px] relative z-10 -mx-4\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <AreaChart data={chartData} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>\r\n                                <defs>\r\n                                    <linearGradient id=\"gradientSales\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"hsl(var(--google-blue))\" stopOpacity={0.3} />\r\n                                        <stop offset=\"95%\" stopColor=\"hsl(var(--google-blue))\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                    <linearGradient id=\"gradientPurchases\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"hsl(var(--google-red))\" stopOpacity={0.2} />\r\n                                        <stop offset=\"95%\" stopColor=\"hsl(var(--google-red))\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                </defs>\r\n                                <XAxis dataKey=\"name\" axisLine={false} tickLine={false} tick={{ fontSize: 10, fontWeight: 900, fill: 'currentColor', opacity: 0.5 }} />\r\n                                <YAxis hide />\r\n                                <Tooltip\r\n                                    content={({ active, payload, label }) => {\r\n                                        if (active && payload && payload.length) {\r\n                                            return (\r\n                                                <div className=\"glass-panel p-4 rounded-2xl border-primary/20 shadow-2xl backdrop-blur-xl ring-1 ring-white/10\">\r\n                                                    <p className=\"text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground mb-3 border-b border-border pb-2\">{label}</p>\r\n                                                    <div className=\"space-y-2\">\r\n                                                        {payload.map((entry: { color?: string; name?: string; value: number }, index: number) => (\r\n                                                            <div key={index} className=\"flex items-center justify-between gap-10\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <div className=\"w-1.5 h-1.5 rounded-full\" style={{ backgroundColor: entry.color }} />\r\n                                                                    <span className=\"text-[10px] font-black uppercase tracking-wider\" style={{ color: entry.color }}>\r\n                                                                        {entry.name}\r\n                                                                    </span>\r\n                                                                </div>\r\n                                                                <span className=\"text-xs font-black tabular-nums\">\r\n                                                                    {formatCurrency(entry.value)}\r\n                                                                </span>\r\n                                                            </div>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                </div>\r\n                                            );\r\n                                        }\r\n                                        return null;\r\n                                    }}\r\n                                />\r\n                                <Area type=\"monotone\" dataKey=\"sales\" stroke=\"hsl(var(--google-blue))\" strokeWidth={4} fillOpacity={1} fill=\"url(#gradientSales)\" />\r\n                                <Area type=\"monotone\" dataKey=\"purchases\" stroke=\"hsl(var(--google-red))\" strokeWidth={4} fillOpacity={1} fill=\"url(#gradientPurchases)\" />\r\n                            </AreaChart>\r\n                        </ResponsiveContainer>\r\n                    </div>\r\n                </motion.div>\r\n\r\n                {/* Dynamic Performance Gauges */}\r\n                <motion.div variants={item} className=\"lg:col-span-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-6\">\r\n                    <div className=\"glass-panel rounded-[2.5rem] p-8 border-primary/10 flex items-center justify-center relative overflow-hidden group\">\r\n                        <div className=\"absolute inset-0 bg-gradient-to-br from-google-green/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n                        <WealthPerformanceGauge\r\n                            value={vitals.netMargin}\r\n                            label=\"Net Margin Score\"\r\n                            status={vitals.status}\r\n                            color=\"hsl(var(--google-green))\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"glass-panel rounded-[2.5rem] p-8 border-primary/10 flex flex-col justify-center relative overflow-hidden group\">\r\n                        <div className=\"flex items-center gap-4 mb-6 relative z-10\">\r\n                            <div className=\"w-12 h-12 rounded-2xl bg-google-blue/10 flex items-center justify-center shadow-inner\">\r\n                                <Wallet className=\"w-6 h-6 text-google-blue\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground\">Liquidity Pool</h3>\r\n                                <p className=\"text-2xl font-black tabular-nums tracking-tighter\">\r\n                                    {vitals.liquidRatio}x\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"h-2 w-full bg-muted/20 rounded-full overflow-hidden relative z-10\">\r\n                            <motion.div\r\n                                initial={{ width: 0 }}\r\n                                animate={{ width: `${Math.min(vitals.liquidRatio * 20, 100)}%` }}\r\n                                className=\"h-full bg-google-blue rounded-full shadow-[0_0_12px_rgba(66,133,244,0.5)]\"\r\n                            />\r\n                        </div>\r\n                        <p className=\"text-[9px] font-black uppercase tracking-widest text-muted-foreground mt-4 opacity-40\">Coverage Strength Indicators</p>\r\n                    </div>\r\n                </motion.div>\r\n\r\n                {/* Cash Position Hub (New Premium Feature) */}\r\n                <motion.div variants={item} className=\"lg:col-span-12 glass-panel rounded-[2.5rem] p-8 border-primary/10 flex flex-col md:flex-row items-center gap-12 relative overflow-hidden\">\r\n                    <div className=\"absolute top-0 right-0 w-full h-full bg-gradient-to-r from-primary/0 via-primary/5 to-primary/0 animate-shimmer pointer-events-none\" />\r\n\r\n                    <div className=\"flex-shrink-0\">\r\n                        <h3 className=\"text-[10px] font-black uppercase tracking-[0.3em] text-primary mb-2\">Treasury Pulse</h3>\r\n                        <div className=\"flex items-baseline gap-2\">\r\n                            <span className=\"text-5xl font-black tracking-tighter text-foreground tabular-nums\">\r\n                                {formatCurrency(Number(stats[0].value) - Number(stats[1].value))}\r\n                            </span>\r\n                            <span className=\"text-sm font-black uppercase text-muted-foreground opacity-40\">Net Position</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex-1 grid grid-cols-2 md:grid-cols-4 gap-8\">\r\n                        {stats.map((stat, i) => (\r\n                            <div key={i} className=\"group cursor-pointer\" onClick={() => navigate(stat.path)}>\r\n                                <span className=\"text-[9px] font-black uppercase tracking-widest text-muted-foreground block mb-2 opacity-50 group-hover:opacity-100 transition-opacity\">{stat.label}</span>\r\n                                <div className=\"flex items-baseline gap-2\">\r\n                                    <span className=\"text-xl font-black tracking-tight group-hover:text-primary transition-colors\">\r\n                                        {stat.label === 'Vouchers' ? stat.value : formatCurrency(Number(stat.value))}\r\n                                    </span>\r\n                                    <span className=\"text-[9px] font-black text-google-green group-hover:translate-x-1 transition-transform\">{stat.change}</span>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </motion.div>\r\n\r\n                {/* Activity Bento (Right Middle) */}\r\n                <motion.div variants={item} className=\"lg:col-span-6 glass-panel rounded-[2.5rem] p-8 border-primary/10 relative\">\r\n                    <div className=\"flex justify-between items-center mb-6\">\r\n                        <h3 className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground flex items-center gap-2\">\r\n                            <Clock className=\"w-4 h-4 text-violet-500\" />\r\n                            Live Activity Feed\r\n                        </h3>\r\n                        <motion.button whileHover={{ scale: 1.05 }} className=\"text-[9px] font-black text-primary uppercase border-b border-primary/30\">View All</motion.button>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        {recentVouchers.map((v, i) => (\r\n                            <div key={i} className=\"p-4 rounded-2xl bg-muted/10 border border-border/50 hover:bg-muted/20 transition-all cursor-pointer group\">\r\n                                <div className=\"flex justify-between items-start mb-2\">\r\n                                    <span className=\"text-[9px] font-black uppercase text-primary tracking-tighter\">{v.type} #{v.voucherNo}</span>\r\n                                    <span className=\"text-[10px] font-black\">{formatCurrency(v.rows[0]?.type === 'Dr' ? v.rows[0]?.debit : v.rows[0]?.credit)}</span>\r\n                                </div>\r\n                                <p className=\"text-[10px] font-bold text-muted-foreground truncate group-hover:text-foreground transition-colors\">{v.rows[0]?.account}</p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </motion.div>\r\n\r\n                {/* Inventory Watch (Bottom Right) */}\r\n                <motion.div variants={item} className=\"lg:col-span-3 glass-panel rounded-[2.5rem] p-8 border-primary/10 relative overflow-hidden\">\r\n                    <h3 className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground flex items-center gap-2 mb-6\">\r\n                        <Target className=\"w-4 h-4 text-google-blue\" />\r\n                        Inventory Watch\r\n                    </h3>\r\n                    <div className=\"space-y-4\">\r\n                        {stockWatch.length > 0 ? stockWatch.map((itemVal, i) => (\r\n                            <div key={i} className=\"flex justify-between items-center group/item hover:bg-white/5 p-2 rounded-xl transition-colors\">\r\n                                <span className=\"text-[10px] font-bold uppercase tracking-tight text-foreground/70 truncate max-w-[120px]\">{itemVal.name}</span>\r\n                                <span className=\"text-[10px] font-black tabular-nums text-primary\">{formatCurrency((itemVal.currentBalance || itemVal.openingStock) * (itemVal.currentRate || itemVal.openingRate))}</span>\r\n                            </div>\r\n                        )) : (\r\n                            <div className=\"flex flex-col items-center justify-center py-8 opacity-40\">\r\n                                <span className=\"text-[10px] font-black uppercase tracking-widest italic\">No active stock items</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </motion.div>\r\n\r\n                {/* Command Center (Bottom Left) */}\r\n                <motion.div variants={item} className=\"lg:col-span-3 glass-panel rounded-[2.5rem] p-8 border-primary/10 flex flex-col gap-4\">\r\n                    <h3 className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground mb-2\">Quick Actions</h3>\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        {[\r\n                            { icon: Wallet, path: '/vouchers/new', color: 'text-google-blue' },\r\n                            { icon: Shield, path: '/security', color: 'text-amber-500' },\r\n                            { icon: Target, path: '/reports/ratios', color: 'text-google-green' },\r\n                            { icon: Activity, path: '/reports/daybook', color: 'text-violet-500' }\r\n                        ].map((btn, i) => (\r\n                            <motion.button\r\n                                key={i}\r\n                                whileHover={{ scale: 1.05, y: -2 }}\r\n                                whileTap={{ scale: 0.95 }}\r\n                                onClick={() => navigate(btn.path)}\r\n                                className=\"h-16 rounded-3xl bg-muted/20 border border-border/50 flex items-center justify-center hover:bg-primary/10 transition-colors\"\r\n                            >\r\n                                <btn.icon className={`w-6 h-6 ${btn.color}`} />\r\n                            </motion.button>\r\n                        ))}\r\n                    </div>\r\n                    <button onClick={() => navigate('/data-portability')} className=\"mt-2 w-full py-3 rounded-2xl bg-primary text-primary-foreground text-[10px] font-black uppercase tracking-widest hover:shadow-lg hover:shadow-primary/20 transition-all flex items-center justify-center gap-2\">\r\n                        Export Data <ArrowRight className=\"w-3 h-3\" />\r\n                    </button>\r\n                </motion.div>\r\n\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\InventoryMaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\QuickStockGroupForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\QuickUnitForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\StockGroupForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\StockGroupList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\StockItemForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\StockItemList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\StockSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\StockVoucher.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedItemId'. Either include it or remove the dependency array.","line":58,"column":8,"nodeType":"ArrayExpression","endLine":58,"endColumn":57,"suggestions":[{"desc":"Update the dependencies array to be: [provider, activeCompany, externalSelectedItemId, selectedItemId]","fix":{"range":[2544,2593],"text":"[provider, activeCompany, externalSelectedItemId, selectedItemId]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nM:\\Projects\\MoneyArc-main\\src\\features\\inventory\\StockVoucher.tsx:62:37\n  60 |     // Sync external ID\n  61 |     useEffect(() => {\n> 62 |         if (externalSelectedItemId) setSelectedItemId(externalSelectedItemId);\n     |                                     ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  63 |     }, [externalSelectedItemId]);\n  64 |\n  65 |     // Calculate Stock Register","line":62,"column":37,"nodeType":null,"endLine":62,"endColumn":54}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport type { StockItem, UnitOfMeasure } from '../../services/inventory/types';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\nimport { Package, FileDown } from 'lucide-react';\r\nimport { ExportService } from '../../services/reports/ExportService';\r\nimport DatePicker from '../../components/ui/DatePicker';\r\nimport Select from '../../components/ui/Select';\r\n\r\ninterface StockVoucherProps {\r\n    externalSelectedItemId?: string;\r\n    onItemChange?: (itemId: string) => void;\r\n    isEmbedded?: boolean;\r\n}\r\n\r\ninterface StockTransactionRow {\r\n    date: string;\r\n    voucherNo: string;\r\n    voucherType: string;\r\n    particulars: string;\r\n    inwardQty: number;\r\n    outwardQty: number;\r\n    balance: number;\r\n    rate: number;\r\n    value: number;\r\n}\r\n\r\nexport default function StockVoucher({ externalSelectedItemId, onItemChange, isEmbedded }: StockVoucherProps) {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const [items, setItems] = useState<StockItem[]>([]);\r\n    const [units, setUnits] = useState<UnitOfMeasure[]>([]);\r\n    const [selectedItemId, setSelectedItemId] = useState<string>(externalSelectedItemId || '');\r\n    const [startDate, setStartDate] = useState<string>(new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0]);\r\n    const [endDate, setEndDate] = useState<string>(new Date().toISOString().split('T')[0]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [transactions, setTransactions] = useState<StockTransactionRow[]>([]);\r\n    const [openingQty, setOpeningQty] = useState(0);\r\n    const [totalInward, setTotalInward] = useState(0);\r\n    const [totalOutward, setTotalOutward] = useState(0);\r\n\r\n    // Initial Data Load\r\n    useEffect(() => {\r\n        const load = async () => {\r\n            if (!provider || !activeCompany) return;\r\n            const [itemData, unitData] = await Promise.all([\r\n                provider.read<StockItem[]>('stock_items.json', activeCompany.path),\r\n                provider.read<UnitOfMeasure[]>('units.json', activeCompany.path)\r\n            ]);\r\n            setItems(itemData || []);\r\n            setUnits(unitData || []);\r\n\r\n            if (!externalSelectedItemId && itemData && itemData.length > 0 && !selectedItemId) {\r\n                setSelectedItemId(itemData[0].id);\r\n            }\r\n        };\r\n        load();\r\n    }, [provider, activeCompany, externalSelectedItemId]);\r\n\r\n    // Sync external ID\r\n    useEffect(() => {\r\n        if (externalSelectedItemId) setSelectedItemId(externalSelectedItemId);\r\n    }, [externalSelectedItemId]);\r\n\r\n    // Calculate Stock Register\r\n    useEffect(() => {\r\n        const calculateRegister = async () => {\r\n            if (!provider || !activeCompany || !selectedItemId) return;\r\n            setLoading(true);\r\n\r\n            const vouchers = await provider.read<Voucher[]>('vouchers.json', activeCompany.path) || [];\r\n            const item = items.find(i => i.id === selectedItemId);\r\n            if (!item) {\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            const start = new Date(startDate).getTime();\r\n            const end = new Date(endDate).getTime();\r\n\r\n            // 1. Filter vouchers containing this item\r\n            const itemVouchers = vouchers.filter(v =>\r\n                v.rows.some(r => r.inventoryAllocations?.some(a => a.itemId === selectedItemId))\r\n            );\r\n            itemVouchers.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\r\n\r\n            // 2. Calculate Opening Balance for the period\r\n            // Start with item's Opening Stock from master\r\n            let runningQty = item.openingStock;\r\n\r\n            // Add all transactions BEFORE startDate\r\n            itemVouchers.forEach(v => {\r\n                if (new Date(v.date).getTime() < start) {\r\n                    v.rows.forEach(r => {\r\n                        r.inventoryAllocations?.forEach(a => {\r\n                            if (a.itemId === selectedItemId) {\r\n                                if (v.type === 'Purchase') runningQty += a.quantity;\r\n                                else if (v.type === 'Sales') runningQty -= a.quantity;\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n\r\n            const opQty = runningQty;\r\n            setOpeningQty(opQty);\r\n\r\n            // 3. Build rows for the period\r\n            const rows: StockTransactionRow[] = [];\r\n            let inQtyTotal = 0;\r\n            let outQtyTotal = 0;\r\n\r\n            itemVouchers.forEach(v => {\r\n                const vTime = new Date(v.date).getTime();\r\n                if (vTime >= start && vTime <= end) {\r\n                    v.rows.forEach(r => {\r\n                        r.inventoryAllocations?.forEach(a => {\r\n                            if (a.itemId === selectedItemId) {\r\n                                const inQty = v.type === 'Purchase' ? a.quantity : 0;\r\n                                const outQty = v.type === 'Sales' ? a.quantity : 0;\r\n\r\n                                runningQty += (inQty - outQty);\r\n                                inQtyTotal += inQty;\r\n                                outQtyTotal += outQty;\r\n\r\n                                // Particulars logic: find the other ledger in this voucher\r\n                                const mainRow = v.rows.find(row => row.id !== r.id && row.account !== '');\r\n                                const particulars = mainRow ? mainRow.account : 'As per Details';\r\n\r\n                                rows.push({\r\n                                    date: v.date,\r\n                                    voucherNo: v.voucherNo,\r\n                                    voucherType: v.type,\r\n                                    particulars,\r\n                                    inwardQty: inQty,\r\n                                    outwardQty: outQty,\r\n                                    balance: runningQty,\r\n                                    rate: a.rate,\r\n                                    value: a.amount\r\n                                });\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n\r\n            setTransactions(rows);\r\n            setTotalInward(inQtyTotal);\r\n            setTotalOutward(outQtyTotal);\r\n            setLoading(false);\r\n        };\r\n\r\n        const timer = setTimeout(calculateRegister, 100);\r\n        return () => clearTimeout(timer);\r\n    }, [selectedItemId, startDate, endDate, items, provider, activeCompany]);\r\n\r\n    const getUnitName = (id?: string) => units.find(u => u.id === id)?.name || 'Units';\r\n    const selectedItem = items.find(i => i.id === selectedItemId);\r\n\r\n    const handleExport = () => {\r\n        if (!selectedItem) return;\r\n        const rows = [\r\n            ['From:', startDate, 'To:', endDate],\r\n            ['Opening Balance:', openingQty.toString(), '', ''],\r\n            ['Date', 'Particulars', 'Vch Type', 'Inwards', 'Outwards', 'Balance'],\r\n            ...transactions.map(t => [\r\n                new Date(t.date).toLocaleDateString(),\r\n                t.particulars,\r\n                `${t.voucherType} #${t.voucherNo}`,\r\n                t.inwardQty > 0 ? t.inwardQty.toString() : '',\r\n                t.outwardQty > 0 ? t.outwardQty.toString() : '',\r\n                t.balance.toString()\r\n            ]),\r\n            ['Total', '', '', totalInward.toString(), totalOutward.toString(), (openingQty + totalInward - totalOutward).toString()]\r\n        ];\r\n        ExportService.exportToPDF(`Stock Register - ${selectedItem.name}`, [], rows, activeCompany);\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, scale: 0.98 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            className=\"space-y-6 max-w-7xl mx-auto pb-12\"\r\n        >\r\n            {/* Controls */}\r\n            <div className=\"flex flex-col md:flex-row md:items-end justify-between gap-6 bg-card p-6 rounded-2xl border border-border shadow-sm\">\r\n                <div className=\"space-y-4 flex-1\">\r\n                    {!isEmbedded && (\r\n                        <div>\r\n                            <h1 className=\"text-2xl font-black text-foreground tracking-tight flex items-center gap-2\">\r\n                                <Package className=\"w-6 h-6 text-primary\" />\r\n                                Stock Register\r\n                            </h1>\r\n                            <p className=\"text-muted-foreground text-sm font-medium\">Monthly item-wise movement & valuation</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                        <div className=\"space-y-1\">\r\n                            <label className=\"text-[10px] uppercase font-bold tracking-widest text-muted-foreground ml-1\">Select Item</label>\r\n                            <Select\r\n                                value={selectedItemId}\r\n                                onChange={(val) => {\r\n                                    setSelectedItemId(val);\r\n                                    if (onItemChange) onItemChange(val);\r\n                                }}\r\n                                options={items.map(i => ({\r\n                                    value: i.id,\r\n                                    label: i.name,\r\n                                    icon: Package\r\n                                }))}\r\n                                className=\"w-full\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-1\">\r\n                            <DatePicker\r\n                                label=\"Start Date\"\r\n                                value={startDate}\r\n                                onChange={setStartDate}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-1\">\r\n                            <DatePicker\r\n                                label=\"End Date\"\r\n                                value={endDate}\r\n                                onChange={setEndDate}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <button\r\n                    onClick={handleExport}\r\n                    disabled={transactions.length === 0 && openingQty === 0}\r\n                    className=\"flex items-center gap-2 px-6 py-2.5 bg-primary text-primary-foreground rounded-xl text-xs font-black uppercase tracking-widest hover:shadow-lg transition-all disabled:opacity-50\"\r\n                >\r\n                    <FileDown className=\"w-4 h-4\" />\r\n                    Export PDF\r\n                </button>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"bg-card rounded-3xl shadow-sm border border-border overflow-hidden min-h-[500px]\">\r\n                {loading ? (\r\n                    <div className=\"flex items-center justify-center h-96\">\r\n                        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n                    </div>\r\n                ) : selectedItem ? (\r\n                    <div className=\"flex flex-col\">\r\n                        {/* Summary */}\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 p-6 bg-muted/10 border-b border-border\">\r\n                            <div className=\"space-y-1 p-4 rounded-2xl bg-card border border-border shadow-sm\">\r\n                                <span className=\"text-[10px] uppercase font-black text-muted-foreground tracking-widest\">Opening Qty</span>\r\n                                <div className=\"font-mono font-bold text-lg text-foreground\">\r\n                                    {openingQty.toLocaleString()} <span className=\"text-xs text-muted-foreground\">{getUnitName(selectedItem.unitId)}</span>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-1 p-4 rounded-2xl bg-emerald-500/5 border border-emerald-500/10 shadow-sm text-emerald-600\">\r\n                                <span className=\"text-[10px] uppercase font-black opacity-70 tracking-widest\">Inwards (+)</span>\r\n                                <div className=\"font-mono font-bold text-lg\">\r\n                                    {totalInward.toLocaleString()}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-1 p-4 rounded-2xl bg-rose-500/5 border border-rose-500/10 shadow-sm text-rose-600\">\r\n                                <span className=\"text-[10px] uppercase font-black opacity-70 tracking-widest\">Outwards (-)</span>\r\n                                <div className=\"font-mono font-bold text-lg\">\r\n                                    {totalOutward.toLocaleString()}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-1 p-4 rounded-2xl bg-primary/5 border border-primary/20 shadow-sm primary-glow\">\r\n                                <span className=\"text-[10px] uppercase font-black text-primary tracking-widest\">Closing Balance</span>\r\n                                <div className=\"font-mono font-bold text-lg text-primary\">\r\n                                    {(openingQty + totalInward - totalOutward).toLocaleString()} <span className=\"text-xs text-muted-foreground\">{getUnitName(selectedItem.unitId)}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Table */}\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-sm text-left\">\r\n                                <thead className=\"bg-muted/50 border-b border-border text-[10px] font-black uppercase tracking-widest text-muted-foreground\">\r\n                                    <tr>\r\n                                        <th className=\"px-6 py-4\">Date</th>\r\n                                        <th className=\"px-6 py-4 w-1/4\">Particulars</th>\r\n                                        <th className=\"px-6 py-4\">Vch Details</th>\r\n                                        <th className=\"px-6 py-4 text-right\">Inward (Qty)</th>\r\n                                        <th className=\"px-6 py-4 text-right\">Outward (Qty)</th>\r\n                                        <th className=\"px-6 py-4 text-right\">Running (Qty)</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-border/50\">\r\n                                    {openingQty !== 0 && (\r\n                                        <tr className=\"bg-muted/10 italic text-muted-foreground\">\r\n                                            <td className=\"px-6 py-3\">{new Date(startDate).toLocaleDateString()}</td>\r\n                                            <td className=\"px-6 py-3\" colSpan={4}>Opening Balance</td>\r\n                                            <td className=\"px-6 py-3 font-mono font-bold text-right\">{openingQty.toLocaleString()}</td>\r\n                                        </tr>\r\n                                    )}\r\n\r\n                                    {transactions.map((t, idx) => (\r\n                                        <tr key={idx} className=\"group hover:bg-muted/20 transition-colors\">\r\n                                            <td className=\"px-6 py-3 font-medium whitespace-nowrap\">\r\n                                                {new Date(t.date).toLocaleDateString()}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-3 font-bold group-hover:text-primary transition-colors cursor-pointer\">\r\n                                                {t.particulars}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-3 text-xs font-bold uppercase text-muted-foreground\">\r\n                                                {t.voucherType} <span className=\"opacity-50\">#{t.voucherNo}</span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-3 font-mono text-right text-emerald-600 font-bold\">\r\n                                                {t.inwardQty > 0 ? t.inwardQty.toLocaleString() : '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-3 font-mono text-right text-rose-600 font-bold\">\r\n                                                {t.outwardQty > 0 ? t.outwardQty.toLocaleString() : '-'}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-3 font-mono text-right font-black text-foreground\">\r\n                                                {t.balance.toLocaleString()}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n\r\n                                    {transactions.length === 0 && openingQty === 0 && (\r\n                                        <tr>\r\n                                            <td colSpan={6} className=\"px-6 py-20 text-center text-muted-foreground italic\">\r\n                                                No transactions found for this item in the selected period.\r\n                                            </td>\r\n                                        </tr>\r\n                                    )}\r\n                                </tbody>\r\n                                <tfoot className=\"bg-muted/30 border-t-2 border-border font-black\">\r\n                                    <tr>\r\n                                        <td className=\"px-6 py-4\" colSpan={3}>Total Period Movement</td>\r\n                                        <td className=\"px-6 py-4 text-right text-emerald-600\">{totalInward.toLocaleString()}</td>\r\n                                        <td className=\"px-6 py-4 text-right text-rose-600\">{totalOutward.toLocaleString()}</td>\r\n                                        <td className=\"px-6 py-4\"></td>\r\n                                    </tr>\r\n                                </tfoot>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"flex items-center justify-center h-96 text-muted-foreground font-medium italic\">\r\n                        Select an item to view its movement history\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\UnitForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\inventory\\UnitList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\onboarding\\CompanySelect.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":344,"column":124,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":127,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19257,19260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19257,19260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { Building2, Plus, Search, Calendar, ChevronRight, Loader2, Trash2 } from 'lucide-react';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport type { Company } from '../../services/persistence/types';\r\nimport Select from '../../components/ui/Select';\r\nimport { CURRENCIES } from '../../data/currencies';\r\nimport { COUNTRIES, COUNTRIES_DATA } from '../../data/countries';\r\n\r\nexport default function CompanySelect() {\r\n    // Verified Dark Mode Support: 2026-02-05\r\n    const { provider, selectCompany, activeCompany } = usePersistence();\r\n    const [companies, setCompanies] = useState<Company[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [showCreateForm, setShowCreateForm] = useState(false);\r\n    const [editingCompanyId, setEditingCompanyId] = useState<string | null>(null);\r\n    const [newCompany, setNewCompany] = useState<Omit<Company, 'id' | 'path'>>({\r\n        name: '',\r\n        financialYear: '2025-26',\r\n        gstin: '',\r\n        address: '',\r\n        state: 'Maharashtra',\r\n        country: 'India',\r\n        phone: '',\r\n        email: '',\r\n        website: '',\r\n        currency: 'INR',\r\n        symbol: '₹',\r\n        registrationType: 'Regular'\r\n    });\r\n    const [error, setError] = useState<string | null>(null);\r\n    const navigate = useNavigate();\r\n\r\n    const loadCompanies = useCallback(async () => {\r\n        if (!provider) return;\r\n        setIsLoading(true);\r\n        setError(null);\r\n        try {\r\n            await new Promise<void>((resolve) => { setTimeout(() => { resolve(); }, 800); });\r\n            const list = await provider.listCompanies();\r\n            setCompanies(list);\r\n        } catch (error) {\r\n            console.error(\"Failed to load companies\", error);\r\n            setError(\"Failed to load companies. Please retry.\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [provider]);\r\n\r\n    useEffect(() => {\r\n        if (!provider) {\r\n            navigate('/select-source');\r\n            return;\r\n        }\r\n        loadCompanies();\r\n    }, [provider, loadCompanies, navigate]);\r\n\r\n    const handleSelect = async (company: Company) => {\r\n        try {\r\n            await selectCompany(company);\r\n            navigate('/dashboard');\r\n        } catch (err) {\r\n            console.error(\"Failed to select company\", err);\r\n            setError(\"Failed to select company.\");\r\n        }\r\n    };\r\n\r\n    const handleEdit = (company: Company) => {\r\n        setNewCompany({\r\n            name: company.name,\r\n            financialYear: company.financialYear,\r\n            gstin: company.gstin || '',\r\n            address: company.address || '',\r\n            state: company.state || '',\r\n            country: company.country || 'India',\r\n            phone: company.phone || '',\r\n            email: company.email || '',\r\n            website: company.website || '',\r\n            currency: company.currency || 'INR',\r\n            symbol: company.symbol || '₹',\r\n            registrationType: company.registrationType || 'Regular'\r\n        });\r\n        setEditingCompanyId(company.id);\r\n        setError(null);\r\n        setShowCreateForm(true);\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setNewCompany({\r\n            name: '',\r\n            financialYear: '2025-26',\r\n            gstin: '',\r\n            address: '',\r\n            state: 'Maharashtra',\r\n            country: 'India',\r\n            phone: '',\r\n            email: '',\r\n            website: '',\r\n            currency: 'INR',\r\n            symbol: '₹',\r\n            registrationType: 'Regular'\r\n        });\r\n        setEditingCompanyId(null);\r\n        setError(null);\r\n        setShowCreateForm(false);\r\n    };\r\n\r\n    const handleCreate = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!provider) return;\r\n        setIsLoading(true);\r\n        setError(null);\r\n        try {\r\n            if (editingCompanyId) {\r\n                const companyToEdit = companies.find(c => c.id === editingCompanyId);\r\n                if (companyToEdit) {\r\n                    const updated = await provider.updateCompany(editingCompanyId, companyToEdit.path, newCompany);\r\n                    if (activeCompany?.id === editingCompanyId) {\r\n                        await selectCompany(updated);\r\n                    }\r\n                }\r\n            } else {\r\n                await provider.createCompany(newCompany);\r\n            }\r\n            await loadCompanies();\r\n            resetForm();\r\n        } catch (error) {\r\n            console.error(\"Failed to save company\", error);\r\n            setError((error as Error).message || \"Failed to save company\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteCompany = async () => {\r\n        if (!editingCompanyId || !provider) return;\r\n\r\n        const companyToDelete = companies.find(c => c.id === editingCompanyId);\r\n        if (!companyToDelete) return;\r\n\r\n        if (!confirm(`Are you sure you want to PERMANENTLY delete \"${companyToDelete.name}\"? This action cannot be undone and all data will be lost.`)) {\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError(null);\r\n        try {\r\n            await provider.deleteCompany(editingCompanyId, companyToDelete.path);\r\n            if (activeCompany?.id === editingCompanyId) {\r\n                await selectCompany(null);\r\n            }\r\n            await loadCompanies();\r\n            resetForm();\r\n        } catch (error) {\r\n            console.error(\"Failed to delete company\", error);\r\n            setError((error as Error).message || \"Failed to delete company\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const filteredCompanies = companies.filter(c =>\r\n        c.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-background p-8 relative isolate\">\r\n\r\n            <div className=\"max-w-4xl mx-auto\">\r\n                <div className=\"flex items-center justify-between mb-8\">\r\n                    <div>\r\n                        <div className=\"flex items-center gap-3 mb-2\">\r\n                            <div className=\"w-10 h-10 rounded-xl bg-primary flex items-center justify-center text-primary-foreground\">\r\n                                <Building2 size={24} />\r\n                            </div>\r\n                            <h1 className=\"text-2xl font-bold text-foreground\">Select Company</h1>\r\n                        </div>\r\n                        <p className=\"text-muted-foreground\">Choose a company to start accounting</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => setShowCreateForm(true)}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-google-green text-primary-foreground rounded-lg hover:shadow-lg hover:shadow-google-green/20 transition-all active:scale-95 shadow-sm\"\r\n                    >\r\n                        <Plus size={20} />\r\n                        Create New\r\n                    </button>\r\n                </div>\r\n\r\n                {!showCreateForm ? (\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"relative\">\r\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\" size={20} />\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Search companies...\"\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                className=\"w-full pl-10 pr-4 py-3 bg-card border border-border rounded-xl focus:ring-2 focus:ring-primary-500 outline-none transition-all shadow-sm text-foreground\"\r\n                            />\r\n                        </div>\r\n\r\n                        {isLoading && companies.length === 0 ? (\r\n                            <div className=\"flex flex-col items-center justify-center py-20 bg-card rounded-2xl border border-border shadow-sm\">\r\n                                <Loader2 className=\"w-8 h-8 text-primary animate-spin mb-4\" />\r\n                                <p className=\"text-muted-foreground\">Loading your companies...</p>\r\n                            </div>\r\n                        ) : filteredCompanies.length === 0 ? (\r\n                            <div className=\"text-center py-20 bg-card rounded-2xl border border-border shadow-sm\">\r\n                                <div className=\"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4 text-muted-foreground\">\r\n                                    <Building2 size={32} />\r\n                                </div>\r\n                                <h3 className=\"text-lg font-medium text-foreground mb-1\">No Companies Found</h3>\r\n                                <p className=\"text-muted-foreground\">Create your first company to get started</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                {filteredCompanies.map((company) => (\r\n                                    <div\r\n                                        key={company.id}\r\n                                        className=\"group relative bg-card border border-border rounded-xl p-6 hover:border-primary-500 hover:shadow-lg transition-all cursor-pointer\"\r\n                                    >\r\n                                        <div onClick={() => handleSelect(company)}>\r\n                                            <div className=\"flex items-start justify-between mb-4\">\r\n                                                <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary group-hover:bg-primary/20 transition-colors\">\r\n                                                    <Building2 size={24} />\r\n                                                </div>\r\n                                                <ChevronRight className=\"text-muted-foreground group-hover:translate-x-1 transition-transform\" />\r\n                                            </div>\r\n                                            <h3 className=\"text-lg font-bold text-foreground mb-1\">{company.name}</h3>\r\n                                            <div className=\"flex flex-wrap items-center gap-4 text-sm text-muted-foreground pr-24\">\r\n                                                <div className=\"flex items-center gap-1\">\r\n                                                    <Calendar size={14} />\r\n                                                    {company.financialYear}\r\n                                                </div>\r\n                                                {company.gstin && (\r\n                                                    <div className=\"px-2 py-0.5 bg-muted rounded text-[10px] font-bold uppercase tracking-wider text-muted-foreground whitespace-nowrap\">\r\n                                                        GST: {company.gstin}\r\n                                                    </div>\r\n                                                )}\r\n                                                <div className=\"px-2 py-0.5 bg-accent-500/10 rounded text-[10px] font-black tracking-wider text-accent-600 dark:text-accent-400 whitespace-nowrap\">\r\n                                                    {company.currency} ({company.symbol})\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                handleEdit(company);\r\n                                            }}\r\n                                            className=\"absolute bottom-6 right-6 text-primary p-2 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-primary/10 rounded-lg text-sm font-medium\"\r\n                                        >\r\n                                            Settings\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"bg-card rounded-2xl shadow-xl border border-border overflow-hidden\">\r\n                        <div className=\"p-6 border-b border-border bg-muted/50 flex items-center justify-between\">\r\n                            <h2 className=\"text-xl font-bold text-foreground\">\r\n                                {editingCompanyId ? 'Edit Company' : 'Create New Company'}\r\n                            </h2>\r\n                            <button\r\n                                onClick={resetForm}\r\n                                className=\"text-muted-foreground hover:text-foreground transition-colors\"\r\n                            >\r\n                                <Plus size={24} className=\"rotate-45\" />\r\n                            </button>\r\n                        </div>\r\n                        <form onSubmit={handleCreate} className=\"p-8 space-y-8\">\r\n                            {error && (\r\n                                <div className=\"p-4 bg-red-500/10 border border-red-500/20 text-red-500 rounded-lg text-sm font-bold\">\r\n                                    {error}\r\n                                </div>\r\n                            )}\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                                <div className=\"space-y-6\">\r\n                                    <h3 className=\"text-xs font-black text-muted-foreground uppercase tracking-widest border-b border-border pb-2\">Basic Information</h3>\r\n                                    <div className=\"space-y-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-bold text-foreground mb-1\">Company Name *</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                required\r\n                                                value={newCompany.name}\r\n                                                onChange={(e) => setNewCompany({ ...newCompany, name: e.target.value })}\r\n                                                className=\"w-full px-4 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary-500 outline-none transition-all text-foreground\"\r\n                                                placeholder=\"e.g. Acme Industries\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"grid grid-cols-2 gap-4\">\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-bold text-foreground mb-1\">Financial Year</label>\r\n                                                <Select\r\n                                                    value={newCompany.financialYear}\r\n                                                    onChange={(val) => setNewCompany({ ...newCompany, financialYear: val })}\r\n                                                    options={[\r\n                                                        { value: '2025-26', label: '2025-26' },\r\n                                                        { value: '2024-25', label: '2024-25' },\r\n                                                    ]}\r\n                                                    className=\"w-full\"\r\n                                                />\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-bold text-foreground mb-1\">Currency</label>\r\n                                                <Select\r\n                                                    value={newCompany.currency}\r\n                                                    onChange={(val) => {\r\n                                                        const currency = CURRENCIES.find(c => c.code === val);\r\n                                                        setNewCompany({\r\n                                                            ...newCompany,\r\n                                                            currency: val,\r\n                                                            symbol: currency?.symbol || '₹'\r\n                                                        });\r\n                                                    }}\r\n                                                    options={CURRENCIES.map(c => ({ value: c.code, label: c.label }))}\r\n                                                    className=\"w-full\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-6\">\r\n                                    <h3 className=\"text-xs font-black text-muted-foreground uppercase tracking-widest border-b border-border pb-2\">Compliance & Tax</h3>\r\n                                    <div className=\"space-y-4\">\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-bold text-foreground mb-1\">GSTIN</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                value={newCompany.gstin}\r\n                                                onChange={(e) => setNewCompany({ ...newCompany, gstin: e.target.value })}\r\n                                                className=\"w-full px-4 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary-500 outline-none transition-all uppercase text-foreground\"\r\n                                                placeholder=\"27AAAAA0000A1Z5\"\r\n                                            />\r\n                                        </div>\r\n                                        <div>\r\n                                            <label className=\"block text-sm font-bold text-foreground mb-1\">Registration Type</label>\r\n                                            <Select\r\n                                                value={newCompany.registrationType || 'Regular'}\r\n                                                onChange={(val) => setNewCompany({ ...newCompany, registrationType: val as any })}\r\n                                                options={[\r\n                                                    { value: 'Regular', label: 'Regular' },\r\n                                                    { value: 'Composition', label: 'Composition' },\r\n                                                    { value: 'Unregistered', label: 'Unregistered' },\r\n                                                ]}\r\n                                                className=\"w-full\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-6\">\r\n                                <h3 className=\"text-xs font-black text-muted-foreground uppercase tracking-widest border-b border-border pb-2\">Address & Contact</h3>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                                    <div>\r\n                                        <label className=\"block text-sm font-bold text-foreground mb-1\">Full Address</label>\r\n                                        <textarea\r\n                                            rows={4}\r\n                                            value={newCompany.address}\r\n                                            onChange={(e) => setNewCompany({ ...newCompany, address: e.target.value })}\r\n                                            className=\"w-full px-4 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary-500 outline-none transition-all resize-none text-foreground\"\r\n                                            placeholder=\"Unit No. 123, Business Park...\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"space-y-4\">\r\n                                        <div className=\"grid grid-cols-2 gap-4\">\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-bold text-foreground mb-1\">State</label>\r\n                                                <Select\r\n                                                    value={newCompany.state || ''}\r\n                                                    onChange={(val) => setNewCompany({ ...newCompany, state: val })}\r\n                                                    options={[\r\n                                                        { value: '', label: 'Select State' },\r\n                                                        ...(COUNTRIES_DATA[newCompany.country] || []).map((state) => ({ value: state, label: state }))\r\n                                                    ]}\r\n                                                    className=\"w-full\"\r\n                                                />\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-bold text-foreground mb-1\">Country</label>\r\n                                                <Select\r\n                                                    value={newCompany.country}\r\n                                                    onChange={(val) => {\r\n                                                        const states = COUNTRIES_DATA[val] || [];\r\n                                                        setNewCompany({\r\n                                                            ...newCompany,\r\n                                                            country: val,\r\n                                                            state: states.length > 0 ? states[0] : ''\r\n                                                        });\r\n                                                    }}\r\n                                                    options={COUNTRIES.map(country => ({ value: country, label: country }))}\r\n                                                    className=\"w-full\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"grid grid-cols-2 gap-4\">\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-bold text-foreground mb-1\">Phone</label>\r\n                                                <input\r\n                                                    type=\"text\"\r\n                                                    value={newCompany.phone}\r\n                                                    onChange={(e) => setNewCompany({ ...newCompany, phone: e.target.value })}\r\n                                                    className=\"w-full px-4 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary-500 outline-none transition-all text-foreground\"\r\n                                                />\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-bold text-foreground mb-1\">Email</label>\r\n                                                <input\r\n                                                    type=\"email\"\r\n                                                    value={newCompany.email}\r\n                                                    onChange={(e) => setNewCompany({ ...newCompany, email: e.target.value })}\r\n                                                    className=\"w-full px-4 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary-500 outline-none transition-all text-foreground\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-between items-center pt-6 border-t border-border\">\r\n                                <div>\r\n                                    {editingCompanyId && (\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={handleDeleteCompany}\r\n                                            disabled={isLoading}\r\n                                            className=\"px-4 py-2 text-rose-500 font-bold hover:bg-rose-500/10 rounded-lg transition-colors flex items-center gap-2\"\r\n                                        >\r\n                                            <Trash2 size={16} />\r\n                                            Delete Company\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"flex gap-3\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={resetForm}\r\n                                        className=\"px-6 py-2.5 text-muted-foreground font-bold hover:bg-muted rounded-lg transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        disabled={isLoading}\r\n                                        className=\"px-8 py-2.5 bg-primary text-primary-foreground font-black uppercase tracking-widest text-xs rounded-lg hover:bg-primary/90 transition-colors shadow-lg shadow-primary-500/20 disabled:opacity-50 flex items-center gap-2\"\r\n                                    >\r\n                                        {isLoading && <Loader2 size={16} className=\"animate-spin\" />}\r\n                                        {editingCompanyId ? 'Update Company' : 'Create Company'}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\onboarding\\DataSourceSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\onboarding\\GitHubImportModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\BalanceSheet.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1832,1835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1832,1835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2331,2334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2331,2334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { ReportService, type Ledger, type GroupSummary } from '../../services/accounting/ReportService';\r\nimport { type StockItem } from '../../services/inventory/types';\r\nimport { FileDown, ChevronRight, ChevronDown } from 'lucide-react';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\nimport { useReportDates } from './DateContext';\r\nimport PeriodSelector from '../../components/ui/PeriodSelector';\r\nimport AIReportAdvisor from '../../components/ai/AIReportAdvisor';\r\nimport { useLocalization } from '../../hooks/useLocalization';\r\n\r\n\r\nexport default function BalanceSheet() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const { formatCurrency } = useLocalization();\r\n    const [liabilities, setLiabilities] = useState<GroupSummary[]>([]);\r\n    const [assets, setAssets] = useState<GroupSummary[]>([]);\r\n    const [closingStock, setClosingStock] = useState(0);\r\n    const [netProfit, setNetProfit] = useState(0);\r\n    const [tbDiff, setTbDiff] = useState(0);\r\n    const [loading, setLoading] = useState(true);\r\n    const [expandedGroups, setExpandedGroups] = useState<Set<string>>(new Set());\r\n\r\n    const { startDate, endDate } = useReportDates();\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (!provider || !activeCompany) return;\r\n            setLoading(true);\r\n\r\n            const [ledgerData, stockItemsData, customGroupsData, vouchersData] = await Promise.all([\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                provider.read<StockItem[]>('stock_items.json', activeCompany.path),\r\n                provider.read<any[]>('custom_groups.json', activeCompany.path),\r\n                provider.read<Voucher[]>('vouchers.json', activeCompany.path)\r\n            ]);\r\n\r\n            const ledgers = ledgerData || [];\r\n            const stockItems = stockItemsData || [];\r\n            const customGroups = customGroupsData || [];\r\n            const vouchers = vouchersData || [];\r\n\r\n            const { AccountGroupManager } = await import('../../services/accounting/ReportService');\r\n            customGroups.forEach((c: any) => AccountGroupManager.registerGroup(c.name, c.parentType));\r\n\r\n            const liabilityData = ReportService.getAsOnGroupSummary(ledgers as Ledger[], vouchers, endDate, 'LIABILITIES');\r\n            const assetData = ReportService.getAsOnGroupSummary(ledgers as Ledger[], vouchers, endDate, 'ASSETS')\r\n                .filter(g => g.groupName !== 'Stock-in-hand');\r\n\r\n            const np = ReportService.getNetProfitPeriod(ledgers as Ledger[], vouchers, startDate, endDate, stockItems);\r\n            const cs = ReportService.getClosingStockValue(stockItems, vouchers, endDate);\r\n            const currentTbDiff = ReportService.getTrialBalanceDiff(ledgers as Ledger[], vouchers, endDate);\r\n\r\n            setLiabilities(liabilityData);\r\n            setAssets(assetData);\r\n            setNetProfit(np);\r\n            setClosingStock(cs);\r\n            setTbDiff(currentTbDiff);\r\n\r\n            setLoading(false);\r\n        };\r\n        loadData();\r\n    }, [provider, activeCompany, startDate, endDate]);\r\n\r\n    const toggleGroup = (groupName: string) => {\r\n        const newExpanded = new Set(expandedGroups);\r\n        if (newExpanded.has(groupName)) {\r\n            newExpanded.delete(groupName);\r\n        } else {\r\n            newExpanded.add(groupName);\r\n        }\r\n        setExpandedGroups(newExpanded);\r\n    };\r\n\r\n    const totalLiabilities = ReportService.calculateTotal(liabilities) + (netProfit > 0 ? netProfit : 0) + (tbDiff > 0 ? tbDiff : 0);\r\n    const totalAssets = ReportService.calculateTotal(assets) + closingStock + (netProfit < 0 ? Math.abs(netProfit) : 0) + (tbDiff < 0 ? Math.abs(tbDiff) : 0);\r\n\r\n    if (loading) return (\r\n        <div className=\"flex items-center justify-center p-12\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"space-y-8 max-w-6xl mx-auto pb-12\"\r\n        >\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-foreground tracking-tight uppercase\">Balance Sheet</h1>\r\n                    <p className=\"text-muted-foreground font-medium\">Financial health ({startDate} to {endDate})</p>\r\n                </div>\r\n                <div className=\"flex flex-wrap items-center gap-4\">\r\n                    <PeriodSelector />\r\n                    <button\r\n                        onClick={() => window.print()}\r\n                        className=\"no-print flex items-center gap-2 px-6 py-2.5 bg-primary text-primary-foreground rounded-xl text-xs font-black uppercase tracking-widest hover:shadow-lg transition-all shadow-md shadow-primary/10\"\r\n                    >\r\n                        <FileDown className=\"w-4 h-4\" />\r\n                        Print / Save PDF\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <AIReportAdvisor\r\n                reportName=\"Balance Sheet\"\r\n                data={{\r\n                    liabilities: liabilities.map(l => ({ group: l.groupName, total: l.total })),\r\n                    assets: assets.map(a => ({ group: a.groupName, total: a.total })),\r\n                    closingStock,\r\n                    netProfit,\r\n                    trialBalanceDifference: tbDiff\r\n                }}\r\n            />\r\n\r\n            <div className=\"glass-panel rounded-[2.5rem] shadow-2xl border-white/10 overflow-hidden relative group/report\">\r\n                <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-accent-500/5 opacity-50 pointer-events-none\" />\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-border\">\r\n                    {/* Liabilities Side */}\r\n                    <div className=\"flex flex-col\">\r\n                        <div className=\"p-6 bg-muted/30 border-b border-border font-black text-primary uppercase text-[10px] tracking-[0.2em] text-center\">\r\n                            Liabilities & Equity\r\n                        </div>\r\n                        <div className=\"p-8 space-y-8 flex-1\">\r\n                            {liabilities.map(group => (\r\n                                group.total !== 0 && (\r\n                                    <div key={group.groupName} className=\"space-y-3\">\r\n                                        <div\r\n                                            onClick={() => toggleGroup(group.groupName)}\r\n                                            className=\"flex justify-between items-center group cursor-pointer hover:bg-muted/30 p-2 -mx-2 rounded-xl transition-all\"\r\n                                        >\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                {expandedGroups.has(group.groupName) ? (\r\n                                                    <ChevronDown className=\"w-4 h-4 text-primary\" />\r\n                                                ) : (\r\n                                                    <ChevronRight className=\"w-4 h-4 text-muted-foreground group-hover:text-primary transition-colors\" />\r\n                                                )}\r\n                                                <span className=\"text-sm font-black text-foreground uppercase tracking-tight\">{group.groupName}</span>\r\n                                            </div>\r\n                                            <span className={`font-mono font-black text-base ${group.total < 0 ? 'text-amber-500' : 'text-foreground'}`}>\r\n                                                {formatCurrency(Math.abs(group.total))} {group.total < 0 ? '(Dr)' : ''}\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        <AnimatePresence>\r\n                                            {expandedGroups.has(group.groupName) && (\r\n                                                <motion.div\r\n                                                    initial={{ height: 0, opacity: 0 }}\r\n                                                    animate={{ height: 'auto', opacity: 1 }}\r\n                                                    exit={{ height: 0, opacity: 0 }}\r\n                                                    className=\"overflow-hidden space-y-1 border-l-2 border-primary/20 pl-4 ml-2\"\r\n                                                >\r\n                                                    {group.ledgers.map(l => (\r\n                                                        <div key={l.id} className=\"flex justify-between items-center text-xs font-bold text-muted-foreground/80 hover:text-foreground transition-colors py-1\">\r\n                                                            <span>{l.name}</span>\r\n                                                            <span className=\"font-mono text-[10px]\">{activeCompany?.symbol || '₹'}{l.balance.toLocaleString()} {l.type}</span>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                </motion.div>\r\n                                            )}\r\n                                        </AnimatePresence>\r\n                                    </div>\r\n                                )\r\n                            ))}\r\n                            {netProfit > 0 && (\r\n                                <div className=\"p-2 -mx-2\">\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"text-sm font-black text-emerald-500 uppercase tracking-tight\">Net Profit</span>\r\n                                        <span className=\"font-mono font-black text-emerald-600 text-base\">{formatCurrency(netProfit)}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                            {tbDiff > 0 && (\r\n                                <div className=\"space-y-2 p-4 bg-amber-500/5 rounded-2xl border border-amber-500/10 mt-4\">\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"text-sm font-black text-amber-500 uppercase tracking-tight\">Opening Diff</span>\r\n                                        <span className=\"font-mono font-black text-amber-600\">{formatCurrency(tbDiff)}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"p-8 bg-muted/30 border-t border-border flex justify-between items-center\">\r\n                            <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">Capital & Liabilities</span>\r\n                            <span className=\"text-2xl font-black text-foreground font-mono\">{formatCurrency(totalLiabilities)}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Assets Side */}\r\n                    <div className=\"flex flex-col\">\r\n                        <div className=\"p-6 bg-muted/30 border-b border-border font-black text-accent-500 uppercase text-[10px] tracking-[0.2em] text-center\">\r\n                            Assets & Resources\r\n                        </div>\r\n                        <div className=\"p-8 space-y-8 flex-1\">\r\n                            {closingStock > 0 && (\r\n                                <div className=\"p-2 -mx-2\">\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"text-sm font-black text-foreground uppercase tracking-tight\">Closing Stock</span>\r\n                                        <span className=\"font-mono font-black text-foreground text-base\">{formatCurrency(closingStock)}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                            {assets.map(group => (\r\n                                group.total !== 0 && (\r\n                                    <div key={group.groupName} className=\"space-y-3\">\r\n                                        <div\r\n                                            onClick={() => toggleGroup(group.groupName)}\r\n                                            className=\"flex justify-between items-center group cursor-pointer hover:bg-muted/30 p-2 -mx-2 rounded-xl transition-all\"\r\n                                        >\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                {expandedGroups.has(group.groupName) ? (\r\n                                                    <ChevronDown className=\"w-4 h-4 text-accent-500\" />\r\n                                                ) : (\r\n                                                    <ChevronRight className=\"w-4 h-4 text-muted-foreground group-hover:text-accent-500 transition-colors\" />\r\n                                                )}\r\n                                                <span className=\"text-sm font-black text-foreground uppercase tracking-tight\">{group.groupName}</span>\r\n                                            </div>\r\n                                            <span className={`font-mono font-black text-base ${group.total < 0 ? 'text-amber-500' : 'text-foreground'}`}>\r\n                                                {formatCurrency(Math.abs(group.total))} {group.total < 0 ? '(Cr)' : ''}\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        <AnimatePresence>\r\n                                            {expandedGroups.has(group.groupName) && (\r\n                                                <motion.div\r\n                                                    initial={{ height: 0, opacity: 0 }}\r\n                                                    animate={{ height: 'auto', opacity: 1 }}\r\n                                                    exit={{ height: 0, opacity: 0 }}\r\n                                                    className=\"overflow-hidden space-y-1 border-l-2 border-accent-500/20 pl-4 ml-2\"\r\n                                                >\r\n                                                    {group.ledgers.map(l => (\r\n                                                        <div key={l.id} className=\"flex justify-between items-center text-xs font-bold text-muted-foreground/80 hover:text-foreground transition-colors py-1\">\r\n                                                            <span>{l.name}</span>\r\n                                                            <span className=\"font-mono text-[10px]\">{activeCompany?.symbol || '₹'}{l.balance.toLocaleString()} {l.type}</span>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                </motion.div>\r\n                                            )}\r\n                                        </AnimatePresence>\r\n                                    </div>\r\n                                )\r\n                            ))}\r\n                            {netProfit < 0 && (\r\n                                <div className=\"p-2 -mx-2\">\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"text-sm font-black text-rose-500 uppercase tracking-tight\">Net Loss</span>\r\n                                        <span className=\"font-mono font-black text-rose-600 text-base\">{formatCurrency(Math.abs(netProfit))}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"p-8 bg-muted/30 border-t border-border flex justify-between items-center\">\r\n                            <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">Assets & Values</span>\r\n                            <span className=\"text-2xl font-black text-foreground font-mono\">{formatCurrency(totalAssets)}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Validation Check */}\r\n            <div className={`p-8 rounded-[2rem] border-2 text-center font-black text-sm tracking-widest uppercase ${Math.abs(totalAssets - totalLiabilities) < 0.01 ? 'bg-emerald-500/5 border-emerald-500/20 text-emerald-500' : 'bg-rose-500/5 border-rose-500/20 text-rose-500'}`}>\r\n                {Math.abs(totalAssets - totalLiabilities) < 0.01\r\n                    ? '✓ Accounts are balanced'\r\n                    : `⚠ System Imbalance: ${(totalAssets - totalLiabilities).toLocaleString()}`\r\n                }\r\n            </div>\r\n        </motion.div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\CashFlow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\DateContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":49,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":49,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState } from 'react';\r\nimport { ReportService } from '../../services/accounting/ReportService';\r\n\r\ntype SelectionType = 'Period' | 'Date';\r\n\r\ninterface DateContextType {\r\n    startDate: string;\r\n    endDate: string;\r\n    selectionType: SelectionType;\r\n    setStartDate: (date: string) => void;\r\n    setEndDate: (date: string) => void;\r\n    setSelectionType: (type: SelectionType) => void;\r\n    setRange: (start: string, end: string) => void;\r\n}\r\n\r\nconst DateContext = createContext<DateContextType | undefined>(undefined);\r\n\r\nexport function DateProvider({ children }: { children: React.ReactNode }) {\r\n    const [selectionType, setSelectionType] = useState<SelectionType>('Period');\r\n    const [startDate, setStartDate] = useState(() => ReportService.getFinancialYearStart(new Date()));\r\n    const [endDate, setEndDate] = useState(() => {\r\n        const d = new Date();\r\n        const year = d.getFullYear();\r\n        const month = String(d.getMonth() + 1).padStart(2, '0');\r\n        const day = String(d.getDate()).padStart(2, '0');\r\n        return `${year}-${month}-${day}`;\r\n    });\r\n\r\n    const setRange = (start: string, end: string) => {\r\n        setStartDate(start);\r\n        setEndDate(end);\r\n    };\r\n\r\n    return (\r\n        <DateContext.Provider value={{\r\n            startDate,\r\n            endDate,\r\n            selectionType,\r\n            setStartDate,\r\n            setEndDate,\r\n            setSelectionType,\r\n            setRange\r\n        }}>\r\n            {children}\r\n        </DateContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useReportDates() {\r\n    const context = useContext(DateContext);\r\n    if (context === undefined) {\r\n        throw new Error('useReportDates must be used within a DateProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\Daybook.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\FundFlow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\GstReport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\Gstr1Report.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\Gstr3bReport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\LedgerQuickView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\LedgerReport.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedLedgerId'. Either include it or remove the dependency array.","line":43,"column":8,"nodeType":"ArrayExpression","endLine":43,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [provider, activeCompany, externalSelectedLedgerId, selectedLedgerId]","fix":{"range":[2023,2074],"text":"[provider, activeCompany, externalSelectedLedgerId, selectedLedgerId]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nM:\\Projects\\MoneyArc-main\\src\\features\\reports\\LedgerReport.tsx:48:13\n  46 |     useEffect(() => {\n  47 |         if (externalSelectedLedgerId) {\n> 48 |             setSelectedLedgerId(externalSelectedLedgerId);\n     |             ^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  49 |         }\n  50 |     }, [externalSelectedLedgerId]);\n  51 |","line":48,"column":13,"nodeType":null,"endLine":48,"endColumn":32}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { type Ledger, LedgerReportCalculator, type LedgerReportData } from '../../services/accounting/ReportService';\r\nimport { type Voucher } from '../../services/accounting/VoucherService';\r\nimport { FileDown, Wallet, ArrowRight, ShieldCheck, Activity } from 'lucide-react';\r\nimport PeriodSelector from '../../components/ui/PeriodSelector';\r\nimport Select from '../../components/ui/Select';\r\nimport { useReportDates } from './DateContext';\r\nimport clsx from 'clsx';\r\n\r\n\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useLocalization } from '../../hooks/useLocalization';\r\n\r\ninterface LedgerReportProps {\r\n    externalSelectedLedgerId?: string;\r\n    onLedgerChange?: (ledgerId: string) => void;\r\n    isEmbedded?: boolean;\r\n}\r\n\r\nexport default function LedgerReport({ externalSelectedLedgerId, onLedgerChange, isEmbedded }: LedgerReportProps) {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const { formatCurrency } = useLocalization();\r\n    const navigate = useNavigate();\r\n    const [ledgers, setLedgers] = useState<Ledger[]>([]);\r\n    const [selectedLedgerId, setSelectedLedgerId] = useState<string>(externalSelectedLedgerId || '');\r\n    const [reportData, setReportData] = useState<LedgerReportData | null>(null);\r\n    const { startDate, endDate } = useReportDates();\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Load minimal data on mount\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            if (!provider || !activeCompany) return;\r\n            const l = await provider.read<Ledger[]>('ledgers.json', activeCompany.path) || [];\r\n            setLedgers(l.sort((a, b) => a.name.localeCompare(b.name)));\r\n            if (!externalSelectedLedgerId && l.length > 0 && !selectedLedgerId) {\r\n                setSelectedLedgerId(l[0].id);\r\n            }\r\n        };\r\n        init();\r\n    }, [provider, activeCompany, externalSelectedLedgerId]);\r\n\r\n    // Sync with external selected ledger ID\r\n    useEffect(() => {\r\n        if (externalSelectedLedgerId) {\r\n            setSelectedLedgerId(externalSelectedLedgerId);\r\n        }\r\n    }, [externalSelectedLedgerId]);\r\n\r\n    // Fetch Report Data when filters change\r\n    useEffect(() => {\r\n        const fetchReport = async () => {\r\n            if (!provider || !activeCompany || !selectedLedgerId) return;\r\n            setLoading(true);\r\n\r\n            const [ledgerList, voucherList] = await Promise.all([\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                provider.read<Voucher[]>('vouchers.json', activeCompany.path)\r\n            ]);\r\n\r\n            const targetLedger = ledgerList?.find(l => l.id === selectedLedgerId);\r\n            const vouchers = voucherList || [];\r\n\r\n            if (targetLedger) {\r\n                // Map Voucher to SimpleVoucher interface expected by Calculator\r\n                // Actually Calculator expects SimpleVoucher which matches Voucher structure mostly\r\n                const data = LedgerReportCalculator.getLedgerVouchers(\r\n                    targetLedger,\r\n                    vouchers as Voucher[],\r\n                    new Date(startDate),\r\n                    new Date(endDate)\r\n                );\r\n                setReportData(data);\r\n            }\r\n            setLoading(false);\r\n        };\r\n\r\n        const timer = setTimeout(fetchReport, 100); // Debounce\r\n        return () => clearTimeout(timer);\r\n    }, [provider, activeCompany, selectedLedgerId, startDate, endDate]);\r\n    if (loading) return (\r\n        <div className=\"flex flex-col items-center justify-center p-24 space-y-4\">\r\n            <div className=\"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin\" />\r\n            <p className=\"text-[10px] font-black uppercase tracking-[0.3em] text-muted-foreground animate-pulse\">Scanning Ledger Registry...</p>\r\n        </div>\r\n    );\r\n\r\n    const container = { hidden: { opacity: 0 }, show: { opacity: 1, transition: { staggerChildren: 0.05 } } };\r\n    const item = { hidden: { y: 10, opacity: 0 }, show: { y: 0, opacity: 1 } };\r\n\r\n    return (\r\n        <motion.div\r\n            variants={container}\r\n            initial=\"hidden\"\r\n            animate=\"show\"\r\n            className=\"max-w-7xl mx-auto space-y-10 px-6 lg:px-12 pb-24 pt-4\"\r\n        >\r\n            <motion.div variants={item} className=\"flex flex-col lg:flex-row lg:items-center justify-between gap-8\">\r\n                <div>\r\n                    {!isEmbedded && (\r\n                        <>\r\n                            <h1 className=\"text-5xl font-black text-foreground tracking-tighter uppercase leading-none bg-gradient-to-br from-foreground to-foreground/50 bg-clip-text text-transparent\">\r\n                                Ledger Registry\r\n                            </h1>\r\n                            <p className=\"text-muted-foreground font-black uppercase tracking-[0.3em] text-[10px] mt-4 flex items-center gap-2\">\r\n                                <span className=\"w-8 h-px bg-primary/30\" />\r\n                                Comprehensive Transaction Audit // {activeCompany?.name}\r\n                            </p>\r\n                        </>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex flex-wrap items-center gap-4 no-print mt-4 lg:mt-0\">\r\n                    <div className=\"flex flex-wrap items-center gap-4\">\r\n                        <div className=\"w-64\">\r\n                            <Select\r\n                                value={selectedLedgerId}\r\n                                onChange={(val) => {\r\n                                    setSelectedLedgerId(val);\r\n                                    if (onLedgerChange) onLedgerChange(val);\r\n                                }}\r\n                                options={ledgers.map(l => ({\r\n                                    value: l.id,\r\n                                    label: l.name,\r\n                                    description: l.group,\r\n                                    icon: Wallet\r\n                                }))}\r\n                                className=\"premium-select\"\r\n                            />\r\n                        </div>\r\n                        <PeriodSelector />\r\n                    </div>\r\n                    <button\r\n                        onClick={() => window.print()}\r\n                        disabled={!reportData}\r\n                        className=\"no-print flex items-center gap-3 px-8 py-4 bg-primary text-primary-foreground rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest hover:shadow-2xl hover:shadow-primary/30 transition-all active:scale-95 group disabled:opacity-50\"\r\n                    >\r\n                        <FileDown className=\"w-4 h-4 group-hover:animate-bounce\" />\r\n                        Download PDF\r\n                    </button>\r\n                </div>\r\n            </motion.div>\r\n\r\n            {/* Report Content */}\r\n            <div className=\"bg-card rounded-3xl shadow-sm border border-border overflow-hidden min-h-[500px]\">\r\n                {reportData ? (\r\n                    <div className=\"flex flex-col h-full\">\r\n                        {/* Summary Header */}\r\n                        <motion.div variants={item} className=\"grid grid-cols-1 md:grid-cols-4 gap-6 p-8 bg-muted/20 border-b border-border/50\">\r\n                            {[\r\n                                { label: 'Opening Balance', value: reportData.openingBalance, type: reportData.openingBalanceType, icon: Wallet, color: 'primary' },\r\n                                { label: 'Total Debits', value: reportData.totalDebit, icon: Activity, color: 'emerald' },\r\n                                { label: 'Total Credits', value: reportData.totalCredit, icon: Activity, color: 'rose' },\r\n                                { label: 'Closing Balance', value: reportData.closingBalance, type: reportData.closingBalanceType, icon: ShieldCheck, color: reportData.closingBalanceType === 'Dr' ? 'emerald' : 'rose' },\r\n                            ].map((stat, i) => (\r\n                                <div key={i} className=\"glass-panel p-6 rounded-3xl border-primary/5 shadow-xl group hover:scale-[1.02] transition-transform\">\r\n                                    <p className=\"text-[9px] font-black text-muted-foreground uppercase tracking-[0.2em] mb-2\">{stat.label}</p>\r\n                                    <div className=\"flex items-end gap-2\">\r\n                                        <p className={clsx(\r\n                                            \"text-2xl font-black tracking-tighter tabular-nums\",\r\n                                            stat.color === 'emerald' ? \"text-emerald-500\" : stat.color === 'rose' ? \"text-rose-500\" : \"text-primary\"\r\n                                        )}>\r\n                                            {activeCompany?.symbol || '₹'}{stat.value.toLocaleString()}\r\n                                        </p>\r\n                                        {stat.type && <span className=\"text-[10px] font-black text-muted-foreground uppercase mb-1\">{stat.type}</span>}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </motion.div>\r\n\r\n                        {/* Table */}\r\n                        <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-left\">\r\n                                <thead>\r\n                                    <tr className=\"bg-muted/30 border-b border-border\">\r\n                                        <th className=\"px-10 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground\">Registry Entry</th>\r\n                                        <th className=\"px-8 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground w-1/3\">Particulars / Journal Ref</th>\r\n                                        <th className=\"px-6 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground\">Type</th>\r\n                                        <th className=\"px-8 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground text-right\">Debit</th>\r\n                                        <th className=\"px-8 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground text-right bg-muted/20\">Credit</th>\r\n                                        <th className=\"px-12 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground text-right bg-primary/5\">Net Balance</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-border\">\r\n                                    {/* Opening Balance Row */}\r\n                                    {reportData.openingBalance > 0 && (\r\n                                        <tr className=\"bg-muted/10 italic text-muted-foreground\">\r\n                                            <td className=\"px-6 py-3 font-medium\">{new Date(startDate).toLocaleDateString()}</td>\r\n                                            <td className=\"px-6 py-3\" colSpan={4}>Opening Balance</td>\r\n                                            <td className=\"px-6 py-3 font-mono font-bold text-right\">\r\n                                                {reportData.openingBalance.toLocaleString()} {reportData.openingBalanceType}\r\n                                            </td>\r\n                                        </tr>\r\n                                    )}\r\n\r\n                                    {reportData.rows.length === 0 ? (\r\n                                        <tr>\r\n                                            <td colSpan={6} className=\"px-12 py-32 text-center text-muted-foreground font-black uppercase tracking-[0.2em] text-[10px] opacity-50\">\r\n                                                Zero transaction volatility detected in this period.\r\n                                            </td>\r\n                                        </tr>\r\n                                    ) : (\r\n                                        reportData.rows.map((row, idx) => (\r\n                                            <tr\r\n                                                key={idx}\r\n                                                onClick={() => navigate(`/vouchers/edit/${row.id}`)}\r\n                                                className=\"group/row hover:bg-primary/5 transition-colors cursor-pointer border-b border-border/30 last:border-0\"\r\n                                            >\r\n                                                <td className=\"px-10 py-6\">\r\n                                                    <div className=\"font-black text-sm text-foreground tracking-tighter\">{new Date(row.date).toLocaleDateString()}</div>\r\n                                                    <div className=\"text-[9px] font-black text-muted-foreground uppercase tracking-widest mt-1 opacity-40\">Entry ID: {row.id.slice(-8)}</div>\r\n                                                </td>\r\n                                                <td className=\"px-8 py-6\">\r\n                                                    <div className=\"flex items-center gap-4 group/text\">\r\n                                                        <ArrowRight className=\"w-3 h-3 text-primary/40 group-hover/row:translate-x-1 transition-transform\" />\r\n                                                        <span className=\"text-lg font-black text-foreground tracking-tighter group-hover/row:text-primary transition-colors\">\r\n                                                            {row.particulars}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-6 font-black text-[10px] uppercase tracking-[0.2em] text-muted-foreground\">\r\n                                                    {row.voucherType} <span className=\"ml-2 text-primary/50\">#{row.voucherNo}</span>\r\n                                                </td>\r\n                                                <td className=\"px-8 py-6 text-right font-black text-foreground tabular-nums tracking-tighter text-xl\">\r\n                                                    {row.debit > 0 ? formatCurrency(row.debit) : '—'}\r\n                                                </td>\r\n                                                <td className=\"px-8 py-6 text-right font-black text-muted-foreground tabular-nums tracking-tighter text-xl bg-muted/5 group-hover/row:bg-muted/10 transition-colors\">\r\n                                                    {row.credit > 0 ? formatCurrency(row.credit) : '—'}\r\n                                                </td>\r\n                                                <td className=\"px-12 py-6 text-right font-black text-foreground tabular-nums tracking-tighter text-xl bg-primary/5 group-hover/row:bg-primary/10 transition-colors\">\r\n                                                    {formatCurrency(row.balance)} <span className=\"text-[9px] text-muted-foreground ml-1 uppercase\">{row.balanceType}</span>\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))\r\n                                    )}\r\n                                    {/* Footer Total Row */}\r\n                                    <tr className=\"bg-primary/5 border-t-4 border-primary/20\">\r\n                                        <td className=\"px-10 py-12 text-[14px] font-black uppercase tracking-[0.4em] text-primary\" colSpan={3}>Consolidated Audit Ledger Total</td>\r\n                                        <td className=\"px-8 py-12 text-right font-black text-primary text-3xl tabular-nums tracking-tighter\">{formatCurrency(reportData.totalDebit)}</td>\r\n                                        <td className=\"px-8 py-12 text-right font-black text-primary text-3xl tabular-nums tracking-tighter\">{formatCurrency(reportData.totalCredit)}</td>\r\n                                        <td className=\"px-12 py-12\"></td>\r\n                                    </tr>\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"flex items-center justify-center h-96 text-muted-foreground\">\r\n                        Select a ledger to view history\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\ProfitAndLoss.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1807,1810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1807,1810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2306,2309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2306,2309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { ReportService, type Ledger, type GroupSummary } from '../../services/accounting/ReportService';\r\nimport { type StockItem } from '../../services/inventory/types';\r\nimport { TrendingUp, TrendingDown, FileDown, ChevronRight, ChevronDown } from 'lucide-react';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\nimport LedgerQuickView from './LedgerQuickView';\r\nimport { useReportDates } from './DateContext';\r\nimport PeriodSelector from '../../components/ui/PeriodSelector';\r\nimport AIReportAdvisor from '../../components/ai/AIReportAdvisor';\r\nimport { useLocalization } from '../../hooks/useLocalization';\r\n\r\n\r\nexport default function ProfitAndLoss() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const { formatCurrency } = useLocalization();\r\n    const [expenses, setExpenses] = useState<GroupSummary[]>([]);\r\n    const [incomes, setIncomes] = useState<GroupSummary[]>([]);\r\n    const [closingStock, setClosingStock] = useState(0);\r\n    const [loading, setLoading] = useState(true);\r\n    const [expandedGroups, setExpandedGroups] = useState<Set<string>>(new Set());\r\n\r\n    const { startDate, endDate } = useReportDates();\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (!provider || !activeCompany) return;\r\n            setLoading(true);\r\n\r\n            const [ledgerData, stockItemsData, customGroupsData, vouchersData] = await Promise.all([\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                provider.read<StockItem[]>('stock_items.json', activeCompany.path),\r\n                provider.read<any[]>('custom_groups.json', activeCompany.path),\r\n                provider.read<Voucher[]>('vouchers.json', activeCompany.path)\r\n            ]);\r\n\r\n            const ledgers = ledgerData || [];\r\n            const stockItems = stockItemsData || [];\r\n            const customGroups = customGroupsData || [];\r\n            const vouchers = vouchersData || [];\r\n\r\n            const { AccountGroupManager } = await import('../../services/accounting/ReportService');\r\n            customGroups.forEach((c: any) => AccountGroupManager.registerGroup(c.name, c.parentType));\r\n\r\n            const expenseData = ReportService.getPeriodGroupSummary(ledgers as Ledger[], vouchers, new Date(startDate), new Date(endDate), 'EXPENSES');\r\n            const incomeData = ReportService.getPeriodGroupSummary(ledgers as Ledger[], vouchers, new Date(startDate), new Date(endDate), 'INCOME');\r\n            const cs = ReportService.getClosingStockValue(stockItems);\r\n\r\n            setExpenses(expenseData);\r\n            setIncomes(incomeData);\r\n            setClosingStock(cs);\r\n            setLoading(false);\r\n        };\r\n        loadData();\r\n    }, [provider, activeCompany, startDate, endDate]);\r\n\r\n    const toggleGroup = (groupName: string) => {\r\n        const newExpanded = new Set(expandedGroups);\r\n        if (newExpanded.has(groupName)) {\r\n            newExpanded.delete(groupName);\r\n        } else {\r\n            newExpanded.add(groupName);\r\n        }\r\n        setExpandedGroups(newExpanded);\r\n    };\r\n\r\n    const totalExpenses = ReportService.calculateTotal(expenses);\r\n    const totalIncome = ReportService.calculateTotal(incomes) + closingStock;\r\n    const netProfit = totalIncome - totalExpenses;\r\n\r\n    if (loading) return (\r\n        <div className=\"flex items-center justify-center p-12\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\r\n        </div>\r\n    );\r\n\r\n    const maxSideTotal = Math.max(totalExpenses + (netProfit > 0 ? netProfit : 0), totalIncome + (netProfit < 0 ? Math.abs(netProfit) : 0));\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"space-y-8 max-w-6xl mx-auto pb-12\"\r\n        >\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-foreground tracking-tight uppercase\">Statement of Profit & Loss</h1>\r\n                    <p className=\"text-muted-foreground font-medium\">Performance summary: {activeCompany?.name}</p>\r\n                </div>\r\n                <div className=\"flex flex-wrap items-center gap-4\">\r\n                    <PeriodSelector />\r\n                    <button\r\n                        onClick={() => window.print()}\r\n                        className=\"no-print flex items-center gap-2 px-6 py-2.5 bg-primary text-primary-foreground rounded-xl text-xs font-black uppercase tracking-widest hover:shadow-lg transition-all shadow-md shadow-primary/10\"\r\n                    >\r\n                        <FileDown className=\"w-4 h-4\" />\r\n                        Print / Save PDF\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <AIReportAdvisor\r\n                reportName=\"Profit & Loss Statement\"\r\n                data={{\r\n                    expenses: expenses.map(e => ({ group: e.groupName, total: e.total })),\r\n                    incomes: incomes.map(i => ({ group: i.groupName, total: i.total })),\r\n                    closingStock,\r\n                    netProfit\r\n                }}\r\n            />\r\n\r\n            <div className=\"glass-panel rounded-[2.5rem] shadow-2xl border-white/10 overflow-hidden relative group/report\">\r\n                <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-accent-500/5 opacity-50 pointer-events-none\" />\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-border\">\r\n                    {/* Expenses Side */}\r\n                    <div className=\"flex flex-col\">\r\n                        <div className=\"p-6 bg-muted/30 border-b border-border font-black text-rose-500 uppercase text-[10px] tracking-[0.2em] text-center\">\r\n                            Operating Expenses\r\n                        </div>\r\n                        <div className=\"p-8 space-y-8 flex-1\">\r\n                            {expenses.map(group => (\r\n                                group.total > 0 && (\r\n                                    <div key={group.groupName} className=\"space-y-3\">\r\n                                        <div\r\n                                            onClick={() => toggleGroup(group.groupName)}\r\n                                            className=\"flex justify-between items-center group cursor-pointer hover:bg-muted/30 p-2 -mx-2 rounded-xl transition-all\"\r\n                                        >\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                {expandedGroups.has(group.groupName) ? (\r\n                                                    <ChevronDown className=\"w-4 h-4 text-rose-500\" />\r\n                                                ) : (\r\n                                                    <ChevronRight className=\"w-4 h-4 text-muted-foreground group-hover:text-rose-500 transition-colors\" />\r\n                                                )}\r\n                                                <span className=\"text-sm font-black text-foreground uppercase tracking-tight\">{group.groupName}</span>\r\n                                            </div>\r\n                                            <span className=\"font-mono font-black text-base text-foreground\">{activeCompany?.symbol || '₹'}{group.total.toLocaleString()}</span>\r\n                                        </div>\r\n\r\n                                        <AnimatePresence>\r\n                                            {expandedGroups.has(group.groupName) && (\r\n                                                <motion.div\r\n                                                    initial={{ height: 0, opacity: 0 }}\r\n                                                    animate={{ height: 'auto', opacity: 1 }}\r\n                                                    exit={{ height: 0, opacity: 0 }}\r\n                                                    className=\"overflow-hidden space-y-1 border-l-2 border-rose-500/20 pl-4 ml-2\"\r\n                                                >\r\n                                                    {group.ledgers.map(l => (\r\n                                                        <div key={l.id} className=\"flex justify-between items-center text-xs font-bold text-muted-foreground/80 hover:text-foreground transition-colors py-1\">\r\n                                                            <LedgerQuickView ledgerName={l.name}>\r\n                                                                <span className=\"hover:text-primary transition-colors cursor-help border-b border-dotted border-primary/30\">{l.name}</span>\r\n                                                            </LedgerQuickView>\r\n                                                            <span className=\"font-mono text-[10px]\">{l.balance.toLocaleString()}</span>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                </motion.div>\r\n                                            )}\r\n                                        </AnimatePresence>\r\n                                    </div>\r\n                                )\r\n                            ))}\r\n\r\n                            {netProfit > 0 && (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0, x: -10 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    className=\"flex justify-between items-center bg-emerald-500/5 p-4 rounded-2xl border border-emerald-500/10 mt-4\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center text-emerald-500\">\r\n                                            <TrendingUp className=\"w-4 h-4\" />\r\n                                        </div>\r\n                                        <span className=\"text-[10px] font-black uppercase tracking-widest text-emerald-600\">Net Profit</span>\r\n                                    </div>\r\n                                    <span className=\"font-mono font-black text-emerald-600 text-lg\">{formatCurrency(netProfit)}</span>\r\n                                </motion.div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"p-8 bg-muted/30 border-t border-border flex justify-between items-center\">\r\n                            <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">Total debits</span>\r\n                            <span className=\"text-2xl font-black text-foreground font-mono\">{activeCompany?.symbol || '₹'}{maxSideTotal.toLocaleString()}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Income Side */}\r\n                    <div className=\"flex flex-col\">\r\n                        <div className=\"p-6 bg-muted/30 border-b border-border font-black text-accent-500 uppercase text-[10px] tracking-[0.2em] text-center\">\r\n                            Revenue & Income\r\n                        </div>\r\n                        <div className=\"p-8 space-y-8 flex-1\">\r\n                            {incomes.map(group => (\r\n                                group.total > 0 && (\r\n                                    <div key={group.groupName} className=\"space-y-3\">\r\n                                        <div\r\n                                            onClick={() => toggleGroup(group.groupName)}\r\n                                            className=\"flex justify-between items-center group cursor-pointer hover:bg-muted/30 p-2 -mx-2 rounded-xl transition-all\"\r\n                                        >\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                {expandedGroups.has(group.groupName) ? (\r\n                                                    <ChevronDown className=\"w-4 h-4 text-accent-500\" />\r\n                                                ) : (\r\n                                                    <ChevronRight className=\"w-4 h-4 text-muted-foreground group-hover:text-accent-500 transition-colors\" />\r\n                                                )}\r\n                                                <span className=\"text-sm font-black text-foreground uppercase tracking-tight\">{group.groupName}</span>\r\n                                            </div>\r\n                                            <span className=\"font-mono font-black text-base text-foreground\">{activeCompany?.symbol || '₹'}{group.total.toLocaleString()}</span>\r\n                                        </div>\r\n\r\n                                        <AnimatePresence>\r\n                                            {expandedGroups.has(group.groupName) && (\r\n                                                <motion.div\r\n                                                    initial={{ height: 0, opacity: 0 }}\r\n                                                    animate={{ height: 'auto', opacity: 1 }}\r\n                                                    exit={{ height: 0, opacity: 0 }}\r\n                                                    className=\"overflow-hidden space-y-1 border-l-2 border-accent-500/20 pl-4 ml-2\"\r\n                                                >\r\n                                                    {group.ledgers.map(l => (\r\n                                                        <div key={l.id} className=\"flex justify-between items-center text-xs font-bold text-muted-foreground/80 hover:text-foreground transition-colors py-1\">\r\n                                                            <LedgerQuickView ledgerName={l.name}>\r\n                                                                <span className=\"hover:text-primary transition-colors cursor-help border-b border-dotted border-primary/30\">{l.name}</span>\r\n                                                            </LedgerQuickView>\r\n                                                            <span className=\"font-mono text-[10px]\">{l.balance.toLocaleString()}</span>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                </motion.div>\r\n                                            )}\r\n                                        </AnimatePresence>\r\n                                    </div>\r\n                                )\r\n                            ))}\r\n\r\n                            {closingStock > 0 && (\r\n                                <div className=\"p-2 -mx-2\">\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <span className=\"text-sm font-black text-foreground uppercase tracking-tight hover:text-accent-500 transition-colors\">Closing Stock</span>\r\n                                        <span className=\"font-mono font-black text-foreground text-base\">{formatCurrency(closingStock)}</span>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {netProfit < 0 && (\r\n                                <motion.div\r\n                                    initial={{ opacity: 0, x: 10 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    className=\"flex justify-between items-center bg-rose-500/5 p-4 rounded-2xl border border-rose-500/10 mt-4\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"w-8 h-8 rounded-lg bg-rose-500/20 flex items-center justify-center text-rose-500\">\r\n                                            <TrendingDown className=\"w-4 h-4\" />\r\n                                        </div>\r\n                                        <span className=\"text-[10px] font-black uppercase tracking-widest text-rose-600\">Net Loss</span>\r\n                                    </div>\r\n                                    <span className=\"font-mono font-black text-rose-600 text-lg\">{formatCurrency(Math.abs(netProfit))}</span>\r\n                                </motion.div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"p-8 bg-muted/30 border-t border-border flex justify-between items-center\">\r\n                            <span className=\"text-xs font-black uppercase tracking-widest text-muted-foreground\">Total credits</span>\r\n                            <span className=\"text-2xl font-black text-foreground font-mono\">{activeCompany?.symbol || '₹'}{maxSideTotal.toLocaleString()}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Performance Summary Pill */}\r\n            <div className={`p-8 rounded-[2rem] border-2 text-center font-black text-sm tracking-widest uppercase transition-all ${netProfit >= 0 ? 'bg-emerald-500/5 border-emerald-500/20 text-emerald-500' : 'bg-rose-500/5 border-rose-500/20 text-rose-500'}`}>\r\n                {netProfit >= 0\r\n                    ? `🎉 Excellent Performance: Net Profit of ${formatCurrency(netProfit)}`\r\n                    : `⚠ Critical Attention: Net Loss of ${formatCurrency(Math.abs(netProfit))}`\r\n                }\r\n            </div>\r\n        </motion.div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\RatioAnalysis.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1020,1023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1020,1023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { ArrowLeft, TrendingUp, Target, Zap, ShieldCheck, FileDown } from 'lucide-react';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { type Ledger, ReportService } from '../../services/accounting/ReportService';\r\nimport { useReportDates } from './DateContext';\r\nimport PeriodSelector from '../../components/ui/PeriodSelector';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\nimport type { StockItem } from '../../services/inventory/types';\r\nimport AIReportAdvisor from '../../components/ai/AIReportAdvisor';\r\n\r\n\r\nexport default function RatioAnalysis() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const navigate = useNavigate();\r\n    const [loading, setLoading] = useState(true);\r\n    const [ratios, setRatios] = useState<{ name: string, value: string, target: string, desc: string, icon: any, color: string, bg: string }[]>([]);\r\n    const { startDate, endDate } = useReportDates();\r\n\r\n    useEffect(() => {\r\n        const calculateRatios = async () => {\r\n            if (!provider || !activeCompany) return;\r\n\r\n            const [vData, lData, sData] = await Promise.all([\r\n                provider.read<Voucher[]>('vouchers.json', activeCompany.path),\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                provider.read<StockItem[]>('stock_items.json', activeCompany.path),\r\n            ]);\r\n\r\n            const vouchers = vData || [];\r\n            const ledgers = lData || [];\r\n            const stockItems = sData || [];\r\n\r\n            // 1. Balance Sheet Items (As On End Date)\r\n            // Current Assets\r\n            // Filter specific CA groups if needed, but usually 'ASSETS' covers Fixed + Current. \r\n\r\n            // Filter specific CA groups if needed, but usually 'ASSETS' covers Fixed + Current. \r\n            // We might need to approximate CA by excluding Fixed Assets if they are clearly separated.\r\n            // For now, let's assume 'Current Assets' is a specific sub-group or we use all Assets - Fixed Assets.\r\n            // Simplification: Use all Assets for Total Assets, but for Current Ratio?\r\n            // Let's use the provided ACCT_GROUPS to identify.\r\n\r\n            // Actually, ReportService.getAsOnGroupSummary returns the top-level groups.\r\n            // We can iterate ledgers and check their group matches 'Current Assets', 'Bank Accounts', 'Cash-in-hand', 'Sundry Debtors', etc.\r\n            // But we need the balance AS ON `endDate`.\r\n\r\n            // To get balance of specific ledgers as on date:\r\n            // We can re-use the logic from ReportService but applied to specific ledgers?\r\n            // Or just use the GroupSummary result which sums up by group.\r\n\r\n            // Let's try to find \"Current Assets\" and \"Current Liabilities\" from the summaries if possible.\r\n            // If the user's chart of accounts is standard:\r\n            // Assets = Fixed Assets + Current Assets\r\n            // Liabilities = Loans + Current Liabilities + Cap Account (Equity)\r\n\r\n            // Liabilities = Loans + Current Liabilities + Cap Account (Equity)\r\n\r\n            // Calculate balances As On endDate\r\n            const getBalanceAsOn = (ledger: Ledger) => {\r\n                return ReportService.getLedgerBalanceAsOn(ledger, vouchers, endDate);\r\n            };\r\n\r\n            // Current Assets: Cash, Bank, Debtors, Stock, etc.\r\n            const caLedgers = ledgers.filter(l =>\r\n                ['Current Assets', 'Bank Accounts', 'Cash-in-hand', 'Sundry Debtors', 'Stock-in-hand'].includes(l.group) ||\r\n                l.group.includes('Bank') || l.group.includes('Cash') || l.group.includes('Debtor')\r\n            );\r\n            const totalCA = caLedgers.reduce((sum, l) => sum + getBalanceAsOn(l), 0) +\r\n                // Add Stock Value (Closing Stock)\r\n                stockItems.reduce((sum, item) => sum + (item.currentBalance || 0) * (item.currentRate || 0), 0); // Simplified stock\r\n\r\n            // Current Liabilities: Creditors, Duties & Taxes, Provisions\r\n            const clLedgers = ledgers.filter(l =>\r\n                ['Current Liabilities', 'Sundry Creditors', 'Duties & Taxes', 'Provisions', 'Bank OD A/c'].includes(l.group) ||\r\n                l.group.includes('Creditor') || l.group.includes('Tax')\r\n            );\r\n            const totalCL = clLedgers.reduce((sum, l) => sum + Math.abs(getBalanceAsOn(l)), 0); // Use Abs as liabilities are Credit\r\n\r\n\r\n            const quickAssets = totalCA - stockItems.reduce((sum, item) => sum + (item.currentBalance || 0) * (item.currentRate || 0), 0);\r\n\r\n            // 2. P&L Items (For the Period)\r\n            // Revenue (Direct Incomes + Sales)\r\n            const incomeSummaries = ReportService.getPeriodGroupSummary(ledgers, vouchers, startDate, endDate, 'INCOME');\r\n            const totalRevenue = Math.abs(incomeSummaries.reduce((sum, g) => sum + g.total, 0)); // Income is Cr\r\n\r\n            // Expenses (Direct + Indirect)\r\n            const expenseSummaries = ReportService.getPeriodGroupSummary(ledgers, vouchers, startDate, endDate, 'EXPENSES');\r\n            const totalExpenses = expenseSummaries.reduce((sum, g) => sum + g.total, 0); // Expense is Dr\r\n\r\n            const netProfit = totalRevenue - totalExpenses;\r\n\r\n            // Gross Profit (Revenue - Direct Expenses)\r\n            // We need to identify Direct Expenses (`Purchase Accounts`, `Direct Expenses`)\r\n            // ReportService.getPeriodGroupSummary returns groups. We can filter by group name.\r\n            const directExpenses = expenseSummaries\r\n                .filter(g => ['Purchase Accounts', 'Direct Expenses'].includes(g.groupName))\r\n                .reduce((sum, g) => sum + g.total, 0);\r\n\r\n            const grossProfit = totalRevenue - directExpenses;\r\n\r\n            setRatios([\r\n                {\r\n                    name: 'Current Ratio',\r\n                    value: totalCL !== 0 ? (totalCA / totalCL).toFixed(2) : 'N/A',\r\n                    target: '2.00',\r\n                    desc: 'Ability to pay short-term obligations',\r\n                    icon: ShieldCheck,\r\n                    color: 'text-primary',\r\n                    bg: 'bg-primary/10'\r\n                },\r\n                {\r\n                    name: 'Quick Ratio',\r\n                    value: totalCL !== 0 ? (quickAssets / totalCL).toFixed(2) : 'N/A',\r\n                    target: '1.00',\r\n                    desc: 'Immediate liquidity position',\r\n                    icon: Zap,\r\n                    color: 'text-amber-500',\r\n                    bg: 'bg-amber-500/10'\r\n                },\r\n                {\r\n                    name: 'GP Margin',\r\n                    value: totalRevenue !== 0 ? ((grossProfit / totalRevenue) * 100).toFixed(2) + '%' : '0%',\r\n                    target: '25%+',\r\n                    desc: 'Profitability from core operations',\r\n                    icon: TrendingUp,\r\n                    color: 'text-emerald-500',\r\n                    bg: 'bg-emerald-500/10'\r\n                },\r\n                {\r\n                    name: 'Net Profit Margin',\r\n                    value: totalRevenue !== 0 ? ((netProfit / totalRevenue) * 100).toFixed(2) + '%' : '0%',\r\n                    target: '15%+',\r\n                    desc: 'Bottom-line efficiency',\r\n                    icon: Target,\r\n                    color: 'text-indigo-500',\r\n                    bg: 'bg-indigo-500/10'\r\n                }\r\n            ]);\r\n            setLoading(false);\r\n        };\r\n        calculateRatios();\r\n    }, [provider, activeCompany, startDate, endDate]);\r\n\r\n    if (loading) return <div className=\"p-20 text-center font-black uppercase tracking-widest animate-pulse\">Calculating Financial Ratios...</div>;\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"max-w-6xl mx-auto space-y-8 pb-20\"\r\n        >\r\n            <div className=\"flex items-center gap-4\">\r\n                <button\r\n                    onClick={() => navigate('/dashboard')}\r\n                    className=\"p-3 hover:bg-muted rounded-2xl transition-all no-print\"\r\n                >\r\n                    <ArrowLeft className=\"w-5 h-5\" />\r\n                </button>\r\n                <div>\r\n                    <h1 className=\"text-4xl font-black text-foreground tracking-tight uppercase\">Ratio Analysis</h1>\r\n                    <p className=\"text-muted-foreground font-bold uppercase tracking-widest text-[10px] mt-1\">Financial Performance Health-check</p>\r\n                </div>\r\n                <div className=\"ml-auto no-print flex flex-wrap items-center gap-4\">\r\n                    <PeriodSelector />\r\n                    <button\r\n                        onClick={() => window.print()}\r\n                        className=\"flex items-center gap-2 px-6 py-2.5 bg-primary text-primary-foreground rounded-xl text-xs font-black uppercase tracking-widest hover:shadow-lg transition-all shadow-md shadow-primary/10\"\r\n                    >\r\n                        <FileDown className=\"w-4 h-4\" />\r\n                        Print / Save PDF\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <AIReportAdvisor\r\n                reportName=\"Ratio Analysis\"\r\n                data={{\r\n                    ratios: ratios.map(r => ({ name: r.name, value: r.value, target: r.target }))\r\n                }}\r\n            />\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                {ratios.map((ratio, i) => (\r\n                    <motion.div\r\n                        key={i}\r\n                        whileHover={{ y: -5 }}\r\n                        className=\"glass-panel p-10 rounded-[3rem] border-white/10 shadow-xl space-y-6 relative overflow-hidden group\"\r\n                    >\r\n                        <div className=\"flex items-center justify-between relative z-10\">\r\n                            <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${ratio.bg} ${ratio.color}`}>\r\n                                <ratio.icon className=\"w-7 h-7\" />\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-widest\">Industry Target</p>\r\n                                <p className=\"text-lg font-black text-foreground\">{ratio.target}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"relative z-10\">\r\n                            <h3 className=\"text-sm font-black uppercase tracking-widest text-muted-foreground\">{ratio.name}</h3>\r\n                            <p className=\"text-5xl font-black mt-2 tracking-tighter\">{ratio.value}</p>\r\n                            <p className=\"text-xs font-bold text-muted-foreground mt-4 italic\">{ratio.desc}</p>\r\n                        </div>\r\n                        <div className=\"pt-6 border-t border-border flex items-center justify-between relative z-10\">\r\n                            <span className=\"text-[9px] font-black uppercase tracking-[0.2em] text-emerald-500 bg-emerald-500/10 px-3 py-1 rounded-full\">Healthy</span>\r\n                            <div className=\"w-24 h-1.5 bg-muted rounded-full overflow-hidden\">\r\n                                <div className=\"w-3/4 h-full bg-primary\" />\r\n                            </div>\r\n                        </div>\r\n                    </motion.div>\r\n                ))}\r\n            </div>\r\n\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\StockSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\StockVoucherReport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\reports\\TrialBalance.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":38,"column":13,"severity":1,"nodeType":null,"fix":{"range":[1762,1824],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1965,1968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1965,1968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1409,1412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1409,1412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { ReportService, type Ledger, type GroupSummary } from '../../services/accounting/ReportService';\r\nimport { FileDown, ArrowRight } from 'lucide-react';\r\nimport type { Voucher } from '../../services/accounting/VoucherService';\r\nimport PeriodSelector from '../../components/ui/PeriodSelector';\r\nimport LedgerQuickView from './LedgerQuickView';\r\nimport React from 'react';\r\nimport { useReportDates } from './DateContext';\r\nimport { useLocalization } from '../../hooks/useLocalization';\r\n\r\nexport default function TrialBalance() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const { formatCurrency } = useLocalization();\r\n    const [groups, setGroups] = useState<GroupSummary[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const { startDate, endDate } = useReportDates();\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (!provider || !activeCompany) return;\r\n            setLoading(true);\r\n\r\n            const [ledgerData, customGroupsData, vouchersData] = await Promise.all([\r\n                provider.read<Ledger[]>('ledgers.json', activeCompany.path),\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                provider.read<any[]>('custom_groups.json', activeCompany.path),\r\n                provider.read<Voucher[]>('vouchers.json', activeCompany.path)\r\n            ]);\r\n\r\n            const ledgers = ledgerData || [];\r\n            const customGroups = customGroupsData || [];\r\n            const vouchers = vouchersData || [];\r\n\r\n            // Re-register groups\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            const { AccountGroupManager } = await import('../../services/accounting/ReportService');\r\n            customGroups.forEach((c: any) => AccountGroupManager.registerGroup(c.name, c.parentType));\r\n\r\n            // Logic Adjustment:\r\n            // For Balance Sheet items (Assets/Liabilities): Show Balance AS OF END DATE.\r\n            // For P&L items (Income/Expenses): Show Net Movement BETWEEN START and END DATE.\r\n\r\n            const balanceSheetTypes = ['ASSETS', 'LIABILITIES'] as const;\r\n            const pnlTypes = ['INCOME', 'EXPENSES'] as const;\r\n\r\n            let allSummaries: GroupSummary[] = [];\r\n\r\n            // 1. Get Balance Sheet Items (As On End Date)\r\n            balanceSheetTypes.forEach(type => {\r\n                const summaries = ReportService.getAsOnGroupSummary(ledgers, vouchers, endDate, type);\r\n                allSummaries = [...allSummaries, ...summaries];\r\n            });\r\n\r\n            // 2. Get P&L Items (Net Movement for Period)\r\n            pnlTypes.forEach(type => {\r\n                const summaries = ReportService.getPeriodGroupSummary(ledgers, vouchers, startDate, endDate, type);\r\n                allSummaries = [...allSummaries, ...summaries];\r\n            });\r\n\r\n            // Clean up empty groups\r\n            const activeGroups = allSummaries.filter(g => g.total !== 0 || g.ledgers.some(l => l.balance !== 0));\r\n\r\n            setGroups(activeGroups);\r\n            setLoading(false);\r\n        };\r\n        loadData();\r\n    }, [provider, activeCompany, startDate, endDate]);\r\n\r\n    // Calculate Grand Totals using the filtered ledger balances from the summaries\r\n    const totalDebit = groups.reduce((sum, g) => {\r\n        return sum + g.ledgers.reduce((lSum, l) => lSum + (l.type === 'Dr' ? l.balance : 0), 0);\r\n    }, 0);\r\n\r\n    const totalCredit = groups.reduce((sum, g) => {\r\n        return sum + g.ledgers.reduce((lSum, l) => lSum + (l.type === 'Cr' ? l.balance : 0), 0);\r\n    }, 0);\r\n\r\n    if (loading) return (\r\n        <div className=\"flex flex-col items-center justify-center p-24 space-y-4\">\r\n            <div className=\"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin\" />\r\n            <p className=\"text-[10px] font-black uppercase tracking-[0.3em] text-muted-foreground animate-pulse\">Reconciling Ledger Matrices...</p>\r\n        </div>\r\n    );\r\n\r\n    const container = { hidden: { opacity: 0 }, show: { opacity: 1, transition: { staggerChildren: 0.05 } } };\r\n    const item = { hidden: { y: 10, opacity: 0 }, show: { y: 0, opacity: 1 } };\r\n\r\n    return (\r\n        <motion.div\r\n            variants={container}\r\n            initial=\"hidden\"\r\n            animate=\"show\"\r\n            className=\"max-w-7xl mx-auto space-y-10 px-6 lg:px-12 pb-24 pt-4\"\r\n        >\r\n            <motion.div variants={item} className=\"flex flex-col lg:flex-row lg:items-center justify-between gap-8\">\r\n                <div>\r\n                    <h1 className=\"text-5xl font-black text-foreground tracking-tighter uppercase leading-none bg-gradient-to-br from-foreground to-foreground/50 bg-clip-text text-transparent\">\r\n                        Trial Balance\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground font-black uppercase tracking-[0.3em] text-[10px] mt-4 flex items-center gap-2\">\r\n                        <span className=\"w-8 h-px bg-primary/30\" />\r\n                        Consolidated Ledger Audit // {startDate} — {endDate}\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex flex-wrap items-center gap-4 no-print\">\r\n                    <PeriodSelector />\r\n                    <button\r\n                        onClick={() => window.print()}\r\n                        className=\"no-print flex items-center gap-3 px-8 py-4 bg-primary text-primary-foreground rounded-[1.5rem] text-[10px] font-black uppercase tracking-widest hover:shadow-2xl hover:shadow-primary/30 transition-all active:scale-95 group\"\r\n                    >\r\n                        <FileDown className=\"w-4 h-4 group-hover:animate-bounce\" />\r\n                        Download Archive\r\n                    </button>\r\n                    <div className=\"glass-panel px-8 py-4 rounded-[2rem] border-primary/10 shadow-2xl flex items-center gap-6 group\">\r\n                        <div className=\"text-right\">\r\n                            <p className=\"text-[9px] font-black text-muted-foreground uppercase tracking-[0.2em] mb-1\">Exposure Variance</p>\r\n                            <p className=\"text-2xl font-black text-primary tracking-tighter tabular-nums\">{formatCurrency(totalDebit - totalCredit)}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n\r\n            <motion.div variants={item} className=\"glass-panel rounded-[3.5rem] border-primary/10 overflow-hidden shadow-2xl\">\r\n                <div className=\"p-10 border-b border-border/50 bg-muted/20 flex items-center justify-between\">\r\n                    <h2 className=\"text-[11px] font-black uppercase tracking-[0.4em] text-foreground\">Statement of Financial Neutrality</h2>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-emerald-500 animate-pulse\" />\r\n                        <span className=\"text-[9px] font-black text-muted-foreground uppercase tracking-widest\">Double-Entry Integrity Verified</span>\r\n                    </div>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left\">\r\n                        <thead>\r\n                            <tr className=\"bg-muted/30 border-b border-border\">\r\n                                <th className=\"px-12 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground\">Particulars / Registry Account</th>\r\n                                <th className=\"px-10 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground text-right w-64\">Debit Liability</th>\r\n                                <th className=\"px-12 py-8 text-[11px] font-black uppercase tracking-[0.3em] text-muted-foreground text-right w-64\">Credit Asset</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border/30\">\r\n                            {groups.map(group => (\r\n                                group.ledgers.length > 0 && (\r\n                                    <React.Fragment key={group.groupName}>\r\n                                        <tr className=\"bg-muted/20 border-l-4 border-primary/40\">\r\n                                            <td className=\"px-12 py-6 font-black text-foreground uppercase tracking-[0.2em] text-[10px]\" colSpan={3}>\r\n                                                {group.groupName}\r\n                                            </td>\r\n                                        </tr>\r\n                                        {group.ledgers.map(ledger => (\r\n                                            (ledger.balance !== 0) && (\r\n                                                <tr key={ledger.id} className=\"hover:bg-primary/5 transition-colors group/row\">\r\n                                                    <td className=\"px-12 py-6\">\r\n                                                        <LedgerQuickView ledgerName={ledger.name}>\r\n                                                            <div className=\"flex items-center gap-4 cursor-help group/text\">\r\n                                                                <ArrowRight className=\"w-3 h-3 text-primary/40 group-hover/text:translate-x-1 transition-transform\" />\r\n                                                                <span className=\"text-lg font-black text-foreground tracking-tighter group-hover/text:text-primary transition-colors\">\r\n                                                                    {ledger.name}\r\n                                                                </span>\r\n                                                            </div>\r\n                                                        </LedgerQuickView>\r\n                                                    </td>\r\n                                                    <td className=\"px-10 py-6 text-right font-black text-foreground tabular-nums tracking-tighter text-xl\">\r\n                                                        {ledger.type === 'Dr' ? formatCurrency(ledger.balance) : ''}\r\n                                                    </td>\r\n                                                    <td className=\"px-12 py-6 text-right font-black text-foreground tabular-nums tracking-tighter text-xl\">\r\n                                                        {ledger.type === 'Cr' ? formatCurrency(ledger.balance) : ''}\r\n                                                    </td>\r\n                                                </tr>\r\n                                            )\r\n                                        ))}\r\n                                    </React.Fragment>\r\n                                )\r\n                            ))}\r\n                        </tbody>\r\n                        <tfoot className=\"bg-primary/5 border-t-4 border-primary/20\">\r\n                            <tr>\r\n                                <td className=\"px-12 py-12 text-[14px] font-black uppercase tracking-[0.4em] text-primary\">Consolidated Audit Total</td>\r\n                                <td className=\"px-10 py-12 text-right font-black text-primary text-4xl tabular-nums tracking-tighter\">{formatCurrency(totalDebit)}</td>\r\n                                <td className=\"px-12 py-12 text-right font-black text-primary text-4xl tabular-nums tracking-tighter\">{formatCurrency(totalCredit)}</td>\r\n                            </tr>\r\n                        </tfoot>\r\n                    </table>\r\n                </div>\r\n            </motion.div>\r\n\r\n            {Math.abs(totalDebit - totalCredit) > 0.01 && (\r\n                <div className=\"p-4 rounded-xl bg-orange-500/10 border border-orange-500/20 text-orange-600 font-bold text-center text-sm\">\r\n                    ⚠️ Difference in Opening Balances: {formatCurrency(totalDebit - totalCredit)}\r\n                </div>\r\n            )}\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\security\\AuditLogViewer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\security\\SecurityCenter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\settings\\SettingsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2306,2309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2306,2309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Moon, Sun, Palette, Bell, Shield, Info, Clock, Sparkles, Eye, EyeOff, ExternalLink, CheckCircle2, Loader2, Play } from 'lucide-react';\r\nimport { useTheme } from './useTheme';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport Select from '../../components/ui/Select';\r\nimport { useState, useEffect } from 'react';\r\nimport { GeminiService } from '../../services/ai/GeminiService';\r\n\r\nexport default function SettingsPage() {\r\n    const { setTheme, theme } = useTheme();\r\n    const [sessionTimeout, setSessionTimeout] = useState('30m');\r\n    const [geminiKey, setGeminiKey] = useState(localStorage.getItem('moneyarc_gemini_key') || '');\r\n    const [showKey, setShowKey] = useState(false);\r\n    const [isTesting, setIsTesting] = useState(false);\r\n    const [testResult, setTestResult] = useState<{ success: boolean; message: string } | null>(null);\r\n    const [isSaved, setIsSaved] = useState(false);\r\n\r\n    // No default initialization needed anymore to prevent using blocked keys\r\n    useEffect(() => {\r\n        // Just ensuring state is consistent with localStorage on mount\r\n        const savedKey = localStorage.getItem('moneyarc_gemini_key');\r\n        if (savedKey) setGeminiKey(savedKey);\r\n    }, []);\r\n\r\n    const handleKeyChange = (val: string) => {\r\n        setGeminiKey(val);\r\n        localStorage.setItem('moneyarc_gemini_key', val);\r\n        setIsSaved(true);\r\n        setTestResult(null);\r\n        setTimeout(() => setIsSaved(false), 2000);\r\n\r\n        // Dispatch custom event for same-tab reactivity\r\n        window.dispatchEvent(new CustomEvent('moneyarc_key_updated', { detail: val }));\r\n    };\r\n\r\n    const testConnection = async () => {\r\n        setIsTesting(true);\r\n        setTestResult(null);\r\n        try {\r\n            const service = new GeminiService(geminiKey);\r\n            const response = await service.generateInsight(\"Say 'Connection Successful' in 2 words.\", {\r\n                vouchers: [], ledgers: [], companyName: 'System Test', symbol: '₹'\r\n            });\r\n\r\n            if (response.toLowerCase().includes('success')) {\r\n                setTestResult({ success: true, message: 'Gemini AI is online and ready!' });\r\n            } else {\r\n                setTestResult({ success: false, message: response });\r\n            }\r\n        } catch (err: any) {\r\n            setTestResult({ success: false, message: err.message || 'Verification failed.' });\r\n        } finally {\r\n            setIsTesting(false);\r\n        }\r\n    };\r\n\r\n    const sections = [\r\n        {\r\n            title: 'Appearance',\r\n            description: 'Customize how MoneyArc looks on your screen.',\r\n            icon: Palette,\r\n            items: [\r\n                {\r\n                    label: 'Theme Mode',\r\n                    description: 'Switch between light and dark themes.',\r\n                    content: (\r\n                        <div className=\"flex p-1 bg-muted rounded-xl gap-1\">\r\n                            {[\r\n                                { id: 'light', icon: Sun, label: 'Light' },\r\n                                { id: 'dark', icon: Moon, label: 'Dark' },\r\n                            ].map((mode) => (\r\n                                <button\r\n                                    key={mode.id}\r\n                                    onClick={() => setTheme(mode.id as 'light' | 'dark')}\r\n                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${theme === mode.id\r\n                                        ? 'bg-card text-foreground shadow-sm'\r\n                                        : 'text-muted-foreground hover:text-foreground'\r\n                                        }`}\r\n                                >\r\n                                    <mode.icon className=\"w-4 h-4\" />\r\n                                    {mode.label}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    )\r\n                }\r\n            ]\r\n        },\r\n        {\r\n            title: 'Notifications',\r\n            description: 'Manage your alerts and updates.',\r\n            icon: Bell,\r\n            items: [\r\n                {\r\n                    label: 'Desktop Notifications',\r\n                    description: 'Receive alerts even when the app is in background.',\r\n                    content: (\r\n                        <div className=\"w-12 h-6 bg-primary/20 rounded-full relative cursor-not-allowed\">\r\n                            <div className=\"absolute left-1 top-1 w-4 h-4 bg-primary rounded-full\" />\r\n                        </div>\r\n                    )\r\n                }\r\n            ]\r\n        },\r\n        {\r\n            title: 'Security',\r\n            description: 'Protect your accounting data.',\r\n            icon: Shield,\r\n            items: [\r\n                {\r\n                    label: 'Session Timeout',\r\n                    description: 'Automatically log out after inactivity.',\r\n                    content: (\r\n                        <Select\r\n                            value={sessionTimeout}\r\n                            onChange={setSessionTimeout}\r\n                            options={[\r\n                                { value: '30m', label: '30 Minutes', icon: Clock, description: 'Standard security' },\r\n                                { value: '1h', label: '1 Hour', icon: Clock, description: 'Flexible focus' },\r\n                                { value: 'never', label: 'Never', icon: Shield, description: 'High risk' },\r\n                            ]}\r\n                            className=\"w-48\"\r\n                        />\r\n                    )\r\n                }\r\n            ]\r\n        },\r\n        {\r\n            title: 'AI & Intelligence',\r\n            description: 'Configure your Gemini AI assistant settings.',\r\n            icon: Sparkles,\r\n            items: [\r\n                {\r\n                    label: 'Gemini API Key',\r\n                    description: 'Required for AI insights and advisor feed.',\r\n                    content: (\r\n                        <div className=\"flex flex-col gap-3 w-full max-w-md\">\r\n                            <div className=\"relative group\">\r\n                                <input\r\n                                    type={showKey ? 'text' : 'password'}\r\n                                    value={geminiKey}\r\n                                    onChange={(e) => handleKeyChange(e.target.value)}\r\n                                    placeholder=\"paste your api key here...\"\r\n                                    className=\"w-full bg-muted border border-border rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 pr-12 font-mono\"\r\n                                />\r\n                                <div className=\"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                                    <AnimatePresence>\r\n                                        {isSaved && (\r\n                                            <motion.div\r\n                                                initial={{ opacity: 0, scale: 0.5 }}\r\n                                                animate={{ opacity: 1, scale: 1 }}\r\n                                                exit={{ opacity: 0 }}\r\n                                                className=\"text-google-green\"\r\n                                            >\r\n                                                <CheckCircle2 className=\"w-4 h-4\" />\r\n                                            </motion.div>\r\n                                        )}\r\n                                    </AnimatePresence>\r\n                                    <button\r\n                                        onClick={() => setShowKey(!showKey)}\r\n                                        className=\"p-1.5 hover:bg-white/10 rounded-lg text-muted-foreground hover:text-foreground transition-all\"\r\n                                    >\r\n                                        {showKey ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center justify-between gap-4 mt-1\">\r\n                                <a\r\n                                    href=\"https://aistudio.google.com/app/apikey\"\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"text-[10px] font-bold text-primary flex items-center gap-1 hover:underline opacity-70 hover:opacity-100\"\r\n                                >\r\n                                    <ExternalLink className=\"w-3 h-3\" />\r\n                                    Get free API key from Google AI Studio\r\n                                </a>\r\n\r\n                                <button\r\n                                    onClick={testConnection}\r\n                                    disabled={isTesting || !geminiKey}\r\n                                    className=\"flex items-center gap-2 px-3 py-1.5 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg text-[10px] font-black uppercase tracking-widest transition-all disabled:opacity-50\"\r\n                                >\r\n                                    {isTesting ? (\r\n                                        <>\r\n                                            <Loader2 className=\"w-3 h-3 animate-spin\" />\r\n                                            Verifying...\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <Play className=\"w-3 h-3\" />\r\n                                            Test Connection\r\n                                        </>\r\n                                    )}\r\n                                </button>\r\n                            </div>\r\n\r\n                            <AnimatePresence>\r\n                                {testResult && (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0, y: -10 }}\r\n                                        animate={{ opacity: 1, y: 0 }}\r\n                                        className={`mt-2 p-3 rounded-xl border text-[11px] font-bold flex items-start gap-2 ${testResult.success\r\n                                            ? 'bg-google-green/10 border-google-green/20 text-google-green'\r\n                                            : 'bg-google-red/10 border-google-red/20 text-google-red'\r\n                                            }`}\r\n                                    >\r\n                                        <div className=\"mt-0.5\">\r\n                                            {testResult.success ? <CheckCircle2 className=\"w-3 h-3\" /> : <Info className=\"w-3 h-3\" />}\r\n                                        </div>\r\n                                        {testResult.message}\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n                        </div>\r\n                    )\r\n                }\r\n            ]\r\n        },\r\n        {\r\n            title: 'About',\r\n            description: 'Application details.',\r\n            icon: Info,\r\n            items: [\r\n                {\r\n                    label: 'Developer',\r\n                    description: 'Created by',\r\n                    content: <span className=\"font-medium\">Munawir Ali V K</span>\r\n                },\r\n                {\r\n                    label: 'Version',\r\n                    description: 'Current build',\r\n                    content: <span className=\"font-mono text-sm bg-muted px-2 py-1 rounded\">0.0.01</span>\r\n                }\r\n            ]\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"max-w-4xl mx-auto space-y-8 pb-12\"\r\n        >\r\n            <div>\r\n                <h1 className=\"text-3xl font-bold tracking-tight\">Settings</h1>\r\n                <p className=\"text-muted-foreground mt-1\">Manage your application preferences and account settings.</p>\r\n            </div>\r\n\r\n            <div className=\"space-y-6\">\r\n                {sections.map((section, idx) => (\r\n                    <div key={idx} className=\"bg-card rounded-2xl border border-border overflow-hidden shadow-sm\">\r\n                        <div className=\"p-6 border-b border-border bg-muted/30 flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-xl bg-primary/10 text-primary flex items-center justify-center\">\r\n                                <section.icon className=\"w-5 h-5\" />\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"text-lg font-bold\">{section.title}</h2>\r\n                                <p className=\"text-sm text-muted-foreground\">{section.description}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"p-6 divide-y divide-border\">\r\n                            {section.items.map((item, itemIdx) => (\r\n                                <div key={itemIdx} className=\"py-6 first:pt-0 last:pb-0 flex items-center justify-between gap-8\">\r\n                                    <div className=\"flex-1\">\r\n                                        <h3 className=\"font-semibold\">{item.label}</h3>\r\n                                        <p className=\"text-sm text-muted-foreground\">{item.description}</p>\r\n                                    </div>\r\n                                    <div className=\"flex-shrink-0\">\r\n                                        {item.content}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\settings\\ThemeContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\settings\\businessThemes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\settings\\useTheme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\utilities\\Calculator.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-eval').","line":31,"column":13,"severity":1,"nodeType":null,"fix":{"range":[971,1006],"text":" "}},{"ruleId":"react-hooks/unsupported-syntax","severity":1,"message":"Compilation Skipped: The 'eval' function is not supported\n\nEval is an anti-pattern in JavaScript, and the code executed cannot be evaluated by React Compiler.\n\nM:\\Projects\\MoneyArc-main\\src\\features\\utilities\\Calculator.tsx:32:28\n  30 |         try {\n  31 |             // eslint-disable-next-line no-eval\n> 32 |             const result = eval(equation + display);\n     |                            ^^^^ The 'eval' function is not supported\n  33 |             setDisplay(String(result));\n  34 |             setEquation('');\n  35 |             setShouldResetDisplay(true);\n\n","line":32,"column":28,"nodeType":null,"endLine":32,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":36,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'handleBackspace', 'handleEqual', 'handleNumberCp', 'handleOperator', and 'onClose'. Either include them or remove the dependency array. If 'onClose' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":73,"column":8,"nodeType":"ArrayExpression","endLine":73,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, display, equation, handleNumberCp, handleOperator, onClose, handleBackspace, handleEqual]","fix":{"range":[2413,2440],"text":"[isOpen, display, equation, handleNumberCp, handleOperator, onClose, handleBackspace, handleEqual]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6065,6068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6065,6068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Delete, Eraser, Calculator as CalcIcon } from 'lucide-react';\r\n\r\ninterface CalculatorProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function Calculator({ isOpen, onClose }: CalculatorProps) {\r\n    const [display, setDisplay] = useState('0');\r\n    const [equation, setEquation] = useState('');\r\n    const [shouldResetDisplay, setShouldResetDisplay] = useState(false);\r\n\r\n    const handleNumberCp = (num: string) => {\r\n        if (display === '0' || shouldResetDisplay) {\r\n            setDisplay(num);\r\n            setShouldResetDisplay(false);\r\n        } else {\r\n            setDisplay(display + num);\r\n        }\r\n    };\r\n\r\n    const handleOperator = (op: string) => {\r\n        setShouldResetDisplay(true);\r\n        setEquation(display + ' ' + op + ' ');\r\n    };\r\n\r\n    const handleEqual = () => {\r\n        try {\r\n            // eslint-disable-next-line no-eval\r\n            const result = eval(equation + display);\r\n            setDisplay(String(result));\r\n            setEquation('');\r\n            setShouldResetDisplay(true);\r\n        } catch (error) {\r\n            setDisplay('Error');\r\n            setShouldResetDisplay(true);\r\n            setEquation('');\r\n        }\r\n    };\r\n\r\n    const handleClear = () => {\r\n        setDisplay('0');\r\n        setEquation('');\r\n        setShouldResetDisplay(false);\r\n    };\r\n\r\n    const handleBackspace = () => {\r\n        if (display.length === 1) {\r\n            setDisplay('0');\r\n        } else {\r\n            setDisplay(display.slice(0, -1));\r\n        }\r\n    };\r\n\r\n    // Keyboard support\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (!isOpen) return;\r\n\r\n            if (e.key >= '0' && e.key <= '9') handleNumberCp(e.key);\r\n            if (['+', '-', '*', '/'].includes(e.key)) handleOperator(e.key);\r\n            if (e.key === 'Enter' || e.key === '=') { e.preventDefault(); handleEqual(); }\r\n            if (e.key === 'Escape') onClose();\r\n            if (e.key === 'Backspace') handleBackspace();\r\n            if (e.key === 'c' || e.key === 'C') handleClear();\r\n            if (e.key === '.') handleNumberCp('.');\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [isOpen, display, equation]);\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, scale: 0.9, y: 20 }}\r\n                    animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                    exit={{ opacity: 0, scale: 0.9, y: 20 }}\r\n                    className=\"fixed bottom-24 right-20 z-50 w-72 bg-card border border-border shadow-2xl rounded-3xl overflow-hidden\"\r\n                >\r\n                    {/* Header */}\r\n                    <div className=\"bg-muted/50 p-3 flex items-center justify-between border-b border-border\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"p-1.5 bg-[#4285F4]/10 rounded-lg text-[#4285F4]\">\r\n                                <CalcIcon className=\"w-4 h-4\" />\r\n                            </div>\r\n                            <span className=\"text-xs font-bold uppercase tracking-wider\">Calculator</span>\r\n                        </div>\r\n                        <button onClick={onClose} className=\"p-1 hover:bg-muted-foreground/10 rounded-full transition-colors\">\r\n                            <X className=\"w-4 h-4 text-muted-foreground\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Display */}\r\n                    <div className=\"p-4 bg-background/50\">\r\n                        <div className=\"h-6 text-xs text-right text-muted-foreground font-mono mb-1\">{equation}</div>\r\n                        <div className=\"text-3xl font-bold text-right tracking-tight truncate\">{display}</div>\r\n                    </div>\r\n\r\n                    {/* Keypad */}\r\n                    <div className=\"p-3 grid grid-cols-4 gap-2 bg-muted/20\">\r\n                        {[\r\n                            { label: 'C', act: handleClear, style: 'text-[#EA4335] bg-[#EA4335]/10' },\r\n                            { label: <Eraser className=\"w-4 h-4\" />, act: handleClear, style: 'text-[#4285F4] bg-[#4285F4]/10' }, // Just using logic for UI balance\r\n                            { label: <Delete className=\"w-4 h-4\" />, act: handleBackspace, style: 'text-[#4285F4] bg-[#4285F4]/10' },\r\n                            { label: '÷', act: () => handleOperator('/'), style: 'bg-[#4285F4] text-white' },\r\n\r\n                            { label: '7', act: () => handleNumberCp('7') },\r\n                            { label: '8', act: () => handleNumberCp('8') },\r\n                            { label: '9', act: () => handleNumberCp('9') },\r\n                            { label: '×', act: () => handleOperator('*'), style: 'bg-[#4285F4] text-white' },\r\n\r\n                            { label: '4', act: () => handleNumberCp('4') },\r\n                            { label: '5', act: () => handleNumberCp('5') },\r\n                            { label: '6', act: () => handleNumberCp('6') },\r\n                            { label: '-', act: () => handleOperator('-'), style: 'bg-[#4285F4] text-white' },\r\n\r\n                            { label: '1', act: () => handleNumberCp('1') },\r\n                            { label: '2', act: () => handleNumberCp('2') },\r\n                            { label: '3', act: () => handleNumberCp('3') },\r\n                            { label: '+', act: () => handleOperator('+'), style: 'bg-[#4285F4] text-white' },\r\n\r\n                            { label: '0', act: () => handleNumberCp('0'), span: 'col-span-2' },\r\n                            { label: '.', act: () => handleNumberCp('.') },\r\n                            { label: '=', act: handleEqual, style: 'bg-[#4285F4] text-white' },\r\n                        ].map((btn: any, i) => (\r\n                            <button\r\n                                key={i}\r\n                                onClick={btn.act}\r\n                                className={`\r\n                                    h-12 rounded-xl font-bold text-lg flex items-center justify-center transition-all active:scale-95\r\n                                    ${btn.style || 'bg-card hover:bg-muted border border-border/50'}\r\n                                    ${btn.span || ''}\r\n                                `}\r\n                            >\r\n                                {btn.label}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\features\\utilities\\DataPortability.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1157,1160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1157,1160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1970,1973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1970,1973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":54,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":80,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":80,"endColumn":25}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Download, Upload, FileJson, FileSpreadsheet, Database, AlertCircle, CheckCircle2, Loader2, ArrowLeft } from 'lucide-react';\r\nimport { usePersistence } from '../../services/persistence/PersistenceContext';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport default function DataPortability() {\r\n    const { provider, activeCompany } = usePersistence();\r\n    const navigate = useNavigate();\r\n    const [status, setStatus] = useState<{ type: 'idle' | 'loading' | 'success' | 'error', message: string }>({ type: 'idle', message: '' });\r\n\r\n    const handleExport = async (format: 'json' | 'csv') => {\r\n        if (!provider || !activeCompany) return;\r\n        setStatus({ type: 'loading', message: `Preparing ${format.toUpperCase()} package...` });\r\n\r\n        try {\r\n            // In a real app, you'd zip all files or specific ones. \r\n            // For now, let's export just the core data.\r\n            const dataFiles = ['ledgers.json', 'vouchers.json', 'stock_items.json', 'units.json', 'groups.json'];\r\n            const allData: Record<string, any> = {};\r\n\r\n            for (const file of dataFiles) {\r\n                allData[file.split('.')[0]] = await provider.read(file, activeCompany.path) || [];\r\n            }\r\n\r\n            let blob: Blob;\r\n            let filename: string;\r\n\r\n            if (format === 'json') {\r\n                blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });\r\n                filename = `${activeCompany.name}_Backup_${new Date().toISOString().split('T')[0]}.json`;\r\n            } else {\r\n                // Simplified CSV export for ledgers\r\n                const ledgers = allData.ledgers || [];\r\n                const headers = ['id', 'name', 'group', 'balance', 'type'];\r\n                const csvContent = [\r\n                    headers.join(','),\r\n                    ...ledgers.map((l: any) => headers.map(h => `\"${l[h]}\"`).join(','))\r\n                ].join('\\n');\r\n                blob = new Blob([csvContent], { type: 'text/csv' });\r\n                filename = `${activeCompany.name}_Ledgers_${new Date().toISOString().split('T')[0]}.csv`;\r\n            }\r\n\r\n            const url = window.URL.createObjectURL(blob);\r\n            const a = document.createElement('a');\r\n            a.style.display = 'none';\r\n            a.href = url;\r\n            a.download = filename;\r\n            document.body.appendChild(a);\r\n            a.click();\r\n            window.URL.revokeObjectURL(url);\r\n\r\n            setStatus({ type: 'success', message: 'Export completed successfully!' });\r\n        } catch (err) {\r\n            setStatus({ type: 'error', message: 'Failed to generate package.' });\r\n        }\r\n    };\r\n\r\n    const handleImport = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file || !provider || !activeCompany) return;\r\n\r\n        setStatus({ type: 'loading', message: 'Analyzing data integrity...' });\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = async (event) => {\r\n            try {\r\n                const text = event.target?.result as string;\r\n                const data = JSON.parse(text);\r\n\r\n                // Validation\r\n                if (!data.ledgers && !data.vouchers) throw new Error(\"Invalid structure\");\r\n\r\n                // Write to provider\r\n                if (data.ledgers) await provider.write('ledgers.json', data.ledgers, activeCompany.path);\r\n                if (data.vouchers) await provider.write('vouchers.json', data.vouchers, activeCompany.path);\r\n                if (data.stock_items) await provider.write('stock_items.json', data.stock_items, activeCompany.path);\r\n\r\n                setStatus({ type: 'success', message: 'Recovery complete! All data restored.' });\r\n            } catch (err) {\r\n                setStatus({ type: 'error', message: 'Import failed: Invalid file format.' });\r\n            }\r\n        };\r\n        reader.readAsText(file);\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            initial={{ opacity: 0, scale: 0.98 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            className=\"max-w-4xl mx-auto py-12 px-6\"\r\n        >\r\n            <div className=\"flex items-center gap-6 mb-12\">\r\n                <button onClick={() => navigate(-1)} className=\"p-4 bg-muted hover:bg-muted/80 rounded-2xl transition-all\">\r\n                    <ArrowLeft className=\"w-6 h-6\" />\r\n                </button>\r\n                <div>\r\n                    <h1 className=\"text-4xl font-black text-foreground tracking-tighter uppercase leading-none\">Data Portability</h1>\r\n                    <p className=\"text-muted-foreground font-bold uppercase tracking-[0.3em] text-[10px] mt-4\">Enterprise Data Mobility Tools</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                {/* Export Section */}\r\n                <div className=\"glass-panel p-10 rounded-[3.5rem] flex flex-col items-center text-center gap-8 border-google-blue/20\">\r\n                    <div className=\"w-20 h-20 bg-google-blue/10 rounded-3xl flex items-center justify-center text-google-blue\">\r\n                        <Download className=\"w-10 h-10\" />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-black uppercase tracking-tight mb-3\">Bulk Export</h2>\r\n                        <p className=\"text-xs font-medium text-muted-foreground leading-relaxed px-6\">\r\n                            Securely extract your entire data vault for offline backups or migration to other systems.\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"flex gap-4 w-full\">\r\n                        <button\r\n                            onClick={() => handleExport('json')}\r\n                            className=\"flex-1 py-4 bg-google-blue text-white rounded-[1.5rem] font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-2 hover:bg-google-blue/90 shadow-xl shadow-google-blue/20 transition-all\"\r\n                        >\r\n                            <FileJson className=\"w-4 h-4\" /> JSON\r\n                        </button>\r\n                        <button\r\n                            onClick={() => handleExport('csv')}\r\n                            className=\"flex-1 py-4 border border-google-blue/30 text-google-blue rounded-[1.5rem] font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-2 hover:bg-google-blue/5 transition-all\"\r\n                        >\r\n                            <FileSpreadsheet className=\"w-4 h-4\" /> Ledgers CSV\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Import Section */}\r\n                <div className=\"glass-panel p-10 rounded-[3.5rem] flex flex-col items-center text-center gap-8 border-google-green/20\">\r\n                    <div className=\"w-20 h-20 bg-google-green/10 rounded-3xl flex items-center justify-center text-google-green\">\r\n                        <Database className=\"w-10 h-10\" />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className=\"text-2xl font-black uppercase tracking-tight mb-3\">Restore & Import</h2>\r\n                        <p className=\"text-xs font-medium text-muted-foreground leading-relaxed px-6\">\r\n                            Seamlessly upload a previously exported vault or bulk-onboard data from spreadsheets.\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"w-full\">\r\n                        <label className=\"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-google-green/30 rounded-[2rem] cursor-pointer hover:bg-google-green/5 transition-all group\">\r\n                            <div className=\"flex flex-col items-center justify-center pt-5 pb-6\">\r\n                                <Upload className=\"w-8 h-8 text-google-green group-hover:scale-110 transition-transform mb-2\" />\r\n                                <p className=\"text-[10px] font-black uppercase tracking-widest text-google-green\">Select Vault File</p>\r\n                            </div>\r\n                            <input type=\"file\" className=\"hidden\" accept=\".json\" onChange={handleImport} />\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Status Overlay */}\r\n            <AnimatePresence>\r\n                {status.type !== 'idle' && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 20 }}\r\n                        className={`fixed bottom-12 left-1/2 -translate-x-1/2 px-10 py-5 rounded-[2rem] shadow-2xl border-2 flex items-center gap-6 z-50 backdrop-blur-xl ${status.type === 'loading' ? 'bg-card border-google-blue/30' :\r\n                            status.type === 'success' ? 'bg-emerald-500 text-white border-transparent' :\r\n                                'bg-rose-500 text-white border-transparent'\r\n                            }`}\r\n                    >\r\n                        {status.type === 'loading' ? <Loader2 className=\"w-6 h-6 animate-spin text-google-blue\" /> :\r\n                            status.type === 'success' ? <CheckCircle2 className=\"w-6 h-6\" /> :\r\n                                <AlertCircle className=\"w-6 h-6\" />}\r\n                        <span className=\"text-xs font-black uppercase tracking-widest\">{status.message}</span>\r\n                        {status.type !== 'loading' && (\r\n                            <button onClick={() => setStatus({ type: 'idle', message: '' })} className=\"ml-4 opacity-50 hover:opacity-100 transition-opacity\">\r\n                                <CheckCircle2 className=\"w-5 h-5\" />\r\n                            </button>\r\n                        )}\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\hooks\\useLocalization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\accounting\\LedgerService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\accounting\\ReportService.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'amount' is never reassigned. Use 'const' instead.","line":71,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":71,"endColumn":27,"fix":{"range":[2513,2536],"text":"const amount = l.balance;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3111,3114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3111,3114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4188,4191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4188,4191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5100,5103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5100,5103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5945,5948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5945,5948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6940,6943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6940,6943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7928,7931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7928,7931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":232,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9529,9532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9529,9532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":253,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10762,10765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10762,10765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":264,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11439,11442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11439,11442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":266,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11574,11577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11574,11577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":291,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12495,12498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12495,12498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":304,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12965,12968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12965,12968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14153,14156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14153,14156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":342,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14708,14711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14708,14711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { type StockItem } from '../inventory/types';\n\nexport interface Ledger {\n    id: string;\n    name: string;\n    group: string;\n    category?: string;\n    balance: number;\n    type: 'Dr' | 'Cr';\n    gstin?: string;\n    registrationType?: 'Regular' | 'Composition' | 'Unregistered' | 'Consumer';\n    partyType?: 'Not Applicable' | 'Deemed Export' | 'Embassy' | 'Government Entity' | 'SEZ';\n    placeOfSupply?: string;\n    address?: string;\n    state?: string;\n    isGstEnabled: boolean;\n}\n\nexport interface GroupSummary {\n    groupName: string;\n    total: number;\n    ledgers: Ledger[];\n}\n\nexport const ACCT_GROUPS = {\n    ASSETS: ['Bank Accounts', 'Cash-in-hand', 'Sundry Debtors', 'Fixed Assets', 'Stock-in-hand', 'Current Assets', 'Loans & Advances (Asset)'],\n    LIABILITIES: ['Capital Account', 'Sundry Creditors', 'Loans (Liability)', 'Duties & Taxes', 'Current Liabilities', 'Reserves & Surplus'],\n    INCOME: ['Sales Accounts', 'Direct Incomes', 'Indirect Incomes'],\n    EXPENSES: ['Purchase Accounts', 'Direct Expenses', 'Indirect Expenses'],\n};\n\n// Extensibility Helper\nexport class AccountGroupManager {\n    static customGroups = {\n        ASSETS: [] as string[],\n        LIABILITIES: [] as string[],\n        INCOME: [] as string[],\n        EXPENSES: [] as string[]\n    };\n\n    static registerGroup(name: string, type: keyof typeof ACCT_GROUPS) {\n        if (!this.customGroups[type].includes(name)) {\n            this.customGroups[type].push(name);\n        }\n    }\n\n    static getGroups(type: keyof typeof ACCT_GROUPS): string[] {\n        return [...ACCT_GROUPS[type], ...this.customGroups[type]];\n    }\n\n    static isAssetOrExpense(group: string): boolean {\n        const assets = this.getGroups('ASSETS');\n        const expenses = this.getGroups('EXPENSES');\n        return assets.includes(group) || expenses.includes(group);\n    }\n}\n\nexport class ReportService {\n    static getGroupSummary(ledgers: Ledger[], targetType: keyof typeof ACCT_GROUPS): GroupSummary[] {\n        const targetGroups = AccountGroupManager.getGroups(targetType);\n\n        return targetGroups.map(group => {\n            const groupLedgers = ledgers.filter(l => l.group === group);\n\n            // Determine natural sign of the group\n            const isAssetOrExpense = AccountGroupManager.isAssetOrExpense(group);\n            // Assets/Expenses: Dr is positive, Cr is negative\n            // Liabilities/Income: Cr is positive, Dr is negative\n\n            const total = groupLedgers.reduce((sum, l) => {\n                let amount = l.balance;\n                if (isAssetOrExpense) {\n                    // Natural Debit: Add Dr, Subtract Cr\n                    return sum + (l.type === 'Dr' ? amount : -amount);\n                } else {\n                    // Natural Credit: Add Cr, Subtract Dr\n                    return sum + (l.type === 'Cr' ? amount : -amount);\n                }\n            }, 0);\n\n            return {\n                groupName: group,\n                total,\n                ledgers: groupLedgers\n            };\n        });\n    }\n\n    static getPeriodGroupSummary(ledgers: Ledger[], vouchers: any[], startDate: Date | string, endDate: Date | string, targetType: keyof typeof ACCT_GROUPS): GroupSummary[] {\n        const targetGroups = AccountGroupManager.getGroups(targetType);\n\n        // Ensure string format for comparison (YYYY-MM-DD)\n        const start = startDate instanceof Date ? startDate.toISOString().split('T')[0] : startDate;\n        const end = endDate instanceof Date ? endDate.toISOString().split('T')[0] : endDate;\n\n        // Filter vouchers within period using string comparison\n        const periodVouchers = vouchers.filter(v => v.date >= start && v.date <= end);\n\n        return targetGroups.map(group => {\n            const groupLedgers = ledgers.filter(l => l.group === group);\n            const isAssetOrExpense = AccountGroupManager.isAssetOrExpense(group);\n\n            const total = groupLedgers.reduce((sum, ledger) => {\n                // Calculate total transaction movement for this ledger in this period\n                let ledgerTotal = 0;\n\n                periodVouchers.forEach(v => {\n                    const row = v.rows.find((r: any) => r.account === ledger.name);\n                    if (row) {\n                        const amount = row.type === 'Dr' ? row.debit : row.credit;\n\n                        // For Asset/Expense: Dr is +, Cr is -\n                        // For Liab/Income: Cr is +, Dr is -\n                        if (isAssetOrExpense) {\n                            ledgerTotal += (row.type === 'Dr' ? amount : -amount);\n                        } else {\n                            ledgerTotal += (row.type === 'Cr' ? amount : -amount);\n                        }\n                    }\n                });\n\n                return sum + ledgerTotal;\n            }, 0);\n\n            // Clone ledgers and update balance for display in drill-down\n            const updatedLedgers = groupLedgers.map(l => {\n                let lTotal = 0;\n                periodVouchers.forEach(v => {\n                    const row = v.rows.find((r: any) => r.account === l.name);\n                    if (row) {\n                        const amount = row.type === 'Dr' ? row.debit : row.credit;\n                        if (isAssetOrExpense) {\n                            lTotal += (row.type === 'Dr' ? amount : -amount);\n                        } else {\n                            lTotal += (row.type === 'Cr' ? amount : -amount);\n                        }\n                    }\n                });\n                return { ...l, balance: Math.abs(lTotal), type: (lTotal >= 0 ? (isAssetOrExpense ? 'Dr' : 'Cr') : (isAssetOrExpense ? 'Cr' : 'Dr')) as 'Dr' | 'Cr' };\n            });\n\n            return {\n                groupName: group,\n                total,\n                ledgers: updatedLedgers\n            };\n        });\n    }\n\n    static getAsOnGroupSummary(ledgers: Ledger[], vouchers: any[], asOnDate: Date | string, targetType: keyof typeof ACCT_GROUPS): GroupSummary[] {\n        const targetGroups = AccountGroupManager.getGroups(targetType);\n        const end = asOnDate instanceof Date ? asOnDate.toISOString().split('T')[0] : asOnDate;\n\n        // Filter vouchers strictly AFTER the as-on date (Future)\n        const futureVouchers = vouchers.filter(v => v.date > end);\n\n        return targetGroups.map(group => {\n            const groupLedgers = ledgers.filter(l => l.group === group);\n            const isAssetOrExpense = AccountGroupManager.isAssetOrExpense(group);\n\n            const total = groupLedgers.reduce((sum, ledger) => {\n                // Start with signed current balance: Dr is positive, Cr is negative (internally here)\n                let signedBalance = (ledger.type === 'Dr' ? ledger.balance : -ledger.balance);\n\n                // Reverse future transactions\n                futureVouchers.forEach(v => {\n                    const row = v.rows.find((r: any) => r.account === ledger.name);\n                    if (row) {\n                        // Current = Previous + Dr - Cr\n                        // Previous = Current - Dr + Cr\n                        const drAmount = row.type === 'Dr' ? row.debit : 0;\n                        const crAmount = row.type === 'Cr' ? row.credit : 0;\n                        signedBalance = signedBalance - drAmount + crAmount;\n                    }\n                });\n\n                // Convert to Group nature sign\n                if (isAssetOrExpense) {\n                    return sum + signedBalance;\n                } else {\n                    return sum + (-signedBalance);\n                }\n            }, 0);\n\n            // Update ledgers for drill-down display\n            const updatedLedgers = groupLedgers.map(l => {\n                let signedBalance = (l.type === 'Dr' ? l.balance : -l.balance);\n                futureVouchers.forEach(v => {\n                    const row = v.rows.find((r: any) => r.account === l.name);\n                    if (row) {\n                        const drAmount = row.type === 'Dr' ? row.debit : 0;\n                        const crAmount = row.type === 'Cr' ? row.credit : 0;\n                        signedBalance = signedBalance - drAmount + crAmount;\n                    }\n                });\n\n                const finalBal = Math.abs(signedBalance);\n                const finalType = signedBalance >= 0 ? 'Dr' : 'Cr'; // Return generic Ledger object\n                return { ...l, balance: finalBal, type: finalType as 'Dr' | 'Cr' };\n            });\n\n            return {\n                groupName: group,\n                total,\n                ledgers: updatedLedgers\n            };\n        });\n    }\n\n    static getFinancialYearStart(date: Date | string): string {\n        let d: Date;\n        if (typeof date === 'string') {\n            const [y, m, day] = date.split('-').map(Number);\n            d = new Date(y, m - 1, day);\n        } else {\n            d = date;\n        }\n        const year = d.getMonth() >= 3 ? d.getFullYear() : d.getFullYear() - 1;\n        return `${year}-04-01`;\n    }\n\n    static calculateTotal(summaries: GroupSummary[]): number {\n        return summaries.reduce((sum, g) => sum + g.total, 0);\n    }\n\n    static getNetProfit(ledgers: Ledger[]): number {\n        const income = this.calculateTotal(this.getGroupSummary(ledgers, 'INCOME'));\n        const expenses = this.calculateTotal(this.getGroupSummary(ledgers, 'EXPENSES'));\n        return income - expenses;\n    }\n\n    static getNetProfitPeriod(ledgers: Ledger[], vouchers: any[], startDate: string | Date, endDate: string | Date, stockItems: StockItem[]): number {\n        const income = this.calculateTotal(this.getPeriodGroupSummary(ledgers, vouchers, startDate, endDate, 'INCOME'));\n        const expenses = this.calculateTotal(this.getPeriodGroupSummary(ledgers, vouchers, startDate, endDate, 'EXPENSES'));\n\n        // For Period P&L:\n        // Result = (Income + Closing Stock) - (Expenses + Opening Stock)\n        const closingStock = this.getClosingStockValue(stockItems, vouchers, endDate);\n        const openingStock = this.getClosingStockValue(stockItems, vouchers, startDate);\n\n        return (income + closingStock) - (expenses + openingStock);\n    }\n\n    static getNetProfitWithStock(ledgers: Ledger[], stockItems: StockItem[]): number {\n        const income = this.calculateTotal(this.getGroupSummary(ledgers, 'INCOME'));\n        const expenses = this.calculateTotal(this.getGroupSummary(ledgers, 'EXPENSES'));\n        const closingStock = this.getClosingStockValue(stockItems);\n        const openingStock = this.getOpeningStockValue(stockItems);\n\n        return (income + closingStock) - (expenses + openingStock);\n    }\n\n    static getClosingStockValue(stockItems: StockItem[], vouchers?: any[], asOnDate?: string | Date): number {\n        const end = asOnDate ? (asOnDate instanceof Date ? asOnDate.toISOString().split('T')[0] : asOnDate) : null;\n\n        return stockItems.reduce((sum, item) => {\n            let balance = item.currentBalance !== undefined ? item.currentBalance : item.openingStock;\n            const rate = item.currentRate !== undefined ? item.currentRate : item.openingRate;\n\n            // If asOnDate is provided, backtrack from current balance\n            if (end && vouchers) {\n                const futureVouchers = vouchers.filter(v => v.date > end);\n                futureVouchers.forEach(v => {\n                    v.rows.forEach((row: any) => {\n                        if (row.inventoryAllocations) {\n                            row.inventoryAllocations.forEach((alloc: any) => {\n                                if (alloc.itemId === item.id) {\n                                    const qtyChange = alloc.quantity;\n                                    if (v.type === 'Purchase') {\n                                        balance -= qtyChange;\n                                    } else if (v.type === 'Sales') {\n                                        balance += qtyChange;\n                                    }\n                                }\n                            });\n                        }\n                    });\n                });\n            }\n\n            return sum + (balance * rate);\n        }, 0);\n    }\n\n    static getOpeningStockValue(stockItems: StockItem[]): number {\n        return stockItems.reduce((sum, item) => {\n            return sum + (item.openingStock * item.openingRate);\n        }, 0);\n    }\n\n    static getTrialBalanceDiff(ledgers: Ledger[], vouchers?: any[], asOnDate?: string | Date): number {\n        if (!asOnDate || !vouchers) {\n            return ledgers.reduce((sum, l) => {\n                return sum + (l.type === 'Dr' ? l.balance : -l.balance);\n            }, 0);\n        }\n\n        return ledgers.reduce((sum, l) => {\n            const balance = this.getLedgerBalanceAsOn(l, vouchers, asOnDate);\n            return sum + balance;\n        }, 0);\n    }\n\n    static getGstSlabBreakdown(ledgers: Ledger[], vouchers: any[], startDate: string, endDate: string) {\n        // Simple logic for V1: Group Duties & Taxes ledgers that might be GST\n        const gstGroups = ['Duties & Taxes'];\n        const gstLedgers = ledgers.filter(l => gstGroups.includes(l.group));\n\n        return gstLedgers.map(l => {\n            const bal = this.getLedgerBalanceAsOn(l, vouchers, endDate) - this.getLedgerBalanceAsOn(l, vouchers, startDate);\n            return {\n                name: l.name,\n                impact: bal,\n                type: bal >= 0 ? 'Dr' : 'Cr'\n            };\n        });\n    }\n\n    static getNegativeBalanceLedgers(ledgers: Ledger[]) {\n        return ledgers.filter(l => {\n            // Cash & Bank should not be Cr\n            if (['Cash-in-hand', 'Bank Accounts'].includes(l.group) && l.type === 'Cr') return true;\n            // Debtors should not be Cr (usually)\n            if (['Sundry Debtors'].includes(l.group) && l.type === 'Cr') return true;\n            // Creditors should not be Dr (usually)\n            if (['Sundry Creditors'].includes(l.group) && l.type === 'Dr') return true;\n            return false;\n        });\n    }\n\n    static getLedgerBalanceAsOn(ledger: Ledger, vouchers: any[], asOnDate: Date | string): number {\n        const end = asOnDate instanceof Date ? asOnDate.toISOString().split('T')[0] : asOnDate;\n\n        // Start with signed current balance: Dr is positive, Cr is negative\n        let signedBalance = (ledger.type === 'Dr' ? ledger.balance : -ledger.balance);\n\n        // Filter vouchers strictly AFTER the as-on date (Future)\n        const futureVouchers = vouchers.filter(v => v.date > end);\n\n        // Reverse future transactions\n        futureVouchers.forEach(v => {\n            const row = v.rows.find((r: any) => r.account === ledger.name);\n            if (row) {\n                // Current = Previous + Dr - Cr\n                // Previous = Current - Dr + Cr\n                const drAmount = row.type === 'Dr' ? row.debit : 0;\n                const crAmount = row.type === 'Cr' ? row.credit : 0;\n                signedBalance = signedBalance - drAmount + crAmount;\n            }\n        });\n\n        // Return signed balance (Dr +, Cr -)\n        return signedBalance;\n    }\n}\n\nexport interface LedgerReportRow {\n    id: string;\n    date: string;\n    voucherNo: string;\n    voucherType: string;\n    particulars: string;\n    debit: number;\n    credit: number;\n    balance: number;\n    balanceType: 'Dr' | 'Cr';\n}\n\nexport interface LedgerReportData {\n    ledgerName: string;\n    openingBalance: number;\n    openingBalanceType: 'Dr' | 'Cr';\n    rows: LedgerReportRow[];\n    totalDebit: number;\n    totalCredit: number;\n    closingBalance: number;\n    closingBalanceType: 'Dr' | 'Cr';\n}\n\n// Need to import Voucher type here, but circular dependency risk if we import form VoucherService. \n// Ideally move shared types to a types.ts, but for now copying or using 'any' safely.\n// Actually, let's accept proper generic or define minimal interface.\ninterface SimpleVoucherRow {\n    account: string;\n    type: 'Dr' | 'Cr';\n    debit: number;\n    credit: number;\n}\ninterface SimpleVoucher {\n    id: string;\n    date: string;\n    voucherNo: string;\n    type: string;\n    rows: SimpleVoucherRow[];\n}\n\nexport class LedgerReportCalculator {\n    static getLedgerVouchers(\n        targetLedger: Ledger,\n        allVouchers: SimpleVoucher[],\n        startDate: Date,\n        endDate: Date\n    ): LedgerReportData {\n        // 1. Calculate Initial Opening Balance (from Ledger Master)\n        // Note: Ledger Master balance IS the current balance. We need back-calculation or store initial OB separately.\n        // Assuming 'ledger.balance' is CURRENT balance.\n        // Actually, in this system, 'ledger.balance' is updated live.\n        // So we can't easily retrieve \"Original Opening Balance\" from just the ledger object unless it's stored.\n        // However, standard pattern: \n        // Start with 0. \n        // Replay ALL vouchers from beginning of time? Expensive.\n        // Alternative: If we don't have historical snapshots, we might have to assume 'ledger.balance' is correct NOW, \n        // and work backwards? No, that's complex due to future dates.\n\n        // BETTER APPROACH for this context: \n        // This is a local-first small business app. Replaying all vouchers is fine for now.\n        // We need the 'Opening Balance' field from Ledger creation. \n        // Let's assume the 'ledger' object passed in has the CURRENT balance.\n        // Wait, does Ledger have an 'openingBalance' field? \n        // Looking at interface Ledger: id, name, balance, type... No explicit 'openingBalance'.\n        // If 'balance' is live, we are stuck.\n\n        // CRITICAL FIX: The Ledger interface definition in ReportService.ts doesn't show 'openingBalance'.\n        // BUT, usually accounting apps store `openingBalance` (master data) separate from `currentBalance`.\n        // Let's check `PersistenceContext` or `ledger` creation.\n        // If not, we have to assume the user started with 0 or the first voucher sets it?\n        // Let's assume valid accounting: There SHOULD be an Opening Balance voucher or field.\n\n        // FALLBACK STRATEGY: \n        // Calculate \"Balance as of StartDate\" by:\n        // 1. Taking Current Balance.\n        // 2. Subtracting all transactions AFTER StartDate? \n        //    Current = Opening + (Sum of All tx).\n        //    Balance_at_Start = Current - (Sum of Tx from Start to Now).\n        //    This works if 'Current' is truly accurate.\n\n        // Let's implement Back-Calculation from Current Balance.\n\n        const start = startDate instanceof Date ? startDate.toISOString().split('T')[0] : startDate;\n        const end = endDate instanceof Date ? endDate.toISOString().split('T')[0] : endDate;\n\n        // Filter vouchers for this ledger\n        const ledgerVouchers = allVouchers.filter(v => v.rows.some(r => r.account === targetLedger.name));\n\n        // Sort all vouchers by date ascending\n        ledgerVouchers.sort((a, b) => a.date.localeCompare(b.date));\n\n        let runningBalance = targetLedger.balance * (targetLedger.type === 'Dr' ? 1 : -1);\n\n        // Filter vouchers AFTER the End Date (Future relative to report)\n        const futureVouchers = ledgerVouchers.filter(v => v.date > end);\n\n        // Rewind future transactions to get Balance at End Date\n        futureVouchers.forEach(v => {\n            const row = v.rows.find(r => r.account === targetLedger.name);\n            if (row) {\n                // If Dr, it added to balance. So subtract.\n                // If Cr, it subtracted. So add.\n                const amount = (row.type === 'Dr' ? row.debit : -row.credit);\n                runningBalance -= amount;\n            }\n        });\n\n        const closingBalanceOfPeriod = runningBalance;\n        let runningBalanceWalk = closingBalanceOfPeriod;\n\n        // Now we are at Closing Balance of Period.\n        // We need to walk BACKWARDS through the Period to find Opening Balance.\n        const periodVouchers = ledgerVouchers.filter(v => v.date >= start && v.date <= end);\n\n        // Reversing period vouchers to walk back\n        [...periodVouchers].reverse().forEach(v => {\n            const row = v.rows.find(r => r.account === targetLedger.name);\n            if (row) {\n                const amount = (row.type === 'Dr' ? row.debit : -row.credit);\n                runningBalanceWalk -= amount;\n            }\n        });\n\n        const openingBalanceOfPeriod = runningBalanceWalk;\n\n        // Now Build the Report Forwards\n        const reportRows: LedgerReportRow[] = [];\n        let currentRun = openingBalanceOfPeriod;\n        let totalDebit = 0;\n        let totalCredit = 0;\n\n        periodVouchers.forEach(v => {\n            const row = v.rows.find(r => r.account === targetLedger.name);\n            if (!row) return;\n\n            // Find 'Particulars' (Contra account)\n            // Simple logic: First row that isn't this one.\n            const contraRow = v.rows.find(r => r.account !== targetLedger.name);\n            const particulars = contraRow ? contraRow.account : 'As per Details';\n\n            const debit = row.type === 'Dr' ? row.debit : 0;\n            const credit = row.type === 'Cr' ? row.credit : 0;\n\n            totalDebit += debit;\n            totalCredit += credit;\n\n            // Update Run\n            // Asset/Exp/Dr-Ledger: Dr increases, Cr decreases?\n            // Actually mathematically: Balance is signed.\n            // If we stick to Signed Balance:\n            // Dr is positive (+), Cr is negative (-).\n            const change = (row.type === 'Dr' ? debit : -credit);\n            currentRun += change;\n\n            reportRows.push({\n                id: v.id,\n                date: v.date,\n                voucherNo: v.voucherNo,\n                voucherType: v.type,\n                particulars,\n                debit,\n                credit,\n                balance: Math.abs(currentRun),\n                balanceType: currentRun >= 0 ? 'Dr' : 'Cr'\n            });\n        });\n\n        return {\n            ledgerName: targetLedger.name,\n            openingBalance: Math.abs(openingBalanceOfPeriod),\n            openingBalanceType: openingBalanceOfPeriod >= 0 ? 'Dr' : 'Cr',\n            rows: reportRows,\n            totalDebit,\n            totalCredit,\n            closingBalance: Math.abs(closingBalanceOfPeriod),\n            closingBalanceType: closingBalanceOfPeriod >= 0 ? 'Dr' : 'Cr'\n        };\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\accounting\\TaxService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\accounting\\VoucherService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\ai\\GeminiService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[268,271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[268,271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2295,2298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2295,2298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport type { Voucher } from \"../accounting/VoucherService\";\nimport type { Ledger } from \"../accounting/ReportService\";\n\nexport class GeminiService {\n    private genAI: GoogleGenerativeAI;\n    private model: any;\n\n    constructor(apiKey: string) {\n        this.genAI = new GoogleGenerativeAI(apiKey);\n        // Using 2.0-flash with v1beta version as it is the most stable for this model in early 2026\n        this.model = this.genAI.getGenerativeModel({ model: \"gemini-2.0-flash\" }, { apiVersion: \"v1beta\" });\n    }\n\n    async generateInsight(\n        question: string,\n        contextData: { vouchers: Voucher[], ledgers: Ledger[], companyName: string, symbol: string }\n    ): Promise<string> {\n        try {\n            // Simplify data for token efficiency\n            const voucherSummary = contextData.vouchers.slice(0, 50).map(v =>\n                `${v.date}: ${v.type} #${v.voucherNo} - ${v.narration || 'No narrative'} (${v.rows.map(r => `${r.account} ${r.type} ${r.debit || r.credit}`).join(', ')})`\n            ).join('\\n');\n\n            const ledgerSummary = contextData.ledgers.map(l =>\n                `${l.name} (${l.group}): ${contextData.symbol}${l.balance} ${l.type}`\n            ).join('\\n');\n\n            const prompt = `\nYou are MoneyArc AI, an expert financial assistant for the company \"${contextData.companyName}\".\nAnalyze the following financial data and answer the user's question with actionable insights.\n\nData Context:\n--- LEDGERS & BALANCES ---\n${ledgerSummary}\n\n--- RECENT TRANSACTIONS ---\n${voucherSummary}\n----------------\n\nUser Question: \"${question}\"\n\nSpecialized Knowledge:\n- Calculate Liquid Ratio (Bank+Cash+Debtors / Creditors+Taxes).\n- Analyze Net Margin (Net Profit / Total Sales).\n- Identify unusual spending patterns or cash flow crunches.\n\nGuidelines:\n- Be concise, professional, and data-driven.\n- Use currency format (${contextData.symbol}).\n- If data is insufficient for a specific request, suggest what needs to be recorded.\n- Highlight key trends and provide advice for financial health.\n            `;\n\n            const result = await this.model.generateContent(prompt);\n            const response = await result.response;\n            return response.text();\n\n        } catch (error: any) {\n            console.error(\"Gemini API Error Detail:\", error);\n            let userMessage = error.message || \"AI Advisor is temporarily unavailable.\";\n\n            if (error.message?.includes(\"API key\") || error.message?.includes(\"leaked\") || error.message?.includes(\"400\")) {\n                userMessage = \"API Key is leaked, blocked, or invalid. Please generate a fresh key in Settings.\";\n            } else if (error.message?.includes(\"model not found\") || error.message?.includes(\"404\")) {\n                userMessage = \"Model not found. Try switching to a newer model or check regional availability.\";\n            } else if (error.message?.includes(\"safety\")) {\n                userMessage = \"Insight blocked by safety filters.\";\n            } else if (error.message?.includes(\"quota\")) {\n                userMessage = \"API Quota exceeded. Please try again later.\";\n            }\n\n            return `[AI Error] ${userMessage}`;\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\inventory\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\localization\\LocalizationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\notifications\\NotificationContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":58,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":58,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, type ReactNode } from 'react';\r\n\r\ninterface Notification {\r\n    id: string;\r\n    title: string;\r\n    message: string;\r\n    type: 'info' | 'success' | 'warning' | 'error';\r\n    timestamp: Date;\r\n    read: boolean;\r\n}\r\n\r\ninterface NotificationContextType {\r\n    notifications: Notification[];\r\n    hasUnread: boolean;\r\n    addNotification: (notification: Omit<Notification, 'id' | 'timestamp' | 'read'>) => void;\r\n    markAsRead: (id: string) => void;\r\n    clearAll: () => void;\r\n}\r\n\r\nconst NotificationContext = createContext<NotificationContextType | null>(null);\r\n\r\nexport function NotificationProvider({ children }: { children: ReactNode }) {\r\n    const [notifications, setNotifications] = useState<Notification[]>([]);\r\n\r\n    const hasUnread = notifications.some(n => !n.read);\r\n\r\n    const addNotification = (n: Omit<Notification, 'id' | 'timestamp' | 'read'>) => {\r\n        const newNotification: Notification = {\r\n            ...n,\r\n            id: Math.random().toString(36).substring(7),\r\n            timestamp: new Date(),\r\n            read: false,\r\n        };\r\n        setNotifications(prev => [newNotification, ...prev]);\r\n    };\r\n\r\n    const markAsRead = (id: string) => {\r\n        setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n));\r\n    };\r\n\r\n    const clearAll = () => {\r\n        setNotifications([]);\r\n    };\r\n\r\n    return (\r\n        <NotificationContext.Provider value={{\r\n            notifications,\r\n            hasUnread,\r\n            addNotification,\r\n            markAsRead,\r\n            clearAll\r\n        }}>\r\n            {children}\r\n        </NotificationContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useNotifications() {\r\n    const context = useContext(NotificationContext);\r\n    if (!context) {\r\n        throw new Error('useNotifications must be used within a NotificationProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\persistence\\FileSystemProvider.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":50,"column":21,"severity":1,"nodeType":null,"fix":{"range":[1857,1919],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[769,772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[769,772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2108,2111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2108,2111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4181,4184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4181,4184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":209,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8647,8650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8647,8650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10166,10169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10166,10169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { get, set, keys, del } from 'idb-keyval';\nimport type { StorageProvider, Company } from './types';\n\nconst HANDLE_KEY = 'moneyarc_dir_handle';\nconst VIRTUAL_FS_PREFIX = 'moneyarc_vfs_';\n\nexport class FileSystemProvider implements StorageProvider {\n    private dirHandle: FileSystemDirectoryHandle | null = null;\n    private isVirtual = false;\n    public readonly: boolean = false;\n\n    public get isReady(): boolean {\n        return this.dirHandle !== null || this.isVirtual;\n    }\n\n    async init(): Promise<void> {\n        try {\n            if ('showDirectoryPicker' in window) {\n                // Desktop: Try Native File System\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                this.dirHandle = await (window as any).showDirectoryPicker({\n                    mode: 'readwrite',\n                    startIn: 'documents',\n                });\n\n                // Persist the handle for next session\n                if (this.dirHandle) {\n                    await set(HANDLE_KEY, this.dirHandle);\n                    this.isVirtual = false;\n                }\n            } else {\n                // Mobile/Unsupported: Use Virtual File System (IDB)\n                console.warn(\"File System Access API not supported. Using Virtual File System (IndexedDB).\");\n                this.isVirtual = true;\n            }\n        } catch (err) {\n            if ((err as Error).name !== 'AbortError') {\n                console.error('Error selecting directory:', err);\n                throw err;\n            }\n        }\n    }\n\n    async restore(): Promise<boolean> {\n        try {\n            if ('showDirectoryPicker' in window) {\n                const savedHandle = await get<FileSystemDirectoryHandle>(HANDLE_KEY);\n                if (savedHandle) {\n                    // Verify permissions\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    const options = { mode: 'readwrite' };\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    if (await (savedHandle as any).queryPermission(options) === 'granted') {\n                        this.dirHandle = savedHandle;\n                        this.isVirtual = false;\n                        return true;\n                    }\n                }\n            } else {\n                // Mobile: Always \"persisted\" as it uses IDB\n                this.isVirtual = true;\n                return true;\n            }\n        } catch (err) {\n            console.warn('Failed to restore directory handle:', err);\n        }\n        return false;\n    }\n\n    async listCompanies(): Promise<Company[]> {\n        if (!this.isReady) throw new Error('Storage not initialized');\n        const companies: Company[] = [];\n\n        if (this.isVirtual) {\n            console.log('FileSystemProvider: Listing companies from Virtual FS');\n            // Virtual FS: Scan IDB keys for company.json files\n            // Format: moneyarc_vfs_{companyPath}_company.json\n            const allKeys = await keys();\n            console.log('FileSystemProvider: Found IDB keys:', allKeys);\n            for (const key of allKeys) {\n                if (typeof key === 'string' && key.startsWith(VIRTUAL_FS_PREFIX) && key.endsWith('company.json')) {\n                    try {\n                        const data = await get(key);\n                        if (data) {\n                            // Extract path from key: moneyarc_vfs_path_to_company_company.json\n                            // But simpler: store path in the object itself\n                            const company = typeof data === 'string' ? JSON.parse(data) : data;\n                            companies.push(company);\n                        }\n                    } catch (e) {\n                        console.error('Failed to parse virtual company', e);\n                    }\n                }\n            }\n            console.log('FileSystemProvider: Parsed companies:', companies);\n        } else {\n            // Native FS\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            for await (const entry of (this.dirHandle as any).values()) {\n                if (entry.kind === 'directory') {\n                    try {\n                        const compFile = await entry.getFileHandle('company.json');\n                        const file = await compFile.getFile();\n                        const text = await file.text();\n                        const data = JSON.parse(text);\n                        companies.push({\n                            ...data,\n                            path: entry.name\n                        });\n                    } catch {\n                        // Skip\n                    }\n                }\n            }\n        }\n        return companies;\n    }\n\n    async createCompany(data: Omit<Company, 'id' | 'path'>): Promise<Company> {\n        if (!this.isReady) throw new Error('Storage not initialized');\n\n        const id = Math.random().toString(36).substr(2, 9);\n        const folderName = `${data.name.replace(/\\s+/g, '_')}_${id}`;\n\n        const companyData: Company = {\n            id,\n            ...data,\n            path: folderName\n        };\n\n        if (this.isVirtual) {\n            console.log('FileSystemProvider: Creating company in Virtual FS:', companyData);\n            // Virtual FS: Write to IDB\n            const key = `${VIRTUAL_FS_PREFIX}${folderName}_company.json`;\n            await set(key, JSON.stringify(companyData, null, 2));\n            console.log('FileSystemProvider: Company saved to IDB key:', key);\n        } else {\n            // Native FS\n            if (!this.dirHandle) throw new Error(\"Native handle missing\");\n            const companyDir = await this.dirHandle.getDirectoryHandle(folderName, { create: true });\n            const compFile = await companyDir.getFileHandle('company.json', { create: true });\n            const writable = await compFile.createWritable();\n            await writable.write(JSON.stringify(companyData, null, 2));\n            await writable.close();\n        }\n\n        return companyData;\n    }\n\n    async updateCompany(id: string, path: string, data: Partial<Omit<Company, 'id' | 'path'>>): Promise<Company> {\n        if (!this.isReady) throw new Error('Storage not initialized');\n\n        // Read existing first to merge\n        let existingData: Company;\n\n        if (this.isVirtual) {\n            const key = `${VIRTUAL_FS_PREFIX}${path}_company.json`;\n            const content = await get(key);\n            existingData = typeof content === 'string' ? JSON.parse(content) : content;\n        } else {\n            if (!this.dirHandle) throw new Error(\"Native handle missing\");\n            const companyDir = await this.dirHandle.getDirectoryHandle(path);\n            const compFile = await companyDir.getFileHandle('company.json');\n            const file = await compFile.getFile();\n            const text = await file.text();\n            existingData = JSON.parse(text);\n        }\n\n        const updatedData: Company = {\n            ...existingData,\n            ...data,\n            id,\n            path\n        };\n\n        if (this.isVirtual) {\n            const key = `${VIRTUAL_FS_PREFIX}${path}_company.json`;\n            await set(key, JSON.stringify(updatedData, null, 2));\n        } else {\n            // Native Write\n            if (!this.dirHandle) throw new Error(\"Native handle missing\");\n            const companyDir = await this.dirHandle.getDirectoryHandle(path);\n            const compFile = await companyDir.getFileHandle('company.json', { create: true });\n            const writable = await compFile.createWritable();\n            await writable.write(JSON.stringify(updatedData, null, 2));\n            await writable.close();\n        }\n\n        return updatedData;\n    }\n\n    async deleteCompany(_id: string, path: string): Promise<void> {\n        if (!this.isReady) throw new Error('Storage not initialized');\n\n        if (this.isVirtual) {\n            console.log('FileSystemProvider: Deleting company from Virtual FS:', path);\n            const allKeys = await keys();\n            const prefix = `${VIRTUAL_FS_PREFIX}${path}`;\n            for (const key of allKeys) {\n                if (typeof key === 'string' && key.startsWith(prefix)) {\n                    await del(key);\n                }\n            }\n        } else {\n            // Native FS\n            if (!this.dirHandle) throw new Error(\"Native handle missing\");\n            try {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                await (this.dirHandle as any).removeEntry(path, { recursive: true });\n            } catch (err) {\n                console.error('Error deleting company directory:', err);\n                throw err;\n            }\n        }\n    }\n\n    async read<T>(filename: string, companyPath?: string): Promise<T | null> {\n        if (!this.isReady) throw new Error('Storage not initialized');\n\n        if (this.isVirtual) {\n            // Virtual FS key: prefix + companyPath + filename\n            // If companyPath is missing (root file?), handling might differ, but app mostly reads company data\n            const key = `${VIRTUAL_FS_PREFIX}${companyPath ? companyPath + '_' : ''}${filename}`;\n            const data = await get(key);\n            if (!data) return null;\n            return typeof data === 'string' ? JSON.parse(data) : data as T;\n        } else {\n            // Native FS\n            try {\n                if (!this.dirHandle) throw new Error(\"Native handle missing\");\n                let targetDir = this.dirHandle;\n                if (companyPath) {\n                    targetDir = await this.dirHandle.getDirectoryHandle(companyPath);\n                }\n\n                const fileHandle = await targetDir.getFileHandle(filename, { create: false });\n                const file = await fileHandle.getFile();\n                const text = await file.text();\n                return JSON.parse(text) as T;\n            } catch (err) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                if ((err as any).name === 'NotFoundError') {\n                    return null;\n                }\n                throw err;\n            }\n        }\n    }\n\n    async write<T>(filename: string, data: T, companyPath?: string): Promise<void> {\n        if (!this.isReady) throw new Error('Storage not initialized');\n\n        if (this.isVirtual) {\n            const key = `${VIRTUAL_FS_PREFIX}${companyPath ? companyPath + '_' : ''}${filename}`;\n            await set(key, JSON.stringify(data, null, 2));\n        } else {\n            // Native FS\n            try {\n                if (!this.dirHandle) throw new Error(\"Native handle missing\");\n                let targetDir = this.dirHandle;\n                if (companyPath) {\n                    targetDir = await this.dirHandle.getDirectoryHandle(companyPath, { create: true });\n                }\n\n                const fileHandle = await targetDir.getFileHandle(filename, { create: true });\n                const writable = await fileHandle.createWritable();\n                await writable.write(JSON.stringify(data, null, 2));\n                await writable.close();\n            } catch (err) {\n                console.error('Error writing file:', err);\n                throw err;\n            }\n        }\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\persistence\\GitHubProvider.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_data' is defined but never used.","line":93,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_id' is defined but never used.","line":97,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_path' is defined but never used.","line":97,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_data' is defined but never used.","line":97,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_id' is defined but never used.","line":101,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_path' is defined but never used.","line":101,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_filename' is defined but never used.","line":120,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_data' is defined but never used.","line":120,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_companyPath' is defined but never used.","line":120,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":61}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { get, set } from 'idb-keyval';\nimport type { StorageProvider, Company } from './types';\n\nconst GH_CONFIG_KEY = 'moneyarc_github_config';\n\ninterface GitHubConfig {\n    owner: string;\n    repo: string;\n    branch: string;\n    path: string; // Base path in the repo\n}\n\nexport class GitHubProvider implements StorageProvider {\n    private config: GitHubConfig | null = null;\n    public readonly: boolean = true;\n\n    public get isReady(): boolean {\n        return this.config !== null;\n    }\n\n    async init(initialConfig?: GitHubConfig): Promise<void> {\n        if (initialConfig) {\n            this.config = initialConfig;\n            await set(GH_CONFIG_KEY, initialConfig);\n        } else {\n            // This is usually called from UI which already collected config\n            const saved = await get<GitHubConfig>(GH_CONFIG_KEY);\n            if (saved) {\n                this.config = saved;\n            } else {\n                throw new Error('GitHub configuration missing');\n            }\n        }\n    }\n\n    async restore(): Promise<boolean> {\n        const saved = await get<GitHubConfig>(GH_CONFIG_KEY);\n        if (saved) {\n            this.config = saved;\n            return true;\n        }\n        return false;\n    }\n\n    private getRawUrl(filename: string, companyPath?: string): string {\n        if (!this.config) throw new Error('GitHub provider not initialized');\n        const { owner, repo, branch, path } = this.config;\n        const fullPath = [path, companyPath, filename].filter(Boolean).join('/');\n        return `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${fullPath}`;\n    }\n\n    async listCompanies(): Promise<Company[]> {\n        if (!this.config) throw new Error('GitHub provider not initialized');\n\n        // This is tricky because we can't easily list directories via raw github URL\n        // We might need to use the GitHub API if listing is required.\n        // For now, let's assume we fetch a 'companies_index.json' or use API.\n\n        // Let's use the GitHub API to list directories if possible, \n        // but raw urls are better for data.\n        // For 'listCompanies', we use the API:\n        const { owner, repo, branch, path } = this.config;\n        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;\n\n        try {\n            const resp = await fetch(apiUrl);\n            if (!resp.ok) throw new Error('Failed to fetch repository contents');\n            const contents = await resp.json();\n\n            const companies: Company[] = [];\n            for (const item of contents) {\n                if (item.type === 'dir') {\n                    try {\n                        const companyData = await this.read<Company>('company.json', item.name);\n                        if (companyData) {\n                            companies.push({\n                                ...companyData,\n                                path: item.name\n                            });\n                        }\n                    } catch (e) {\n                        console.warn(`Failed to read company at ${item.name}`, e);\n                    }\n                }\n            }\n            return companies;\n        } catch (e) {\n            console.error('Error listing companies from GitHub:', e);\n            return [];\n        }\n    }\n\n    async createCompany(_data: Omit<Company, 'id' | 'path'>): Promise<Company> {\n        throw new Error('Writing to GitHub is not supported in this version. Use local storage for full features.');\n    }\n\n    async updateCompany(_id: string, _path: string, _data: Partial<Omit<Company, 'id' | 'path'>>): Promise<Company> {\n        throw new Error('Writing to GitHub is not supported.');\n    }\n\n    async deleteCompany(_id: string, _path: string): Promise<void> {\n        throw new Error('Writing to GitHub is not supported.');\n    }\n\n    async read<T>(filename: string, companyPath?: string): Promise<T | null> {\n        const url = this.getRawUrl(filename, companyPath);\n        try {\n            const resp = await fetch(url, { cache: 'no-store' });\n            if (!resp.ok) {\n                if (resp.status === 404) return null;\n                throw new Error(`Failed to fetch ${filename}: ${resp.statusText}`);\n            }\n            return await resp.json() as T;\n        } catch (e) {\n            console.error(`Error reading ${filename} from GitHub:`, e);\n            return null;\n        }\n    }\n\n    async write<T>(_filename: string, _data: T, _companyPath?: string): Promise<void> {\n        throw new Error('GitHub provider is read-only. Export your data manually if needed.');\n    }\n\n    async sync(): Promise<void> {\n        // Since we use no-store by default, every read is already a \"sync\".\n        // But we provide this method to allow explicit refresh and UI feedback.\n        await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate work\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\persistence\\LocalStorageProvider.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\persistence\\PersistenceContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[658,661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[658,661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4199,4202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4199,4202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":172,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":172,"endColumn":31}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect, type ReactNode } from 'react';\r\nimport type { StorageProvider, StorageType, Company } from './types';\r\nimport { FileSystemProvider } from './FileSystemProvider';\r\nimport { GitHubProvider } from './GitHubProvider';\r\nimport { LedgerService } from '../accounting/LedgerService';\r\nimport { useNotifications } from '../notifications/NotificationContext';\r\n\r\ninterface PersistenceContextType {\r\n    provider: StorageProvider | null;\r\n    storageType: StorageType;\r\n    activeCompany: Company | null;\r\n    isSyncing: boolean;\r\n    isInitialized: boolean;\r\n    initializeStorage: (type: StorageType, config?: any) => Promise<void>;\r\n    restoreStorage: () => Promise<boolean>;\r\n    selectCompany: (company: Company | null) => Promise<void>;\r\n    sync: () => Promise<void>;\r\n}\r\n\r\nconst PersistenceContext = createContext<PersistenceContextType | null>(null);\r\n\r\nexport function PersistenceProvider({ children }: { children: ReactNode }) {\r\n    const [provider, setProvider] = useState<StorageProvider | null>(null);\r\n    const [storageType, setStorageType] = useState<StorageType>(null);\r\n    const [activeCompany, setActiveCompany] = useState<Company | null>(null);\r\n    const [isSyncing, setIsSyncing] = useState(false);\r\n    const [isInitialized, setIsInitialized] = useState(false);\r\n    const { addNotification } = useNotifications();\r\n\r\n    const restoreStorage = async () => {\r\n        console.log('[Persistence] Starting restoration sequence...');\r\n        setIsInitialized(false);\r\n        try {\r\n            // Priority 1: Check Local Storage/IDB\r\n            const localProvider = new FileSystemProvider();\r\n            const restored = await localProvider.restore?.();\r\n\r\n            if (restored) {\r\n                console.log('[Persistence] Local storage handle restored.');\r\n                setProvider(localProvider);\r\n                setStorageType('local');\r\n\r\n                const savedCompany = localStorage.getItem('moneyarc_active_company');\r\n                if (savedCompany) {\r\n                    try {\r\n                        const company: Company = JSON.parse(savedCompany);\r\n                        setActiveCompany(company);\r\n                        console.log('[Persistence] Restored active company:', company.name);\r\n\r\n                        // Run sanity check in background\r\n                        LedgerService.ensureDataSanity(localProvider, company).catch(err => {\r\n                            console.error('[Persistence] Sanity check failed:', err);\r\n                        });\r\n                    } catch (e) {\r\n                        console.error('[Persistence] Failed to parse saved company', e);\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n\r\n            // Priority 2: Check Cloud (GitHub)\r\n            const githubProvider = new GitHubProvider();\r\n            const ghRestored = await githubProvider.restore?.();\r\n            if (ghRestored) {\r\n                console.log('[Persistence] GitHub storage restored.');\r\n                setProvider(githubProvider);\r\n                setStorageType('github');\r\n\r\n                const savedCompany = localStorage.getItem('moneyarc_active_company');\r\n                if (savedCompany) {\r\n                    try {\r\n                        const company: Company = JSON.parse(savedCompany);\r\n                        setActiveCompany(company);\r\n                        LedgerService.ensureDataSanity(githubProvider, company).catch(e => console.error(e));\r\n                    } catch (e) {\r\n                        console.error(e);\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n        } catch (error) {\r\n            console.error('[Persistence] Critical error during storage restoration:', error);\r\n        } finally {\r\n            console.log('[Persistence] Initialization complete (isInitialized set to true).');\r\n            setIsInitialized(true);\r\n        }\r\n        return false;\r\n    };\r\n\r\n    // Try to restore storage on mount\r\n    useEffect(() => {\r\n        restoreStorage();\r\n    }, []);\r\n\r\n    const initializeStorage = async (type: StorageType, config?: any) => {\r\n        let newProvider: StorageProvider | null = null;\r\n        if (type === 'local' || type === 'browser') {\r\n            console.log(`[Persistence] Initializing ${type} storage...`);\r\n            newProvider = new FileSystemProvider();\r\n        } else if (type === 'github') {\r\n            console.log('[Persistence] Initializing GitHub storage...');\r\n            newProvider = new GitHubProvider();\r\n        }\r\n\r\n        if (newProvider) {\r\n            try {\r\n                await newProvider.init(config);\r\n                if (newProvider.isReady) {\r\n                    console.log(`[Persistence] ${type} storage provider is ready.`);\r\n                    setProvider(newProvider);\r\n                    setStorageType(type);\r\n                } else {\r\n                    console.error(`[Persistence] ${type} storage provider initialized but not ready.`);\r\n                }\r\n            } catch (err) {\r\n                console.error(`[Persistence] Failed to initialize ${type} storage:`, err);\r\n                throw err;\r\n            }\r\n        }\r\n    };\r\n\r\n    const selectCompany = async (company: Company | null) => {\r\n        setActiveCompany(company);\r\n        if (company) {\r\n            localStorage.setItem('moneyarc_active_company', JSON.stringify(company));\r\n            if (provider) {\r\n                await LedgerService.ensureDataSanity(provider, company);\r\n            }\r\n        } else {\r\n            localStorage.removeItem('moneyarc_active_company');\r\n        }\r\n    };\r\n\r\n    const sync = async () => {\r\n        if (!provider || !provider.sync) return;\r\n        setIsSyncing(true);\r\n        try {\r\n            await provider.sync();\r\n            addNotification({\r\n                title: 'Data Synced',\r\n                message: 'Successfully updated from GitHub',\r\n                type: 'success'\r\n            });\r\n        } catch (e) {\r\n            addNotification({\r\n                title: 'Sync Failed',\r\n                message: (e as Error).message,\r\n                type: 'error'\r\n            });\r\n        } finally {\r\n            setIsSyncing(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <PersistenceContext.Provider value={{\r\n            provider,\r\n            storageType,\r\n            activeCompany,\r\n            isSyncing,\r\n            isInitialized,\r\n            initializeStorage,\r\n            restoreStorage,\r\n            selectCompany,\r\n            sync\r\n        }}>\r\n            {children}\r\n        </PersistenceContext.Provider>\r\n    );\r\n}\r\n\r\nexport function usePersistence() {\r\n    const context = useContext(PersistenceContext);\r\n    if (!context) {\r\n        throw new Error('usePersistence must be used within a PersistenceProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\persistence\\types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[738,741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[738,741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface Company {\n    id: string;\n    name: string;\n    financialYear: string;\n    path: string; // Folder name or ID in storage\n    gstin?: string;\n    address?: string;\n    state?: string;\n    country: string;\n    phone?: string;\n    email?: string;\n    website?: string;\n    currency: string;\n    symbol: string;\n    registrationType?: 'Regular' | 'Composition' | 'Unregistered';\n    businessType?: 'General' | 'Hotel' | 'Automobile' | 'Textiles' | 'Restaurant' | 'School' | 'Hospital' | 'Retail' | 'Manufacturing' | 'Service' | 'RealEstate' | 'Technology' | 'Logistics' | 'Agriculture';\n}\n\nexport interface StorageProvider {\n    /**\n     * Initialize the storage (e.g., prompt for directory handle)\n     */\n    init(config?: any): Promise<void>;\n\n    /**\n     * List all companies in the storage\n     */\n    listCompanies(): Promise<Company[]>;\n\n    /**\n     * Create a new company\n     */\n    createCompany(data: Omit<Company, 'id' | 'path'>): Promise<Company>;\n\n    /**\n     * Update an existing company\n     */\n    updateCompany(id: string, path: string, data: Partial<Omit<Company, 'id' | 'path'>>): Promise<Company>;\n\n    /**\n     * Delete an existing company\n     */\n    deleteCompany(id: string, path: string): Promise<void>;\n\n    /**\n     * Read a file and return its content as JSON\n     */\n    read<T>(filename: string, companyPath?: string): Promise<T | null>;\n\n    /**\n     * Write data to a file\n     */\n    write<T>(filename: string, data: T, companyPath?: string): Promise<void>;\n\n    /**\n     * Optional sync method for remote providers\n     */\n    sync?(): Promise<void>;\n\n    /**\n     * Check if storage is ready\n     */\n    isReady: boolean;\n    readonly: boolean;\n}\n\nexport type StorageType = 'local' | 'cloud' | 'browser' | 'github' | null;\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\reports\\ExportService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":127,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":130,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[311,314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[311,314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2020,2023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2020,2023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2624,2627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2624,2627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { jsPDF } from 'jspdf';\nimport autoTable from 'jspdf-autotable';\nimport * as XLSX from 'xlsx';\nimport type { Company } from '../persistence/types';\n\nexport class ExportService {\n    static exportToPDF(title: string, columns: string[], rows: (string | number)[][], company: Company | null, columnStyles?: any) {\n        // ... existing PDF logic ...\n        const doc = new jsPDF();\n        const timestamp = new Date().toLocaleString();\n\n        // Add Header\n        doc.setFontSize(22);\n        doc.setTextColor(15, 23, 42); // slate-900\n        doc.text(\"MoneyArc\", 14, 20);\n\n        // ... (lines 17-38 remain same, omitted for brevity in thought, but must be careful in replacement)\n        // actually I will just replace the function signature and the autoTable call\n\n        doc.setFontSize(10);\n        doc.setTextColor(100, 116, 139); // slate-500\n        doc.text(\"Professional Accounting Suite\", 14, 26);\n\n        // Company Details\n        if (company) {\n            doc.setFontSize(12);\n            doc.setTextColor(15, 23, 42);\n            doc.text(company.name, 14, 40);\n            doc.setFontSize(9);\n            doc.setTextColor(100, 116, 139);\n            doc.text(`${company.address || 'Address not set'} | GST: ${company.gstin || 'No GSTIN'}`, 14, 45);\n        }\n\n        // Report Title\n        doc.setFontSize(16);\n        doc.setTextColor(14, 165, 233); // cyan-500\n        doc.text(title.toUpperCase(), 14, 60);\n\n        doc.setFontSize(9);\n        doc.setTextColor(100, 116, 139);\n        doc.text(`Generated on: ${timestamp}`, 14, 65);\n\n        // Table\n        autoTable(doc, {\n            startY: 75,\n            head: [columns],\n            body: rows,\n            theme: 'striped',\n            headStyles: { fillColor: [15, 23, 42], fontStyle: 'bold' },\n            styles: { fontSize: 8, cellPadding: 3 },\n            columnStyles: columnStyles || {},\n            alternateRowStyles: { fillColor: [248, 250, 252] }\n        });\n\n        // Footer\n        const pageCount = (doc as any).internal.getNumberOfPages();\n        for (let i = 1; i <= pageCount; i++) {\n            doc.setPage(i);\n            doc.setFontSize(8);\n            doc.setTextColor(148, 163, 184);\n            doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.getWidth() - 30, doc.internal.pageSize.getHeight() - 10);\n            doc.text(\"MoneyArc - Accurate. Secure. Professional.\", 14, doc.internal.pageSize.getHeight() - 10);\n        }\n\n        doc.save(`${title.toLowerCase().replace(/\\s+/g, '_')}_${new Date().getTime()}.pdf`);\n    }\n\n    static exportToExcel(title: string, columns: string[], rows: any[][]) {\n        const worksheetData = [columns, ...rows];\n        const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);\n        const workbook = XLSX.utils.book_new();\n        XLSX.utils.book_append_sheet(workbook, worksheet, title);\n\n        XLSX.writeFile(workbook, `${title.toLowerCase().replace(/\\s+/g, '_')}_${new Date().getTime()}.xlsx`);\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\src\\services\\security\\AuditService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":45,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { StorageProvider } from '../persistence/types';\n\nexport interface AuditLog {\n    id: string;\n    timestamp: string;\n    userId: string;\n    action: 'CREATE' | 'UPDATE' | 'DELETE';\n    entityType: 'VOUCHER' | 'LEDGER' | 'STOCK_ITEM';\n    entityId: string;\n    details: string; // e.g. \"Voucher Sales #101 created\"\n    changes?: Record<string, { old: unknown, new: unknown }>;\n}\n\nexport class AuditService {\n    private static _currentUser: { name: string; id: string } | null = null;\n\n    static setCurrentUser(user: { name: string; id: string } | null) {\n        this._currentUser = user;\n    }\n\n    static getCurrentUser() {\n        return this._currentUser;\n    }\n\n    static async log(\n        provider: StorageProvider,\n        companyPath: string,\n        log: Omit<AuditLog, 'id' | 'timestamp' | 'userId'> & { userId?: string }\n    ) {\n        try {\n            const logs = await provider.read<AuditLog[]>('audit_logs.json', companyPath) || [];\n            let userName = this._currentUser?.name;\n\n            // Fallback: Try to recover user from localStorage if memory state is lost\n            if (!userName && typeof window !== 'undefined' && window.localStorage) {\n                try {\n                    const savedUser = localStorage.getItem('moneyarc_auth_user');\n                    if (savedUser) {\n                        const parsed = JSON.parse(savedUser);\n                        if (parsed?.name) {\n                            userName = parsed.name;\n                            this._currentUser = parsed; // Restore memory state\n                        }\n                    }\n                } catch (e) {\n                    // Ignore storage errors\n                }\n            }\n\n            const newLog: AuditLog = {\n                userId: userName || 'SYSTEM', // Use current logged in user name or fallback\n                ...log,\n                id: Date.now().toString(),\n                timestamp: new Date().toISOString()\n            };\n            logs.unshift(newLog); // Newest first\n            // Keep only last 1000 logs for performance\n            await provider.write('audit_logs.json', logs.slice(0, 1000), companyPath);\n        } catch (error) {\n            console.error(\"Failed to write audit log\", error);\n        }\n    }\n\n    static async getLogs(provider: StorageProvider, companyPath: string): Promise<AuditLog[]> {\n        return await provider.read<AuditLog[]>('audit_logs.json', companyPath) || [];\n    }\n\n    static async updateAllLogsToUser(provider: StorageProvider, companyPath: string, userName: string) {\n        const logs = await this.getLogs(provider, companyPath);\n        const updatedLogs = logs.map(log => {\n            // Only claim logs that are unattributed\n            if (log.userId === 'SYSTEM' || log.userId === 'System' || !log.userId || log.userId === 'Unknown') {\n                return { ...log, userId: userName };\n            }\n            return log;\n        });\n        await provider.write('audit_logs.json', updatedLogs, companyPath);\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\test_gemini.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"M:\\Projects\\MoneyArc-main\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]